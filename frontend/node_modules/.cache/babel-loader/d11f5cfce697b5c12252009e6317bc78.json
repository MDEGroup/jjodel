{"ast":null,"code":"import{LGraphElement,Log,RuntimeAccessibleClass,transientProperties,U,windoww}from'../../joiner';import React,{PureComponent}from'react';import{connect}from'react-redux';import'./style.scss';// <-- tenuto per retro-compatibilità ma dovrebbe sparire\nimport'./editors.scss';// <-- stile comune a tutte le tab editor (idealmente da tenere leggero)\nimport'./console.scss';// <-- stile di questa tab\nimport ReactDOM from\"react-dom\";import{Empty}from\"./Empty\";import{Tooltip}from\"../forEndUser/Tooltip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const Convert=require('ansi-to-html');let ansiConvert=window.ansiConvert;if(!ansiConvert)window.ansiconvert=ansiConvert=new Convert();class ThisState{constructor(){this.expression='';this.output=null;this.expressionIndex=0;this.expressionHistory=[''];this.initialState=true;this.time=0;}}// trasformato in class component così puoi usare il this nella console. e non usa accidentalmente window come contesto\nlet hiddenkeys=[\"jsxString\",\"pointedBy\",\"clonedCounter\",\"parent\",\"_subMaps\",\"inspect\",\"__random\",'__serialize'];function fixproxy(output){var _output;let addDKeys=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;let addLKeys=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;let ret={output};if(!output)return ret;let proxy;if((_output=output)===null||_output===void 0?void 0:_output.__isProxy){proxy=output;output=output.__raw;//Object.fromEntries(Object.getOwnPropertyNames(p).map(k => [k, p[k]]));\n}else proxy=undefined;console.log('console short in 1',{output,proxy,ret,addLKeys,iff:addLKeys&&proxy});switch(typeof output){case\"function\":{let fdata=U.buildFunctionDocumentation(output);return{output:fdata};}default:return ret;case\"object\":// if (Array.isArray(output)) { ret.output = output; break; /* no need to go inside, it is already done at render phase */ }\nret.output=output={...output};// if (ret.output.anchors) ret.output.anchors = JSON.stringify(ret.output.anchors);\nif(addLKeys&&proxy){var _RuntimeAccessibleCla,_RuntimeAccessibleCla2,_output2,_output3,_RuntimeAccessibleCla3,_output4;let Lsingleton=((_RuntimeAccessibleCla=RuntimeAccessibleClass.get((_output2=output)===null||_output2===void 0?void 0:_output2.className))===null||_RuntimeAccessibleCla===void 0?void 0:(_RuntimeAccessibleCla2=_RuntimeAccessibleCla.logic)===null||_RuntimeAccessibleCla2===void 0?void 0:_RuntimeAccessibleCla2.singleton)||{};let comments={};ret.shortcuts={...Lsingleton};console.log('console short in 2',{output,rett:{...ret,shortt:{...(ret.shortcuts||{})}},Lsingleton,DClass:RuntimeAccessibleClass.get((_output3=output)===null||_output3===void 0?void 0:_output3.className),LClass:(_RuntimeAccessibleCla3=RuntimeAccessibleClass.get((_output4=output)===null||_output4===void 0?void 0:_output4.className))===null||_RuntimeAccessibleCla3===void 0?void 0:_RuntimeAccessibleCla3.logic});ret.comments=comments;for(let key in output){if(Lsingleton[\"__info_of__\"+key])comments[key]=Lsingleton[\"__info_of__\"+key];}for(let key in Lsingleton){if(key in output||key.indexOf(\"__info_of__\")===0){delete ret.shortcuts[key];continue;}else{if(ret.shortcuts[key]===undefined)ret.shortcuts[key]='';}if(key.indexOf(\"info\")>=0&&key.indexOf(\"of\")>=0){Log.eDevv('Possible error on __info_of__ misnamed as '+key+', if the name was intentional'+' and not an Info object add an allowal rule here.');continue;}if(Lsingleton[\"__info_of__\"+key])comments[key]=Lsingleton[\"__info_of__\"+key];if(comments[key])continue;// if explicitly commented, i will not attempt to generate documentation.\nlet entryvalue=Lsingleton[key];switch(typeof entryvalue){default:case\"object\":ret.shortcuts[key]=entryvalue;break;case\"function\":ret.shortcuts[key]=U.buildFunctionDocumentation(entryvalue);break;}}console.log('console short in 3',{ret});}if(hiddenkeys){ret.hiddenkeys={};for(let key of hiddenkeys){ret.hiddenkeys[key]=output[key];delete output[key];if(ret.shortcuts)delete ret.shortcuts[key];}}break;}//@ts-ignore\n//ret ={...ret, shortcuts: undefined, comments: undefined, hiddenkeys: undefined};\nreturn ret;}class ConsoleComponent extends PureComponent{constructor(props){super(props);this.lastNode=void 0;this._context={};this.outputhtml=null;this.state=new ThisState();this.change=this.change.bind(this);this.change(undefined);}change(evt){var _this$props$node;if(!this)return;// component being destroyed and remade after code hot update\nlet expression0=(evt?evt.target.value:this.state.expression)||'';let expression=expression0.trim();let output;// let context = {...this.props, props: this.props}; // makeEvalContext(this.props as any, {} as any);\nlet nid=(_this$props$node=this.props.node)===null||_this$props$node===void 0?void 0:_this$props$node.id;let tn=transientProperties.node[nid];if(nid&&tn){// let component = GraphElementComponent.map[this.props.node.id];\nthis._context={...tn.viewScores[tn.mainView.id].evalContext};this._context.fromcomponent=true;}else{this._context={...this.props,props:this.props};}try{// if (expression === 'this') expression = 'data'; // it does a mess by taking a L-singleton with all his __info_of__ stuff\nif(expression==='this')output=this._context;else output=U.evalInContextAndScope(expression||'<span class=\"console-msg\">undefined</span>',this._context,this._context);}catch(e){console.error(\"console error\",e);// output = '<span class=\"console-error\">Invalid Syntax!</span> <span class=\"console-error-msg\">' + e.toString() + '<span>' ; }\noutput='<span class=\"console-error-msg\"><i class=\"bi bi-exclamation-square-fill\"></i><span>'+e.toString()+'</span></span>';}this.setState({expression:expression0,output});}// textarea: HTMLTextAreaElement | null = null;\ngetClickableEntry(jsxComments,strcomments,expression,k,arr){let isReactNode=!!jsxComments[k];let infoof_tooltip;if(isReactNode){infoof_tooltip=/*#__PURE__*/_jsx(\"span\",{id:'console_output_comment_key_'+k,className:\"my-tooltip output-comment tooltip-msg\"});//jsxComments[k];\n}else{var _strcomments$k;let str=((_strcomments$k=strcomments[k])===null||_strcomments$k===void 0?void 0:_strcomments$k.txt)||'';if(str)infoof_tooltip=/*#__PURE__*/_jsx(\"div\",{className:\"my-tooltip output-comment\",dangerouslySetInnerHTML:{__html:str}});else infoof_tooltip=null;}if(k==='father')console.log('jsx comment',{k,infoof_tooltip,jsxComments:{...jsxComments}});if(k==='isM1')console.log('jsx comment',{k,infoof_tooltip,jsxComments:{...jsxComments}});return/*#__PURE__*/_jsxs(\"li\",{onClick:()=>{let isnum=!isNaN(+k);let isregular=isnum?true:/\\w/.test(k);let append;if(isnum)append='['+k+']';else if(isregular)append='.'+k;else append='['+JSON.stringify(k)+']';this.setState({expression:expression?expression+append:k}/*, ()=> { this.change(); }*/);},children:[k,arr&&arr[k]||null,infoof_tooltip]});}setState(s,callback){if(s){if(s.initialState){delete s.initialState;return super.setState(s);}let s0={...s};let olds=this.state;if(s0.expressionIndex!==undefined&&s0.expressionIndex!==olds.expressionIndex)s.expression=olds.expressionHistory[s0.expressionIndex];if(s0.expression&&s0.expression!==olds.expression){var _s$expressionIndex;let time=new Date().getTime();let oldtime=olds.time;Log.exDev(s0.expressionIndex!==undefined,'cannot set both index and expression together');let i=(_s$expressionIndex=s.expressionIndex)!==null&&_s$expressionIndex!==void 0?_s$expressionIndex:olds.expressionIndex;let slice;if(time-oldtime<1000){slice=olds.expressionHistory.slice(0,i);}else{slice=olds.expressionHistory.slice(0,i+1);s.expressionIndex=i+1;}s.time=time;s.expressionHistory=[...slice,s0.expression];console.log('setstate',{olds:{...olds},s,slice,i,s0});}if(s.expression!==olds.expression&&!('output'in s)){let call0=callback;callback=()=>{call0===null||call0===void 0?void 0:call0();this.change();};}}super.setState(s,callback);}render(){var _this$state$output,_this$props$node2,_this$props$node3;/*const [expression, setExpression] = useStateIfMounted('data');\r\n        const [output, setOutput] = useStateIfMounted('');*/if(!this.props.node)return/*#__PURE__*/_jsx(Empty,{msg:\"Select a node.\"});let postprocess=true;let expression=this.state.expression.trim();if(expression==='this')expression='data';const data=this.props.data;if(this.lastNode!==this.props.node.id)this.change();// force reevaluation if selected node changed\nthis.lastNode=this.props.node.id;/*display history*/let history=this.state.expressionHistory||[];let hlen=history.length;let hindex=this.state.expressionIndex;const entries=10;let max=Math.floor(Math.min(hindex+entries/2,hlen));let min=Math.floor(hindex+entries-Math.max(hlen-max,entries/2));history=history.slice(min,max);console.log('chistory',{min,max,oldh:this.state.expressionHistory,h:history,selected:history[entries/2]});let outstr;// try { outstr = U.circularStringify(this.state.output, (key, value)=> { return value.__isProxy ? value.name : value; }, \"\\t\", 1) }\n// (window as any).inspect = util.inspect;\n// (window as any).tmpp = this.state.output;\nlet ashtml;let output=this.state.output;let shortcuts=undefined;let comments=undefined;let hidden=undefined;let jsxComments={};let shortcutsjsx=undefined;try{var _output5;if(Array.isArray(output)){comments={\"separator\":'<span>Similar to <a href={\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"}>Array.join(separator)</a>'+', but supports array of JSX nodes and JSX as separator argument.</span>'};shortcuts={\"separator\":\"\"};output=output.map(o=>fixproxy(o).output);}else{console.log('console short pre',{output});let ret=fixproxy(output);output=ret.output;comments=ret.comments;shortcuts=ret.shortcuts;console.log('console short',{shortcuts,ret,output});hidden=ret.hiddenkeys;}// todo: as i fix the displaying of a LViewElement without replacing it with __raw,\n//  i will fix window, component and props displaying too i think they crash for props.data, props.view...\nif((_output5=output)===null||_output5===void 0?void 0:_output5._reactInternals){output={\"React.Component\":{props:\"...navigate to expand...\",state:\"\",_isMounted:output._isMounted}};}outstr='<h4>Result</h4><section class=\"group result-container\"><div class=\"output-row\" tabindex=\"984\">'+U.objectInspect(output)+\"<span>\";let commentsPopup=\"\";if(shortcuts||comments){// if(!shortcuts) shortcuts = {};\nif(!comments)comments={};for(let commentKey in comments){var _commentVal,_commentVal2,_commentVal3,_commentVal3$type;let commentVal=comments[commentKey];let txt=(_commentVal=commentVal)===null||_commentVal===void 0?void 0:_commentVal.txt;if(txt&&typeof txt!==\"string\"){// only for infoof that have txt = reactNode\n// try to inject jsx\njsxComments[commentKey]=txt;txt=\"<span id='console_output_comment_\"+commentKey+\"'  class='tooltip-msg'/>\";// fallback read text, that should go deep iteration, but 1 level deep should be enough.\n// let arr: any[] = (Array.isArray(txt?.props?.children) ? txt.props.children : (txt.props.children ? [txt.props.children] : []));\n// txt = arr.map(e => typeof e === \"string\" ? e : e?.props?.children + '' || '').join(\"\");\n}if((_commentVal2=commentVal)===null||_commentVal2===void 0?void 0:_commentVal2.type)commentVal=\"\\t\\t<span class='console-msg'>\"+(((_commentVal3=commentVal)===null||_commentVal3===void 0?void 0:(_commentVal3$type=_commentVal3.type)===null||_commentVal3$type===void 0?void 0:_commentVal3$type.cname)||commentVal.type)+\"</span>\";// + \" ~ \" + txt;\n// warning: unicode char but should not make a problem. 𐀹\ncommentVal+='<div class=\"output-comment my-tooltip\">'+txt+'</div></div><div class=\"output-row\" tabindex=\"984\">';if(postprocess){let commentKeyEscaped=U.multiReplaceAll(commentKey,[\"$\",\"-\"],[\"\\\\$\",\"\\\\-\"]);// _ should be safe, .-,?^ not happening?\nlet regexp=new RegExp(\"^({?\\\\s*\"+commentKeyEscaped+\":.*)$\",\"gm\");let regexpCloseTags=new RegExp(\"(\\\\<span style\\\\=\\\"color\\\\:\\\\#)\",\"gm\");outstr=U.replaceAll(outstr,\"$\",\"£\");outstr=outstr.replace(regexp,\"$1\"+commentVal);outstr=outstr.replace(regexpCloseTags,\"</span>$1\");outstr=U.replaceAll(outstr,\"£\",\"$\");}}/*if (shortcuts) outstr += \"</div></section><br><br>\" +\r\n                    \"<h4>Shortcuts</h4><section class='group shortcuts-container'><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + U.objectInspect(shortcuts)+\"</section>\";\r\n                */ // if (hidden) outstr +=\"</div><br><br><h4>Other less useful properties</h4><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + format(hidden);\n// warning: unicode char but should not make a problem.\n// outstr = U.replaceAll( outstr, '𐀹,\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span style=\"color:#000\">');\nwindoww.outstr=outstr.substring(0,500);windoww.outstrr=outstr;// [length]: <span style=\"color:#A50\">1<span style=\"color:#000\"> ]\nif(postprocess){// let closetagsafely = '</span>';\nlet closetagsafely='</span></span></span></span></span></span></span></span></span></span>';outstr=U.replaceAll(outstr,'<span style=\"color:#000\">,\\n',closetagsafely+'\\n</div>'+'<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');outstr=U.replaceAll(outstr,'<span style=\"color:#000\"> ],\\n',']</span>\\n</div>'+'<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');outstr=U.replaceAll(outstr,': {},\\n',': {}</span>\\n</div>'+'<div class=\"output-row\" tabindex=\"984\">');// let regexpFixArray = /,?\\s\\[length\\]:\\s<span style=\"color:#A50\">\\d<span style=\"color:#000\">\\s/gm;\nwindoww.outp=outstr;// let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+]/gm;\nlet regexpFixArray=/,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+(<span style=\"color:#000\">\\s){0,1}]/gm;outstr=outstr.replaceAll(regexpFixArray,\"&nbsp;]</span>\");outstr=U.replaceAll(outstr,': [&nbsp;]',': []');}let postprocessold=false;if(postprocessold){outstr=U.replaceAll(outstr,'<span style=\"color:#000\" class=\"console-msg\">,\\n','</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');/*outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n                        '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');*/outstr=U.replaceAll(outstr,'],\\n','],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');outstr=U.replaceAll(outstr,'},\\n','},</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');}}ashtml=true;}catch(e){console.error(e);throw e;outstr=\"[circular object]: \"+e.toString();ashtml=false;}let contextkeysarr;let contextkeys='';if(this.state.expression.trim()===\"this\")contextkeys=\"Warning: \\\"this\\\" in the console is aliased to data instead of the whole context of a GraphElement component.\";let objraw=((_this$state$output=this.state.output)===null||_this$state$output===void 0?void 0:_this$state$output.__raw)||(typeof this.state.output===\"object\"?this.state.output:\"[primitiveValue]\")||{};if(this.state.expression.trim()===\"\")contextkeysarr=[\"data\",\"node\",\"view\",\"component\"];else if(typeof objraw===\"string\"){contextkeysarr=Object.keys(String.prototype);}else contextkeysarr=(Array.isArray(objraw)?[...Object.keys(objraw).filter(k=>k<=10).map(k=>k===10?'...':''+k),...Object.keys(Array.prototype)]:Object.getOwnPropertyNames(objraw))||[];let injectCommentJSX=()=>{try{for(let key in jsxComments){if(hiddenkeys.includes(key))continue;let commentNode=document.getElementById(\"console_output_comment_\"+key);Log.eDev(!commentNode,\"failed to find comment placeholder\",{key,v:jsxComments[key],jsxComments});if(commentNode)ReactDOM.render(jsxComments[key],commentNode);// for shortcut or context keys, this can fail without warning as some shortcuts are missing\ncommentNode=document.getElementById(\"console_output_comment_key_\"+key);if(commentNode)ReactDOM.render(jsxComments[key],commentNode);}}catch(e){console.error(\"failed to inject console output comment:\",e);}};setTimeout(injectCommentJSX,1);this.setNativeConsoleVariables();windoww.output=output;const undo=()=>{let expressionIndex=Math.max(0,this.state.expressionIndex-1);if(expressionIndex===this.state.expressionIndex)return;this.setState({expressionIndex});};const redo=()=>{const expressionHistory=this.state.expressionHistory;let expressionIndex=Math.min(expressionHistory.length-1,this.state.expressionIndex+1);if(expressionIndex===this.state.expressionIndex)return;this.setState({expressionIndex});};let canredo=this.state.expressionIndex<this.state.expressionHistory.length-1;let canundo=this.state.expressionIndex>0;let advanced=this.props.advanced;contextkeys=/*#__PURE__*/_jsx(\"ul\",{children:contextkeysarr.sort().map(k=>this.getClickableEntry(jsxComments,comments||{},expression,k))});if(shortcuts){shortcutsjsx=/*#__PURE__*/_jsx(\"ul\",{children:Object.keys(shortcuts).sort().map(k=>this.getClickableEntry(jsxComments,comments||{},expression,k,shortcuts))});}return/*#__PURE__*/_jsxs(\"div\",{className:'w-100 h-100 p-2 console',children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"On \",((data===null||data===void 0?void 0:data.name)||\"model-less node (\"+((_this$props$node2=this.props.node)===null||_this$props$node2===void 0?void 0:_this$props$node2.className)+\")\")+\" - \"+((_this$props$node3=this.props.node)===null||_this$props$node3===void 0?void 0:_this$props$node3.className)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"console-terminal p-0 mb-2 w-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"commands\",children:[/*#__PURE__*/_jsx(\"i\",{onClick:e=>{this.setState({expression:'',expressionHistory:[''],expressionIndex:0});},title:'Empty console',className:\"bi bi-slash-circle\"}),/*#__PURE__*/_jsx(\"i\",{onClick:e=>{var _this$outputhtml;if(!this.state.expression.trim()){return Tooltip.show('Nothing to copy',undefined,undefined,2);}let s=((_this$outputhtml=this.outputhtml)===null||_this$outputhtml===void 0?void 0:_this$outputhtml.innerText)||'';s=s.substring('Result'.length).trim();U.clipboardCopy(s,()=>Tooltip.show('Content copied to clipboard',undefined,undefined,2));},title:'Copy in the clipboard',className:\"bi bi-clipboard-plus\"}),/*#__PURE__*/_jsx(\"i\",{onClick:redo,title:'redo',className:\"redo bi bi-arrow-right-square\"+(canredo?'':\" disabled\")}),/*#__PURE__*/_jsx(\"i\",{onClick:undo,title:'undo',className:\"undo bi bi-arrow-left-square\"+(canundo?'':\" disabled\")})]}),/*#__PURE__*/_jsx(\"textarea\",{id:'console',spellCheck:false,className:'p-0 input w-100',onChange:this.change,value:this.state.expression})]}),advanced&&history.length>1&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Advanced query history (index = \",this.state.expressionIndex,\")\",history.map((s,i)=>i===0?null:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{style:{border:'1px solid '+(i===history.length/2)?'red':'gray',marginTop:'5px',height:'30px'},children:i+') '+s})}))]}),/*#__PURE__*/_jsx(\"hr\",{className:'mt-1 mb-1'}),this.state.expression&&ashtml&&/*#__PURE__*/_jsx(\"div\",{className:\"console-output-container console-msg\",ref:e=>this.outputhtml=e,dangerouslySetInnerHTML:ashtml?{__html:outstr}:undefined}),this.state.expression&&!ashtml&&/*#__PURE__*/_jsx(\"div\",{className:\"console-output-container console-msg\",ref:e=>this.outputhtml=e,style:{whiteSpace:\"pre\"},children:outstr}),contextkeysarr.length&&/*#__PURE__*/_jsxs(\"section\",{className:'group suggestion-keys context-keys-list',style:{whiteSpace:\"pre\"},children:[/*#__PURE__*/_jsx(\"label\",{className:\"context-keys\",children:\"Context keys\"}),contextkeys]}),shortcutsjsx&&/*#__PURE__*/_jsxs(\"section\",{className:\"group  suggestion-keys shortcuts-container\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"context-keys pt-0\",children:\"Shortcuts\"}),shortcutsjsx]})]});}setNativeConsoleVariables(){var _context$data,_context$data2;// just fordebugging\nlet context=this._context;windoww.context=context;windoww.data=context.data;windoww.node=context.node;windoww.edge=context.edge;windoww.output=this.state.output;if((_context$data=context.data)===null||_context$data===void 0?void 0:_context$data.model)windoww.model=(_context$data2=context.data)===null||_context$data2===void 0?void 0:_context$data2.model;}}ConsoleComponent.cname=\"ConsoleComponent\";function mapStateToProps(state,ownProps){var _state$_lastSelected;const ret={};const nodeid=(_state$_lastSelected=state._lastSelected)===null||_state$_lastSelected===void 0?void 0:_state$_lastSelected.node;const node=nodeid?LGraphElement.fromPointer(nodeid):null;ret.node=node;ret.data=(node===null||node===void 0?void 0:node.model)?node.model:null;ret.view=(node===null||node===void 0?void 0:node.view)?node.view:null;ret.advanced=state.advanced;return ret;}function mapDispatchToProps(dispatch){const ret={};return ret;}export const ConsoleConnected=connect(mapStateToProps,mapDispatchToProps)(ConsoleComponent);export const Console=function(props){let children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(ConsoleConnected,{...props,children});};export default Console;","map":{"version":3,"names":["LGraphElement","Log","RuntimeAccessibleClass","transientProperties","U","windoww","React","PureComponent","connect","ReactDOM","Empty","Tooltip","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Convert","require","ansiConvert","window","ansiconvert","ThisState","constructor","expression","output","expressionIndex","expressionHistory","initialState","time","hiddenkeys","fixproxy","_output","addDKeys","arguments","length","undefined","addLKeys","ret","proxy","__isProxy","__raw","console","log","iff","fdata","buildFunctionDocumentation","_RuntimeAccessibleCla","_RuntimeAccessibleCla2","_output2","_output3","_RuntimeAccessibleCla3","_output4","Lsingleton","get","className","logic","singleton","comments","shortcuts","rett","shortt","DClass","LClass","key","indexOf","eDevv","entryvalue","ConsoleComponent","props","lastNode","_context","outputhtml","state","change","bind","evt","_this$props$node","expression0","target","value","trim","nid","node","id","tn","viewScores","mainView","evalContext","fromcomponent","evalInContextAndScope","e","error","toString","setState","getClickableEntry","jsxComments","strcomments","k","arr","isReactNode","infoof_tooltip","_strcomments$k","str","txt","dangerouslySetInnerHTML","__html","onClick","isnum","isNaN","isregular","test","append","JSON","stringify","children","s","callback","s0","olds","_s$expressionIndex","Date","getTime","oldtime","exDev","i","slice","call0","render","_this$state$output","_this$props$node2","_this$props$node3","msg","postprocess","data","history","hlen","hindex","entries","max","Math","floor","min","oldh","h","selected","outstr","ashtml","hidden","shortcutsjsx","_output5","Array","isArray","map","o","_reactInternals","_isMounted","objectInspect","commentsPopup","commentKey","_commentVal","_commentVal2","_commentVal3","_commentVal3$type","commentVal","type","cname","commentKeyEscaped","multiReplaceAll","regexp","RegExp","regexpCloseTags","replaceAll","replace","substring","outstrr","closetagsafely","outp","regexpFixArray","postprocessold","contextkeysarr","contextkeys","objraw","Object","keys","String","prototype","filter","getOwnPropertyNames","injectCommentJSX","includes","commentNode","document","getElementById","eDev","v","setTimeout","setNativeConsoleVariables","undo","redo","canredo","canundo","advanced","sort","name","title","_this$outputhtml","show","innerText","clipboardCopy","spellCheck","onChange","style","border","marginTop","height","ref","whiteSpace","_context$data","_context$data2","context","edge","model","mapStateToProps","ownProps","_state$_lastSelected","nodeid","_lastSelected","fromPointer","view","mapDispatchToProps","dispatch","ConsoleConnected","Console"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/src/components/editors/Console.tsx"],"sourcesContent":["import {\r\n    DEdge,\r\n    DGraphElement,\r\n    Dictionary,\r\n    DState,\r\n    GObject, Info,\r\n    LGraphElement,\r\n    LModelElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    Pointer,\r\n    RuntimeAccessibleClass,\r\n    transientProperties,\r\n    U,\r\n    windoww\r\n} from '../../joiner';\r\nimport {FakeStateProps} from '../../joiner/types';\r\nimport React, {Component, Dispatch, PureComponent, ReactElement, ReactNode} from 'react';\r\nimport {connect} from 'react-redux';\r\n\r\nimport './style.scss'; // <-- tenuto per retro-compatibilità ma dovrebbe sparire\r\nimport './editors.scss'; // <-- stile comune a tutte le tab editor (idealmente da tenere leggero)\r\nimport './console.scss'; // <-- stile di questa tab\r\nimport ReactDOM from \"react-dom\";\r\nimport {Empty} from \"./Empty\";\r\nimport {Tooltip} from \"../forEndUser/Tooltip\";\r\n\r\nconst Convert = require('ansi-to-html');\r\n\r\nlet ansiConvert = (window as any).ansiConvert;\r\nif (!ansiConvert) (window as any).ansiconvert = ansiConvert = new Convert();\r\n\r\nclass ThisState{\r\n    expression: string = '';\r\n    output: any = null;\r\n    expressionIndex: number = 0;\r\n    expressionHistory: string[] = [''];\r\n    initialState: boolean = true;\r\n    time: number = 0;\r\n}\r\n\r\n// trasformato in class component così puoi usare il this nella console. e non usa accidentalmente window come contesto\r\n\r\nlet hiddenkeys = [\"jsxString\", \"pointedBy\", \"clonedCounter\", \"parent\", \"_subMaps\", \"inspect\", \"__random\", '__serialize'];\r\nfunction fixproxy(output: any/*but not array*/, addDKeys: boolean = true, addLKeys: boolean = true):\r\n    { output: any, shortcuts?: GObject<'L singleton'>, comments?: Dictionary<string, string | {type:string, txt:string}>, hiddenkeys?: GObject} {\r\n\r\n    let ret: ReturnType<typeof fixproxy> = {output};\r\n    if (!output) return ret;\r\n\r\n    let proxy: LPointerTargetable | undefined;\r\n    if (output?.__isProxy) {\r\n        proxy = output;\r\n        output = output.__raw; //Object.fromEntries(Object.getOwnPropertyNames(p).map(k => [k, p[k]]));\r\n    } else proxy = undefined;\r\n\r\n    console.log('console short in 1', {output, proxy, ret, addLKeys, iff:addLKeys && proxy});\r\n\r\n    switch (typeof output) {\r\n        case \"function\": {\r\n            let fdata =  U.buildFunctionDocumentation(output);\r\n            return {output: fdata};\r\n        }\r\n        default: return ret;\r\n        case \"object\":\r\n            // if (Array.isArray(output)) { ret.output = output; break; /* no need to go inside, it is already done at render phase */ }\r\n            ret.output = output = {...output};\r\n            // if (ret.output.anchors) ret.output.anchors = JSON.stringify(ret.output.anchors);\r\n            if (addLKeys && proxy) {\r\n                let Lsingleton: GObject<'L singleton'> = (RuntimeAccessibleClass.get(output?.className)?.logic?.singleton) || {};\r\n                let comments: Dictionary<string, string | {type:string, txt:string}> = {};\r\n                ret.shortcuts = {...Lsingleton};\r\n                console.log('console short in 2', {output, rett:{...ret, shortt:{...(ret.shortcuts||{})}}, Lsingleton, DClass:RuntimeAccessibleClass.get(output?.className), LClass:RuntimeAccessibleClass.get(output?.className)?.logic});\r\n                ret.comments = comments;\r\n                for (let key in output) {\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                }\r\n                for (let key in Lsingleton) {\r\n                    if ((key in output) || (key.indexOf(\"__info_of__\") === 0)) {\r\n                        delete ret.shortcuts[key];\r\n                        continue;\r\n                    } else { if (ret.shortcuts[key] === undefined) ret.shortcuts[key] = ''; }\r\n                    if (key.indexOf(\"info\") >=0 && key.indexOf(\"of\") >=0){\r\n                        Log.eDevv('Possible error on __info_of__ misnamed as '+key+', if the name was intentional' +\r\n                            ' and not an Info object add an allowal rule here.');\r\n                        continue;\r\n                    }\r\n                    if (Lsingleton[\"__info_of__\" + key]) comments[key] = Lsingleton[\"__info_of__\" + key];\r\n                    if (comments[key]) continue; // if explicitly commented, i will not attempt to generate documentation.\r\n                    let entryvalue = Lsingleton[key];\r\n                    switch (typeof entryvalue) {\r\n                        default:\r\n                        case \"object\":\r\n                            ret.shortcuts[key] = entryvalue;\r\n                            break;\r\n                        case \"function\":\r\n                            ret.shortcuts[key] = U.buildFunctionDocumentation(entryvalue);\r\n                            break;\r\n                    }\r\n                }\r\n                console.log('console short in 3', {ret});\r\n\r\n            }\r\n            if (hiddenkeys) {\r\n                ret.hiddenkeys = {};\r\n                for (let key of hiddenkeys) {\r\n                    ret.hiddenkeys[key] = output[key];\r\n                    delete output[key];\r\n                    if (ret.shortcuts) delete ret.shortcuts[key];\r\n                }\r\n            }\r\n            break;\r\n    }\r\n\r\n    //@ts-ignore\r\n    //ret ={...ret, shortcuts: undefined, comments: undefined, hiddenkeys: undefined};\r\n\r\n    return ret;\r\n}\r\n\r\n\r\nclass ConsoleComponent extends PureComponent<AllProps, ThisState>{\r\n    public static cname: string = \"ConsoleComponent\";\r\n    lastNode?: Pointer<DGraphElement>;\r\n    constructor(props: AllProps) {\r\n        super(props);\r\n        this.state = new ThisState();\r\n        this.change = this.change.bind(this);\r\n        this.change(undefined);\r\n    }\r\n    private _context: GObject = {};\r\n    change(evt?: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        if (!this) return; // component being destroyed and remade after code hot update\r\n        let expression0: string = (evt ? evt.target.value : this.state.expression) || '';\r\n        let expression: string = expression0.trim();\r\n        let output;\r\n        // let context = {...this.props, props: this.props}; // makeEvalContext(this.props as any, {} as any);\r\n\r\n        let nid = this.props.node?.id;\r\n        let tn = transientProperties.node[nid as string];\r\n        if (nid && tn) {\r\n            // let component = GraphElementComponent.map[this.props.node.id];\r\n            this._context = {...tn.viewScores[tn.mainView.id].evalContext};\r\n            this._context.fromcomponent = true;\r\n        }\r\n        else {\r\n            this._context = {...this.props, props: this.props};\r\n        }\r\n        try {\r\n            // if (expression === 'this') expression = 'data'; // it does a mess by taking a L-singleton with all his __info_of__ stuff\r\n            if (expression === 'this') output = this._context;\r\n            else output = U.evalInContextAndScope(expression || '<span class=\"console-msg\">undefined</span>', this._context, this._context);\r\n        }\r\n        catch (e: any) {\r\n            console.error(\"console error\", e);\r\n            // output = '<span class=\"console-error\">Invalid Syntax!</span> <span class=\"console-error-msg\">' + e.toString() + '<span>' ; }\r\n            output = '<span class=\"console-error-msg\"><i class=\"bi bi-exclamation-square-fill\"></i><span>' + e.toString() + '</span></span>' ; }\r\n        this.setState({expression:expression0, output });\r\n    }\r\n\r\n    // textarea: HTMLTextAreaElement | null = null;\r\n    getClickableEntry(jsxComments: Dictionary<string, ReactNode>, strcomments: Dictionary<string, Info>, expression: string, k: string, arr?: any): JSX.Element{\r\n        let isReactNode = !!jsxComments[k];\r\n        let infoof_tooltip: string | ReactNode;\r\n        if (isReactNode){\r\n            infoof_tooltip = <span id={'console_output_comment_key_' + k} className='my-tooltip output-comment tooltip-msg'/>;//jsxComments[k];\r\n        } else {\r\n            let str = (strcomments[k]?.txt as string)||'';\r\n            if (str) infoof_tooltip = <div className=\"my-tooltip output-comment\" dangerouslySetInnerHTML={{__html:str}}/>;\r\n            else infoof_tooltip = null;\r\n        }\r\n        if (k === 'father') console.log('jsx comment', {k, infoof_tooltip, jsxComments:{...jsxComments}});\r\n        if (k === 'isM1') console.log('jsx comment', {k, infoof_tooltip, jsxComments:{...jsxComments}});\r\n        return <li onClick={()=> {\r\n            let isnum = !isNaN(+k);\r\n            let isregular: boolean = isnum ? true : /\\w/.test(k);\r\n            let append: string;\r\n            if (isnum) append = '['+k+']';\r\n            else if (isregular) append = '.'+k;\r\n            else append = '['+JSON.stringify(k)+']';\r\n            this.setState({expression: (expression ? expression + append : k)}/*, ()=> { this.change(); }*/);\r\n        }}>{k}{arr && arr[k] || null}{infoof_tooltip}</li>;\r\n    }\r\n\r\n    outputhtml: HTMLElement | null = null;\r\n    setState(s: GObject<Partial<ThisState>> | null, callback?: (...a:any) => any): void{\r\n        if (s){\r\n            if (s.initialState) {\r\n                delete s.initialState;\r\n                return super.setState(s as any);\r\n            }\r\n            let s0: GObject<ThisState> = {...s} as any;\r\n            let olds = this.state;\r\n            if (s0.expressionIndex !== undefined && s0.expressionIndex !== olds.expressionIndex) s.expression = olds.expressionHistory[s0.expressionIndex];\r\n            if (s0.expression && s0.expression !== olds.expression) {\r\n                let time = new Date().getTime();\r\n                let oldtime = olds.time;\r\n                Log.exDev(s0.expressionIndex !== undefined, 'cannot set both index and expression together');\r\n                let i = s.expressionIndex ?? olds.expressionIndex;\r\n                let slice: string[];\r\n                if (time - oldtime < 1000) {\r\n                    slice = olds.expressionHistory.slice(0, i);\r\n                }\r\n                else {\r\n                    slice = olds.expressionHistory.slice(0, i+1);\r\n                    s.expressionIndex = i + 1;\r\n                }\r\n                s.time = time;\r\n                s.expressionHistory = [...slice, s0.expression];\r\n                console.log('setstate', {olds: {...olds}, s, slice, i, s0});\r\n            }\r\n            if (s.expression !== olds.expression && !('output' in s)) {\r\n                let call0 = callback;\r\n                callback = () => { call0?.(); this.change(); }\r\n            }\r\n        }\r\n        super.setState(s as any, callback);\r\n    }\r\n    render(){\r\n        /*const [expression, setExpression] = useStateIfMounted('data');\r\n        const [output, setOutput] = useStateIfMounted('');*/\r\n\r\n        if (!this.props.node) return <Empty msg={\"Select a node.\"} />;\r\n        let postprocess: boolean = true;\r\n        let expression = this.state.expression.trim();\r\n        if (expression === 'this') expression = 'data';\r\n        const data = this.props.data;\r\n        if (this.lastNode !== this.props.node.id) this.change(); // force reevaluation if selected node changed\r\n        this.lastNode = this.props.node.id;\r\n\r\n        /*display history*/\r\n        let history = this.state.expressionHistory||[];\r\n        let hlen = history.length;\r\n        let hindex = this.state.expressionIndex;\r\n        const entries = 10;\r\n        let max = Math.floor(Math.min(hindex+entries/2, hlen));\r\n        let min = Math.floor(hindex + entries - Math.max((hlen-max), entries/2));\r\n        history = history.slice(min, max);\r\n        console.log('chistory', {min, max, oldh: this.state.expressionHistory, h: history, selected: history[entries/2]});\r\n\r\n\r\n        let outstr;\r\n        // try { outstr = U.circularStringify(this.state.output, (key, value)=> { return value.__isProxy ? value.name : value; }, \"\\t\", 1) }\r\n        // (window as any).inspect = util.inspect;\r\n        // (window as any).tmpp = this.state.output;\r\n        let ashtml: boolean\r\n        let output: any = this.state.output;\r\n        let shortcuts: GObject<'L singleton'> | undefined = undefined;\r\n        let comments: Dictionary<string, string | {type:string, txt:string}> | undefined = undefined;\r\n        let hidden: Dictionary<string, string> | undefined = undefined;\r\n        let jsxComments: Dictionary<string, JSX.Element[]> = {};\r\n        let shortcutsjsx: ReactNode = undefined;\r\n        try {\r\n            if (Array.isArray(output)){\r\n                comments = {\"separator\": '<span>Similar to <a href={\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join\"}>Array.join(separator)</a>' +\r\n                        ', but supports array of JSX nodes and JSX as separator argument.</span>'};\r\n                shortcuts = {\"separator\": \"\"};\r\n                output = output.map(o => fixproxy(o).output);\r\n            }\r\n            else {\r\n                console.log('console short pre', {output});\r\n                let ret = fixproxy(output);\r\n                output = ret.output;\r\n                comments = ret.comments;\r\n                shortcuts = ret.shortcuts;\r\n                console.log('console short', {shortcuts, ret, output});\r\n                hidden = ret.hiddenkeys;\r\n            }\r\n            // todo: as i fix the displaying of a LViewElement without replacing it with __raw,\r\n            //  i will fix window, component and props displaying too i think they crash for props.data, props.view...\r\n            if (output?._reactInternals) {\r\n                output = {\"React.Component\": {props:\"...navigate to expand...\", state:\"\", _isMounted:output._isMounted}}\r\n            }\r\n            outstr = '<h4>Result</h4><section class=\"group result-container\"><div class=\"output-row\" tabindex=\"984\">' + U.objectInspect(output)+\"<span>\";\r\n            let commentsPopup = \"\";\r\n            if (shortcuts || comments){\r\n                // if(!shortcuts) shortcuts = {};\r\n                if (!comments) comments = {};\r\n                for (let commentKey in comments){\r\n                    let commentVal: any = comments[commentKey];\r\n                    let txt = commentVal?.txt;\r\n                    if (txt && typeof txt !== \"string\") {// only for infoof that have txt = reactNode\r\n                        // try to inject jsx\r\n                        jsxComments[commentKey] = txt;\r\n                        txt = \"<span id='console_output_comment_\" + commentKey + \"'  class='tooltip-msg'/>\";\r\n                        // fallback read text, that should go deep iteration, but 1 level deep should be enough.\r\n                        // let arr: any[] = (Array.isArray(txt?.props?.children) ? txt.props.children : (txt.props.children ? [txt.props.children] : []));\r\n                        // txt = arr.map(e => typeof e === \"string\" ? e : e?.props?.children + '' || '').join(\"\");\r\n                    }\r\n                    if (commentVal?.type) commentVal = \"\\t\\t<span class='console-msg'>\" + (commentVal?.type?.cname || commentVal.type)+\"</span>\"; // + \" ~ \" + txt;\r\n                    // warning: unicode char but should not make a problem. 𐀹\r\n                    commentVal += '<div class=\"output-comment my-tooltip\">' + txt + '</div></div><div class=\"output-row\" tabindex=\"984\">'\r\n\r\n                    if (postprocess){\r\n                        let commentKeyEscaped = U.multiReplaceAll(commentKey, [\"$\", \"-\"], [\"\\\\$\", \"\\\\-\"]); // _ should be safe, .-,?^ not happening?\r\n\r\n                        let regexp = new RegExp(\"^({?\\\\s*\" +commentKeyEscaped+\":.*)$\", \"gm\");\r\n                        let regexpCloseTags = new RegExp(\"(\\\\<span style\\\\=\\\"color\\\\:\\\\#)\", \"gm\");\r\n                        outstr = U.replaceAll(outstr, \"$\", \"£\");\r\n                        outstr = outstr.replace(regexp, \"$1\" + commentVal);\r\n                        outstr = outstr.replace(regexpCloseTags,  \"</span>$1\");\r\n                        outstr = U.replaceAll(outstr, \"£\", \"$\");\r\n                    }\r\n                }\r\n\r\n\r\n                /*if (shortcuts) outstr += \"</div></section><br><br>\" +\r\n                    \"<h4>Shortcuts</h4><section class='group shortcuts-container'><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + U.objectInspect(shortcuts)+\"</section>\";\r\n                */\r\n\r\n                // if (hidden) outstr +=\"</div><br><br><h4>Other less useful properties</h4><div class=\\\"output-row\\\" tabindex=\\\"984\\\">\" + format(hidden);\r\n                // warning: unicode char but should not make a problem.\r\n                // outstr = U.replaceAll( outstr, '𐀹,\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span style=\"color:#000\">');\r\n                windoww.outstr = outstr.substring(0, 500);\r\n                windoww.outstrr = outstr;\r\n                // [length]: <span style=\"color:#A50\">1<span style=\"color:#000\"> ]\r\n                if (postprocess){\r\n                    // let closetagsafely = '</span>';\r\n                    let closetagsafely = '</span></span></span></span></span></span></span></span></span></span>';\r\n\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\">,\\n',\r\n                        closetagsafely+'\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\"> ],\\n',\r\n                        ']</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                    outstr = U.replaceAll( outstr, ': {},\\n',\r\n                        ': {}</span>\\n</div>' + '<div class=\"output-row\" tabindex=\"984\">');\r\n                    // let regexpFixArray = /,?\\s\\[length\\]:\\s<span style=\"color:#A50\">\\d<span style=\"color:#000\">\\s/gm;\r\n                    windoww.outp = outstr;\r\n                    // let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+]/gm;\r\n                    let regexpFixArray = /,?\\s\\[length\\]:\\s(<\\/span>)+<span style=\"color:#A50\">\\d(<\\/span>)+(<span style=\"color:#000\">\\s){0,1}]/gm\r\n                    outstr = outstr.replaceAll(regexpFixArray, \"&nbsp;]</span>\");\r\n                    outstr = U.replaceAll( outstr, ': [&nbsp;]', ': []');\r\n\r\n                }\r\n                let postprocessold: boolean = false;\r\n                if (postprocessold){\r\n                    outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n                        '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n                    /*outstr = U.replaceAll( outstr, '<span style=\"color:#000\" class=\"console-msg\">,\\n',\r\n                        '</span><span style=\"color:#000\" class=\"console-msg\">,</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');*/\r\n\r\n                    outstr = U.replaceAll( outstr, '],\\n', '],</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n                    outstr = U.replaceAll( outstr, '},\\n', '},</span>\\n</div><div class=\"output-row\" tabindex=\"984\"><span class=\"console-msg\" style=\"color:#000\">');\r\n\r\n                }\r\n            }\r\n            ashtml = true; }\r\n        catch(e: any) {\r\n            console.error(e);\r\n            throw e;\r\n            outstr = \"[circular object]: \" + e.toString();\r\n            ashtml = false;\r\n        }\r\n        let contextkeysarr: (string)[];\r\n        let contextkeys: ReactNode = '';\r\n        if (this.state.expression.trim() === \"this\") contextkeys = \"Warning: \\\"this\\\" in the console is aliased to data instead of the whole context of a GraphElement component.\";\r\n\r\n        let objraw = this.state.output?.__raw || (typeof this.state.output === \"object\" ? this.state.output : \"[primitiveValue]\") || {};\r\n        if (this.state.expression.trim() === \"\") contextkeysarr = [\"data\", \"node\", \"view\", \"component\"];\r\n        else if (typeof objraw === \"string\") { contextkeysarr = Object.keys(String.prototype); }\r\n        else contextkeysarr = (Array.isArray(objraw) ?\r\n                [...(Object.keys(objraw) as any as number[]).filter(k => (k) <= 10).map(k=>k===10 ? '...' : ''+k), ...Object.keys(Array.prototype)]\r\n                : Object.getOwnPropertyNames(objraw)) || [];\r\n\r\n\r\n        let injectCommentJSX = () => {\r\n            try{ for (let key in jsxComments) {\r\n                if (hiddenkeys.includes(key)) continue;\r\n                let commentNode: HTMLElement | null = document.getElementById(\"console_output_comment_\"+key);\r\n                Log.eDev(!commentNode, \"failed to find comment placeholder\", {key, v:jsxComments[key], jsxComments});\r\n                if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\r\n                // for shortcut or context keys, this can fail without warning as some shortcuts are missing\r\n                commentNode = document.getElementById(\"console_output_comment_key_\"+key);\r\n                if (commentNode) ReactDOM.render(jsxComments[key], commentNode);\r\n            } }\r\n            catch (e) { console.error(\"failed to inject console output comment:\", e)}\r\n        }\r\n        setTimeout(injectCommentJSX, 1)\r\n        this.setNativeConsoleVariables();\r\n        windoww.output = output;\r\n        const undo = ()=>{\r\n            let expressionIndex = Math.max(0, this.state.expressionIndex - 1);\r\n            if (expressionIndex === this.state.expressionIndex) return;\r\n            this.setState({ expressionIndex })\r\n        }\r\n        const redo = ()=>{\r\n            const expressionHistory = this.state.expressionHistory;\r\n            let expressionIndex = Math.min(expressionHistory.length-1, this.state.expressionIndex + 1);\r\n            if (expressionIndex === this.state.expressionIndex) return;\r\n            this.setState({ expressionIndex })\r\n        }\r\n        let canredo = this.state.expressionIndex < this.state.expressionHistory.length - 1;\r\n        let canundo = this.state.expressionIndex > 0;\r\n        let advanced = this.props.advanced;\r\n\r\n        contextkeys = <ul>{\r\n            contextkeysarr.sort().map(k=>this.getClickableEntry(jsxComments, comments||{} as any, expression, k))\r\n        }</ul>;\r\n\r\n        if (shortcuts) {\r\n            shortcutsjsx = <ul>{\r\n                Object.keys(shortcuts).sort().map(k=>this.getClickableEntry(jsxComments, comments||{} as any, expression, k, shortcuts))\r\n            }</ul>\r\n        }\r\n\r\n        return(<div className={'w-100 h-100 p-2 console'}>\r\n            <h1>\r\n                On {((data as GObject)?.name || \"model-less node (\" + this.props.node?.className + \")\") + \" - \" + this.props.node?.className}\r\n            </h1>\r\n            <div className='console-terminal p-0 mb-2 w-100'>\r\n                <div className='commands'>\r\n                    <i onClick={(e) => {\r\n                        this.setState({expression: '', expressionHistory:[''], expressionIndex:0})\r\n                    }} title={'Empty console'} className=\"bi bi-slash-circle\"/>\r\n                    <i onClick={(e) => {\r\n                        if (!this.state.expression.trim()) {\r\n                            return Tooltip.show('Nothing to copy', undefined, undefined, 2);\r\n                        }\r\n                        let s = this.outputhtml?.innerText || '';\r\n                        s = s.substring('Result'.length).trim();\r\n                        U.clipboardCopy(s, () => Tooltip.show('Content copied to clipboard', undefined, undefined, 2));\r\n                    }} title={'Copy in the clipboard'} className=\"bi bi-clipboard-plus\"/>\r\n                    {/* @ts-ignore */}\r\n                    <i onClick={redo} title={'redo'}\r\n                       className={\"redo bi bi-arrow-right-square\" + (canredo ? '' : \" disabled\")}/>\r\n                    {/* @ts-ignore */}\r\n                    <i onClick={undo} title={'undo'}\r\n                       className={\"undo bi bi-arrow-left-square\" + (canundo ? '' : \" disabled\")}/>\r\n                </div>\r\n                <textarea id={'console'} spellCheck={false} className={'p-0 input w-100'} onChange={this.change}\r\n                          value={this.state.expression}></textarea>\r\n            </div>\r\n            {advanced && history.length>1 && <div>Advanced query history (index = {this.state.expressionIndex})\r\n                {history.map((s, i) => i === 0 ? null : <>\r\n                    <div style={{\r\n                        border: '1px solid ' + (i === history.length/2) ? 'red' : 'gray',\r\n                        marginTop: '5px',\r\n                        height: '30px'\r\n                    }}>{(i) + ') ' + s}</div>\r\n                </>)}</div>}\r\n            {/*<label>Query {(this.state.expression)}</label>*/}\r\n            <hr className={'mt-1 mb-1'}/>\r\n            {this.state.expression && ashtml && <div className={\"console-output-container console-msg\"}\r\n                                                     ref={(e) => this.outputhtml = e}\r\n                                                     dangerouslySetInnerHTML={ashtml ? {__html: outstr as string} : undefined}/>}\r\n\r\n            {this.state.expression && !ashtml && <div className={\"console-output-container console-msg\"}\r\n                                                      ref={(e) => this.outputhtml = e}\r\n                                                      style={{whiteSpace: \"pre\"}}>{outstr}</div>}\r\n\r\n\r\n            {contextkeysarr.length && <section className={'group suggestion-keys context-keys-list'} style={{whiteSpace: \"pre\"}}>\r\n                    <label className={\"context-keys\"}>Context keys</label>\r\n                    {contextkeys}\r\n                </section>\r\n            }\r\n            {shortcutsjsx && <section className='group  suggestion-keys shortcuts-container'>\r\n                <label className={\"context-keys pt-0\"}>Shortcuts</label>\r\n                {shortcutsjsx}\r\n            </section>}\r\n        </div>)\r\n    }\r\n\r\n    private setNativeConsoleVariables(): void { // just fordebugging\r\n        let context = this._context;\r\n        windoww.context = context;\r\n        windoww.data = context.data;\r\n        windoww.node = context.node;\r\n        windoww.edge = context.edge;\r\n        windoww.output = this.state.output;\r\n        if (context.data?.model) windoww.model = context.data?.model;\r\n    }\r\n}\r\n\r\ninterface OwnProps {}\r\ninterface StateProps {\r\n    data: LModelElement|null;\r\n    node: LGraphElement|null;\r\n    view: LViewElement|null;\r\n    advanced: boolean;\r\n}\r\ninterface DispatchProps {}\r\n\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    const nodeid = state._lastSelected?.node;\r\n    const node: LGraphElement|null = (nodeid) ? LGraphElement.fromPointer(nodeid) : null;\r\n    ret.node = node;\r\n    ret.data = (node?.model) ? node.model : null;\r\n    ret.view = (node?.view) ? node.view : null;\r\n    ret.advanced = state.advanced;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ConsoleConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ConsoleComponent);\r\n\r\nexport const Console = (props: OwnProps, children: (string | Component)[] = []): ReactElement => {\r\n    return <ConsoleConnected {...{...props, children}} />;\r\n}\r\nexport default Console;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}