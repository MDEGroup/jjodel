{"ast":null,"code":"import _regeneratorRuntime from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useStateIfMounted}from'use-state-if-mounted';import{DUser,SetRootFieldAction,U}from'../joiner';import Storage from'../data/storage';import{useNavigate}from\"react-router-dom\";import{AuthApi}from\"../api/persistance\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AuthPage(){var _useStateIfMounted=useStateIfMounted(false),_useStateIfMounted2=_slicedToArray(_useStateIfMounted,2),isRegister=_useStateIfMounted2[0],setIsRegister=_useStateIfMounted2[1];var _useStateIfMounted3=useStateIfMounted(''),_useStateIfMounted4=_slicedToArray(_useStateIfMounted3,2),username=_useStateIfMounted4[0],setUsername=_useStateIfMounted4[1];var _useStateIfMounted5=useStateIfMounted(''),_useStateIfMounted6=_slicedToArray(_useStateIfMounted5,2),email=_useStateIfMounted6[0],setEmail=_useStateIfMounted6[1];var _useStateIfMounted7=useStateIfMounted(''),_useStateIfMounted8=_slicedToArray(_useStateIfMounted7,2),password=_useStateIfMounted8[0],setPassword=_useStateIfMounted8[1];var navigate=useNavigate();var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();SetRootFieldAction.new('isLoading',true);if(!isRegister){_context.next=7;break;}_context.next=5;return register(username,email,password);case 5:_context.next=9;break;case 7:_context.next=9;return login(email,password);case 9:SetRootFieldAction.new('isLoading',false);case 10:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x){return _ref.apply(this,arguments);};}();var login=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,password){var response,data,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return AuthApi.login(email,password);case 2:response=_context2.sent;if(!(response.code!==200)){_context2.next=6;break;}alert('Bad Data!');return _context2.abrupt(\"return\");case 6:data=U.wrapper(response.data);Storage.write('token',data.token);user=DUser.new(data.username,data.id);Storage.write('user',user);navigate('/dashboard');U.refresh();case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function login(_x2,_x3){return _ref2.apply(this,arguments);};}();var register=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(username,email,password){var response,data,user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return AuthApi.register(username,email,password);case 2:response=_context3.sent;if(!(response.code!==200)){_context3.next=6;break;}alert('Bad Data!');return _context3.abrupt(\"return\");case 6:data=U.wrapper(response.data);Storage.write('token',data.token);user=DUser.new(data.username,data.id);Storage.write('user',user);navigate('/dashboard');U.refresh();case 12:case\"end\":return _context3.stop();}}},_callee3);}));return function register(_x4,_x5,_x6){return _ref3.apply(this,arguments);};}();var offline=function offline(){AuthApi.offline();navigate('/dashboard');U.refresh();};return/*#__PURE__*/_jsx(\"section\",{className:'w-100 h-100',children:/*#__PURE__*/_jsxs(\"form\",{className:'d-block bg-white rounded border mx-auto w-fit px-5 py-4 mt-5',onSubmit:onSubmit,children:[/*#__PURE__*/_jsx(\"label\",{className:'fs-1 d-block text-center text-primary',children:isRegister?'REGISTER':'LOGIN'}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"input\",{className:'w-100 input w-fit d-block mx-auto mt-3',placeholder:'Email',value:email,onChange:function onChange(e){return setEmail(e.target.value);},type:'email',required:true}),isRegister&&/*#__PURE__*/_jsx(\"input\",{className:'w-100 input w-fit d-block mx-auto mt-2',placeholder:'Username',value:username,onChange:function onChange(e){return setUsername(e.target.value);},type:'text',required:true}),/*#__PURE__*/_jsx(\"input\",{className:'w-100 input w-fit d-block mx-auto  mt-2',placeholder:'Password',value:password,onChange:function onChange(e){return setPassword(e.target.value);},type:'password',required:true}),/*#__PURE__*/_jsx(\"button\",{className:'d-block btn btn-primary p-1 mx-auto mt-3',type:'submit',children:\"Submit\"}),/*#__PURE__*/_jsxs(\"label\",{className:'mt-3 d-block text-center',children:[isRegister?'Already have an account?':'Don\\'t have an account?',/*#__PURE__*/_jsx(\"b\",{tabIndex:-1,onClick:function onClick(e){return setIsRegister(!isRegister);},className:'ms-1 text-primary text-decoration-none cursor-pointer',children:\"click here\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Or start in\",/*#__PURE__*/_jsx(\"b\",{tabIndex:-1,className:'ms-1 text-primary text-decoration-none cursor-pointer',onClick:function onClick(e){return offline();},children:\"Offline Mode\"})]})]})});}export{AuthPage};","map":{"version":3,"names":["useStateIfMounted","DUser","SetRootFieldAction","U","Storage","useNavigate","AuthApi","jsx","_jsx","jsxs","_jsxs","AuthPage","_useStateIfMounted","_useStateIfMounted2","_slicedToArray","isRegister","setIsRegister","_useStateIfMounted3","_useStateIfMounted4","username","setUsername","_useStateIfMounted5","_useStateIfMounted6","email","setEmail","_useStateIfMounted7","_useStateIfMounted8","password","setPassword","navigate","onSubmit","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","wrap","_callee$","_context","prev","next","preventDefault","new","register","login","stop","_x","apply","arguments","_ref2","_callee2","response","data","user","_callee2$","_context2","sent","code","alert","abrupt","wrapper","write","token","id","refresh","_x2","_x3","_ref3","_callee3","_callee3$","_context3","_x4","_x5","_x6","offline","className","children","placeholder","value","onChange","target","type","required","tabIndex","onClick"],"sources":["C:/d/Programming/web/jodel-mde/src/pages/Auth.tsx"],"sourcesContent":["import {FormEvent} from 'react';\r\nimport {useStateIfMounted} from 'use-state-if-mounted';\r\nimport {DUser, SetRootFieldAction, U} from '../joiner';\r\nimport Storage from '../data/storage';\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {AuthApi} from \"../api/persistance\";\r\n\r\nfunction AuthPage(): JSX.Element {\r\n    const [isRegister, setIsRegister] = useStateIfMounted(false);\r\n    const [username, setUsername] = useStateIfMounted('');\r\n    const [email, setEmail] = useStateIfMounted('');\r\n    const [password, setPassword] = useStateIfMounted('');\r\n    const navigate = useNavigate();\r\n\r\n    const onSubmit = async(e: FormEvent<HTMLFormElement>) => {\r\n        e.preventDefault();\r\n        SetRootFieldAction.new('isLoading', true);\r\n        if(isRegister) await register(username, email, password);\r\n        else await login(email, password);\r\n        SetRootFieldAction.new('isLoading', false);\r\n    }\r\n    const login = async(email: string, password: string) => {\r\n        const response = await AuthApi.login(email, password);\r\n        if(response.code !== 200) {\r\n            alert('Bad Data!');\r\n            return;\r\n        }\r\n        const data = U.wrapper<DUser>(response.data);\r\n        Storage.write('token', data.token);\r\n        const user = DUser.new(data.username, data.id);\r\n        Storage.write('user', user);\r\n        navigate('/dashboard');\r\n        U.refresh();\r\n    }\r\n    const register = async(username: string, email: string, password: string) => {\r\n        const response = await AuthApi.register(username, email, password);\r\n        if(response.code !== 200) {\r\n            alert('Bad Data!');\r\n            return;\r\n        }\r\n        const data = U.wrapper<DUser>(response.data);\r\n        Storage.write('token', data.token);\r\n        const user = DUser.new(data.username, data.id);\r\n        Storage.write('user', user);\r\n        navigate('/dashboard');\r\n        U.refresh();\r\n    }\r\n    const offline = () => {\r\n        AuthApi.offline();\r\n        navigate('/dashboard');\r\n        U.refresh();\r\n    }\r\n\r\n    return(<section className={'w-100 h-100'}>\r\n        <form className={'d-block bg-white rounded border mx-auto w-fit px-5 py-4 mt-5'} onSubmit={onSubmit}>\r\n            <label className={'fs-1 d-block text-center text-primary'}>\r\n                {isRegister ? 'REGISTER' : 'LOGIN'}\r\n            </label>\r\n            <hr />\r\n            <input className={'w-100 input w-fit d-block mx-auto mt-3'} placeholder={'Email'}\r\n                   value={email} onChange={e => setEmail(e.target.value)} type={'email'}  required={true} />\r\n            {isRegister &&\r\n                <input className={'w-100 input w-fit d-block mx-auto mt-2'} placeholder={'Username'}\r\n                       value={username} onChange={e => setUsername(e.target.value)} type={'text'} required={true} />\r\n            }\r\n            <input className={'w-100 input w-fit d-block mx-auto  mt-2'} placeholder={'Password'}\r\n                   value={password} onChange={e => setPassword(e.target.value)} type={'password'} required={true} />\r\n            <button className={'d-block btn btn-primary p-1 mx-auto mt-3'} type={'submit'}>Submit</button>\r\n            <label className={'mt-3 d-block text-center'}>\r\n                {isRegister ? 'Already have an account?' : 'Don\\'t have an account?'}\r\n                <b tabIndex={-1} onClick={e => setIsRegister(!isRegister)} className={'ms-1 text-primary text-decoration-none cursor-pointer'}>\r\n                    click here\r\n                </b>\r\n                <br/>Or start in\r\n                <b tabIndex={-1} className={'ms-1 text-primary text-decoration-none cursor-pointer'}\r\n                   onClick={e => offline()}\r\n                >\r\n                    Offline Mode\r\n                </b>\r\n            </label>\r\n        </form>\r\n    </section>);\r\n}\r\n\r\nexport {AuthPage};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}