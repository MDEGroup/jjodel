{"ast":null,"code":"var _jsxFileName = \"C:\\\\d\\\\Programming\\\\web\\\\jodel-mde\\\\src\\\\components\\\\forEndUser\\\\FunctionComponent.tsx\",\n  _s = $RefreshSig$(),\n  _this = this;\nimport React from 'react';\nimport { Log } from \"../../joiner\";\nimport { useStateIfMounted } from \"use-state-if-mounted\";\nimport \"./FunctionComponent.scss\";\n\n/*\r\n Rationale behind this:\r\n To do this properly, one would need a complete js parser to make sure comments, ifs, loops, newlines,\r\n   expressions inside array indexing for objects... are all correctly parsed.\r\n\r\n\r\n Instead, to make it faster, i'm forcing the valid \"function string\" value to hold a much more definite structure\r\n   for which i can do an extremely simpler inline parser.\r\n The getter and setter properties and the interface, are making sure the user cannot write a \"function string\"\r\n   not respecting my format, and that it is as much turing-complete as javascript is.\r\n\r\n legenda:\r\n  - ALL_CAPS identifiers, are not literals and the user can change their names.\r\n  - Newlines are included in the format, spaces are not.\r\n  - ... are explaining the format and are not part of it.\r\n  - // **   ** // Styled comments ARE part of the format.\r\n  - Excess spaces in the format are not preserved (might be added/removed by getter/setter), but not mandatory and not relevant.\r\n\r\n my structure is:\r\n (OBJECT_NAME)=> {\\n\r\n   STATEMENT_A1\r\n   STATEMENT_A2\r\n   ...\r\n   STATEMENT_AN\r\n   \\n// ** declarations here ** //\\n\r\n   OBJECT_NAME.IDENTIFIER_1 = STATEMENT_1;\\n\r\n   OBJECT_NAME.IDENTIFIER_2 = STATEMENT_2;\\n\r\n   ...\r\n   OBJECT_NAME.IDENTIFIER_N = STATEMENT_N;\\n\r\n }\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst minimalTextareaValue = '(ret)=>{\\n';\nfunction parseFunction(props) {\n  Log.exDev(!props.data, \"FunctionComponent: missing data props\", {\n    props\n  });\n  let getter = props.getter || (a => a[props.field]); // ((lobj: GObject<LPointerTargetable>, key: string) => U.wrapUserFunction(lobj[key]));\n  let val = getter(props.data);\n  if (!val || val.length <= 2) val = \"(ret)=>{\\n    // ** declarations here ** //\\n\\n}\"; // fallback for empty string and {}\n  else val = val.trim();\n  let txtparts = val.split(\"// ** declarations here ** //\");\n  if (txtparts.length !== 2) {\n    Log.eDevv(\"cannot find declaration section\", {\n      val,\n      props\n    });\n    txtparts = [val.substring(0, val.length - 1), val.substring(val.length - 1)];\n  }\n  let declarations = (txtparts[1] || '').split(\"\\n\");\n  let stateArrayValues = [];\n  let textAreaState = {\n    v: txtparts[0]\n  };\n  let i = -1;\n  for (let dec of declarations) {\n    let splitindex = dec.indexOf(\"=\");\n    if (splitindex === -1) continue; // for ending \\n} line\n    i++; // don't loop by i, the index ending in state must increase only for non-empty rows filtering them out.\n    let expression = dec.substring(splitindex + 1);\n    let identifier = dec.substring(0, splitindex);\n    let idsplitindex = identifier.indexOf(\".\");\n    let identifierPrefix = identifier.substring(0, idsplitindex);\n    let identifierName = identifier.substring(idsplitindex + 1);\n    stateArrayValues.push({\n      index: i,\n      key: i,\n      id: {\n        prefix: identifierPrefix,\n        value: identifierName.trim(),\n        line: i,\n        startindex: idsplitindex,\n        endindex: splitindex\n      },\n      exp: {\n        value: expression.trim(),\n        line: i,\n        startindex: splitindex,\n        endindex: -1\n      }\n    });\n  }\n  return {\n    advancedMode: !!props.advancedMode,\n    collapsed: props.collapsed === !!props.collapsed,\n    ta: textAreaState,\n    arr: stateArrayValues\n  };\n}\n\n// event listing start\n// it's not on purpose, but this function is a candidate for obscure code context XD\nfunction addClick(v, set) {\n  var _v$arr$index, _v$arr, _v$arr$key, _v$arr2, _v$arr$;\n  let lasti = ((_v$arr$index = (_v$arr = v.arr[v.arr.length - 1]) === null || _v$arr === void 0 ? void 0 : _v$arr.index) !== null && _v$arr$index !== void 0 ? _v$arr$index : -1) + 1;\n  let lastk = ((_v$arr$key = (_v$arr2 = v.arr[v.arr.length - 1]) === null || _v$arr2 === void 0 ? void 0 : _v$arr2.key) !== null && _v$arr$key !== void 0 ? _v$arr$key : -1) + 1;\n  set({\n    ...v,\n    arr: [...v.arr, {\n      index: lasti,\n      key: lastk,\n      id: {\n        prefix: ((_v$arr$ = v.arr[0]) === null || _v$arr$ === void 0 ? void 0 : _v$arr$.id.prefix) || \"ret\",\n        value: \"\"\n      },\n      exp: {\n        value: \"\"\n      }\n    }]\n  });\n}\n\n// function fixIndex(i: number, rows: RowData[]): number{ for (let row of rows) if (row.index === ) }\nfunction deleteClick(v0, set, i, props, row) {\n  // do i really need to shallow copy nested objects too? it should not be necessary\n  let v = {\n    ...v0\n  }; //, arr:[...v0.arr]};\n  /// problem: deleting an element in the middle invalidetes the row.index values\n  /// solution 1: update the row.index values, move the rect key to a different field that is initial = index, but never changes.\n  /// implemented\n  v.arr.splice(i, 1);\n  for (; i < v.arr.length; i++) v.arr[i].index = i;\n  /// solution 2: keep original indexes, use a fixIndex function to map the index in html (without holes) to index in row structure (with holes).\n  ///  discareded\n\n  set(v);\n  onBlur(v, set, props, undefined, true);\n}\nfunction expressionChange(e, i, v, set) {\n  v = {\n    ...v,\n    arr: [...v.arr]\n  };\n  v.arr[i] = {\n    ...v.arr[i],\n    isDirty: true,\n    exp: {\n      ...v.arr[i].exp,\n      value: e.currentTarget.value\n    }\n  };\n  set(v);\n}\nfunction identifierChange(e, i, v, set) {\n  let nv = e.currentTarget.value;\n  v = {\n    ...v,\n    arr: [...v.arr]\n  };\n  v.arr[i] = {\n    ...v.arr[i],\n    isDirty: true,\n    // empty string is fine, as long value is empty too the entire row is ignored. but identifiers cannot start with a number are not allowed.\n    id: {\n      ...v.arr[i].id,\n      value: isNaN(+nv[0]) ? nv : \"A\" + nv\n    }\n  };\n  set(v);\n}\nfunction textAreaChange(e, v, set) {\n  set({\n    ...v,\n    ta: {\n      v: e.currentTarget.value,\n      isDirty: true\n    }\n  });\n}\nfunction onBlur(v, set, props, i, isDelete) {\n  if (isDelete) {\n    // force update without checking dirty (the row is not present anymore)\n  }\n  // problem: this might be called before the onChange setState() actually edits the state, so it finds isDirty false or even a non-yet existing index\n  // for now i will just hope the user is not typing and blurring extra fast, i don't think a simple solution exists\n  else if (i !== undefined) {\n    var _v$arr$i;\n    if (!((_v$arr$i = v.arr[i]) === null || _v$arr$i === void 0 ? void 0 : _v$arr$i.isDirty)) return;\n    v = {\n      ...v,\n      arr: [...v.arr]\n    };\n    v.arr[i] = {\n      ...v.arr[i],\n      isDirty: false\n    };\n    set(v);\n  } else {\n    if (!v.ta.isDirty) return;\n    set({\n      ...v,\n      ta: {\n        v: v.ta.v,\n        isDirty: false\n      }\n    });\n  }\n  updateFunctionValue(props, v.ta.v, v.arr);\n}\nfunction updateFunctionValue(props, textAreaContent, stateArrayValues) {\n  let declarations = stateArrayValues.map(o => o.id.value && o.exp.value ? o.id.prefix + \".\" + o.id.value + \" = \" + o.exp.value : '');\n  let setter = props.setter || (v => props.data[props.field] = v);\n  setter(textAreaContent + \"\\n// ** declarations here ** //\\n\" + declarations.filter(d => !!d).join(\"\\n\") + \"\\n}\");\n}\n// event listing end\n\nfunction FunctionComponent(props) {\n  _s();\n  var _ref;\n  // if (false) return asTextArea(props) // i gave up\n  const [state, setState] = useStateIfMounted(parseFunction(props));\n  const [showTooltip, setShowTooltip] = useStateIfMounted(false);\n  // if (!props.data) return <></>;\n  let advancedMode = state.advancedMode,\n    readOnly = props.readonly; // (props.readonly !== undefined) ? props.readonly : !props.debugMode && props.data.id.indexOf(\"Pointer_View\") !== -1;\n\n  // NB: could be heavily optimized by cutting the original string with indexes and substring,\n  // but it is a function called too rarely and not impactful on overall performances\n\n  let tooltip = props.tooltip === true ? (_ref = props.data['__info_of__' + props.field]) === null || _ref === void 0 ? void 0 : _ref.txt : props.tooltip;\n\n  // JSX building start\n  let inputs = [];\n  // console.log(\"funccomp\", {stateArrayValues, textAreaState, props});\n\n  for (let row of state.arr) {\n    inputs.push( /*#__PURE__*/_jsxDEV(\"label\", {\n      className: \"d-flex\" + (advancedMode ? \"\" : \" my-1\"),\n      \"data-key\": row.index,\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"my-auto detailedMode\",\n        children: [row.id.prefix, \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"my-auto input\",\n        placeholder: \"identifier\",\n        value: row.id.value,\n        disabled: readOnly,\n        tabIndex: row.index * 2,\n        onInput: e => identifierChange(e, row.index, state, setState),\n        onBlur: e => !readOnly && onBlur(state, setState, props, row.index)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"my-auto mx-1 simpleMode\",\n        style: {\n          fontWeight: \"bold\"\n        },\n        children: \"\\u21E0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"my-auto mx-1 detailedMode\",\n        children: \"=\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"my-auto input\",\n        placeholder: \"expression\",\n        value: row.exp.value,\n        disabled: readOnly,\n        tabIndex: row.index * 2 + 1,\n        onInput: e => expressionChange(e, row.index, state, setState),\n        onBlur: e => !readOnly && onBlur(state, setState, props, row.index)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"my-auto detailedMode\",\n        children: \";\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-danger my-auto ms-2\",\n        tabIndex: state.arr.length * 2 + 1 + row.index,\n        disabled: readOnly,\n        onClick: () => !readOnly && deleteClick(state, setState, row.index, props, row),\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"p-1 bi bi-trash3-fill\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 13\n      }, this)]\n    }, row.index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 21\n    }, this));\n  }\n  let transitionTime = 300;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"function-editor-root\",\n    \"data-mode\": advancedMode ? \"detailedMode\" : \"simpleMode\",\n    style: {\n      fontSize: \"0.9rem\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"d-flex w-100\",\n      style: {\n        transition: \"all 300ms\",\n        cursor: tooltip ? 'help' : 'auto'\n      },\n      onMouseEnter: e => tooltip && setShowTooltip(true),\n      onMouseLeave: e => tooltip && setShowTooltip(false),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"function-editor-header w-100 d-flex\",\n        children: [props.jsxLabel, /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-secondary function-editor-add\",\n          tabIndex: state.arr.length * 2,\n          disabled: readOnly,\n          onClick: () => !readOnly && addClick(state, setState),\n          children: \"+\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"m-auto me-1\",\n        style: {\n          cursor: 'auto'\n        },\n        children: [tooltip && /*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"p1 m-auto me-1 bi bi-info-lg\",\n          style: {\n            cursor: 'help'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"m-auto\",\n          style: {\n            cursor: 'auto',\n            height: \"100%\",\n            display: \"inline-block\"\n          },\n          onMouseEnter: e => tooltip && setShowTooltip(false),\n          onMouseLeave: e => tooltip && setShowTooltip(true),\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"p1 m-auto mx-1 bi \" + (advancedMode ? \"btn-outline-secondary bi-eye-slash-fill\" : \"btn-outline-secondary bi-eye-fill\"),\n            onClick: () => setState({\n              ...state,\n              advancedMode: !state.advancedMode\n            }),\n            style: {\n              cursor: 'pointer'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"p1 bi m-auto mx-1 bi bi-chevron-down btn-outline-secondary\",\n            onClick: () => setState({\n              ...state,\n              collapsed: !state.collapsed\n            }),\n            style: {\n              cursor: 'pointer',\n              transition: transitionTime / 2 + \"ms all\",\n              transform: \"scaleY(\" + (state.collapsed ? 1 : -1) + \")  translateY(\" + (state.collapsed ? -0 : 0.1) + \"em)\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"p1 m-auto mx-1 bi btn btn-danger bi-trash3-fill\",\n            disabled: !props.data.__raw[props.field],\n            onClick: () => {\n              setState({\n                ...state,\n                ta: {\n                  ...state.ta,\n                  v: minimalTextareaValue\n                },\n                arr: []\n              });\n              props.data[props.field] = undefined;\n            },\n            style: {\n              cursor: 'pointer'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 9\n    }, this), tooltip && showTooltip && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: 'my-tooltip',\n      children: [/*#__PURE__*/_jsxDEV(\"b\", {\n        className: 'text-center text-capitalize',\n        children: props.field\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: tooltip\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 38\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      \"data-comment\": \"collapsable-section\",\n      style: {\n        transition: transitionTime + \"ms all\",\n        // transformOrigin: \"top\", transform: \"rotateX(\"+(state.collapsed ? 0 : 90 )+\"deg)\",\n        transform: \"scaleY(\" + (state.collapsed ? 0 : 1) + \")\",\n        overflow: \"hidden\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: \"detailedMode input w-100\",\n        disabled: readOnly,\n        rows: Math.min(10, state.ta.v.split(\"\\n\").length),\n        onInput: e => textAreaChange(e, state, setState),\n        onBlur: e => !readOnly && onBlur(state, setState, props),\n        \"data-txtcontent\": state.ta.v,\n        value: state.ta.v\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 13\n      }, this), inputs, false && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          whiteSpace: \"pre\"\n        },\n        children: props.data[props.field]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 10\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 205,\n    columnNumber: 12\n  }, this);\n}\n_s(FunctionComponent, \"Bviltdm45UY/nK1pk7UeuowBwqM=\", false, function () {\n  return [useStateIfMounted, useStateIfMounted];\n});\n_c = FunctionComponent;\n/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n  return ownProps;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const FunctionConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(FunctionComponent);\r\n*/ // export const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionConnected {...{...props, children}} />);\nexport const Function = function (props) {\n  let children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return /*#__PURE__*/_jsxDEV(FunctionComponent, {\n    ...props,\n    children,\n    tooltip: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 298,\n    columnNumber: 106\n  }, _this);\n};\n_c2 = Function;\nFunction.cname = \"FunctionComponent\";\n// FunctionConnected.cname = \"FunctionComponent_Connected\";\nFunctionComponent.cname = \"FunctionComponent_Disconnected\";\nvar _c, _c2;\n$RefreshReg$(_c, \"FunctionComponent\");\n$RefreshReg$(_c2, \"Function\");","map":{"version":3,"names":["React","Log","useStateIfMounted","jsxDEV","_jsxDEV","minimalTextareaValue","parseFunction","props","exDev","data","getter","a","field","val","length","trim","txtparts","split","eDevv","substring","declarations","stateArrayValues","textAreaState","v","i","dec","splitindex","indexOf","expression","identifier","idsplitindex","identifierPrefix","identifierName","push","index","key","id","prefix","value","line","startindex","endindex","exp","advancedMode","collapsed","ta","arr","addClick","set","_v$arr$index","_v$arr","_v$arr$key","_v$arr2","_v$arr$","lasti","lastk","deleteClick","v0","row","splice","onBlur","undefined","expressionChange","e","isDirty","currentTarget","identifierChange","nv","isNaN","textAreaChange","isDelete","_v$arr$i","updateFunctionValue","textAreaContent","map","o","setter","filter","d","join","FunctionComponent","_s","_ref","state","setState","showTooltip","setShowTooltip","readOnly","readonly","tooltip","txt","inputs","className","children","fileName","_jsxFileName","lineNumber","columnNumber","placeholder","disabled","tabIndex","onInput","style","fontWeight","onClick","transitionTime","fontSize","transition","cursor","onMouseEnter","onMouseLeave","jsxLabel","height","display","transform","__raw","overflow","rows","Math","min","whiteSpace","_c","Function","arguments","_this","_c2","cname","$RefreshReg$"],"sources":["C:/d/Programming/web/jodel-mde/src/components/forEndUser/FunctionComponent.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement, ReactNode, useEffect, useState} from 'react';\r\nimport {connect} from \"react-redux\";\r\nimport type {Dictionary, DocString, GObject, DState, LViewElement, Pointer, Info} from \"../../joiner\";\r\nimport {Log, LPointerTargetable, U} from \"../../joiner\";\r\nimport {useStateIfMounted} from \"use-state-if-mounted\";\r\nimport {stringify} from \"querystring\";\r\nimport \"./FunctionComponent.scss\";\r\n\r\n/*\r\n Rationale behind this:\r\n To do this properly, one would need a complete js parser to make sure comments, ifs, loops, newlines,\r\n   expressions inside array indexing for objects... are all correctly parsed.\r\n\r\n\r\n Instead, to make it faster, i'm forcing the valid \"function string\" value to hold a much more definite structure\r\n   for which i can do an extremely simpler inline parser.\r\n The getter and setter properties and the interface, are making sure the user cannot write a \"function string\"\r\n   not respecting my format, and that it is as much turing-complete as javascript is.\r\n\r\n legenda:\r\n  - ALL_CAPS identifiers, are not literals and the user can change their names.\r\n  - Newlines are included in the format, spaces are not.\r\n  - ... are explaining the format and are not part of it.\r\n  - // **   ** // Styled comments ARE part of the format.\r\n  - Excess spaces in the format are not preserved (might be added/removed by getter/setter), but not mandatory and not relevant.\r\n\r\n my structure is:\r\n (OBJECT_NAME)=> {\\n\r\n   STATEMENT_A1\r\n   STATEMENT_A2\r\n   ...\r\n   STATEMENT_AN\r\n   \\n// ** declarations here ** //\\n\r\n   OBJECT_NAME.IDENTIFIER_1 = STATEMENT_1;\\n\r\n   OBJECT_NAME.IDENTIFIER_2 = STATEMENT_2;\\n\r\n   ...\r\n   OBJECT_NAME.IDENTIFIER_N = STATEMENT_N;\\n\r\n }\r\n */\r\n\r\ntype StrPos = {value: string, line?: number, startindex?: number, endindex?: number};\r\ntype RowData = {index: number; key: number, id: StrPos & { prefix: string }; exp: StrPos, isDirty?: boolean};\r\ntype TextAreaState = {v:string, isDirty?: boolean};\r\ntype FunctionComponentState = {advancedMode: boolean, collapsed: boolean, ta: TextAreaState, arr: RowData[]};\r\ntype SetState = (value: FunctionComponentState)=>void;\r\nconst minimalTextareaValue = '(ret)=>{\\n';\r\n\r\nfunction parseFunction(props: AllProps): FunctionComponentState {\r\n    Log.exDev(!props.data, \"FunctionComponent: missing data props\", {props});\r\n    let getter = props.getter || ((a: GObject) => a[props.field]); // ((lobj: GObject<LPointerTargetable>, key: string) => U.wrapUserFunction(lobj[key]));\r\n    let val: string = getter(props.data);\r\n    if (!val || val.length <= 2) val = \"(ret)=>{\\n    // ** declarations here ** //\\n\\n}\"; // fallback for empty string and {}\r\n    else val = val.trim();\r\n    let txtparts = val.split(\"// ** declarations here ** //\");\r\n    if (txtparts.length !== 2) {\r\n        Log.eDevv(\"cannot find declaration section\", {val, props});\r\n        txtparts = [val.substring(0, val.length-1), val.substring(val.length-1)];\r\n    }\r\n    let declarations: string[] = (txtparts[1] || '').split(\"\\n\");\r\n    let stateArrayValues: RowData[] = [];\r\n    let textAreaState: TextAreaState = {v: txtparts[0]};\r\n    let i: number = -1;\r\n    for (let dec of declarations) {\r\n        let splitindex = dec.indexOf(\"=\");\r\n        if (splitindex === -1) continue; // for ending \\n} line\r\n        i++; // don't loop by i, the index ending in state must increase only for non-empty rows filtering them out.\r\n        let expression = dec.substring(splitindex+1);\r\n        let identifier = dec.substring(0, splitindex);\r\n        let idsplitindex = identifier.indexOf(\".\");\r\n        let identifierPrefix = identifier.substring(0, idsplitindex);\r\n        let identifierName = identifier.substring(idsplitindex+1);\r\n        stateArrayValues.push({\r\n            index: i,\r\n            key: i,\r\n            id: {prefix: identifierPrefix, value: identifierName.trim(), line: i, startindex: idsplitindex, endindex: splitindex},\r\n            exp:{                          value: expression.trim(),     line: i, startindex: splitindex,   endindex: -1}\r\n        });\r\n    }\r\n    return {advancedMode: !!props.advancedMode, collapsed: props.collapsed === !!props.collapsed, ta: textAreaState, arr:stateArrayValues};\r\n}\r\n\r\n// event listing start\r\n// it's not on purpose, but this function is a candidate for obscure code context XD\r\nfunction addClick(v: FunctionComponentState, set: SetState): void {\r\n    let lasti: number = (v.arr[v.arr.length-1]?.index ?? -1) +1;\r\n    let lastk: number = (v.arr[v.arr.length-1]?.key ?? -1) +1;\r\n    set({...v, arr: [...v.arr, {index: lasti, key: lastk,\r\n            id: {prefix: v.arr[0]?.id.prefix || \"ret\", value: \"\"},\r\n            exp: {value: \"\"} }]\r\n    });\r\n}\r\n\r\n// function fixIndex(i: number, rows: RowData[]): number{ for (let row of rows) if (row.index === ) }\r\nfunction deleteClick(v0: FunctionComponentState, set: SetState, i: number, props: AllProps, row:RowData): void {\r\n    // do i really need to shallow copy nested objects too? it should not be necessary\r\n    let v = {...v0} //, arr:[...v0.arr]};\r\n    /// problem: deleting an element in the middle invalidetes the row.index values\r\n    /// solution 1: update the row.index values, move the rect key to a different field that is initial = index, but never changes.\r\n    /// implemented\r\n    v.arr.splice(i, 1);\r\n    for (; i < v.arr.length; i++) v.arr[i].index = i;\r\n    /// solution 2: keep original indexes, use a fixIndex function to map the index in html (without holes) to index in row structure (with holes).\r\n    ///  discareded\r\n\r\n    set(v);\r\n    onBlur(v, set, props, undefined, true);\r\n}\r\n\r\nfunction expressionChange(e: React.FormEvent<HTMLInputElement>, i: number, v: FunctionComponentState, set: SetState): void {\r\n    v = {...v, arr:[...v.arr]};\r\n    v.arr[i] = {\r\n        ...v.arr[i],\r\n        isDirty: true,\r\n        exp: {...v.arr[i].exp, value: e.currentTarget.value}\r\n    };\r\n    set(v);\r\n}\r\n\r\nfunction identifierChange(e: React.FormEvent<HTMLInputElement>, i: number, v: FunctionComponentState, set: SetState): void {\r\n    let nv = e.currentTarget.value;\r\n    v = {...v, arr:[...v.arr]};\r\n    v.arr[i] = {\r\n        ...v.arr[i],\r\n        isDirty: true,\r\n        // empty string is fine, as long value is empty too the entire row is ignored. but identifiers cannot start with a number are not allowed.\r\n        id: {...v.arr[i].id, value: isNaN(+nv[0]) ? nv : \"A\" + nv}\r\n    };\r\n    set(v);\r\n}\r\n\r\nfunction textAreaChange(e: React.FormEvent<HTMLTextAreaElement>, v: FunctionComponentState, set: SetState): void {\r\n    set({...v, ta: {v:e.currentTarget.value, isDirty: true} });\r\n}\r\n\r\nfunction onBlur(v: FunctionComponentState, set: SetState, props: AllProps, i?: number, isDelete?: boolean) {\r\n    if (isDelete) {\r\n        // force update without checking dirty (the row is not present anymore)\r\n    }\r\n    // problem: this might be called before the onChange setState() actually edits the state, so it finds isDirty false or even a non-yet existing index\r\n        // for now i will just hope the user is not typing and blurring extra fast, i don't think a simple solution exists\r\n    else if (i !== undefined) {\r\n        if (!v.arr[i]?.isDirty) return;\r\n        v = {...v, arr:[...v.arr]};\r\n        v.arr[i] = {\r\n            ...v.arr[i],\r\n            isDirty: false,\r\n        };\r\n        set(v);\r\n    }\r\n    else {\r\n        if (!v.ta.isDirty) return;\r\n        set({...v, ta: {v: v.ta.v, isDirty: false} });\r\n    }\r\n    updateFunctionValue(props, v.ta.v, v.arr);\r\n}\r\n\r\nfunction updateFunctionValue(props: AllProps, textAreaContent: string, stateArrayValues: RowData[]){\r\n    let declarations: string[] = stateArrayValues.map( o => o.id.value && o.exp.value ? o.id.prefix + \".\" + o.id.value + \" = \" + o.exp.value : '');\r\n    let setter = props.setter || ((v: string) => (props.data as GObject)[props.field] = v);\r\n    setter(textAreaContent + \"\\n// ** declarations here ** //\\n\" + declarations.filter(d=>!!d).join(\"\\n\") + \"\\n}\")\r\n}\r\n// event listing end\r\n\r\nfunction FunctionComponent(props: AllProps) {\r\n    // if (false) return asTextArea(props) // i gave up\r\n    const [state, setState] = useStateIfMounted(parseFunction(props));\r\n    const [showTooltip, setShowTooltip] = useStateIfMounted(false);\r\n    // if (!props.data) return <></>;\r\n    let advancedMode: boolean = state.advancedMode,\r\n        readOnly = props.readonly; // (props.readonly !== undefined) ? props.readonly : !props.debugMode && props.data.id.indexOf(\"Pointer_View\") !== -1;\r\n\r\n    // NB: could be heavily optimized by cutting the original string with indexes and substring,\r\n    // but it is a function called too rarely and not impactful on overall performances\r\n\r\n    let tooltip: string|undefined | ReactNode = (props.tooltip === true) ? (props.data as GObject)['__info_of__' + props.field]?.txt : props.tooltip;\r\n\r\n\r\n    // JSX building start\r\n    let inputs: JSX.Element[] = [];\r\n    // console.log(\"funccomp\", {stateArrayValues, textAreaState, props});\r\n\r\n\r\n    for (let row of state.arr) {\r\n        inputs.push(<label className={\"d-flex\" + (advancedMode ? \"\" : \" my-1\")} key={row.index} data-key={row.index}>\r\n            <span className={\"my-auto detailedMode\"}>{row.id.prefix}.</span>\r\n            <input className={\"my-auto input\"} placeholder={\"identifier\"} value={row.id.value}  disabled={readOnly}\r\n                   tabIndex={row.index*2}\r\n                   onInput={(e)=>identifierChange(e, row.index, state, setState)}\r\n                   onBlur={(e)=> !readOnly && onBlur(state, setState, props, row.index)}\r\n            />\r\n            <span className={\"my-auto mx-1 simpleMode\"} style={{fontWeight: \"bold\"}}>⇠</span>\r\n            <span className={\"my-auto mx-1 detailedMode\"}>=</span>\r\n            <input className={\"my-auto input\"} placeholder={\"expression\"} value={row.exp.value} disabled={readOnly}\r\n                   tabIndex={row.index*2+1}\r\n                   onInput={(e)=>expressionChange(e, row.index, state, setState)}\r\n                   onBlur={(e)=> !readOnly && onBlur(state, setState, props, row.index)}\r\n            />\r\n            <span className={\"my-auto detailedMode\"}>;</span>\r\n            <button className={\"btn btn-danger my-auto ms-2\"} tabIndex={state.arr.length*2 +1 +row.index} disabled={readOnly} onClick={()=>!readOnly && deleteClick(state, setState, row.index, props, row)}>\r\n                <i className={\"p-1 bi bi-trash3-fill\"} /></button>\r\n        </label>);\r\n    }\r\n\r\n    let transitionTime = 300;\r\n    return <div className={\"function-editor-root\"} data-mode={advancedMode ? \"detailedMode\" : \"simpleMode\"} style={{fontSize: \"0.9rem\"}}>\r\n        <div className={\"d-flex w-100\"} style={{transition: \"all 300ms\",  cursor: tooltip ? 'help' : 'auto'}}\r\n             onMouseEnter={e => tooltip && setShowTooltip(true)} onMouseLeave={e =>  tooltip && setShowTooltip(false)}>\r\n            <div className={\"function-editor-header w-100 d-flex\"}>\r\n                {props.jsxLabel}\r\n                <button className={\"btn btn-secondary function-editor-add\"} tabIndex={state.arr.length*2}\r\n                        disabled={readOnly} onClick={()=> !readOnly && addClick(state, setState)}>+</button>\r\n            </div>\r\n            <span className={\"m-auto me-1\"} style={{cursor: 'auto'}}>\r\n                {tooltip && <i className={\"p1 m-auto me-1 bi bi-info-lg\"} style={{cursor: 'help'}} />}\r\n\r\n                <span className={\"m-auto\"} style={{cursor: 'auto', height: \"100%\", display: \"inline-block\"}}\r\n                      onMouseEnter={e => tooltip && setShowTooltip(false)} onMouseLeave={e =>  tooltip && setShowTooltip(true)}\r\n                >\r\n                <i className={ \"p1 m-auto mx-1 bi \" + (advancedMode ? \"btn-outline-secondary bi-eye-slash-fill\" : \"btn-outline-secondary bi-eye-fill\")}\r\n                   onClick={()=>setState( {...state, advancedMode:!state.advancedMode})} style={{cursor: 'pointer'}} />\r\n                <i className={ \"p1 bi m-auto mx-1 bi bi-chevron-down btn-outline-secondary\"}\r\n                   onClick={()=>setState( {...state, collapsed:!state.collapsed})}\r\n                   style={{cursor: 'pointer', transition:transitionTime/2 + \"ms all\",\r\n                       transform: \"scaleY(\"+(state.collapsed ? 1 : -1 )+\")  translateY(\" + (state.collapsed ? -0 : 0.1) +\"em)\",\r\n                   }} />\r\n                <button className={ \"p1 m-auto mx-1 bi btn btn-danger bi-trash3-fill\"} disabled={!(props.data.__raw as GObject)[props.field]}\r\n                        onClick={()=>{ setState( {...state,  ta: {...state.ta, v:minimalTextareaValue}, arr: []}); (props.data as GObject)[props.field] = undefined}}\r\n                        style={{cursor: 'pointer'}} />\r\n                </span>\r\n            </span>\r\n        </div>\r\n        {(tooltip && showTooltip) && <div className={'my-tooltip'}>\r\n            <b className={'text-center text-capitalize'}>{props.field}</b>\r\n            <br />\r\n            <label>{tooltip}</label>\r\n        </div>}\r\n        {<div data-comment={\"collapsable-section\"} style={{transition: transitionTime + \"ms all\",\r\n            // transformOrigin: \"top\", transform: \"rotateX(\"+(state.collapsed ? 0 : 90 )+\"deg)\",\r\n            transform: \"scaleY(\"+(state.collapsed ? 0 : 1 )+\")\",\r\n            overflow:\"hidden\"}}>\r\n            <textarea className={\"detailedMode input w-100\"} disabled={readOnly} rows={Math.min(10, state.ta.v.split(\"\\n\").length)}\r\n                  onInput={(e)=>textAreaChange(e, state, setState)}\r\n                  onBlur={(e)=> !readOnly && onBlur(state, setState, props)}\r\n                  data-txtcontent={state.ta.v}\r\n                  value={state.ta.v}\r\n        />\r\n        {inputs}\r\n        {false && <div style={{whiteSpace:\"pre\"}}>{(props.data as any)[props.field]}</div>}\r\n        </div>}\r\n    </div>;\r\n}\r\n\r\ninterface OwnProps {\r\n    advancedMode?: boolean; // toggle textbox pre-declarations, initial value to set state. after initialization only state.advancedMode is used\r\n    collapsed?: boolean; // start collapsed or visible, default value is false = visible\r\n    data: LPointerTargetable;\r\n    field: string;\r\n    getter?: (data: LPointerTargetable) => string;\r\n    setter?: (value: string|boolean) => void;\r\n    readonly?: boolean;\r\n    // not used for now\r\n    label?: string;\r\n    jsxLabel?: ReactNode;\r\n    className?: string;\r\n    style?: GObject;\r\n    tooltip?: string | boolean | ReactElement;\r\n    hidden?: boolean;\r\n    autosize?: boolean;\r\n    inputClassName?: string;\r\n    inputStyle?: GObject;\r\n    asLabel?: boolean;\r\n    key?: React.Key | null;\r\n}\r\n\r\ninterface StateProps {\r\n}\r\n\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n  return ownProps;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const FunctionConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(FunctionComponent);\r\n*/\r\n// export const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionConnected {...{...props, children}} />);\r\nexport const Function = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => (<FunctionComponent {...{...props, children}} tooltip={true} />);\r\n\r\nFunction.cname = \"FunctionComponent\";\r\n// FunctionConnected.cname = \"FunctionComponent_Connected\";\r\nFunctionComponent.cname = \"FunctionComponent_Disconnected\";\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}