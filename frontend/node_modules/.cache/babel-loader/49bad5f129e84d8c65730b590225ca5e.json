{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect}from'react';import{connect}from'react-redux';import Editor,{useMonaco}from'@monaco-editor/react';import{LViewElement,Defaults}from'../../../joiner';import{useStateIfMounted}from'use-state-if-mounted';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function JsEditorComponent(props){var view=props.view,field=props.field,placeHolder=props.placeHolder,height=props.height,title=props.title,getter=props.getter,setter=props.setter,jsxLabel=props.jsxLabel;var _useStateIfMounted=useStateIfMounted(view.jsCondition),_useStateIfMounted2=_slicedToArray(_useStateIfMounted,2),js=_useStateIfMounted2[0],setJs=_useStateIfMounted2[1];var _useStateIfMounted3=useStateIfMounted(false),_useStateIfMounted4=_slicedToArray(_useStateIfMounted3,2),show=_useStateIfMounted4[0],setShow=_useStateIfMounted4[1];var readOnly=props.readonly!==undefined?props.readonly:Defaults.check(view.id);var change=function change(value){/* save in local state for frequent changes */if(value!==undefined)setJs(value);};var blur=function blur(){/* confirm in redux state for final state */if(js&&setter)setter(js);else if(field)view[field]=js;};var monaco=useMonaco();window.monaco=monaco;useEffect(function(){if(!monaco)return;monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.Latest,allowNonTsExtensions:true,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:monaco.languages.typescript.ModuleKind.CommonJS,noEmit:true,esModuleInterop:true,reactNamespace:'React',allowJs:true,typeRoots:['node_modules/@types']//, 'src/static/'], // doubt those can be accesed at runtime but trying\n});monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:false,noSyntaxValidation:false});monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);monaco.languages.typescript.typescriptDefaults.addExtraLib(\"declare var data: 'datatype';\");},[monaco]);var value='';if(getter)value=getter();else if(placeHolder)value=placeHolder;else if(field&&view[field])value=view[field];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread({},props.style||{}),className:'d-flex',children:[/*#__PURE__*/_jsx(\"span\",{className:'cursor-pointer my-auto',tabIndex:-1,onClick:function onClick(e){return setShow(!show);},children:show?/*#__PURE__*/_jsx(\"i\",{className:'bi bi-eye-fill'}):/*#__PURE__*/_jsx(\"i\",{className:'bi bi-eye-slash-fill'})}),/*#__PURE__*/_jsx(\"label\",{className:'ms-2 mb-1 my-auto',children:title||'JS Editor'}),jsxLabel&&jsxLabel]}),show&&/*#__PURE__*/_jsx(\"div\",{className:'monaco-editor-wrapper',style:{padding:'5px',minHeight:'20px',height:height?\"\".concat(height,\"px\"):'100px',resize:'vertical',overflow:'hidden'},tabIndex:-1,onBlur:blur,children:/*#__PURE__*/_jsx(Editor,{className:'mx-1',onChange:change,options:{fontSize:12,scrollbar:{vertical:'hidden',horizontalScrollbarSize:5},minimap:{enabled:false},readOnly:readOnly},defaultLanguage:'typescript',value:value})})]});}function mapStateToProps(state,ownProps){var ret={};ret.view=LViewElement.fromPointer(ownProps.viewID);return ret;}function mapDispatchToProps(dispatch){var ret={};return ret;}export var JsEditorConnected=connect(mapStateToProps,mapDispatchToProps)(JsEditorComponent);export var JsEditor=function JsEditor(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(JsEditorConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};JsEditorComponent.cname='JsEditorComponent';JsEditorConnected.cname='JsEditorConnected';JsEditor.cname='JsEditor';export default JsEditor;","map":{"version":3,"names":["React","useEffect","connect","Editor","useMonaco","LViewElement","Defaults","useStateIfMounted","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","JsEditorComponent","props","view","field","placeHolder","height","title","getter","setter","jsxLabel","_useStateIfMounted","jsCondition","_useStateIfMounted2","_slicedToArray","js","setJs","_useStateIfMounted3","_useStateIfMounted4","show","setShow","readOnly","readonly","undefined","check","id","change","value","blur","monaco","window","languages","typescript","typescriptDefaults","setCompilerOptions","target","ScriptTarget","Latest","allowNonTsExtensions","moduleResolution","ModuleResolutionKind","NodeJs","module","ModuleKind","CommonJS","noEmit","esModuleInterop","reactNamespace","allowJs","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","javascriptDefaults","setEagerModelSync","addExtraLib","children","style","_objectSpread","className","tabIndex","onClick","e","padding","minHeight","concat","resize","overflow","onBlur","onChange","options","fontSize","scrollbar","vertical","horizontalScrollbarSize","minimap","enabled","defaultLanguage","mapStateToProps","state","ownProps","ret","fromPointer","viewID","mapDispatchToProps","dispatch","JsEditorConnected","JsEditor","arguments","length","cname"],"sources":["C:/d/Programming/web/jodel-mde/src/components/rightbar/jsEditor/JsEditor.tsx"],"sourcesContent":["import React, {CSSProperties, Dispatch, ReactElement, ReactNode, useEffect} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport Editor, {useMonaco} from '@monaco-editor/react';\r\nimport {DState, DViewElement, LViewElement, Pointer, Defaults} from '../../../joiner';\r\nimport {useStateIfMounted} from 'use-state-if-mounted';\r\nimport {FakeStateProps} from '../../../joiner/types';\r\n\r\nfunction JsEditorComponent(props: AllProps) {\r\n    const {view, field, placeHolder, height, title, getter, setter, jsxLabel} = props;\r\n    const [js, setJs] = useStateIfMounted(view.jsCondition);\r\n    const [show, setShow] = useStateIfMounted(false);\r\n    const readOnly = props.readonly !== undefined ? props.readonly : Defaults.check(view.id);\r\n    const change = (value: string|undefined) => {\r\n        /* save in local state for frequent changes */\r\n        if(value !== undefined) setJs(value);\r\n    }\r\n    const blur = () => {\r\n        /* confirm in redux state for final state */\r\n        if(js && setter) setter(js);\r\n        else if(field) (view as any)[field] = js;\r\n    }\r\n    const monaco = useMonaco();\r\n    (window as any).monaco = monaco;\r\n\r\n    useEffect(() => {\r\n        if (!monaco) return;\r\n        monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\r\n            target: monaco.languages.typescript.ScriptTarget.Latest,\r\n            allowNonTsExtensions: true,\r\n            moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,\r\n            module: monaco.languages.typescript.ModuleKind.CommonJS,\r\n            noEmit: true,\r\n            esModuleInterop: true,\r\n            reactNamespace: 'React',\r\n            allowJs: true,\r\n            typeRoots: ['node_modules/@types']//, 'src/static/'], // doubt those can be accesed at runtime but trying\r\n        });\r\n        monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false, noSyntaxValidation: false });\r\n        monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);\r\n        monaco.languages.typescript.typescriptDefaults.addExtraLib(`declare var data: 'datatype';`);\r\n        }, [monaco]);\r\n\r\n    let value = '';\r\n    if(getter) value = getter();\r\n    else if(placeHolder) value = placeHolder;\r\n    else if(field && view[field]) value = (view as any)[field];\r\n\r\n    return <>\r\n        <div style={{...(props.style || {})}} className={'d-flex'}>\r\n            <span className={'cursor-pointer my-auto'} tabIndex={-1} onClick={e => setShow(!show)}>\r\n                {show ? <i className={'bi bi-eye-fill'} /> : <i className={'bi bi-eye-slash-fill'} /> }\r\n            </span>\r\n            <label className={'ms-2 mb-1 my-auto'}>\r\n                {title || 'JS Editor'}\r\n            </label>\r\n            {jsxLabel && jsxLabel}\r\n        </div>\r\n        {show && <div className={'monaco-editor-wrapper'}\r\n             style={{padding: '5px', minHeight: '20px', height: height ? `${height}px` : '100px', resize: 'vertical', overflow:'hidden'}}\r\n             tabIndex={-1} onBlur={blur}>\r\n            <Editor className={'mx-1'} onChange={change}\r\n                    options={{fontSize: 12, scrollbar: {vertical: 'hidden', horizontalScrollbarSize: 5}, minimap: {enabled: false}, readOnly: readOnly}}\r\n                    defaultLanguage={'typescript'} value={value} />\r\n        </div>}\r\n    </>;\r\n}\r\ninterface OwnProps {\r\n    readonly?: boolean;\r\n    viewID: Pointer<DViewElement, 1, 1, LViewElement>;\r\n    field?: keyof LViewElement;\r\n    placeHolder?: string;\r\n    title?: ReactNode;\r\n    height?: number;\r\n    style?: CSSProperties;\r\n    jsxLabel?: ReactNode;\r\n    getter?: () => string;\r\n    setter?: (js: string) => void;\r\n}\r\ninterface StateProps { view: LViewElement }\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    ret.view = LViewElement.fromPointer(ownProps.viewID);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const JsEditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(JsEditorComponent);\r\n\r\nexport const JsEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <JsEditorConnected {...{...props, children}} />;\r\n}\r\n\r\nJsEditorComponent.cname = 'JsEditorComponent';\r\nJsEditorConnected.cname = 'JsEditorConnected';\r\nJsEditor.cname = 'JsEditor';\r\nexport default JsEditor;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}