{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React from'react';import{TRANSACTION,SetFieldAction,store,LPointerTargetable}from'../../../joiner';import{Defaults,DUser,DViewElement,LUser}from'../../../joiner';import{connect}from\"react-redux\";import\"./Vews.scss\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ViewsDataComponent(props){var project=props.project;console.log(\"pv:\",project.views,project.activeViewpoint.id);// const views = project.views.filter(v => v && (!v.viewpoint || v.viewpoint.id === project.activeViewpoint.id));\nvar vp=project.activeViewpoint;//\nvar subViewScores=vp.__raw.subViews;var add=function add(e){DViewElement.newDefault();};var clone=function clone(e,v){e.preventDefault();e.stopPropagation();TRANSACTION(function(){v.duplicate(false);});};var destroy=function destroy(e,view,candelete){e.stopPropagation();if(!candelete)return;TRANSACTION(function(){SetFieldAction.new(view.viewpoint.id,'subViews',view.id,'-=',false);view.delete();});};var state=store.getState();return/*#__PURE__*/_jsxs(\"div\",{style:{maxHeight:\"100%\",overflow:\"scroll\",paddingBottom:\"calc(42px + 15px)\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:'d-flex p-2',children:[/*#__PURE__*/_jsx(\"b\",{className:'ms-1 my-auto',children:\"VIEWS\"}),/*#__PURE__*/_jsx(\"button\",{className:'btn btn-primary ms-auto',onClick:add,children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-plus'})})]}),Object.keys(subViewScores).map(function(subviewid,i){var scoreBoost=subViewScores[subviewid];var subview=LPointerTargetable.fromPointer(subviewid,state);// todo: add a \"header\" here with subview | subview piority boost or and turn the \"subview\" section of a vp/view into this stuff instead of separate tab\nif(!subview)return;var candelete=!Defaults.check(subview.id);// todo: credo esploda perchè il click di delete triggera anche l'apertura della tab con la vista ora cancellata.\n// @ts-ignore\nreturn/*#__PURE__*/_jsxs(\"div\",{tabIndex:i,onClick:function onClick(e){return props.setSelectedView(subview);},className:'view-list-elem d-flex p-1 mt-1 border round mx-1 hoverable',children:[/*#__PURE__*/_jsx(\"label\",{style:{cursor:'pointer'},className:'my-auto',children:subview.name}),/*#__PURE__*/_jsx(\"label\",{className:\"preview ms-auto\",style:{position:'unset'}}),false?/*#__PURE__*/_jsxs(\"label\",{className:\"content ms-auto\",style:{position:'unset'},onClick:function onClick(e){e.stopPropagation();},children:[/*#__PURE__*/_jsx(\"span\",{children:\"Sub-view matching boost\"}),/*#__PURE__*/_jsx(\"input\",{onBlur:function onBlur(e){return subview.setSubViewScore(subviewid,+e.target.value);},type:\"number\",digit:\"4\",value:scoreBoost,className:\"ms-1 me-1\",style:{maxHeight:'21px',width:\"50px\"}})]}):/*#__PURE__*/_jsx(\"label\",{className:\"content ms-auto\",style:{position:'unset'}}),/*#__PURE__*/_jsx(\"button\",{className:'btn btn-success ms-1',onClick:function onClick(e){clone(e,subview);e.stopPropagation();},children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-clipboard2-fill'})}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){return destroy(e,subview,candelete);},className:'btn btn-danger ms-1',disabled:!candelete,children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-trash3-fill'})})]},subviewid);})]});}function mapStateToProps(state,ownProps){var ret={};var user=LUser.fromPointer(DUser.current);ret.project=user.project;return ret;}function mapDispatchToProps(dispatch){var ret={};return ret;}export var ViewsDataConnected=connect(mapStateToProps,mapDispatchToProps)(ViewsDataComponent);export var ViewsData=function ViewsData(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(ViewsDataConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};export default ViewsData;","map":{"version":3,"names":["React","TRANSACTION","SetFieldAction","store","LPointerTargetable","Defaults","DUser","DViewElement","LUser","connect","jsx","_jsx","jsxs","_jsxs","ViewsDataComponent","props","project","console","log","views","activeViewpoint","id","vp","subViewScores","__raw","subViews","add","e","newDefault","clone","v","preventDefault","stopPropagation","duplicate","destroy","view","candelete","new","viewpoint","delete","state","getState","style","maxHeight","overflow","paddingBottom","children","className","onClick","Object","keys","map","subviewid","i","scoreBoost","subview","fromPointer","check","tabIndex","setSelectedView","cursor","name","position","onBlur","setSubViewScore","target","value","type","digit","width","disabled","mapStateToProps","ownProps","ret","user","current","mapDispatchToProps","dispatch","ViewsDataConnected","ViewsData","arguments","length","undefined","_objectSpread"],"sources":["C:/d/Programming/web/jodel-mde/src/components/rightbar/viewsEditor/Views.tsx"],"sourcesContent":["import React, {Dispatch, MouseEvent, ReactElement} from 'react';\r\nimport {\r\n    LProject,\r\n    Dictionary,\r\n    Pointer,\r\n    TRANSACTION,\r\n    Pointers,\r\n    LViewPoint,\r\n    SetFieldAction,\r\n    DPointerTargetable,\r\n    store,\r\n    LPointerTargetable\r\n} from '../../../joiner';\r\nimport {CreateElementAction, Defaults, DState, DUser, DViewElement, LUser, LViewElement, U} from '../../../joiner';\r\nimport {useStateIfMounted} from 'use-state-if-mounted';\r\nimport {FakeStateProps} from \"../../../joiner/types\";\r\nimport {connect} from \"react-redux\";\r\nimport \"./Vews.scss\"\r\n\r\nfunction ViewsDataComponent(props: AllProps) {\r\n    const project = props.project;\r\n    console.log(\"pv:\", project.views, project.activeViewpoint.id);\r\n    // const views = project.views.filter(v => v && (!v.viewpoint || v.viewpoint.id === project.activeViewpoint.id));\r\n    let vp: LViewPoint = project.activeViewpoint; //\r\n    const subViewScores = vp.__raw.subViews;\r\n\r\n    const add = (e: MouseEvent) => {\r\n        DViewElement.newDefault();\r\n    }\r\n\r\n    const clone = (e: MouseEvent, v: LViewElement) => {\r\n        e.preventDefault(); e.stopPropagation();\r\n        TRANSACTION(() => {\r\n            v.duplicate(false);\r\n        });\r\n    }\r\n\r\n    const destroy = (e: MouseEvent, view: LViewElement, candelete: boolean) => {\r\n        e.stopPropagation();\r\n        if (!candelete) return;\r\n        TRANSACTION(()=>{\r\n            SetFieldAction.new(view.viewpoint.id, 'subViews', view.id as any, '-=', false);\r\n            view.delete();\r\n        })\r\n    }\r\n\r\n    const state: DState = store.getState();\r\n    return(<div style={{maxHeight: \"100%\", overflow: \"scroll\", paddingBottom: \"calc(42px + 15px)\"}}>\r\n        <div className={'d-flex p-2'}>\r\n            <b className={'ms-1 my-auto'}>VIEWS</b>\r\n            <button className={'btn btn-primary ms-auto'} onClick={add}>\r\n                <i className={'p-1 bi bi-plus'}></i>\r\n            </button>\r\n        </div>\r\n        {Object.keys(subViewScores).map((subviewid, i) => {\r\n            let scoreBoost: number = subViewScores[subviewid];\r\n            let subview: LViewElement = LPointerTargetable.fromPointer(subviewid, state);\r\n            // todo: add a \"header\" here with subview | subview piority boost or and turn the \"subview\" section of a vp/view into this stuff instead of separate tab\r\n            if (!subview) return;\r\n            let candelete = !Defaults.check(subview.id); // todo: credo esploda perchè il click di delete triggera anche l'apertura della tab con la vista ora cancellata.\r\n            // @ts-ignore\r\n            return <div key={subviewid} tabIndex={i} onClick={e => props.setSelectedView(subview)} className={'view-list-elem d-flex p-1 mt-1 border round mx-1 hoverable'}>\r\n                <label style={{cursor: 'pointer'}} className={'my-auto'}>{subview.name}</label>\r\n                <label className='preview ms-auto' style={{position:'unset'}} />\r\n                {false ? <label className='content ms-auto' style={{position:'unset'}} onClick={e => {e.stopPropagation();}} >\r\n                    <span>Sub-view matching boost</span>\r\n                    {/* @ts-ignore: digit={\"2\"} */}\r\n                    <input onBlur={(e) => subview.setSubViewScore(subviewid, +e.target.value)} type={\"number\"} digit={\"4\"}\r\n                           value={scoreBoost} className={\"ms-1 me-1\"} style={{maxHeight:'21px', width:\"50px\"}} />\r\n                </label>\r\n                    :\r\n                <label className='content ms-auto' style={{position:'unset'}} />\r\n                }\r\n                <button className={'btn btn-success ms-1'} onClick={e => { clone(e, subview); e.stopPropagation(); }}>\r\n                    <i className={'p-1 bi bi-clipboard2-fill'} />\r\n                </button>\r\n                {<button onClick={e => destroy(e, subview, candelete)} className={'btn btn-danger ms-1'} disabled={!candelete}>\r\n                    <i className={'p-1 bi bi-trash3-fill'}/>\r\n                </button>}\r\n            </div>\r\n        })}\r\n    </div>);\r\n}\r\n\r\ninterface OwnProps {\r\n    setSelectedView: React.Dispatch<React.SetStateAction<LViewElement | undefined>>;// (val: LViewElement | undefined) => {}\r\n}\r\ninterface StateProps {\r\n    project: LProject;\r\n}\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    const user = LUser.fromPointer(DUser.current);\r\n    ret.project = user.project as LProject;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\nexport const ViewsDataConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ViewsDataComponent);\r\n\r\nexport const ViewsData = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ViewsDataConnected {...{...props, children}} />;\r\n}\r\nexport default ViewsData;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}