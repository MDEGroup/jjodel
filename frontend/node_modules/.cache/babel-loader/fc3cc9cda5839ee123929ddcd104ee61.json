{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{connect}from'react-redux';import{Input}from'../../../joiner';import{DUser,DViewPoint,LUser,U,SetFieldAction}from'../../../joiner';import{useStateIfMounted}from'use-state-if-mounted';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ViewpointsEditorComponent(props){var project=props.project;var viewpoints=props.viewpoints;var active=props.active;var _useStateIfMounted=useStateIfMounted(''),_useStateIfMounted2=_slicedToArray(_useStateIfMounted,2),hoverID=_useStateIfMounted2[0],setHoverID=_useStateIfMounted2[1];var editName=function editName(evt,vp){vp.name=evt.target.value;};var add=function add(){var name='viewpoint_'+0;var viewpointNames=viewpoints.map(function(vp){return vp&&vp.name;});name=U.increaseEndingNumber(name,false,false,function(newName){return viewpointNames.indexOf(newName)>=0;});DViewPoint.new2(name,'',function(d){d.isExclusiveView=!(d.isValidation=props.validation);});};var destroy=function destroy(e,viewPoint){e.stopPropagation();SetFieldAction.new(project.id,'viewpoints',viewPoint.id,'-=',false);viewPoint.subViews.map(function(v){return v.delete();});viewPoint.delete();};var select=function select(viewPoint){project.activeViewpoint=viewPoint;};var clone=function clone(viewPoint){viewPoint.duplicate(true);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:'d-flex p-2',children:[/*#__PURE__*/_jsx(\"b\",{className:'ms-1 my-auto',children:\"Perspectives\"}),/*#__PURE__*/_jsx(\"button\",{className:'btn btn-primary ms-auto',onClick:add,children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-plus'})})]}),viewpoints.map(function(viewpoint,index){return/*#__PURE__*/_jsxs(\"div\",{className:'d-flex p-1 mt-1 border round mx-1',onMouseEnter:function onMouseEnter(e){return setHoverID(viewpoint.id);},onMouseLeave:function onMouseLeave(e){return setHoverID('');},style:{backgroundColor:active.id===viewpoint.id?'white':hoverID===viewpoint.id?'#E0E0E0':'transparent'},children:[/*#__PURE__*/_jsx(\"input\",{className:'p-0 input hidden-input',value:viewpoint.name,type:'text',onChange:function onChange(evt){editName(evt,viewpoint);},disabled:index<=0}),/*#__PURE__*/_jsx(Input,{className:\"ms-auto\",data:viewpoint,field:\"isExclusiveView\",type:\"checkbox\",label:\"Is exclusive\",readonly:props.validation||index<=0}),(!props.validation||true)&&/*#__PURE__*/_jsx(\"button\",{className:'btn btn-success ms-1',disabled:active.id===viewpoint.id,onClick:function onClick(evt){select(viewpoint);},children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-check2'})})// todo: validation views should not be \"activable\" but so far it is the only way to see the subviews in it.\n,/*#__PURE__*/_jsx(\"button\",{className:'btn btn-success ms-1',onClick:function onClick(evt){clone(viewpoint);},children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-clipboard2-fill'})}),/*#__PURE__*/_jsx(\"button\",{className:'btn btn-danger ms-1',disabled:index<=0||active.id===viewpoint.id,onClick:function onClick(e){return destroy(e,viewpoint);},children:/*#__PURE__*/_jsx(\"i\",{className:'p-1 bi bi-trash3-fill'})})]},index);}),/*#__PURE__*/_jsx(\"label\",{className:'p-1',children:\"*To apply a custom viewpoint, first activate the default one, and then proceed to activate the custom one.\"})]});}function mapStateToProps(state,ownProps){var ret={};var user=LUser.fromPointer(DUser.current);var project=U.wrapper(user.project);ret.project=project;ret.viewpoints=project.viewpoints.filter(function(vp){return!!vp&&vp.isValidation===ownProps.validation;});ret.active=project.activeViewpoint;return ret;}function mapDispatchToProps(dispatch){var ret={};return ret;}export var ViewpointsEditorConnected=connect(mapStateToProps,mapDispatchToProps)(ViewpointsEditorComponent);export var ViewpointsEditor=function ViewpointsEditor(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(ViewpointsEditorConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};export default ViewpointsEditor;","map":{"version":3,"names":["React","connect","Input","DUser","DViewPoint","LUser","U","SetFieldAction","useStateIfMounted","jsx","_jsx","jsxs","_jsxs","ViewpointsEditorComponent","props","project","viewpoints","active","_useStateIfMounted","_useStateIfMounted2","_slicedToArray","hoverID","setHoverID","editName","evt","vp","name","target","value","add","viewpointNames","map","increaseEndingNumber","newName","indexOf","new2","d","isExclusiveView","isValidation","validation","destroy","e","viewPoint","stopPropagation","new","id","subViews","v","delete","select","activeViewpoint","clone","duplicate","children","className","onClick","viewpoint","index","onMouseEnter","onMouseLeave","style","backgroundColor","type","onChange","disabled","data","field","label","readonly","mapStateToProps","state","ownProps","ret","user","fromPointer","current","wrapper","filter","mapDispatchToProps","dispatch","ViewpointsEditorConnected","ViewpointsEditor","arguments","length","undefined","_objectSpread"],"sources":["C:/d/Programming/web/jodel-mde/src/components/rightbar/viewpointsEditor/ViewpointsEditor.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport {DState, Input} from '../../../joiner';\r\nimport {DUser, DViewPoint, LProject, LUser, LViewPoint, U, SetFieldAction} from '../../../joiner';\r\nimport {useStateIfMounted} from 'use-state-if-mounted';\r\nimport {FakeStateProps} from '../../../joiner/types';\r\n\r\n\r\nfunction ViewpointsEditorComponent(props: AllProps) {\r\n    const project = props.project;\r\n    const viewpoints = props.viewpoints;\r\n    const active = props.active;\r\n\r\n    const [hoverID, setHoverID] = useStateIfMounted('');\r\n\r\n    const editName = (evt: React.ChangeEvent<HTMLInputElement>, vp: LViewPoint) => {\r\n        vp.name = evt.target.value;\r\n    }\r\n    const add = () => {\r\n        let name = 'viewpoint_' + 0;\r\n        let viewpointNames: string[] = viewpoints.map(vp => vp && vp.name);\r\n        name = U.increaseEndingNumber(name, false, false, newName => viewpointNames.indexOf(newName) >= 0);\r\n        DViewPoint.new2(name, '', (d) => { d.isExclusiveView = !(d.isValidation = props.validation); } );\r\n    }\r\n    const destroy = (e: React.MouseEvent, viewPoint: LViewPoint) => {\r\n        e.stopPropagation();\r\n        SetFieldAction.new(project.id, 'viewpoints', viewPoint.id as any, '-=', false);\r\n        viewPoint.subViews.map(v => v.delete());\r\n        viewPoint.delete();\r\n    }\r\n    const select = (viewPoint: LViewPoint) => {\r\n        project.activeViewpoint = viewPoint;\r\n    }\r\n    const clone = (viewPoint: LViewPoint) => {\r\n        viewPoint.duplicate(true);\r\n    }\r\n\r\n    return(<div>\r\n        <div className={'d-flex p-2'}>\r\n            <b className={'ms-1 my-auto'}>Perspectives</b>\r\n            <button className={'btn btn-primary ms-auto'} onClick={add}>\r\n                <i className={'p-1 bi bi-plus'}></i>\r\n            </button>\r\n        </div>\r\n        {viewpoints.map((viewpoint, index) => {\r\n            return <div key={index} className={'d-flex p-1 mt-1 border round mx-1'}\r\n                        onMouseEnter={(e) => setHoverID(viewpoint.id)}\r\n                        onMouseLeave={(e) => setHoverID('')}\r\n                        style={{backgroundColor: (active.id === viewpoint.id) ? 'white' :\r\n                                (hoverID === viewpoint.id ? '#E0E0E0' : 'transparent')}}>\r\n                <input className={'p-0 input hidden-input'} value={viewpoint.name} type={'text'}\r\n                       onChange={(evt) => {editName(evt, viewpoint)}} disabled={index <= 0} />\r\n                <Input className={\"ms-auto\"} data={viewpoint} field={\"isExclusiveView\"} type={\"checkbox\"}\r\n                       label={\"Is exclusive\"} readonly={props.validation || index <= 0} />\r\n                {(!props.validation || true) && <button className={'btn btn-success ms-1'} disabled={active.id === viewpoint.id}\r\n                        onClick={(evt) => {select(viewpoint)}}>\r\n                    <i className={'p-1 bi bi-check2'}></i>\r\n                </button>\r\n                // todo: validation views should not be \"activable\" but so far it is the only way to see the subviews in it.\r\n                }\r\n                <button className={'btn btn-success ms-1'}\r\n                        onClick={(evt) => {clone(viewpoint)}}>\r\n                    <i className={'p-1 bi bi-clipboard2-fill'}></i>\r\n                </button>\r\n                <button className={'btn btn-danger ms-1'} disabled={index <= 0 || active.id === viewpoint.id}\r\n                        onClick={(e) => destroy(e, viewpoint)}>\r\n                    <i className={'p-1 bi bi-trash3-fill'}></i>\r\n                </button>\r\n            </div>\r\n        })}\r\n        <label className={'p-1'}>\r\n            *To apply a custom viewpoint, first activate the default one, and then proceed to activate the custom one.\r\n        </label>\r\n    </div>);\r\n}\r\ninterface OwnProps {\r\n    validation: boolean;\r\n}\r\ninterface StateProps {\r\n    project: LProject;\r\n    viewpoints: LViewPoint[];\r\n    active: LViewPoint;\r\n}\r\ninterface DispatchProps { }\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    const user: LUser = LUser.fromPointer(DUser.current);\r\n    const project = U.wrapper<LProject>(user.project);\r\n    ret.project = project;\r\n    ret.viewpoints = project.viewpoints.filter( (vp) => !!vp && vp.isValidation === ownProps.validation);\r\n    ret.active = project.activeViewpoint;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ViewpointsEditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ViewpointsEditorComponent);\r\n\r\nexport const ViewpointsEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ViewpointsEditorConnected {...{...props, children}} />;\r\n}\r\nexport default ViewpointsEditor;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}