{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _createClass from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _classCallCheck from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";var _dec,_class,_dec2,_class3,_dec3,_class5,_dec4,_class7,_class8,_dec5,_class9,_dec6,_class11;import{DPointerTargetable,JsType,Log,LPointerTargetable,RuntimeAccessible,RuntimeAccessibleClass,SetFieldAction,SetRootFieldAction,U}from\"../joiner\";// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))\n// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (           WViewElement\n//\n// (IN extends WViewElement ? LViewElement : (IN extends WViewTransientProperties ? LWiewTransientProperties : (ERROR)))\n// ))\n// type WtoL<WX extends WPointerTargetable> ='';\nvar childrenKeys=[\"@\",\"$\"];export var LogicContext=(_dec=RuntimeAccessible('LogicContext'),_dec(_class=/*#__PURE__*/function(_RuntimeAccessibleCla){_inherits(LogicContext,_RuntimeAccessibleCla);var _super=_createSuper(LogicContext);// & GObject;\nfunction LogicContext(proxyObject,data){var _this;_classCallCheck(this,LogicContext);_this=_super.call(this);_this.proxyObject=void 0;_this.data=void 0;_this.write=void 0;_this.className=_this.constructor.cname||_this.constructor.name;_this.data=data;_this.proxyObject=proxyObject;_this.write=proxyObject;return _this;}/*\r\n        saveToRedux(propkey: \"keyof data\" | string, val: \"typeof data[path]\" | any): void { // todo: ask non stackoverflow\r\n            // todo, put data in redux store, path is \"obj1.obj2.obj3...\" might replace it with a path funciton that return the foremost nested object container\r\n            if (!propkey) {\r\n                // todo: set whole object instead of a property\r\n            }\r\n        }*/return LogicContext;}(RuntimeAccessibleClass))||_class);RuntimeAccessibleClass.set_extend(RuntimeAccessibleClass,LogicContext);export var MapLogicContext=(_dec2=RuntimeAccessible('MapLogicContext'),_dec2(_class3=/*#__PURE__*/function(_LogicContext){_inherits(MapLogicContext,_LogicContext);var _super2=_createSuper(MapLogicContext);function MapLogicContext(proxy,data,path){var _this2;var subMaps=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];_classCallCheck(this,MapLogicContext);_this2=_super2.call(this,proxy,data);// this.proxyfyFunction = proxyfyFunction;\n_this2.data=void 0;_this2.path=void 0;_this2.subMaps=void 0;_this2.proxyObject=proxy;_this2.data=data;_this2.path=path;_this2.subMaps=subMaps;_this2.className=_this2.constructor.cname||_this2.constructor.name;return _this2;}return MapLogicContext;}(LogicContext))||_class3);RuntimeAccessibleClass.set_extend(LogicContext,MapLogicContext);export var MyProxyHandler=(_dec3=RuntimeAccessible('MyProxyHandler'),_dec3(_class5=/*#__PURE__*/function(_RuntimeAccessibleCla2){_inherits(MyProxyHandler,_RuntimeAccessibleCla2);var _super3=_createSuper(MyProxyHandler);function MyProxyHandler(){var _this3;_classCallCheck(this,MyProxyHandler);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this3=_super3.call.apply(_super3,[this].concat(args));_this3.s='set_';_this3.g='get_';return _this3;}_createClass(MyProxyHandler,[{key:\"set\",value:/*get(target: T, p: string | number | symbol, proxyitself: Proxyfied<T>): boolean {\r\n        switch (p) {\r\n            case '_isProxy': return true;\r\n            case 'init': return (this as any).init;\r\n            case 'init0': return (this as any).init0;\r\n            default: throw new Error('proxy get must be overridden, called for key: ' + (p as string));\r\n        }}*/function set(target,p,value,proxyitself){throw new Error('proxy set must be overridden');}},{key:\"deleteProperty\",value:function deleteProperty(target,p){throw new Error('proxy delete must be overridden');}},{key:\"ownKeys\",value:function ownKeys(target){// return Object.getOwnPropertyNames(target);\nconsole.log(\"ownkeys trap 1\",{thiss:this,target:target});console.log(\"ownkeys trap 2\",{thiss:this,target:target,ret:Reflect.ownKeys(target)});return Reflect.ownKeys(target);}/// proxy methods not used\n/* setPrototypeOf(target: T, v: object | null): boolean { ?? }\r\n    apply(target: T, thisArg: any, argArray: any[]): any { }\r\n    defineProperty(target: T, p: string | symbol, attributes: PropertyDescriptor): boolean { }\r\n    construct(target: T, argArray: any[], newTarget: Function): object { }\r\n    getOwnPropertyDescriptor(target: T, p: string | symbol): PropertyDescriptor | undefined { }\r\n    has(target: T, p: string | symbol): boolean { return p in target; }\r\n    getPrototypeOf(target: T): object | null { }\r\n    isExtensible(target: T): boolean { }\r\n    preventExtensions(target: T): boolean { }*/}],[{key:\"wrap\",value:function wrap(data,baseObjInLookup){var path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var canThrow=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;//    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable, RET extends boolean = false>\n//        (data: D | Pointer<DViewElement>, baseObjInLookup?: DPointerTargetable, path: string = '', canthrow: RET = false as RET): RET {\nreturn DPointerTargetable.wrap(data,baseObjInLookup,path);}},{key:\"isProxy\",value:function isProxy(data){return(data===null||data===void 0?void 0:data.__isProxy)||false;}}]);return MyProxyHandler;}(RuntimeAccessibleClass))||_class5);RuntimeAccessibleClass.set_extend(RuntimeAccessibleClass,MyProxyHandler);/*\r\n* handling proxy += and proxy -=\r\n*\r\n* will become var = var + add; which will call Symbol.getPrimitive\r\nconsole.log(+obj2);     // 10        — hint is \"number\"         NaN with +array with multiple vals, +array[0] with array of size 1, NaN with functions & objects\r\nconsole.log(`${obj2}`); // \"hello\"   — hint is \"string\"         array => array.join(','), object => \"[object Object]\", function => function.toString() whole func definition with body code\r\nconsole.log(obj2 + \"\"); // \"true\"    — hint is \"default\"        array, object, function => same as with hint \"string\"\r\n*\r\n* */ // NB: lclass.extends += somepointer will become: lclass.extends = lclass.extends + somepointer;\n// array + string will cause getPrimitive(\"default\") to array, then .join(',') on it, and finally and toString() to be called on all array members.\n// so pointers cannot include \",\" char and toString() must return a pointer to keep lclass.extends += somepointer as a valid expression;\n// -= will call getPrimitive(\"number\") which will result in array -> NaN, so NaN = NaN - pointer and cannot be done.\nvar GetPathHandler=(_dec4=RuntimeAccessible('GetPathHandler'),_dec4(_class7=(_class8=/*#__PURE__*/function(_MyProxyHandler){_inherits(GetPathHandler,_MyProxyHandler);var _super4=_createSuper(GetPathHandler);function GetPathHandler(){var _this4;_classCallCheck(this,GetPathHandler);_this4=_super4.call(this);_this4.strbuilder='';_this4.array=[];_this4.calls=[];return _this4;}_createClass(GetPathHandler,[{key:\"get\",value:function get(targetObj,propKey,proxyitself){// console.log('GetPathHandler', {targetObj, propKey, proxyitself});\nif(propKey===\"start\"){this.strbuilder='';this.array=[];}if(propKey==='$'){var ret=GetPathHandler.__asCalls?this.calls:GetPathHandler.__asArray?this.array:this.strbuilder;this.array=[];this.strbuilder='';return ret;}this.array.push(propKey);this.calls.push(arguments);if(propKey===Symbol.toPrimitive){console.log(\"toprimitive\");return function(){for(var _len2=arguments.length,a=new Array(_len2),_key2=0;_key2<_len2;_key2++){a[_key2]=arguments[_key2];}console.log(\"toprimitive called with parameters\",a);};}if(!GetPathHandler.__asArray&&!GetPathHandler.__asCalls){if(typeof propKey===\"symbol\"){this.strbuilder+=propKey.toString();}else{// Giordano: add ignore for webpack\n//@ts-ignore\nthis.strbuilder+=(this.strbuilder?'.':'')+propKey;}}return GetPathHandler.__nested?proxyitself:{};}},{key:\"set\",value:function set(target,p,value,proxyitself){switch(p){case'__asArray':case'__asCalls':case'__nested':GetPathHandler[p]=value;return true;default:throw new Error('getPath proxy cannot be written');}}}]);return GetPathHandler;}(MyProxyHandler),_class8.__asCalls=false,_class8.__asArray=false,_class8.__nested=true,_class8))||_class7);RuntimeAccessibleClass.set_extend(MyProxyHandler,GetPathHandler);export var TargetableProxyHandler=(_dec5=RuntimeAccessible('TargetableProxyHandler'),_dec5(_class9=/*#__PURE__*/function(_MyProxyHandler2){_inherits(TargetableProxyHandler,_MyProxyHandler2);var _super5=_createSuper(TargetableProxyHandler);// permette di fare cose tipo: user.name_surname che ritorna la concatenazione di nome e cognome anche se il campo name_surname non esiste.\n// to disable type check easily and access 'set_' + varname dynamically\nfunction TargetableProxyHandler(d,baseObjInLookup){var _this5;var additionalPath=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var l=arguments.length>3?arguments[3]:undefined;_classCallCheck(this,TargetableProxyHandler);_this5=_super5.call(this);_this5.lg=void 0;_this5.l=void 0;_this5.d=void 0;_this5.additionalPath=void 0;_this5.baseObjInLookup=void 0;_this5.d=d;if(!l){var _RuntimeAccessibleCla3,_RuntimeAccessibleCla4;l=(_RuntimeAccessibleCla3=RuntimeAccessibleClass.get(d===null||d===void 0?void 0:d.className))===null||_RuntimeAccessibleCla3===void 0?void 0:(_RuntimeAccessibleCla4=_RuntimeAccessibleCla3.logic)===null||_RuntimeAccessibleCla4===void 0?void 0:_RuntimeAccessibleCla4.singleton;Log.exDev(!l,'Trying to wrap class without singleton or logic mapped: '+(d===null||d===void 0?void 0:d.className),{object:d,className:d.className});}_this5.baseObjInLookup=baseObjInLookup||d;_this5.additionalPath=additionalPath;_this5.l=l;_this5.lg=_this5.l;_this5.className=_this5.constructor.cname||_this5.constructor.name;return _this5;}// damiano todo: this does not work\n_createClass(TargetableProxyHandler,[{key:\"concatenableHandler\",value:function concatenableHandler(targetObj,propKey,proxyitself){var _this6=this;//console.log(\"concatenableHandler 1\", {targetObj, propKey, proxyitself});\nif(propKey in targetObj)return null;var propKeyStr=U.asString(propKey,null);var _index=propKeyStr?propKeyStr.indexOf('_'):-1;//console.log(\"concatenableHandler 2\", {targetObj, propKey, propKeyStr, proxyitself, _index});\nif(_index<0)return null;var isConcatenable=true;var ret=propKey.split('_').map(function(subKey){//console.log(\"concatenableHandler 3.0\", {targetObj, subKey, propKeyStr, proxyitself});\n// se trovo multipli ___ li tratto come spazi aggiuntivi invece che come proprietà '' che ritornano undefined, così posso fare name___surname --> \"damiano   di vincenzo\"\nvar val=subKey===''?' ':_this6.get(targetObj,subKey,proxyitself);isConcatenable=isConcatenable&&JsType.isPrimitive(val);return val;});//console.log(\"concatenableHandler 4\", {targetObj, propKey, propKeyStr, proxyitself, ret, isConcatenable});\nreturn isConcatenable?ret.join(' '):ret;}},{key:\"get\",value:function get(targetObj,propKey,proxyitself){var ret;var isError=false;// console.error('_proxy get PRE:', {targetObj, propKey, proxyitself, arguments});\ntry{ret=this.get0(targetObj,propKey,proxyitself);}catch(e){ret=e;isError=true;}// if (isError) throw ret;\n// console.error('_proxy get POST:', {targetObj, propKey, ret, isError});\nreturn ret;}},{key:\"get0\",value:function get0(targetObj,propKey,proxyitself){// console.log('proxy keysearch', {propKey, targetObj, l: this.l, proxyitself, d: this.d});\nvar canThrowErrors=true;if(propKey===\"__raw\")return targetObj;switch(typeof propKey){case\"symbol\":switch(String(propKey)){default:Log.exDevv('unexpected symbol:',propKey);break;case\"Symbol(Symbol.toPrimitive)\":return targetObj[propKey];//  || typeof targetObj;\n}return null;case\"number\":return null;}switch(propKey){case'__l':return this.l;case'__d':return this.d;case'inspect':// node.js util\ncase\"r\":case\"_refresh\":case\"_reload\":return LPointerTargetable.wrap(targetObj.id);case'__Raw':case'__raw':return targetObj;case'__serialize':return JSON.stringify(targetObj);case'__isproxy':case'__isProxy':return true;case'__random':return Math.random();case'editCount':case'clonedcounter':case'clonedCounter':return targetObj.clonedCounter||0;}if(propKey[0]===\"_\"&&propKey.indexOf(\"__info_of__\")===0){return this.l[propKey];}var proxyacceptables={typeName:'',$$typeof:''};// check if exist directly in D.key, L.key or through a get_key\nif(propKey in this.l||propKey in this.d||this.l[this.g+propKey]||propKey in proxyacceptables){// todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\nif(typeof propKey!=='symbol'&&this.g+propKey in this.lg)return this.lg[this.g+propKey](new LogicContext(proxyitself,targetObj));// if specific custom getter exist\nif(typeof propKey!=='symbol'&&this.g+propKey in this.lg){var getterMethod=this.lg[this.g+propKey];// || this.defaultGetter;\n// console.log(\"gets method\", {getterMethod, lg:this.lg, thiss: this});\nif(getterMethod)return getterMethod(new LogicContext(proxyitself,targetObj));}switch(propKey){default://constructor.prototype.typeName\n// se esiste la proprietà ma non esiste il getter, che fare? do errore?\n// Log.eDevv(\"dev error: property exist but getter does not: \", propKey, this);\n// console.error('proxy GET direct match', {targetObj, propKey, ret: this.d[propKey as keyof ME]});\n// console.error('proxy GET direct match', {l:this.l});\nreturn this.d[propKey];case'$$typeof':case\"typeName\":return this.d.className;}}// @ts-ignore\n//console.trace(\"proxy $getter 2\", {targetObj, n:targetObj.name, propKey, l:this.lg, dg:this.lg._defaultGetter});\n// if not exist check for children names\nif(typeof propKey===\"string\"&&propKey!==\"children\"&&\"children\"in this.l){// __info_of_children__\nvar lchildren;try{lchildren=this.get(targetObj,'children',proxyitself);}catch(e){lchildren=[];}// let dchildren: DPointerTargetable[] = lchildren.map<DPointerTargetable>(l => l.__raw as any);\nvar lc;var pk;if(childrenKeys.includes(propKey[0])){pk=propKey.substring(1);canThrowErrors=false;}else pk=propKey;var _iterator=_createForOfIteratorHelper(lchildren),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _lc;lc=_step.value;var n=(_lc=lc)===null||_lc===void 0?void 0:_lc.name;if(n&&n.toLowerCase()===pk.toLowerCase())return lc;}}catch(err){_iterator.e(err);}finally{_iterator.f();}}// if custom generic getter exist\nif(this.lg._defaultGetter)return this.lg._defaultGetter(new LogicContext(proxyitself,targetObj),propKey);// if property do not exist, try a concatenation\nvar concatenationTentative=null;try{concatenationTentative=this.concatenableHandler(targetObj,propKey,proxyitself);}catch(e){}if(concatenationTentative!==null)return concatenationTentative;Log.ex(canThrowErrors,'GET property \"'+propKey+'\" do not exist in object of type \"'+U.getType(this.l)+\" DType:\"+U.getType(this.l),{logic:this.l,data:targetObj});return undefined;// todo: credo che con espressioni sui tipi siano tipizzabili tutti i return di proprietà note eccetto quelle ottenute per concatenazione.\n}},{key:\"defaultGetter\",value:function defaultGetter(targetObj,key,proxyitself){if(!targetObj)return targetObj;if(!targetObj._subMaps||!targetObj._subMaps[key])return targetObj[key];// if is a nexted subobject\nvar context=new MapLogicContext(proxyitself,targetObj,key,[]);var retRaw=this.lg[this.s+key];return MapProxyHandler.mapWrap(targetObj[key],targetObj,this.additionalPath+'.'+key);}},{key:\"defaultSetter\",value:function defaultSetter(targetObj,propKey,value,proxyitself){SetFieldAction.new(targetObj,propKey,value);return true;}},{key:\"set\",value:function set(targetObj,propKey,value,proxyitself){var enableFallbackSetter=true;// console.error('_proxy set PRE:', {targetObj, propKey, value, proxyitself, arguments});\n// if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.s + (propKey as string)] || (this.l as GObject)[(propKey as string)]) {\nif(propKey in this.l||propKey in this.d||this.l[this.s+propKey]){// todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\nif(typeof propKey!=='symbol'&&this.s+propKey in this.lg)return this.lg[this.s+propKey](value,new LogicContext(proxyitself,targetObj));// if custom generic getter exist\nif(this.lg._defaultSetter)return this.lg._defaultSetter(value,new LogicContext(proxyitself,targetObj),propKey);if(enableFallbackSetter){return this.defaultSetter(targetObj,propKey,value,proxyitself);// new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\n}// if custom generic getter exist\nif(this.lg._defaultSetter)return this.lg._defaultSetter(value,new LogicContext(proxyitself,targetObj),propKey);// se esiste la proprietà ma non esiste il setter, che fare? do errore.\nLog.eDevv(\"dev error: property exist but setter does not: \",propKey,this);return false;}// if property do not exist\nvar breakpoint=1;// if custom generic getter exist\nif(this.lg._defaultSetter)return this.lg._defaultSetter(value,new LogicContext(proxyitself,targetObj),propKey);if(enableFallbackSetter&&typeof(propKey===\"string\")&&(propKey[0]==='_'||propKey.indexOf('tmp')>0)){return this.defaultSetter(targetObj,propKey,value,proxyitself);// new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\n}Log.exx('SET property \"set_'+propKey+'\" do not exist in object of type \"'+U.getType(this.l)+\" DType:\"+U.getType(this.l),{'this':this,targetObj:targetObj});return false;}/*      problema: ogni oggetto deve avere multipli puntatori, quando ne modifico uno devo modificarli tutti, come tengo traccia?\r\n            ipotesi 1: lo memorizzo in un solo posto (store.idlookup) e uso Pointer<type, lb, ub> che è una stringa che simula un puntatore\r\n            problema 1: se fornisco l'intero store ai componenti si aggiornano ad ogni singola modifica, se estraggo i campi interesasti le stringhe puntatore sono invariate ma il contenuto puntato è cambiato e il componente non lo sa...\r\n            problemone 2: non so a quali proprietà dello store devo abbonarmi, devo leggere sempre tutto lo store?\r\n            !!!!! soluzione 2?: dovrei dichiarare le variabili a cui mi abbono, salvarle nello stato e precaricarle tramite mapStateToProps*/},{key:\"deleteProperty\",value:function deleteProperty(target,key,proxyItself){if(typeof key===\"symbol\")return false;this.set(target,key,undefined,proxyItself);delete target[key];return true;}},{key:\"mergedObject\",value:function mergedObject(target){var ret=_objectSpread({},target);// U.arrayMergeInPlace(Object.keys(target), Object.keys(this.l).filter(k => k.indexOf('set_') !== 0 && k.indexOf('get_') !== 0));\nfor(var k in this.l){if(!(k in ret)&&k.lastIndexOf('get_',4)!==0&&k.lastIndexOf('set_',4)!==0)ret[k]=true;}return ret;}},{key:\"ownKeys\",value:function ownKeys(target){var ret=this.mergedObject(target);// ret = Reflect.ownKeys(ret);\nreturn Reflect.ownKeys(ret);}// has(target: ME, p: string | symbol): boolean { return p in this.mergedObject(target); }\n},{key:\"has\",value:function has(target,p){return p in target||p in this.l;}/*\r\n    apply(target: DModelElement, thisArg: any, argArray: any[]): any {\r\n        // will i ever use it? dovrei pasare una funzione invece di una classe, quindi in questo caso credo wrappi solo il costruttore\r\n    }*/}]);return TargetableProxyHandler;}(MyProxyHandler))||_class9);RuntimeAccessibleClass.set_extend(MyProxyHandler,TargetableProxyHandler);export var MapProxyHandler=(_dec6=RuntimeAccessible('MapProxyHandler'),_dec6(_class11=/*#__PURE__*/function(_TargetableProxyHandl){_inherits(MapProxyHandler,_TargetableProxyHandl);var _super6=_createSuper(MapProxyHandler);// todo: sposta alcune funzioni da TargetableProxy a MyProxy e fai estendere direttamente MyProxy a questa classe\nfunction MapProxyHandler(d,baseObjInLookup){var _this7;var additionalPath=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';var subMapKeys=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};_classCallCheck(this,MapProxyHandler);_this7=_super6.call(this,d,baseObjInLookup,additionalPath,LPointerTargetable.singleton);_this7.subMapKeys=void 0;_this7.subMapKeys=subMapKeys;return _this7;}_createClass(MapProxyHandler,[{key:\"get\",value:function get(target,key,proxyitself){if(typeof key===\"symbol\")return this.d[key];var val=this.d[key];if(key in this.subMapKeys&&!(key in target)){Log.exx('property not found in dictionary',{target:target,key:key,thiss:this,proxyitself:proxyitself,submapkeys:this.subMapKeys});return undefined;}if(key in this.subMapKeys){this.additionalPath+='.';return MapProxyHandler.mapWrap(this.d,this.baseObjInLookup,this.additionalPath,this.subMapKeys[key]);Log.exDevv('todo: wrap sub-map',{thiss:this});}return target[key];}},{key:\"set\",value:function set(target,key,value,proxyitself){if(typeof key===\"symbol\"){Log.exx('cannot set a symbol in dictionary',{target:target,key:key,value:value,proxyitself:proxyitself});return false;}SetRootFieldAction.new(this.additionalPath+'.'+key,value,'',false);return true;}},{key:\"deleteProperty\",value:function deleteProperty(target,key,proxyItself){if(typeof key===\"symbol\")return false;this.set(target,key,undefined,proxyItself);delete target[key];return true;}}]);return MapProxyHandler;}(TargetableProxyHandler))||_class11);RuntimeAccessibleClass.set_extend(MyProxyHandler,MapProxyHandler);// 15-20 min + 5 di domande entro il 1° ottobre, discussione 10-12 ottobre\nexport var getPath=new Proxy({},new GetPathHandler());window.getPath=getPath;// usage: pathstring = ((getPath as DType).some.path.to.follow as any).$; // = \"some.path.to.follow\" with compilation-time validation","map":{"version":3,"names":["DPointerTargetable","JsType","Log","LPointerTargetable","RuntimeAccessible","RuntimeAccessibleClass","SetFieldAction","SetRootFieldAction","U","childrenKeys","LogicContext","_dec","_class","_RuntimeAccessibleCla","_inherits","_super","_createSuper","proxyObject","data","_this","_classCallCheck","call","write","className","constructor","cname","name","set_extend","MapLogicContext","_dec2","_class3","_LogicContext","_super2","proxy","path","_this2","subMaps","arguments","length","undefined","MyProxyHandler","_dec3","_class5","_RuntimeAccessibleCla2","_super3","_this3","_len","args","Array","_key","apply","concat","s","g","_createClass","key","value","set","target","p","proxyitself","Error","deleteProperty","ownKeys","console","log","thiss","ret","Reflect","wrap","baseObjInLookup","canThrow","isProxy","__isProxy","GetPathHandler","_dec4","_class7","_class8","_MyProxyHandler","_super4","_this4","strbuilder","array","calls","get","targetObj","propKey","__asCalls","__asArray","push","Symbol","toPrimitive","_len2","a","_key2","toString","__nested","TargetableProxyHandler","_dec5","_class9","_MyProxyHandler2","_super5","d","_this5","additionalPath","l","lg","_RuntimeAccessibleCla3","_RuntimeAccessibleCla4","logic","singleton","exDev","object","concatenableHandler","_this6","propKeyStr","asString","_index","indexOf","isConcatenable","split","map","subKey","val","isPrimitive","join","isError","get0","e","canThrowErrors","String","exDevv","id","JSON","stringify","Math","random","clonedCounter","proxyacceptables","typeName","$$typeof","getterMethod","lchildren","lc","pk","includes","substring","_iterator","_createForOfIteratorHelper","_step","n","done","_lc","toLowerCase","err","f","_defaultGetter","concatenationTentative","ex","getType","defaultGetter","_subMaps","context","retRaw","MapProxyHandler","mapWrap","defaultSetter","new","enableFallbackSetter","_defaultSetter","eDevv","breakpoint","exx","proxyItself","mergedObject","_objectSpread","k","lastIndexOf","has","_dec6","_class11","_TargetableProxyHandl","_super6","_this7","subMapKeys","submapkeys","getPath","Proxy","window"],"sources":["C:/d/Programming/web/jodel-mde/src/joiner/proxy.ts"],"sourcesContent":["import type {DocString, DtoL, DtoW, GObject, Proxyfied, WPointerTargetable,} from \"../joiner\";\r\nimport {\r\n    Dictionary,\r\n    DModelElement,\r\n    DPointerTargetable,\r\n    JsType,\r\n    LModelElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    U\r\n} from \"../joiner\";\r\n\r\ntype NotAConcatenation = null;\r\ntype ERROR = \"_Type_Error_\";\r\n\r\n// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (ERROR))\r\n// (DX extends DUser ? LUser : (DX extends DPointerTargetable ? LPointerTargetable : (           WViewElement\r\n//\r\n// (IN extends WViewElement ? LViewElement : (IN extends WViewTransientProperties ? LWiewTransientProperties : (ERROR)))\r\n// ))\r\n// type WtoL<WX extends WPointerTargetable> ='';\r\n\r\nconst childrenKeys = [\"@\", \"$\"];\r\n@RuntimeAccessible('LogicContext')\r\nexport class LogicContext<\r\n    DX extends GObject = DModelElement,\r\n    LX = DtoL<DX>,\r\n    // PF extends MyProxyHandler<DX> = MyProxyHandler<DX>,\r\n    WX = DtoW<DX>\r\n    > extends RuntimeAccessibleClass{\r\n    public proxyObject: LX;\r\n    public data: DX;// & GObject;\r\n    public write: WX;\r\n    constructor(proxyObject: LX, data: DX) {\r\n        super();\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n        this.data = data;\r\n        this.proxyObject = proxyObject;\r\n        this.write = proxyObject as any;\r\n    }\r\n    /*\r\n        saveToRedux(propkey: \"keyof data\" | string, val: \"typeof data[path]\" | any): void { // todo: ask non stackoverflow\r\n            // todo, put data in redux store, path is \"obj1.obj2.obj3...\" might replace it with a path funciton that return the foremost nested object container\r\n            if (!propkey) {\r\n                // todo: set whole object instead of a property\r\n            }\r\n        }*/\r\n}\r\n\r\nRuntimeAccessibleClass.set_extend(RuntimeAccessibleClass, LogicContext);\r\n@RuntimeAccessible('MapLogicContext')\r\nexport class MapLogicContext extends LogicContext<GObject, LPointerTargetable, WPointerTargetable> {\r\n    data: GObject;\r\n    path: string;\r\n    subMaps: string[];\r\n    constructor(proxy: LPointerTargetable, data: GObject, path: string, subMaps: string[] = []) {\r\n        super(proxy, data);\r\n        // this.proxyfyFunction = proxyfyFunction;\r\n        this.proxyObject = proxy;\r\n        this.data = data;\r\n        this.path = path;\r\n        this.subMaps = subMaps;\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n}\r\nRuntimeAccessibleClass.set_extend(LogicContext, MapLogicContext);\r\n\r\n@RuntimeAccessible('MyProxyHandler')\r\nexport abstract class MyProxyHandler<T extends GObject> extends RuntimeAccessibleClass implements ProxyHandler<T>{\r\n    s: string = 'set_';\r\n    g: string = 'get_';\r\n    /*get(target: T, p: string | number | symbol, proxyitself: Proxyfied<T>): boolean {\r\n        switch (p) {\r\n            case '_isProxy': return true;\r\n            case 'init': return (this as any).init;\r\n            case 'init0': return (this as any).init0;\r\n            default: throw new Error('proxy get must be overridden, called for key: ' + (p as string));\r\n        }}*/\r\n    set(target: T, p: string | number | symbol, value: any, proxyitself: Proxyfied<T>): boolean { throw new Error('proxy set must be overridden'); }\r\n    deleteProperty(target: T, p: string | symbol): boolean { throw new Error('proxy delete must be overridden'); }\r\n\r\n    ownKeys(target: T): ArrayLike<string | symbol>{\r\n        // return Object.getOwnPropertyNames(target);\r\n        console.log(\"ownkeys trap 1\", {thiss:this, target})\r\n        console.log(\"ownkeys trap 2\", {thiss:this, target, ret:Reflect.ownKeys(target)});\r\n        return Reflect.ownKeys(target);\r\n    }\r\n    /// proxy methods not used\r\n    /* setPrototypeOf(target: T, v: object | null): boolean { ?? }\r\n    apply(target: T, thisArg: any, argArray: any[]): any { }\r\n    defineProperty(target: T, p: string | symbol, attributes: PropertyDescriptor): boolean { }\r\n    construct(target: T, argArray: any[], newTarget: Function): object { }\r\n    getOwnPropertyDescriptor(target: T, p: string | symbol): PropertyDescriptor | undefined { }\r\n    has(target: T, p: string | symbol): boolean { return p in target; }\r\n    getPrototypeOf(target: T): object | null { }\r\n    isExtensible(target: T): boolean { }\r\n    preventExtensions(target: T): boolean { }*/\r\n\r\n    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable = LPointerTargetable, CAN_THROW extends boolean = false,\r\n        RET extends CAN_THROW extends true ? L : L | undefined  = CAN_THROW extends true ? L : L>\r\n    (data: D | Pointer | undefined | null, baseObjInLookup?: DPointerTargetable, path: string = '', canThrow: CAN_THROW = false as CAN_THROW): RET{\r\n\r\n//    static wrap<D extends RuntimeAccessibleClass, L extends LPointerTargetable, RET extends boolean = false>\r\n//        (data: D | Pointer<DViewElement>, baseObjInLookup?: DPointerTargetable, path: string = '', canthrow: RET = false as RET): RET {\r\n        return DPointerTargetable.wrap(data, baseObjInLookup, path) as RET; }\r\n\r\n    static isProxy(data: GObject): boolean { return data?.__isProxy || false; }\r\n}\r\nRuntimeAccessibleClass.set_extend(RuntimeAccessibleClass, MyProxyHandler);\r\nexport type GetPath<T = GObject> = T;\r\n/*\r\n* handling proxy += and proxy -=\r\n*\r\n* will become var = var + add; which will call Symbol.getPrimitive\r\nconsole.log(+obj2);     // 10        — hint is \"number\"         NaN with +array with multiple vals, +array[0] with array of size 1, NaN with functions & objects\r\nconsole.log(`${obj2}`); // \"hello\"   — hint is \"string\"         array => array.join(','), object => \"[object Object]\", function => function.toString() whole func definition with body code\r\nconsole.log(obj2 + \"\"); // \"true\"    — hint is \"default\"        array, object, function => same as with hint \"string\"\r\n*\r\n* */\r\n\r\n// NB: lclass.extends += somepointer will become: lclass.extends = lclass.extends + somepointer;\r\n// array + string will cause getPrimitive(\"default\") to array, then .join(',') on it, and finally and toString() to be called on all array members.\r\n// so pointers cannot include \",\" char and toString() must return a pointer to keep lclass.extends += somepointer as a valid expression;\r\n// -= will call getPrimitive(\"number\") which will result in array -> NaN, so NaN = NaN - pointer and cannot be done.\r\n\r\n@RuntimeAccessible('GetPathHandler')\r\nclass GetPathHandler<T extends GObject> extends MyProxyHandler<T>{\r\n    public static __asCalls: boolean = false;\r\n    public static __asArray: boolean = false;\r\n    public static __nested: boolean = true;\r\n    private strbuilder: string = '';\r\n    private array: (string | number | symbol)[] = [];\r\n    private calls: (GObject<'parameters of get calls'>)[] = [];\r\n\r\n    public constructor() { super(); }\r\n\r\n    get(targetObj: T, propKey: keyof T | string, proxyitself: Proxyfied<T>): any {\r\n        // console.log('GetPathHandler', {targetObj, propKey, proxyitself});\r\n        if (propKey === \"start\") { this.strbuilder = ''; this.array = []; }\r\n        if (propKey === '$') {\r\n            const ret = GetPathHandler.__asCalls ? this.calls : (GetPathHandler.__asArray ? this.array : this.strbuilder);\r\n            this.array = [];\r\n            this.strbuilder = '';\r\n            return ret; }\r\n        this.array.push(propKey);\r\n        this.calls.push(arguments);\r\n        if (propKey === Symbol.toPrimitive) {\r\n            console.log(\"toprimitive\");\r\n            return (...a: any)=> {console.log(\"toprimitive called with parameters\", a); }\r\n        }\r\n        if (!GetPathHandler.__asArray && !GetPathHandler.__asCalls) {\r\n            if (typeof propKey === \"symbol\") { this.strbuilder += propKey.toString(); }\r\n            else {\r\n                // Giordano: add ignore for webpack\r\n                //@ts-ignore\r\n                this.strbuilder += (this.strbuilder ? '.' : '') + propKey;\r\n            }\r\n        }\r\n        return GetPathHandler.__nested ? proxyitself : {};\r\n    }\r\n\r\n    set(target: T, p: string | number | symbol, value: any, proxyitself: Proxyfied<T>): boolean {\r\n        switch(p){\r\n            case '__asArray':\r\n            case '__asCalls':\r\n            case '__nested':\r\n                (GetPathHandler as any)[p] = value;\r\n                return true;\r\n            default:\r\n                throw new Error('getPath proxy cannot be written');\r\n        }\r\n    }\r\n}\r\nRuntimeAccessibleClass.set_extend(MyProxyHandler, GetPathHandler);\r\n@RuntimeAccessible('TargetableProxyHandler')\r\nexport class TargetableProxyHandler<ME extends GObject = DModelElement, LE extends LPointerTargetable = LModelElement> extends MyProxyHandler<ME> {\r\n// permette di fare cose tipo: user.name_surname che ritorna la concatenazione di nome e cognome anche se il campo name_surname non esiste.\r\n    lg: LE & GObject; // to disable type check easily and access 'set_' + varname dynamically\r\n    l: LE;\r\n    d: ME;\r\n    additionalPath: string;\r\n\r\n    public baseObjInLookup: DPointerTargetable;\r\n\r\n    constructor(d: ME, baseObjInLookup?: DPointerTargetable, additionalPath: string = '', l?: LE) {\r\n        super();\r\n        this.d = d;\r\n        if (!l) {\r\n            l = RuntimeAccessibleClass.get(d?.className)?.logic?.singleton as LE;\r\n            Log.exDev(!l, 'Trying to wrap class without singleton or logic mapped: ' + d?.className, { object: d, className: d.className })\r\n        }\r\n        this.baseObjInLookup = baseObjInLookup || d as any;\r\n        this.additionalPath = additionalPath;\r\n        this.l = l as LE;\r\n        this.lg = this.l;\r\n        this.className = (this.constructor as typeof RuntimeAccessibleClass).cname || this.constructor.name;\r\n    }\r\n\r\n    // damiano todo: this does not work\r\n    private concatenableHandler(targetObj: ME, propKey: number | string | symbol, proxyitself: Proxyfied<ME>): NotAConcatenation | any[] | string {\r\n        //console.log(\"concatenableHandler 1\", {targetObj, propKey, proxyitself});\r\n        if (propKey in targetObj)  return null as NotAConcatenation;\r\n        const propKeyStr: null | string = U.asString(propKey, null);\r\n        let _index: number = propKeyStr ? propKeyStr.indexOf('_') : -1;\r\n        //console.log(\"concatenableHandler 2\", {targetObj, propKey, propKeyStr, proxyitself, _index});\r\n        if (_index < 0) return null as NotAConcatenation;\r\n\r\n        let isConcatenable = true;\r\n        let ret: any[] = (propKey as string).split('_').map( (subKey: string) => {\r\n            //console.log(\"concatenableHandler 3.0\", {targetObj, subKey, propKeyStr, proxyitself});\r\n            // se trovo multipli ___ li tratto come spazi aggiuntivi invece che come proprietà '' che ritornano undefined, così posso fare name___surname --> \"damiano   di vincenzo\"\r\n            let val: any = subKey === '' ? ' ' : this.get(targetObj, subKey, proxyitself);\r\n            isConcatenable = isConcatenable && JsType.isPrimitive(val);\r\n            return val;\r\n        });\r\n        //console.log(\"concatenableHandler 4\", {targetObj, propKey, propKeyStr, proxyitself, ret, isConcatenable});\r\n        return isConcatenable ? ret.join(' ') : ret; }\r\n\r\n    public get(targetObj: ME, propKey: string | symbol, proxyitself: Proxyfied<ME>): any {\r\n        let ret;\r\n        let isError = false;\r\n        // console.error('_proxy get PRE:', {targetObj, propKey, proxyitself, arguments});\r\n        try { ret = this.get0(targetObj, propKey, proxyitself); } catch(e) { ret = e; isError = true;}\r\n\r\n        // if (isError) throw ret;\r\n        // console.error('_proxy get POST:', {targetObj, propKey, ret, isError});\r\n        return ret;\r\n    }\r\n\r\n    public get0(targetObj: ME, propKey: string | symbol, proxyitself: Proxyfied<ME>): any {\r\n        // console.log('proxy keysearch', {propKey, targetObj, l: this.l, proxyitself, d: this.d});\r\n        let canThrowErrors = true;\r\n        if (propKey === \"__raw\") return targetObj;\r\n\r\n        switch(typeof propKey){\r\n            case \"symbol\":\r\n                switch(String(propKey)){\r\n                    default: Log.exDevv('unexpected symbol:', propKey); break;\r\n                    case \"Symbol(Symbol.toPrimitive)\": return (targetObj as any)[propKey];//  || typeof targetObj;\r\n                }\r\n                return null;\r\n            case \"number\": return null;\r\n        }\r\n\r\n        switch (propKey) {\r\n            case '__l': return this.l;\r\n            case '__d': return this.d;\r\n            case 'inspect': // node.js util\r\n            case \"r\":\r\n            case \"_refresh\":\r\n            case \"_reload\": return LPointerTargetable.wrap(targetObj.id);\r\n            case '__Raw':\r\n            case '__raw': return targetObj;\r\n            case '__serialize': return JSON.stringify(targetObj);\r\n            case '__isproxy':\r\n            case '__isProxy': return true;\r\n            case '__random': return Math.random();\r\n            case 'editCount':\r\n            case 'clonedcounter':\r\n            case 'clonedCounter':\r\n                return targetObj.clonedCounter || 0;\r\n        }\r\n        if (propKey[0] === \"_\" && propKey.indexOf(\"__info_of__\")===0) {\r\n            return (this.l as GObject)[propKey];\r\n        }\r\n\r\n\r\n        const proxyacceptables = {typeName:'', $$typeof:''};\r\n        // check if exist directly in D.key, L.key or through a get_key\r\n        if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.g + (propKey as string)] || propKey in proxyacceptables) {\r\n            // todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\r\n            if (typeof propKey !== 'symbol' && this.g + propKey in this.lg) return this.lg[this.g + propKey](new LogicContext(proxyitself as any, targetObj));\r\n\r\n\r\n\r\n            // if specific custom getter exist\r\n            if (typeof propKey !== 'symbol' && this.g + propKey in this.lg) {\r\n                let getterMethod: Function = this.lg[this.g + propKey]; // || this.defaultGetter;\r\n                // console.log(\"gets method\", {getterMethod, lg:this.lg, thiss: this});\r\n                if (getterMethod) return getterMethod(new LogicContext(proxyitself as any, targetObj));\r\n\r\n            }\r\n\r\n\r\n            switch (propKey){\r\n                default:\r\n                    //constructor.prototype.typeName\r\n                    // se esiste la proprietà ma non esiste il getter, che fare? do errore?\r\n                    // Log.eDevv(\"dev error: property exist but getter does not: \", propKey, this);\r\n                    // console.error('proxy GET direct match', {targetObj, propKey, ret: this.d[propKey as keyof ME]});\r\n                    // console.error('proxy GET direct match', {l:this.l});\r\n                    return this.d[propKey as keyof ME];\r\n                case '$$typeof':\r\n                case \"typeName\":\r\n                    return this.d.className;\r\n            }\r\n        }\r\n        // @ts-ignore\r\n        //console.trace(\"proxy $getter 2\", {targetObj, n:targetObj.name, propKey, l:this.lg, dg:this.lg._defaultGetter});\r\n\r\n        // if not exist check for children names\r\n\r\n        if (typeof propKey === \"string\" && propKey !== \"children\" && (\"children\" in this.l)) { // __info_of_children__\r\n            let lchildren: LPointerTargetable[];\r\n            try { lchildren = this.get(targetObj, 'children', proxyitself); }\r\n            catch (e) { lchildren = []; }\r\n            // let dchildren: DPointerTargetable[] = lchildren.map<DPointerTargetable>(l => l.__raw as any);\r\n            let lc: GObject;\r\n            let pk: string;\r\n            if (childrenKeys.includes(propKey[0])) { pk = propKey.substring(1); canThrowErrors = false; }\r\n            else pk = propKey;\r\n            for (lc of lchildren) {\r\n                let n = lc?.name;\r\n                if (n && n.toLowerCase() === pk.toLowerCase()) return lc;\r\n            }\r\n        }\r\n\r\n        // if custom generic getter exist\r\n        if (this.lg._defaultGetter) return this.lg._defaultGetter(new LogicContext(proxyitself as any, targetObj), propKey);\r\n\r\n        // if property do not exist, try a concatenation\r\n        let concatenationTentative = null;\r\n        try {concatenationTentative = this.concatenableHandler(targetObj, propKey, proxyitself); } catch(e) {}\r\n        if (concatenationTentative !== null) return concatenationTentative;\r\n        Log.ex(canThrowErrors,'GET property \"'+ (propKey as any)+ '\" do not exist in object of type \"' + U.getType(this.l) + \" DType:\" +  U.getType(this.l), {logic: this.l, data: targetObj});\r\n        return undefined;\r\n        // todo: credo che con espressioni sui tipi siano tipizzabili tutti i return di proprietà note eccetto quelle ottenute per concatenazione.\r\n    }\r\n\r\n    public defaultGetter(targetObj: ME, key: string, proxyitself: Proxyfied<ME>): any {\r\n        if (!targetObj) return targetObj;\r\n        if (!targetObj._subMaps || !targetObj._subMaps[key]) return (targetObj as Dictionary)[key];\r\n        // if is a nexted subobject\r\n        let context: MapLogicContext = new MapLogicContext(proxyitself as any, targetObj, key, []);\r\n        let retRaw: Dictionary = this.lg[this.s + key]\r\n        return MapProxyHandler.mapWrap((targetObj as Dictionary)[key], targetObj as any, this.additionalPath + '.' + key)\r\n    }\r\n\r\n    public defaultSetter(targetObj: DPointerTargetable, propKey: string, value: any, proxyitself?: Proxyfied<ME>): boolean {\r\n        SetFieldAction.new(targetObj, propKey as any, value);\r\n        return true;\r\n    }\r\n\r\n    public set(targetObj: ME, propKey: string | symbol, value: any, proxyitself?: Proxyfied<ME>): boolean {\r\n        let enableFallbackSetter = true;\r\n\r\n        // console.error('_proxy set PRE:', {targetObj, propKey, value, proxyitself, arguments});\r\n        // if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.s + (propKey as string)] || (this.l as GObject)[(propKey as string)]) {\r\n        if (propKey in this.l || propKey in this.d || (this.l as GObject)[this.s + (propKey as string)]) {\r\n            // todo: il LogicContext passato come parametro risulta nell'autocompletion editor automaticamente generato, come passo un parametro senza passargli il parametro? uso arguments senza dichiararlo?\r\n            if (typeof propKey !== 'symbol' && this.s + propKey in this.lg) return this.lg[this.s + propKey](value, new LogicContext(proxyitself as any, targetObj));\r\n\r\n\r\n\r\n            // if custom generic getter exist\r\n            if (this.lg._defaultSetter) return this.lg._defaultSetter(value, new LogicContext(proxyitself as any, targetObj), propKey);\r\n            if (enableFallbackSetter) {\r\n                return this.defaultSetter(targetObj as any as DPointerTargetable, propKey as string, value, proxyitself);\r\n                // new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\r\n            }\r\n            // if custom generic getter exist\r\n            if (this.lg._defaultSetter) return this.lg._defaultSetter(value, new LogicContext(proxyitself as any, targetObj), propKey);\r\n            // se esiste la proprietà ma non esiste il setter, che fare? do errore.\r\n            Log.eDevv(\"dev error: property exist but setter does not: \", propKey, this);\r\n            return false;\r\n        }\r\n        // if property do not exist\r\n        let breakpoint = 1;\r\n\r\n        // if custom generic getter exist\r\n        if (this.lg._defaultSetter) return this.lg._defaultSetter(value, new LogicContext(proxyitself as any, targetObj), propKey);\r\n        if (enableFallbackSetter && typeof (propKey === \"string\") && ((propKey as string)[0] === '_' || (propKey as string).indexOf('tmp') > 0)) {\r\n            return this.defaultSetter(targetObj as any as DPointerTargetable, propKey as string, value, proxyitself);\r\n            // new SetFieldAction(new LogicContext(proxyitself as any, targetObj).data as any, propKey as string, value); return true;\r\n        }\r\n        Log.exx('SET property \"set_' + (propKey as any) + '\" do not exist in object of type \"' + U.getType(this.l) + \" DType:\" +  U.getType(this.l), {'this': this, targetObj});\r\n        return false; }\r\n    /*      problema: ogni oggetto deve avere multipli puntatori, quando ne modifico uno devo modificarli tutti, come tengo traccia?\r\n            ipotesi 1: lo memorizzo in un solo posto (store.idlookup) e uso Pointer<type, lb, ub> che è una stringa che simula un puntatore\r\n            problema 1: se fornisco l'intero store ai componenti si aggiornano ad ogni singola modifica, se estraggo i campi interesasti le stringhe puntatore sono invariate ma il contenuto puntato è cambiato e il componente non lo sa...\r\n            problemone 2: non so a quali proprietà dello store devo abbonarmi, devo leggere sempre tutto lo store?\r\n            !!!!! soluzione 2?: dovrei dichiarare le variabili a cui mi abbono, salvarle nello stato e precaricarle tramite mapStateToProps*/\r\n\r\n    public deleteProperty(target: ME, key: string | symbol, proxyItself?: Proxyfied<any>): boolean {\r\n        if (typeof key === \"symbol\") return false;\r\n        this.set(target, key, undefined, proxyItself);\r\n        delete target[key];\r\n        return true; }\r\n\r\n    private mergedObject(target: ME): GObject{\r\n        let ret: GObject = {...target}; // U.arrayMergeInPlace(Object.keys(target), Object.keys(this.l).filter(k => k.indexOf('set_') !== 0 && k.indexOf('get_') !== 0));\r\n        for (let k in this.l) {\r\n            if (!(k in ret) && k.lastIndexOf('get_', 4) !== 0 && k.lastIndexOf('set_', 4) !== 0) ret[k] = true;\r\n        }\r\n        return ret;\r\n    }\r\n    ownKeys(target: ME): ArrayLike<string | symbol>{\r\n        const ret: GObject = this.mergedObject(target);\r\n        // ret = Reflect.ownKeys(ret);\r\n        return Reflect.ownKeys(ret);\r\n    }\r\n\r\n    // has(target: ME, p: string | symbol): boolean { return p in this.mergedObject(target); }\r\n    has(target: ME, p: string | symbol): boolean { return (p in target) || (p in this.l); }\r\n\r\n    /*\r\n    apply(target: DModelElement, thisArg: any, argArray: any[]): any {\r\n        // will i ever use it? dovrei pasare una funzione invece di una classe, quindi in questo caso credo wrappi solo il costruttore\r\n    }*/\r\n}\r\nRuntimeAccessibleClass.set_extend(MyProxyHandler, TargetableProxyHandler);\r\n@RuntimeAccessible('MapProxyHandler')\r\nexport class MapProxyHandler extends TargetableProxyHandler<Dictionary, LPointerTargetable> {\r\n    // todo: sposta alcune funzioni da TargetableProxy a MyProxy e fai estendere direttamente MyProxy a questa classe\r\n    public subMapKeys: Dictionary<string, any | Dictionary<DocString<'nested map keys'>>>;\r\n\r\n    constructor(d: Dictionary, baseObjInLookup: DPointerTargetable, additionalPath: string = '', subMapKeys: Dictionary<string, any | Dictionary<DocString<'nested map keys'>>> = {}) {\r\n        super(d, baseObjInLookup, additionalPath, LPointerTargetable.singleton);\r\n        this.subMapKeys = subMapKeys;\r\n    }\r\n\r\n    get(target: Dictionary, key: string | number | symbol, proxyitself: Proxyfied<Dictionary>): any {\r\n        if (typeof key === \"symbol\") return this.d[key as any];\r\n        let val: any = this.d[key];\r\n        if (key in this.subMapKeys && !(key in target)) { Log.exx('property not found in dictionary', {target, key, thiss:this, proxyitself, submapkeys: this.subMapKeys}); return undefined; }\r\n        if (key in this.subMapKeys) {\r\n            this.additionalPath += '.';\r\n            return MapProxyHandler.mapWrap( this.d, this.baseObjInLookup, this.additionalPath, this.subMapKeys[key]);\r\n            Log.exDevv('todo: wrap sub-map', {thiss: this});\r\n        }\r\n        return target[key as string]; }\r\n\r\n    set(target: Dictionary, key: string | number | symbol, value: any, proxyitself: Proxyfied<Dictionary>): boolean {\r\n        if (typeof key === \"symbol\") { Log.exx('cannot set a symbol in dictionary', {target, key, value, proxyitself}); return false; }\r\n        SetRootFieldAction.new(this.additionalPath + '.' + key, value, '',false)\r\n        return true;\r\n    }\r\n\r\n    public deleteProperty(target: Dictionary, key: string | symbol, proxyItself?: Proxyfied<any>): boolean {\r\n        if (typeof key === \"symbol\") return false;\r\n        this.set(target, key, undefined, proxyItself);\r\n        delete target[key];\r\n        return true; }\r\n}\r\nRuntimeAccessibleClass.set_extend(MyProxyHandler, MapProxyHandler);\r\n// 15-20 min + 5 di domande entro il 1° ottobre, discussione 10-12 ottobre\r\nexport const getPath: GetPath = new Proxy( {}, new GetPathHandler());\r\n(window as any).getPath = getPath;\r\n// usage: pathstring = ((getPath as DType).some.path.to.follow as any).$; // = \"some.path.to.follow\" with compilation-time validation\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}