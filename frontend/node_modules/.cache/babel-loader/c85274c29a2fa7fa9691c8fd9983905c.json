{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{useEffect}from'react';import{connect}from'react-redux';import{DUser,LProject,LUser,U}from'../joiner';import Dock from'../components/abstract/Dock';import useQuery from\"../hooks/useQuery\";import{ProjectsApi}from\"../api/persistance\";import Navbar from\"../components/navbar/Navbar\";import{SaveManager}from\"../components/topbar/SaveManager\";import Loader from\"../components/loader/Loader\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function EditorComponent(props){var user=props.user;var query=useQuery();var id=query.get('id')||'';var project=LProject.fromPointer(id);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var project,state;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ProjectsApi.getOne(id);case 2:project=_context.sent;if(project){_context.next=5;break;}return _context.abrupt(\"return\");case 5:user.project=LProject.fromPointer(project.id);if(project.state){_context.next=8;break;}return _context.abrupt(\"return\");case 8:_context.next=10;return U.decompressState(project.state);case 10:state=_context.sent;U.log(JSON.parse(state));SaveManager.load(state);case 13:case\"end\":return _context.stop();}}},_callee);}))();},[id]);var allViews=(project===null||project===void 0?void 0:project.viewpoints.flatMap(function(vp){return vp&&vp.allSubViews;}))||[];allViews=allViews.filter(function(v){return v;});var viewsDeDuplicator={};var _iterator=_createForOfIteratorHelper(allViews),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var v=_step.value;viewsDeDuplicator[v.id]=v;}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(user.project)return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsx(Dock,{}),/*#__PURE__*/_jsx(\"style\",{id:\"views-css-injector\",children:Object.values(viewsDeDuplicator).map(function(v){return v.compiled_css;}).join('\\n\\n')})]});return/*#__PURE__*/_jsx(Loader,{});}function mapStateToProps(state,ownProps){var ret={};ret.user=LUser.fromPointer(DUser.current);return ret;}function mapDispatchToProps(dispatch){var ret={};return ret;}export var EditorConnected=connect(mapStateToProps,mapDispatchToProps)(EditorComponent);var EditorPage=function EditorPage(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(EditorConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};export default EditorPage;","map":{"version":3,"names":["useEffect","connect","DUser","LProject","LUser","U","Dock","useQuery","ProjectsApi","Navbar","SaveManager","Loader","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","EditorComponent","props","user","query","id","get","project","fromPointer","_asyncToGenerator","_regeneratorRuntime","mark","_callee","state","wrap","_callee$","_context","prev","next","getOne","sent","abrupt","decompressState","log","JSON","parse","load","stop","allViews","viewpoints","flatMap","vp","allSubViews","filter","v","viewsDeDuplicator","_iterator","_createForOfIteratorHelper","_step","s","n","done","value","err","e","f","children","Object","values","map","compiled_css","join","mapStateToProps","ownProps","ret","current","mapDispatchToProps","dispatch","EditorConnected","EditorPage","arguments","length","undefined","_objectSpread"],"sources":["C:/d/Programming/web/jodel-mde/src/pages/Editor.tsx"],"sourcesContent":["import {Dispatch, ReactElement, useEffect, useState} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport {\r\n    Dictionary,\r\n    DProject,\r\n    DState,\r\n    DUser,\r\n    DViewElement,\r\n    LoadAction,\r\n    LProject,\r\n    LUser, LViewElement,\r\n    LViewPoint,\r\n    Pointer,\r\n    U\r\n} from '../joiner';\r\nimport {FakeStateProps} from '../joiner/types';\r\nimport Dock from '../components/abstract/Dock';\r\nimport useQuery from \"../hooks/useQuery\";\r\nimport {ProjectsApi} from \"../api/persistance\";\r\nimport Navbar from \"../components/navbar/Navbar\";\r\nimport {SaveManager} from \"../components/topbar/SaveManager\";\r\nimport Loader from \"../components/loader/Loader\";\r\n\r\n\r\nfunction EditorComponent(props: AllProps) {\r\n    const user = props.user;\r\n    const query = useQuery();\r\n    const id = query.get('id') || '';\r\n    const project: LProject = LProject.fromPointer(id);\r\n\r\n    useEffect(() => {\r\n        (async function() {\r\n            const project = await ProjectsApi.getOne(id);\r\n            if(!project) return;\r\n            user.project = LProject.fromPointer(project.id);\r\n            if(!project.state) return;\r\n            const state = await U.decompressState(project.state);\r\n            U.log(JSON.parse(state));\r\n            SaveManager.load(state);\r\n        })();\r\n    }, [id]);\r\n    let allViews = project?.viewpoints.flatMap((vp: LViewPoint) => vp && vp.allSubViews) || [];\r\n    allViews = allViews.filter(v => v);\r\n    const viewsDeDuplicator: Dictionary<Pointer<DViewElement>, LViewElement> = {};\r\n    for (let v of allViews) viewsDeDuplicator[v.id] = v;\r\n    if(user.project) return(<>\r\n        <Navbar />\r\n        <Dock />\r\n        <style id={\"views-css-injector\"}>\r\n            {Object.values(viewsDeDuplicator).map(v => v.compiled_css).join('\\n\\n')}\r\n        </style>\r\n    </>);\r\n    return(<Loader />);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {user: LUser}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    ret.user = LUser.fromPointer(DUser.current);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\nexport const EditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(EditorComponent);\r\n\r\nconst EditorPage = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <EditorConnected {...{...props, children}} />;\r\n}\r\n\r\nexport default EditorPage;\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}