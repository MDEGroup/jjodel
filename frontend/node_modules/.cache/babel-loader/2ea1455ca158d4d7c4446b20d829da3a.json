{"ast":null,"code":"import{Action,DUser,Input,LUser,U}from'../../joiner';import React,{useState}from'react';import{connect}from'react-redux';import IoT from\"../../iot/IoT\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function makeInput(label,type){return/*#__PURE__*/_jsxs(\"div\",{className:'p-1 d-flex',children:[/*#__PURE__*/_jsx(\"label\",{className:'my-auto',children:label}),/*#__PURE__*/_jsx(\"input\",{type:type,className:'my-auto input ms-auto',spellCheck:false})]});}function BrokerEditorComponent(props){const{user}=props;const[connected,setConnected]=useState(IoT.client.connected);const[url,setUrl]=useState('http://localhost');const[port,setPort]=useState(1883);const[actions,setActions]=useState([]);const connect=async()=>{var _user$project;//SetRootFieldAction.new('isLoading', true);\nIoT.client.io.opts.query={'project':(_user$project=user.project)===null||_user$project===void 0?void 0:_user$project.id,'brokerUrl':\"\".concat(url,\":\").concat(port)};IoT.client.connect();// IoT.client.off('pull-action');\nIoT.client.on('pull-action',receivedAction=>{// if(actions.includes(receivedAction.id)) return;\nconst action=Action.fromJson(receivedAction);console.log('Received Action from server.',action);action.fire();});await U.sleep(1);//SetRootFieldAction.new('isLoading', false);\nsetConnected(IoT.client.connected);};const disconnect=async()=>{//SetRootFieldAction.new('isLoading', true);\nIoT.client.off('pull-action');IoT.client.disconnect();await U.sleep(1);//SetRootFieldAction.new('isLoading', false);\nsetConnected(IoT.client.connected);};return/*#__PURE__*/_jsxs(\"section\",{className:'properties-tab',children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',bottom:10,right:10,width:'20px',height:'20px'},className:\"d-block ms-2 my-auto circle \".concat(connected?'bg-success':'bg-danger')}),/*#__PURE__*/_jsxs(\"label\",{className:'input-container',children:[/*#__PURE__*/_jsx(\"b\",{className:'me-2',children:\"Url:\"}),/*#__PURE__*/_jsx(Input,{getter:()=>url,setter:v=>setUrl(String(v)),type:'text'})]}),/*#__PURE__*/_jsxs(\"label\",{className:'input-container',children:[/*#__PURE__*/_jsx(\"b\",{className:'me-2',children:\"Port:\"}),/*#__PURE__*/_jsx(Input,{getter:()=>String(port),setter:v=>setPort(Number(v)),type:'number'})]}),/*#__PURE__*/_jsxs(\"label\",{className:'input-container',children:[/*#__PURE__*/_jsx(\"b\",{className:'me-2',children:\"Username:\"}),/*#__PURE__*/_jsx(Input,{getter:()=>'',setter:v=>{},type:'text'})]}),/*#__PURE__*/_jsxs(\"label\",{className:'input-container',children:[/*#__PURE__*/_jsx(\"b\",{className:'me-2',children:\"Password:\"}),/*#__PURE__*/_jsx(Input,{getter:()=>'',setter:v=>{},type:'text'})]}),!connected&&/*#__PURE__*/_jsx(\"button\",{onClick:connect,className:'mt-2 btn btn-primary w-25 p-2',children:\"Connect\"}),connected&&/*#__PURE__*/_jsx(\"button\",{onClick:disconnect,className:'mt-2 btn btn-primary w-25 p-2',children:\"Disconnect\"})]});}function mapStateToProps(state,ownProps){const ret={};ret.user=LUser.fromPointer(DUser.current);return ret;}function mapDispatchToProps(dispatch){const ret={};return ret;}export const BrokerEditorConnected=connect(mapStateToProps,mapDispatchToProps)(BrokerEditorComponent);export const BrokerEditor=function(props){let children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(BrokerEditorConnected,{...props,children});};BrokerEditorComponent.cname='BrokerEditorComponent';BrokerEditorConnected.cname='BrokerEditorConnected';BrokerEditor.cname='BrokerEditor';export default BrokerEditor;","map":{"version":3,"names":["Action","DUser","Input","LUser","U","React","useState","connect","IoT","jsx","_jsx","jsxs","_jsxs","makeInput","label","type","className","children","spellCheck","BrokerEditorComponent","props","user","connected","setConnected","client","url","setUrl","port","setPort","actions","setActions","_user$project","io","opts","query","project","id","concat","on","receivedAction","action","fromJson","console","log","fire","sleep","disconnect","off","style","position","bottom","right","width","height","getter","setter","v","String","Number","onClick","mapStateToProps","state","ownProps","ret","fromPointer","current","mapDispatchToProps","dispatch","BrokerEditorConnected","BrokerEditor","arguments","length","undefined","cname"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/src/components/editors/Broker.tsx"],"sourcesContent":["import {\r\n    Action,\r\n    CompositeAction,\r\n    DState,\r\n    DUser,\r\n    GObject, Input,\r\n    LUser,\r\n    Pointer,\r\n    SetRootFieldAction,\r\n    store,\r\n    U\r\n} from '../../joiner';\r\nimport React, {Dispatch, ReactElement, ReactNode, useState} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport IoT from \"../../iot/IoT\";\r\nimport {FakeStateProps} from \"../../joiner/types\";\r\n\r\nfunction makeInput(label: string, type: 'text'|'number'|'password'): ReactNode {\r\n    return(<div className={'p-1 d-flex'}>\r\n        <label className={'my-auto'}>{label}</label>\r\n        <input type={type} className={'my-auto input ms-auto'} spellCheck={false} />\r\n    </div>);\r\n}\r\n\r\nfunction BrokerEditorComponent(props: AllProps) {\r\n    const {user} = props;\r\n    const [connected, setConnected] = useState(IoT.client.connected);\r\n    const [url, setUrl] = useState('http://localhost');\r\n    const [port, setPort] = useState(1883);\r\n    const [actions, setActions] = useState<Pointer[]>([]);\r\n\r\n\r\n    const connect = async() => {\r\n        //SetRootFieldAction.new('isLoading', true);\r\n        IoT.client.io.opts.query = {'project': user.project?.id, 'brokerUrl': `${url}:${port}`};\r\n        IoT.client.connect();\r\n        // IoT.client.off('pull-action');\r\n        IoT.client.on('pull-action', (receivedAction: GObject<Action & CompositeAction>) => {\r\n            // if(actions.includes(receivedAction.id)) return;\r\n            const action = Action.fromJson(receivedAction);\r\n            console.log('Received Action from server.', action);\r\n            action.fire();\r\n        });\r\n        await U.sleep(1);\r\n        //SetRootFieldAction.new('isLoading', false);\r\n        setConnected(IoT.client.connected);\r\n    }\r\n    const disconnect = async() => {\r\n        //SetRootFieldAction.new('isLoading', true);\r\n        IoT.client.off('pull-action');\r\n        IoT.client.disconnect();\r\n        await U.sleep(1);\r\n        //SetRootFieldAction.new('isLoading', false);\r\n        setConnected(IoT.client.connected);\r\n    }\r\n\r\n    return <section className={'properties-tab'}>\r\n        <div style={{position: 'absolute', bottom: 10, right: 10, width: '20px', height: '20px'}} className={`d-block ms-2 my-auto circle ${connected ? 'bg-success' : 'bg-danger'}`}></div>\r\n        <label className={'input-container'}>\r\n            <b className={'me-2'}>Url:</b>\r\n            <Input getter={() => url} setter={v => setUrl(String(v))} type={'text'} />\r\n        </label>\r\n        <label className={'input-container'}>\r\n            <b className={'me-2'}>Port:</b>\r\n            <Input getter={() => String(port)} setter={v => setPort(Number(v))} type={'number'} />\r\n        </label>\r\n        <label className={'input-container'}>\r\n            <b className={'me-2'}>Username:</b>\r\n            <Input getter={() => ''} setter={v => {}} type={'text'} />\r\n        </label>\r\n        <label className={'input-container'}>\r\n            <b className={'me-2'}>Password:</b>\r\n            <Input getter={() => ''} setter={v => {}} type={'text'} />\r\n        </label>\r\n        {!connected && <button onClick={connect} className={'mt-2 btn btn-primary w-25 p-2'}>Connect</button>}\r\n        {connected && <button onClick={disconnect} className={'mt-2 btn btn-primary w-25 p-2'}>Disconnect</button>}\r\n        {/*<button onClick={e => U.publish('sensors', {test: 15, other: true})}>click</button>*/}\r\n    </section>;\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {user: LUser}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    ret.user = LUser.fromPointer(DUser.current);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const BrokerEditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(BrokerEditorComponent);\r\n\r\nexport const BrokerEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <BrokerEditorConnected {...{...props, children}} />;\r\n}\r\n\r\nBrokerEditorComponent.cname = 'BrokerEditorComponent';\r\nBrokerEditorConnected.cname = 'BrokerEditorConnected';\r\nBrokerEditor.cname = 'BrokerEditor';\r\nexport default BrokerEditor;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}