{"ast":null,"code":"import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createClass from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _get from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";import _getPrototypeOf from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _classCallCheck from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{Debug,DEdgePoint,DGraph,DGraphElement,DGraphVertex,DVertex,DVoidVertex,EMeasurableEvents,GraphElementComponent,GraphElementDispatchProps,GraphElementStatee,Log,LPointerTargetable,RuntimeAccessibleClass,Size,TRANSACTION,U}from'../../joiner';import $ from'jquery';import'jqueryui';import'jqueryui/jquery-ui.css';import{lightModeAllowedElements}from'../graphElement/graphElement';import{VertexStateProps}from'../graphElement/sharedTypes/sharedTypes';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var superclassGraphElementComponent=RuntimeAccessibleClass.classes.GraphElementComponent;var ThisStatee=/*#__PURE__*/function(_GraphElementStatee){_inherits(ThisStatee,_GraphElementStatee);var _super=_createSuper(ThisStatee);function ThisStatee(){var _this;_classCallCheck(this,ThisStatee);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.forceupdate=void 0;return _this;}return ThisStatee;}(GraphElementStatee);var dragHelper=document.createElement('div');dragHelper.style.backgroundColor='transparent';dragHelper.style.outline='1px dashed black';// '4px dashed #333';\ndragHelper.style.zIndex='9999';export var VertexComponent=/*#__PURE__*/function(_superclassGraphEleme){_inherits(VertexComponent,_superclassGraphEleme);var _super2=_createSuper(VertexComponent);function VertexComponent(props,context){var _this2;_classCallCheck(this,VertexComponent);_this2=_super2.call(this,props,context);_this2.draggableOptions=void 0;_this2.resizableOptions=void 0;_this2.rotableOptions=void 0;_this2.getSize=_this2.getSize.bind(_assertThisInitialized(_this2));_this2.setSize=_this2.setSize.bind(_assertThisInitialized(_this2));// this.state={forceupdate:1};\n/*// remove this?\r\n        setTimeout(()=>{\r\n            this.getSize = this.getSize.bind(this);\r\n            this.setSize = this.setSize.bind(this);\r\n            // this.get_size = console.error as any;\r\n            // this.r = (<RootVertex props={this.props} render={super.render()} super={this} />);\r\n            this.forceUpdate();\r\n            this.setState({forceupdate:2});\r\n        },1)*/return _this2;}/*\r\n    onViewChangeOld(): void {\r\n        super.onViewChangeOld();\r\n        this.draggableOptions = undefined;\r\n        this.resizableOptions = undefined;\r\n        this.rotableOptions = undefined;\r\n    }*/_createClass(VertexComponent,[{key:\"setVertexProperties\",value:function setVertexProperties(){var _this3=this;if(!this.props.node||!this.html.current)return;var html=this.html.current;var $measurable=$(html);// todo: install typings\nvar view=this.props.view;var isDraggable=view.draggable;var isResizable=view.resizable;var allviews=[view].concat(_toConsumableArray(this.props.views)).map(function(v){return v.id;});// $element = $(html).find('.measurable').addBack();\ntry{if(!isDraggable){if($measurable.data(\"uiDraggable\"))$measurable.draggable('disable');}else if(this.draggableOptions){if($measurable.data(\"uiDraggable\"))$measurable.draggable('enable');// NB: this check is to see if draggable has been setup. i think if 2 refreshes happens to fast it can\n// happen that this.draggableOptions i set, but jqui didn't set up the draggable infos and throws warnings.\n}else{// first setup only\nthis.draggableOptions={cursor:'grabbing',containment:'parent',opacity:0.0,disabled:!isDraggable,// this does not work, i think because once set the first time the whole declaration is not re-applied. would need to undo draggable\ndistance:5,helper:function helper(){// or 'clone'\n// dragHelper.style.display='block';\nvar size=_this3.getSize();// let actualSize = Size.of(html);\n// if (size.w !== actualSize.w || size.h !== actualSize.h) this.setSize({w:actualSize.w, h:actualSize.h});\ndragHelper.style.width=size.w+'px';dragHelper.style.height=size.h+'px';dragHelper.style.opacity='1';// this.props.view.constraints.length ? '1' : '0.5';\nif(_this3.props.view.lazySizeUpdate)dragHelper.classList.add('lazySizeUpdate');else dragHelper.classList.remove('lazySizeUpdate');return dragHelper;},// disabled: !(view.draggable),\nstart:function start(event,obj){var _iterator=_createForOfIteratorHelper(allviews),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var vid=_step.value;_this3.doMeasurableEvent(EMeasurableEvents.onDragStart,vid);}}catch(err){_iterator.e(err);}finally{_iterator.f();}},drag:function drag(event,obj){TRANSACTION(function(){if(!_this3.props.view.lazySizeUpdate)_this3.setSize({x:obj.position.left,y:obj.position.top});var _iterator2=_createForOfIteratorHelper(allviews),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var vid=_step2.value;_this3.doMeasurableEvent(EMeasurableEvents.whileDragging,vid);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}});},stop:function stop(event,obj){TRANSACTION(function(){_this3.setSize({x:obj.position.left,y:obj.position.top});var _iterator3=_createForOfIteratorHelper(allviews),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var vid=_step3.value;_this3.doMeasurableEvent(EMeasurableEvents.onDragEnd,vid);}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}});}};$measurable.draggable(this.draggableOptions);}}catch(e){this.draggableOptions=undefined;Log.w(\"failed to setup / update draggable uptions\",e,this,this.props.node,this.props.data);return;// might throw error if element is not visible or in the dom or similar, but i won't care in that case.\n// but i reset draggableOptions so it can retry later if element enters the DOM instead of thinking it is already finished setup\n}try{if(!isResizable){if($measurable.data(\"uiResizable\"))$measurable.resizable('disable');}else if(this.resizableOptions){if($measurable.data(\"uiResizable\"))$measurable.resizable('enable');}if(!this.resizableOptions){this.resizableOptions={helper:'selected-by-me',start:function start(event,obj){TRANSACTION(function(){if(!_this3.props.node.isResized)_this3.props.node.isResized=true;// set only on manual resize, so here and not on setSize()\nvar _iterator4=_createForOfIteratorHelper(allviews),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var vid=_step4.value;_this3.doMeasurableEvent(EMeasurableEvents.onResizeStart,vid);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}});},resize:function resize(event,obj){TRANSACTION(function(){if(!_this3.props.view.lazySizeUpdate)_this3.setSize({w:obj.position.width,h:obj.position.height});var _iterator5=_createForOfIteratorHelper(allviews),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var vid=_step5.value;_this3.doMeasurableEvent(EMeasurableEvents.whileResizing,vid);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}});},stop:function stop(event,obj){if(!_this3.state.classes.includes('resized'))_this3.setState({classes:[].concat(_toConsumableArray(_this3.state.classes),['resized'])});// if (!withSetSize) { node.width = obj.size.width; node.height = obj.size.height; } else {\nvar absolutemode=true;// this one is less tested and safe, but should work even if html container is sized 0. best if made to work\nvar newSize;if(absolutemode){var nativeevt=event.originalEvent.originalEvent;var htmlSize=Size.of(event.target,false);newSize=_this3.props.node.graph.translateHtmlSize(htmlSize);/*n\r\n                        this is some pixels off, i think because inner coords are post the border of the container element,\r\n                         and the innermost graph size have coords before his borders, so the translation is off by the amount\r\n                          of border width of the innermost graph (and package default view does have a border)\r\n                           so in graph coord translate function should add: outersize.add( x: innergraph.html.getFinalComputedCSS('border-width-left'), y: ...border-width-top\r\n\r\n                    let cursorSize = new GraphSize(0, 0, nativeevt.clientX, nativeevt.clientY);//\r\n                    newSize = htmlSize.duplicate() as any; // .subtract( {w:cursorSize.x, h:cursorSize.y}, true);\r\n                    let handleClasses: string[] = [...event.originalEvent.target.classList];\r\n                    let handleKeyLength = 14; // equal to 'ui-resizable-'.length + 1;\r\n                    let handleClassName = handleClasses.find( // i check both length and indexOf, because i must match 'ui-resizable-se' but not 'ui-resizable-handle'\r\n                        (e) => (e.length === handleKeyLength || e.length === handleKeyLength + 1) && e.indexOf('ui-resizable-')===0);\r\n\r\n                        let handleType = handleClassName ? handleClassName.substring(13) : '';\r\n                        switch (handleType) {\r\n                            default: case '': case 'se':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                newSize.w = cursorSize.w - htmlSize.x;\r\n                                newSize.h = cursorSize.h - htmlSize.y;\r\n                                break;\r\n                            case 'n': case 's':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                delete newSize.w;\r\n                                newSize.h = cursorSize.h - htmlSize.y;\r\n                                break;\r\n                            case 'e': case 'W':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                newSize.w = cursorSize.w - htmlSize.x;\r\n                                delete newSize.h;\r\n                                break;\r\n                            case 'nw':\r\n                                let br = htmlSize.br();\r\n                                newSize.x = cursorSize.x;\r\n                                newSize.y = cursorSize.y;\r\n                                newSize.w = br.x - cursorSize.w;\r\n                                newSize.h = br.y - cursorSize.h;\r\n                                break;\r\n                            case 'ne':\r\n                                delete newSize.x;\r\n                                newSize.y = cursorSize.y;\r\n                                delete newSize.w;\r\n                                delete newSize.h;\r\n                            case '?':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                delete newSize.w;\r\n                                delete newSize.h;\r\n                                break;\r\n                        }*/ // n, e, s, w, ne, se, sw, nw\n// almost, but: there is a few pix error. and: if i drag through horizontal or vertical handles it acts as if i used diagonal handle\n// console.log('resizing', {newSize, cursorSize, htmlSize, event, nativeevt, sizeof_with_transforms: Size.of(event.target, true)});\nconsole.log('resizing',{newSize:newSize,htmlSize:htmlSize,event:event,nativeevt:nativeevt,sizeof_with_transforms:Size.of(event.target,true)});}else newSize={w:obj.size.width,h:obj.size.height};// evt coordinates: clientX, layerX, offsetX, pageX, screenX\nTRANSACTION(function(){_this3.setSize(newSize);// console.log('resize setsize:', obj, {w:obj.size.width, h:obj.size.height});\nvar _iterator6=_createForOfIteratorHelper(allviews),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var vid=_step6.value;_this3.doMeasurableEvent(EMeasurableEvents.onResizeEnd,vid);}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}});}};$measurable.resizable(this.resizableOptions);}}catch(e){// check draggable catch comment\nthis.resizableOptions=undefined;Log.w(\"failed to setup / update resizable uptions\",e,this,this.props.node,this.props.data);return;}try{// edit dynamic draggable options post-setup\nif(this.draggableOptions){// none so far?\n}// edit dynamic resizable options post-setup\nif(this.resizableOptions){var _this$resizableOption,_this$resizableOption2;var lazySizeUpdate=view.lazySizeUpdate;var containment=lazySizeUpdate?false:'parent';var helper=lazySizeUpdate?'resizable-helper-bad':'original';// helper does not accept a func or htmlElem, but only a classname...\n// and makes his own empty proxy element to resize in his place. inchoherent.\nif(((_this$resizableOption=this.resizableOptions)===null||_this$resizableOption===void 0?void 0:_this$resizableOption.containment)!==containment){this.resizableOptions.containment=containment;$measurable.draggable('option','containment',containment);}if(((_this$resizableOption2=this.resizableOptions)===null||_this$resizableOption2===void 0?void 0:_this$resizableOption2.helper)!==helper){this.resizableOptions.helper=helper;$measurable.resizable('option','helper',helper);}}}catch(e){// check draggable catch comment\nthis.draggableOptions=undefined;this.resizableOptions=undefined;this.rotableOptions=undefined;Log.w(\"failed to update measurable uptions\",e,this,this.props.node,this.props.data);return;}}},{key:\"getSize\",value:function getSize(){var _this$props$data,_this$props$node;return this.props.node.getSize(false,!this.props.node.isResized&&this.props.view.adaptWidth);/*console.log('get_size('+(this.props?.data as any).name+')', {\r\n            view:this.props.view.getSize(this.props.dataid || this.props.nodeid as string),\r\n            node:this.props.node?.size,\r\n            default: this.props.view.defaultVSize});*/var ret=this.props.view.getSize(((_this$props$data=this.props.data)===null||_this$props$data===void 0?void 0:_this$props$data.id)||this.props.nodeid)||((_this$props$node=this.props.node)===null||_this$props$node===void 0?void 0:_this$props$node.size)||this.props.view.defaultVSize;if(this.props.node.isResized)return ret;var actualSize=this.html.current?Size.of(this.html.current):{w:0,h:0};if(this.props.view.adaptWidth&&ret.w!==actualSize.w){this.setSize({w:actualSize.w});ret.w=actualSize.w;}if(this.props.view.adaptHeight&&ret.h!==actualSize.h){this.setSize({h:actualSize.h});ret.h=actualSize.h;}return ret;}// setSize(x_or_size_or_point: number, y?: number, w?:number, h?:number): void;\n},{key:\"setSize\",value:// setSize(x_or_size_or_point: number | GraphSize | GraphPoint, y?: number, w?:number, h?:number): void;\nfunction setSize(size0){var size=size0;if(size.w!==undefined&&size.w<0)size.w=0;if(size.h!==undefined&&size.h<0)size.h=0;return this.props.node.size=size;// console.log('setSize('+(this.props?.data as any).name+') thisss', this);\nif(this.props.view.storeSize){var _this$props$data2;var id=((_this$props$data2=this.props.data)===null||_this$props$data2===void 0?void 0:_this$props$data2.id)||this.props.nodeid;this.props.view.updateSize(id,size);return;}var olds=this.props.node.size;size.x=size.x===undefined?olds===null||olds===void 0?void 0:olds.x:size.x;size.y=size.y===undefined?olds===null||olds===void 0?void 0:olds.y:size.y;size.w=size.w===undefined?olds===null||olds===void 0?void 0:olds.w:size.w;size.h=size.h===undefined?olds===null||olds===void 0?void 0:olds.h:size.h;this.props.node.size=size;}},{key:\"render\",value:function render(){if(Debug.lightMode&&(!this.props.data||!lightModeAllowedElements.includes(this.props.data.className))){return this.props.data?/*#__PURE__*/_jsxs(\"div\",{children:[\" \"+this.props.data.name,\":\",this.props.data.className]}):undefined;}if(!this.props.node)return'Loading Node...';var cssOverride=[];// const selected = this.props.selected;\n// if (selected && selected.id === this.props.nodeid) cssOverride.push('selected-by-me');\n// if(!windoww.cpts) windoww.cpts = {};\n// windoww.cpts[this.props.nodeid]=this;\n// console.log('updated');\n//return this.r || <div>loading...</div>;\n// set classes\nvar nodeType='NODE_TYPE_ERROR';if(this.props.isedgepoint)nodeType='EdgePoint';else if(this.props.isgraph&&this.props.isvertex)nodeType='GraphVertex';else if(this.props.isgraph&&!this.props.isvertex)nodeType='Graph';else if(!this.props.isgraph&&this.props.isvertex&&(this.props.isvoid||!this.props.data))nodeType='VoidVertex';else if(!this.props.isgraph&&this.props.isvertex)nodeType='Vertex';else if(!this.props.isgraph&&!this.props.isvertex)nodeType='Field';// const named: LNamedElement = this.props.data as LNamedElement; // LNamedElement.fromPointer(this.props.dataid);\nvar classesOverride=[nodeType].concat(cssOverride);// , (named?.name === 'default') ? 'default' : ''];\nvar styleOverride={};// set classes end\nvar size=this.getSize();switch(nodeType){case'GraphVertex':case'Vertex':case'VoidVertex':case'EdgePoint':styleOverride.top=size.y+'px';styleOverride.left=size.x+'px';var isResized=this.props.node.isResized;if(isResized||!this.props.view.adaptWidth)styleOverride.width=size.w+'px';else styleOverride.width=undefined;if(isResized||!this.props.view.adaptHeight)styleOverride.height=size.h+'px';else styleOverride.height=undefined;// todo: the goal is to reset jqui inline style, but not override user-defined inline style\nthis.setVertexProperties();break;default:break;}return _get(_getPrototypeOf(VertexComponent.prototype),\"render\",this).call(this,nodeType,styleOverride,classesOverride);// return <RootVertex props={this.props} render={super.render()} super={this} key={this.props.nodeid+'.'+this.state?.forceupdate} />;\n}},{key:\"select\",value:function select(forUser){_get(_getPrototypeOf(VertexComponent.prototype),\"select\",this).call(this,forUser);}}]);return VertexComponent;}(superclassGraphElementComponent);VertexComponent.cname='VertexComponent';var DispatchProps=/*#__PURE__*/function(_GraphElementDispatch){_inherits(DispatchProps,_GraphElementDispatch);var _super3=_createSuper(DispatchProps);function DispatchProps(){_classCallCheck(this,DispatchProps);return _super3.apply(this,arguments);}return DispatchProps;}(GraphElementDispatchProps);function mapStateToProps(state,ownProps){var DGraphElementClass;if(ownProps.isedgepoint)DGraphElementClass=DEdgePoint;else if(ownProps.isvertex&&ownProps.isgraph)DGraphElementClass=DGraphVertex;else if(ownProps.isvertex&&!ownProps.isgraph)DGraphElementClass=DVertex;else if(!ownProps.isvertex&&ownProps.isgraph)DGraphElementClass=DGraph;else DGraphElementClass=DGraphElement;// DField;\nif(DGraphElementClass===DVertex&&ownProps.isvoid)DGraphElementClass=DVoidVertex;var superret=GraphElementComponent.mapStateToProps(state,ownProps,DGraphElementClass,_objectSpread({},ownProps));// superret.lastSelected = state._lastSelected?.modelElement;\n// superret.lastSelected = state._lastSelected ? LPointerTargetable.from(state._lastSelected.modelElement) : null;\n// change current to correct user ID when authentication is implemented.\n// const selected = state.selected[DUser.current];\n// uperret.selected = (selected) ? LGraphElement.fromPointer(selected) : null;\n/*  Uncomment this when we have user authentication.\r\n    superret.selected = {};\r\n    for(let user of Object.keys(selected)) {\r\n        const pointer = selected[user];\r\n        if (pointer) superret.selected[user] = LModelElement.fromPointer(pointer);\r\n        else superret.selected[user] = null;\r\n    }\r\n    */superret.isEdgePending={user:LPointerTargetable.from(state.isEdgePending.user),source:LPointerTargetable.from(state.isEdgePending.source)};// superret.viewpoint = LViewPoint.fromPointer(state.viewpoint);\nvar ret=new VertexStateProps();U.objectMergeInPlace(superret,ret);U.removeEmptyObjectKeys(superret);return superret;}function mapDispatchToProps(dispatch){var superret=GraphElementComponent.mapDispatchToProps(dispatch);var ret=new GraphElementDispatchProps();U.objectMergeInPlace(superret,ret);U.removeEmptyObjectKeys(superret);return superret;}export var VertexConnected=connect(mapStateToProps,mapDispatchToProps)(VertexComponent);export var Vertex=function Vertex(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];//  children: (string | React.Component)[]\nreturn/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:false,isvertex:true}));};export var VoidVertex=function VoidVertex(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:false,isvertex:true,isvoid:true}));};export var EdgePoint=function EdgePoint(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:false,isedgepoint:true}));};// todo: name them all or verify the name is still usable.\nexport var Graph=function Graph(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];// doesn't work?\nreturn/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:true,isvertex:false}));};export var GraphVertex=function GraphVertex(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:true,isvertex:true}));};export var Field=function Field(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(VertexConnected,_objectSpread(_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})),{},{isgraph:false,isvertex:false}));};window.componentdebug={Graph:Graph,GraphVertex:GraphVertex,Field:Field,Vertex:Vertex,VoidVertex:VoidVertex,EdgePoint:EdgePoint,VertexConnected:VertexConnected,VertexComponent:VertexComponent};Graph.cname='Graph';GraphVertex.cname='GraphVertex';Field.cname='Field';Vertex.cname='Vertex';VoidVertex.cname='VoidVertex';EdgePoint.cname='EdgePoint';// GraphConnected.cname = 'GraphConnected';\n// GraphVertexConnected.cname = 'GraphVertexConnected';\n// FieldConnected.cname = 'FieldConnected';\nVertexConnected.cname='VertexConnected';// VoidVertexConnected.cname = 'VoidVertexConnected';\n// EdgePointConnected.cname = 'EdgePointConnected';\n// GraphComponent.cname = 'GraphComponent';\n// GraphVertexComponent.cname = 'GraphVertexComponent';\n// FieldComponent.cname = 'FieldComponent';\nVertexComponent.cname='VertexComponent';// VoidVertexComponent.cname = 'VoidVertexComponent';\n// EdgePointComponent.cname = 'EdgePointComponent';","map":{"version":3,"names":["React","connect","Debug","DEdgePoint","DGraph","DGraphElement","DGraphVertex","DVertex","DVoidVertex","EMeasurableEvents","GraphElementComponent","GraphElementDispatchProps","GraphElementStatee","Log","LPointerTargetable","RuntimeAccessibleClass","Size","TRANSACTION","U","$","lightModeAllowedElements","VertexStateProps","jsxs","_jsxs","jsx","_jsx","superclassGraphElementComponent","classes","ThisStatee","_GraphElementStatee","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","forceupdate","dragHelper","document","createElement","style","backgroundColor","outline","zIndex","VertexComponent","_superclassGraphEleme","_super2","props","context","_this2","draggableOptions","resizableOptions","rotableOptions","getSize","bind","_assertThisInitialized","setSize","_createClass","key","value","setVertexProperties","_this3","node","html","current","$measurable","view","isDraggable","draggable","isResizable","resizable","allviews","_toConsumableArray","views","map","v","id","data","cursor","containment","opacity","disabled","distance","helper","size","width","w","height","h","lazySizeUpdate","classList","add","remove","start","event","obj","_iterator","_createForOfIteratorHelper","_step","s","n","done","vid","doMeasurableEvent","onDragStart","err","e","f","drag","x","position","left","y","top","_iterator2","_step2","whileDragging","stop","_iterator3","_step3","onDragEnd","undefined","isResized","_iterator4","_step4","onResizeStart","resize","_iterator5","_step5","whileResizing","state","includes","setState","absolutemode","newSize","nativeevt","originalEvent","htmlSize","of","target","graph","translateHtmlSize","console","log","sizeof_with_transforms","_iterator6","_step6","onResizeEnd","_this$resizableOption","_this$resizableOption2","_this$props$data","_this$props$node","adaptWidth","ret","nodeid","defaultVSize","actualSize","adaptHeight","size0","storeSize","_this$props$data2","updateSize","olds","render","lightMode","className","children","name","cssOverride","nodeType","isedgepoint","isgraph","isvertex","isvoid","classesOverride","styleOverride","_get","_getPrototypeOf","prototype","select","forUser","cname","DispatchProps","_GraphElementDispatch","_super3","mapStateToProps","ownProps","DGraphElementClass","superret","_objectSpread","isEdgePending","user","from","source","objectMergeInPlace","removeEmptyObjectKeys","mapDispatchToProps","dispatch","VertexConnected","Vertex","VoidVertex","EdgePoint","Graph","GraphVertex","Field","window","componentdebug"],"sources":["C:/d/Programming/web/jodel-mde/src/graph/vertex/Vertex.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement, ReactNode} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport {\r\n    Debug,\r\n    DEdgePoint,\r\n    DGraph,\r\n    DGraphElement,\r\n    DGraphVertex,\r\n    DState, DUser,\r\n    DVertex, DViewElement,\r\n    DVoidVertex,\r\n    EMeasurableEvents,\r\n    GObject,\r\n    GraphElementComponent,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    GraphPoint,\r\n    GraphSize,\r\n    LClass, LGraph, LGraphElement,\r\n    LModelElement, LNamedElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    LUser, LViewElement,\r\n    LViewPoint,\r\n    LVoidVertex, Pointer,\r\n    RuntimeAccessibleClass,\r\n    SetRootFieldAction,\r\n    Size,\r\n    TRANSACTION,\r\n    U,\r\n} from '../../joiner';\r\nimport $ from 'jquery';\r\nimport 'jqueryui';\r\nimport 'jqueryui/jquery-ui.css';\r\nimport { lightModeAllowedElements } from '../graphElement/graphElement';\r\nimport ContextMenu from \"../../components/contextMenu/ContextMenu\";\r\nimport {VertexOwnProps, VertexStateProps} from '../graphElement/sharedTypes/sharedTypes';\r\n\r\nconst superclassGraphElementComponent: typeof GraphElementComponent = RuntimeAccessibleClass.classes.GraphElementComponent as any as typeof GraphElementComponent;\r\nclass ThisStatee extends GraphElementStatee { forceupdate?: number }\r\n\r\nconst dragHelper = document.createElement('div');\r\ndragHelper.style.backgroundColor = 'transparent';\r\ndragHelper.style.outline = '1px dashed black'; // '4px dashed #333';\r\ndragHelper.style.zIndex = '9999';\r\n\r\n\r\nexport class VertexComponent<AllProps extends AllPropss = AllPropss, ThisState extends ThisStatee = ThisStatee>\r\n    extends superclassGraphElementComponent<AllProps, ThisState> {\r\n    public static cname: string = 'VertexComponent';\r\n    draggableOptions: GObject | undefined;\r\n    resizableOptions: GObject | undefined;\r\n    rotableOptions: GObject | undefined;\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        this.getSize = this.getSize.bind(this);\r\n        this.setSize = this.setSize.bind(this);\r\n        // this.state={forceupdate:1};\r\n        /*// remove this?\r\n        setTimeout(()=>{\r\n            this.getSize = this.getSize.bind(this);\r\n            this.setSize = this.setSize.bind(this);\r\n            // this.get_size = console.error as any;\r\n            // this.r = (<RootVertex props={this.props} render={super.render()} super={this} />);\r\n            this.forceUpdate();\r\n            this.setState({forceupdate:2});\r\n        },1)*/\r\n    }\r\n/*\r\n    onViewChangeOld(): void {\r\n        super.onViewChangeOld();\r\n        this.draggableOptions = undefined;\r\n        this.resizableOptions = undefined;\r\n        this.rotableOptions = undefined;\r\n    }*/\r\n\r\n    setVertexProperties(){\r\n        if (!this.props.node || !this.html.current) return;\r\n        let html = this.html.current;\r\n        const $measurable: GObject<'JQuery + ui plugin'> = $(html); // todo: install typings\r\n\r\n        let view: LViewElement = this.props.view;\r\n        let isDraggable: boolean = view.draggable;\r\n        let isResizable: boolean = view.resizable;\r\n        let allviews: Pointer<DViewElement>[] = [view, ...this.props.views].map(v=>v.id);\r\n        // $element = $(html).find('.measurable').addBack();\r\n        try {\r\n        if (!isDraggable) {\r\n            if ($measurable.data(\"uiDraggable\")) $measurable.draggable('disable');\r\n        }\r\n        else if (this.draggableOptions) {\r\n            if ($measurable.data(\"uiDraggable\")) $measurable.draggable('enable');\r\n            // NB: this check is to see if draggable has been setup. i think if 2 refreshes happens to fast it can\r\n            // happen that this.draggableOptions i set, but jqui didn't set up the draggable infos and throws warnings.\r\n        }\r\n        else {\r\n            // first setup only\r\n            this.draggableOptions = {\r\n                cursor: 'grabbing',\r\n                containment: 'parent',\r\n                opacity: 0.0,\r\n                disabled: !(isDraggable), // this does not work, i think because once set the first time the whole declaration is not re-applied. would need to undo draggable\r\n                distance: 5,\r\n                helper: () => { // or 'clone'\r\n                    // dragHelper.style.display='block';\r\n                    let size = this.getSize();\r\n                    // let actualSize = Size.of(html);\r\n                    // if (size.w !== actualSize.w || size.h !== actualSize.h) this.setSize({w:actualSize.w, h:actualSize.h});\r\n                    dragHelper.style.width = size.w + 'px';\r\n                    dragHelper.style.height = size.h + 'px';\r\n                    dragHelper.style.opacity = '1'; // this.props.view.constraints.length ? '1' : '0.5';\r\n                    if (this.props.view.lazySizeUpdate) dragHelper.classList.add('lazySizeUpdate');\r\n                    else dragHelper.classList.remove('lazySizeUpdate');\r\n                    return dragHelper;\r\n                },\r\n                // disabled: !(view.draggable),\r\n                start: (event: GObject, obj: GObject) => {\r\n                    for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.onDragStart, vid);\r\n                },\r\n                drag: (event: GObject, obj: GObject) => {\r\n                    TRANSACTION(()=>{\r\n                        if (!this.props.view.lazySizeUpdate) this.setSize({x:obj.position.left, y:obj.position.top});\r\n                        for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.whileDragging, vid);\r\n                    })\r\n                },\r\n                stop: (event: GObject, obj: GObject) => {\r\n                    TRANSACTION(()=>{\r\n                        this.setSize({x:obj.position.left, y:obj.position.top});\r\n                        for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.onDragEnd, vid);\r\n                    })\r\n                }\r\n            };\r\n            $measurable.draggable(this.draggableOptions);\r\n        }\r\n        } catch(e) {\r\n            this.draggableOptions = undefined;\r\n            Log.w(\"failed to setup / update draggable uptions\", e, this, this.props.node, this.props.data);\r\n            return;\r\n            // might throw error if element is not visible or in the dom or similar, but i won't care in that case.\r\n            // but i reset draggableOptions so it can retry later if element enters the DOM instead of thinking it is already finished setup\r\n        }\r\n\r\n        try{\r\n        if (!isResizable) {\r\n            if ($measurable.data(\"uiResizable\")) $measurable.resizable('disable');\r\n        }\r\n        else if (this.resizableOptions) {\r\n            if ($measurable.data(\"uiResizable\")) $measurable.resizable('enable');\r\n        }\r\n        if (!this.resizableOptions) {\r\n            this.resizableOptions = {\r\n                helper: 'selected-by-me',\r\n                start: (event: GObject, obj: GObject) => {\r\n                    TRANSACTION(()=>{\r\n                        if (!this.props.node.isResized) this.props.node.isResized = true; // set only on manual resize, so here and not on setSize()\r\n                        for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.onResizeStart, vid);\r\n                    })\r\n                },\r\n                resize: (event: GObject, obj: GObject) => {\r\n                    TRANSACTION(()=>{\r\n                        if (!this.props.view.lazySizeUpdate) this.setSize({w:obj.position.width, h:obj.position.height});\r\n                        for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.whileResizing, vid);\r\n                    })\r\n                },\r\n                stop: (event: GObject, obj: GObject) => {\r\n                    if (!this.state.classes.includes('resized')) this.setState({classes:[...this.state.classes, 'resized']});\r\n                    // if (!withSetSize) { node.width = obj.size.width; node.height = obj.size.height; } else {\r\n                    let absolutemode = true; // this one is less tested and safe, but should work even if html container is sized 0. best if made to work\r\n                    let newSize: Partial<GraphSize>;\r\n                    if (absolutemode) {\r\n                        let nativeevt: MouseEvent = event.originalEvent.originalEvent;\r\n                        let htmlSize = Size.of(event.target, false);\r\n                        newSize = this.props.node.graph.translateHtmlSize(htmlSize);\r\n                        /*n\r\n                        this is some pixels off, i think because inner coords are post the border of the container element,\r\n                         and the innermost graph size have coords before his borders, so the translation is off by the amount\r\n                          of border width of the innermost graph (and package default view does have a border)\r\n                           so in graph coord translate function should add: outersize.add( x: innergraph.html.getFinalComputedCSS('border-width-left'), y: ...border-width-top\r\n\r\n                    let cursorSize = new GraphSize(0, 0, nativeevt.clientX, nativeevt.clientY);//\r\n                    newSize = htmlSize.duplicate() as any; // .subtract( {w:cursorSize.x, h:cursorSize.y}, true);\r\n                    let handleClasses: string[] = [...event.originalEvent.target.classList];\r\n                    let handleKeyLength = 14; // equal to 'ui-resizable-'.length + 1;\r\n                    let handleClassName = handleClasses.find( // i check both length and indexOf, because i must match 'ui-resizable-se' but not 'ui-resizable-handle'\r\n                        (e) => (e.length === handleKeyLength || e.length === handleKeyLength + 1) && e.indexOf('ui-resizable-')===0);\r\n\r\n                        let handleType = handleClassName ? handleClassName.substring(13) : '';\r\n                        switch (handleType) {\r\n                            default: case '': case 'se':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                newSize.w = cursorSize.w - htmlSize.x;\r\n                                newSize.h = cursorSize.h - htmlSize.y;\r\n                                break;\r\n                            case 'n': case 's':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                delete newSize.w;\r\n                                newSize.h = cursorSize.h - htmlSize.y;\r\n                                break;\r\n                            case 'e': case 'W':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                newSize.w = cursorSize.w - htmlSize.x;\r\n                                delete newSize.h;\r\n                                break;\r\n                            case 'nw':\r\n                                let br = htmlSize.br();\r\n                                newSize.x = cursorSize.x;\r\n                                newSize.y = cursorSize.y;\r\n                                newSize.w = br.x - cursorSize.w;\r\n                                newSize.h = br.y - cursorSize.h;\r\n                                break;\r\n                            case 'ne':\r\n                                delete newSize.x;\r\n                                newSize.y = cursorSize.y;\r\n                                delete newSize.w;\r\n                                delete newSize.h;\r\n                            case '?':\r\n                                delete newSize.x;\r\n                                delete newSize.y;\r\n                                delete newSize.w;\r\n                                delete newSize.h;\r\n                                break;\r\n                        }*/\r\n                        // n, e, s, w, ne, se, sw, nw\r\n                        // almost, but: there is a few pix error. and: if i drag through horizontal or vertical handles it acts as if i used diagonal handle\r\n                        // console.log('resizing', {newSize, cursorSize, htmlSize, event, nativeevt, sizeof_with_transforms: Size.of(event.target, true)});\r\n                        console.log('resizing', {newSize, htmlSize, event, nativeevt, sizeof_with_transforms: Size.of(event.target, true)});\r\n                    }\r\n                    else newSize = {w:obj.size.width, h:obj.size.height};\r\n                    // evt coordinates: clientX, layerX, offsetX, pageX, screenX\r\n                    TRANSACTION(()=>{\r\n\r\n                        this.setSize(newSize);\r\n                        // console.log('resize setsize:', obj, {w:obj.size.width, h:obj.size.height});\r\n                        for (let vid of allviews) this.doMeasurableEvent(EMeasurableEvents.onResizeEnd, vid);\r\n                    })\r\n\r\n                }\r\n            }\r\n            $measurable.resizable(this.resizableOptions);\r\n        }\r\n        } catch(e){\r\n            // check draggable catch comment\r\n            this.resizableOptions = undefined;\r\n            Log.w(\"failed to setup / update resizable uptions\", e, this, this.props.node, this.props.data);\r\n            return;\r\n        }\r\n\r\n        try{\r\n            // edit dynamic draggable options post-setup\r\n            if (this.draggableOptions) {\r\n                // none so far?\r\n            }\r\n            // edit dynamic resizable options post-setup\r\n            if (this.resizableOptions) {\r\n                let lazySizeUpdate = view.lazySizeUpdate;\r\n                let containment = lazySizeUpdate ? false : 'parent';\r\n                let helper = lazySizeUpdate ? 'resizable-helper-bad' : 'original';\r\n                // helper does not accept a func or htmlElem, but only a classname...\r\n                // and makes his own empty proxy element to resize in his place. inchoherent.\r\n                if (this.resizableOptions?.containment !== containment){\r\n                    this.resizableOptions.containment = containment;\r\n                    $measurable.draggable( 'option', 'containment', containment);\r\n                }\r\n                if (this.resizableOptions?.helper !== helper){\r\n                    this.resizableOptions.helper = helper;\r\n                    $measurable.resizable( 'option', 'helper', helper);\r\n                }\r\n            }\r\n        } catch(e) {\r\n            // check draggable catch comment\r\n            this.draggableOptions = undefined;\r\n            this.resizableOptions = undefined;\r\n            this.rotableOptions = undefined;\r\n            Log.w(\"failed to update measurable uptions\", e, this, this.props.node, this.props.data);\r\n            return;\r\n        }\r\n    }\r\n\r\n\r\n\r\n    getSize(): Readonly<GraphSize> {\r\n        return this.props.node.getSize(false, !this.props.node.isResized && this.props.view.adaptWidth);\r\n        /*console.log('get_size('+(this.props?.data as any).name+')', {\r\n            view:this.props.view.getSize(this.props.dataid || this.props.nodeid as string),\r\n            node:this.props.node?.size,\r\n            default: this.props.view.defaultVSize});*/\r\n        let ret = this.props.view.getSize(this.props.data?.id || this.props.nodeid as string)\r\n            || this.props.node?.size\r\n            || this.props.view.defaultVSize;\r\n        if (this.props.node.isResized) return ret;\r\n        let actualSize: Partial<Size>&{w:number, h:number} = this.html.current ? Size.of(this.html.current as Element) : {w:0, h:0};\r\n        if (this.props.view.adaptWidth && ret.w !== actualSize.w) {\r\n            this.setSize({w:actualSize.w});\r\n            ret.w = actualSize.w;\r\n        }\r\n        if (this.props.view.adaptHeight && ret.h !== actualSize.h) {\r\n            this.setSize({h:actualSize.h});\r\n            ret.h = actualSize.h;\r\n        }\r\n        return ret;\r\n    }\r\n    // setSize(x_or_size_or_point: number, y?: number, w?:number, h?:number): void;\r\n    setSize(x_or_size_or_point: Partial<GraphPoint>): void;\r\n    setSize(x_or_size_or_point: Partial<GraphSize>): void;\r\n    // setSize(x_or_size_or_point: number | GraphSize | GraphPoint, y?: number, w?:number, h?:number): void;\r\n    setSize(size0: Partial<GraphSize> | Partial<GraphPoint>): void {\r\n        let size: {x?:number, y?: number, w?:number, h?:number} = size0;\r\n        if (size.w !== undefined && size.w < 0) size.w = 0;\r\n        if (size.h !== undefined && size.h < 0) size.h = 0;\r\n        return this.props.node.size = size as any;\r\n        // console.log('setSize('+(this.props?.data as any).name+') thisss', this);\r\n        if (this.props.view.storeSize) {\r\n            let id = (this.props.data?.id || this.props.nodeid) as string;\r\n            this.props.view.updateSize(id, size);\r\n            return;\r\n        }\r\n        let olds = this.props.node.size;\r\n        size.x = size.x === undefined ? olds?.x : size.x;\r\n        size.y = size.y === undefined ? olds?.y : size.y;\r\n        size.w = size.w === undefined ? olds?.w : size.w;\r\n        size.h = size.h === undefined ? olds?.h : size.h;\r\n        this.props.node.size = size as GraphSize;\r\n    }\r\n\r\n    render(): ReactNode {\r\n        if (Debug.lightMode && (!this.props.data || !(lightModeAllowedElements.includes(this.props.data.className)))){\r\n            return this.props.data ? <div>{\" \" + ((this.props.data as any).name)}:{this.props.data.className}</div> : undefined;\r\n        }\r\n        if (!this.props.node) return 'Loading Node...';\r\n\r\n        const cssOverride: string[] = [];\r\n        // const selected = this.props.selected;\r\n        // if (selected && selected.id === this.props.nodeid) cssOverride.push('selected-by-me');\r\n\r\n        // if(!windoww.cpts) windoww.cpts = {};\r\n        // windoww.cpts[this.props.nodeid]=this;\r\n        // console.log('updated');\r\n        //return this.r || <div>loading...</div>;\r\n\r\n        // set classes\r\n        let nodeType = 'NODE_TYPE_ERROR';\r\n        if ( this.props.isedgepoint) nodeType = 'EdgePoint'; else\r\n        if ( this.props.isgraph &&  this.props.isvertex) nodeType = 'GraphVertex'; else\r\n        if ( this.props.isgraph && !this.props.isvertex) nodeType = 'Graph'; else\r\n        if (!this.props.isgraph &&  this.props.isvertex && (this.props.isvoid || !this.props.data)) nodeType = 'VoidVertex'; else\r\n        if (!this.props.isgraph &&  this.props.isvertex) nodeType = 'Vertex'; else\r\n        if (!this.props.isgraph && !this.props.isvertex) nodeType = 'Field';\r\n\r\n        // const named: LNamedElement = this.props.data as LNamedElement; // LNamedElement.fromPointer(this.props.dataid);\r\n        const classesOverride = [nodeType, ...cssOverride]; // , (named?.name === 'default') ? 'default' : ''];\r\n        const styleOverride: React.CSSProperties = {};\r\n        // set classes end\r\n        const size: Readonly<GraphSize> = this.getSize();\r\n\r\n        switch (nodeType){\r\n            case 'GraphVertex':\r\n            case 'Vertex':\r\n            case 'VoidVertex':\r\n            case 'EdgePoint':\r\n                styleOverride.top = size.y + 'px';\r\n                styleOverride.left = size.x + 'px';\r\n                let isResized = this.props.node.isResized;\r\n                if (isResized || !this.props.view.adaptWidth) styleOverride.width = size.w+'px';\r\n                else styleOverride.width = undefined;\r\n                if (isResized || !this.props.view.adaptHeight) styleOverride.height = size.h+'px';\r\n                else styleOverride.height = undefined; // todo: the goal is to reset jqui inline style, but not override user-defined inline style\r\n                this.setVertexProperties(); break;\r\n            default: break;\r\n        }\r\n\r\n\r\n        return super.render(nodeType, styleOverride, classesOverride);\r\n        // return <RootVertex props={this.props} render={super.render()} super={this} key={this.props.nodeid+'.'+this.state?.forceupdate} />;\r\n    }\r\n\r\n    select(forUser?: Pointer<DUser>): void{\r\n        super.select(forUser);\r\n    }\r\n}\r\n\r\n\r\nclass DispatchProps extends GraphElementDispatchProps {\r\n}\r\n\r\nexport type AllPropss = VertexOwnProps & VertexStateProps & DispatchProps;\r\n\r\nfunction mapStateToProps(state: DState, ownProps: VertexOwnProps): VertexStateProps {\r\n    let DGraphElementClass: typeof DGraphElement;\r\n    if (ownProps.isedgepoint) DGraphElementClass = DEdgePoint; else\r\n    if (ownProps.isvertex && ownProps.isgraph) DGraphElementClass = DGraphVertex; else\r\n    if (ownProps.isvertex && !ownProps.isgraph) DGraphElementClass = DVertex; else\r\n    if (!ownProps.isvertex && ownProps.isgraph) DGraphElementClass = DGraph;\r\n    else DGraphElementClass = DGraphElement; // DField;\r\n\r\n    if (DGraphElementClass === DVertex && ownProps.isvoid) DGraphElementClass = DVoidVertex;\r\n    const superret: VertexStateProps = GraphElementComponent.mapStateToProps(state, ownProps, DGraphElementClass, {...ownProps}) as VertexStateProps;\r\n    // superret.lastSelected = state._lastSelected?.modelElement;\r\n    // superret.lastSelected = state._lastSelected ? LPointerTargetable.from(state._lastSelected.modelElement) : null;\r\n\r\n    // change current to correct user ID when authentication is implemented.\r\n    // const selected = state.selected[DUser.current];\r\n    // uperret.selected = (selected) ? LGraphElement.fromPointer(selected) : null;\r\n    /*  Uncomment this when we have user authentication.\r\n    superret.selected = {};\r\n    for(let user of Object.keys(selected)) {\r\n        const pointer = selected[user];\r\n        if (pointer) superret.selected[user] = LModelElement.fromPointer(pointer);\r\n        else superret.selected[user] = null;\r\n    }\r\n    */\r\n\r\n    superret.isEdgePending = {\r\n        user: LPointerTargetable.from(state.isEdgePending.user),\r\n        source: LPointerTargetable.from(state.isEdgePending.source)\r\n    };\r\n    // superret.viewpoint = LViewPoint.fromPointer(state.viewpoint);\r\n    const ret: VertexStateProps = new VertexStateProps();\r\n    U.objectMergeInPlace(superret, ret);\r\n    U.removeEmptyObjectKeys(superret);\r\n    return superret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const superret: GraphElementDispatchProps = GraphElementComponent.mapDispatchToProps(dispatch);\r\n    const ret: GraphElementDispatchProps = new GraphElementDispatchProps();\r\n    U.objectMergeInPlace(superret, ret);\r\n    U.removeEmptyObjectKeys(superret);\r\n    return superret;\r\n}\r\nexport const VertexConnected = connect<VertexStateProps, DispatchProps, VertexOwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(VertexComponent as any);\r\n\r\nexport const Vertex = (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement => { //  children: (string | React.Component)[]\r\n    return <VertexConnected {...{...props, children}} isgraph={false} isvertex={true}/>;\r\n}\r\nexport const VoidVertex = (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isgraph={false} isvertex={true} isvoid={true}/>;\r\n}\r\nexport const EdgePoint = function EdgePoint (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement {\r\n    return <VertexConnected {...{...props, children}} isgraph={false} isedgepoint={true}/>;\r\n}\r\n// todo: name them all or verify the name is still usable.\r\n\r\nexport const Graph = (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement => { // doesn't work?\r\n    return <VertexConnected {...{...props, children}} isgraph={true} isvertex={false} />;\r\n}\r\n\r\nexport const GraphVertex = (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isgraph={true} isvertex={true} />;\r\n}\r\n\r\nexport const Field = (props: VertexOwnProps, children: ReactNode | undefined = []): ReactElement => {\r\n    return <VertexConnected {...{...props, children}} isgraph={false} isvertex={false} />;\r\n}\r\n(window as any).componentdebug = {Graph, GraphVertex, Field, Vertex, VoidVertex, EdgePoint, VertexConnected, VertexComponent};\r\n\r\n\r\nGraph.cname = 'Graph';\r\nGraphVertex.cname = 'GraphVertex';\r\nField.cname = 'Field';\r\nVertex.cname = 'Vertex';\r\nVoidVertex.cname = 'VoidVertex';\r\nEdgePoint.cname = 'EdgePoint';\r\n\r\n// GraphConnected.cname = 'GraphConnected';\r\n// GraphVertexConnected.cname = 'GraphVertexConnected';\r\n// FieldConnected.cname = 'FieldConnected';\r\nVertexConnected.cname = 'VertexConnected';\r\n// VoidVertexConnected.cname = 'VoidVertexConnected';\r\n// EdgePointConnected.cname = 'EdgePointConnected';\r\n\r\n// GraphComponent.cname = 'GraphComponent';\r\n// GraphVertexComponent.cname = 'GraphVertexComponent';\r\n// FieldComponent.cname = 'FieldComponent';\r\nVertexComponent.cname = 'VertexComponent';\r\n// VoidVertexComponent.cname = 'VoidVertexComponent';\r\n// EdgePointComponent.cname = 'EdgePointComponent';\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}