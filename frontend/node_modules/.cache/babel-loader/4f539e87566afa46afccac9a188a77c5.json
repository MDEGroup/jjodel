{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) {\n    to[j] = from[i];\n  }\n  return to;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.OperationContextExpression = void 0;\nvar OclExecutionContext_1 = require(\"../../OclExecutionContext\");\nvar OclValidationError_1 = require(\"../../OclValidationError\");\nvar PreExpression_1 = require(\"../PreExpression\");\nvar PostExpression_1 = require(\"../PostExpression\");\nvar ContextExpression_1 = require(\"./ContextExpression\");\n/**\n * The Operation Context Expression allows to define pre and or post conditions of functions.\n *\n * @oclExpression context Person::kill() (pre|post)\n * @oclExample\n *     context Person::setAge(age: number)\n *         pre: age > 0\n */\nvar OperationContextExpression = /** @class */function (_super) {\n  __extends(OperationContextExpression, _super);\n  function OperationContextExpression(operationMetaInfo, expressions, registeredTypes) {\n    var _this = _super.call(this) || this;\n    var split = operationMetaInfo.pathName.split('::');\n    _this.targetType = split[0];\n    _this.fnName = split[1];\n    _this.params = operationMetaInfo.params;\n    _this.returnType = operationMetaInfo.returnType;\n    _this.preExpressions = expressions.filter(function (expr) {\n      return expr instanceof PreExpression_1.PreExpression;\n    });\n    _this.postExpressions = expressions.filter(function (expr) {\n      return expr instanceof PostExpression_1.PostExpression;\n    });\n    var actualType = registeredTypes[_this.targetType];\n    if (actualType && typeof actualType.prototype[_this.fnName] === 'function') {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var self_1 = _this;\n      var originalFn_1 = actualType.prototype[_this.fnName];\n      actualType.prototype[_this.fnName] = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var oclExecutionContext = new OclExecutionContext_1.OclExecutionContext(this);\n        oclExecutionContext.registerTypes(registeredTypes);\n        var anies = (self_1.params || []).reduce(function (prev, cur, i) {\n          prev[cur] = args[i];\n          return prev;\n        }, {\n          result: undefined\n        });\n        self_1.preExpressions.forEach(function (preExpression) {\n          var evaluationResult = preExpression.evaluate(oclExecutionContext, anies);\n          if (!evaluationResult) {\n            throw new OclValidationError_1.OclValidationError(\"A precondition failed on type \" + self_1.targetType + \".\");\n          }\n        });\n        var result = originalFn_1.call.apply(originalFn_1, __spreadArray([this], args));\n        anies.result = result;\n        self_1.postExpressions.forEach(function (postExpression) {\n          var evaluationResult = postExpression.evaluate(oclExecutionContext, anies);\n          if (!evaluationResult) {\n            throw new OclValidationError_1.OclValidationError(\"A postcondition failed on type \" + self_1.targetType + \".\");\n          }\n        });\n        return result;\n      };\n    }\n    return _this;\n  }\n  return OperationContextExpression;\n}(ContextExpression_1.ContextExpression);\nexports.OperationContextExpression = OperationContextExpression;","map":{"version":3,"names":["OclExecutionContext_1","require","OclValidationError_1","PreExpression_1","PostExpression_1","ContextExpression_1","OperationContextExpression","_super","__extends","operationMetaInfo","expressions","registeredTypes","_this","call","split","pathName","targetType","fnName","params","returnType","preExpressions","filter","expr","PreExpression","postExpressions","PostExpression","actualType","prototype","self_1","originalFn_1","args","_i","arguments","length","oclExecutionContext","OclExecutionContext","registerTypes","anies","reduce","prev","cur","i","result","undefined","forEach","preExpression","evaluationResult","evaluate","OclValidationError","apply","__spreadArray","postExpression","ContextExpression","exports"],"sources":["../../../../lib/components/expressions/context/OperationContextExpression.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}