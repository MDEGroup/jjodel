{"ast":null,"code":"var _s = $RefreshSig$();\nimport Collaborative from './Collaborative';\nimport { Action, SetRootFieldAction } from '../../joiner';\nimport { useEffectOnce } from 'usehooks-ts';\nimport { useState } from \"react\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CollaborativeAttacher(props) {\n  _s();\n  const project = props.project;\n  const [actions, setActions] = useState([]);\n  useEffectOnce(() => {\n    SetRootFieldAction.new('collaborativeSession', true);\n    Collaborative.client.io.opts.query = {\n      'project': project.id\n    };\n    Collaborative.client.connect();\n    /*\r\n    return () => {\r\n        Collaborative.client.off('pullAction');\r\n        Collaborative.client.disconnect();\r\n        SetRootFieldAction.new('collaborativeSession', false);\r\n    }\r\n    */\n    Collaborative.client.on('pullAction', action => {\n      const receivedAction = Action.fromJson(action);\n      console.log('Received Action from server.', action);\n      receivedAction.hasFired = 0;\n      if (!actions.includes(receivedAction.id)) {\n        console.log('Received actions', actions);\n        setActions([...actions, action.id]);\n        receivedAction.fire();\n      }\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n}\n_s(CollaborativeAttacher, \"BT4wnJncbSmGMfWJrBfDxtRDgBo=\", false, function () {\n  return [useEffectOnce];\n});\n_c = CollaborativeAttacher;\nexport default CollaborativeAttacher;\nvar _c;\n$RefreshReg$(_c, \"CollaborativeAttacher\");","map":{"version":3,"names":["Collaborative","Action","SetRootFieldAction","useEffectOnce","useState","Fragment","_Fragment","jsxDEV","_jsxDEV","CollaborativeAttacher","props","_s","project","actions","setActions","new","client","io","opts","query","id","connect","on","action","receivedAction","fromJson","console","log","hasFired","includes","fire","_c","$RefreshReg$"],"sources":["C:/d/Programming/web/jodel-mde/src/components/collaborative/CollaborativeAttacher.tsx"],"sourcesContent":["import Collaborative from './Collaborative';\r\nimport type {CompositeAction, GObject, LProject, Pointer} from '../../joiner';\r\nimport {Action, DUser, SetRootFieldAction} from '../../joiner';\r\nimport {useEffectOnce} from 'usehooks-ts';\r\nimport {useEffect, useState} from \"react\";\r\n\r\ninterface Props {project: LProject}\r\nfunction CollaborativeAttacher(props: Props) {\r\n    const project = props.project;\r\n    const [actions, setActions] = useState<Pointer[]>([]);\r\n\r\n    useEffectOnce(() => {\r\n        SetRootFieldAction.new('collaborativeSession', true);\r\n        Collaborative.client.io.opts.query = {'project': project.id};\r\n        Collaborative.client.connect();\r\n        /*\r\n        return () => {\r\n            Collaborative.client.off('pullAction');\r\n            Collaborative.client.disconnect();\r\n            SetRootFieldAction.new('collaborativeSession', false);\r\n        }\r\n        */\r\n        Collaborative.client.on('pullAction', (action: GObject<Action & CompositeAction>) => {\r\n            const receivedAction = Action.fromJson(action);\r\n            console.log('Received Action from server.', action);\r\n            receivedAction.hasFired = 0;\r\n            if(!actions.includes(receivedAction.id)) {\r\n                console.log('Received actions', actions)\r\n                setActions([...actions, action.id]);\r\n                receivedAction.fire();\r\n            }\r\n        });\r\n    });\r\n\r\n\r\n\r\n    return(<></>);\r\n}\r\n\r\nexport default CollaborativeAttacher;\r\n"],"mappings":";AAAA,OAAOA,aAAa,MAAM,iBAAiB;AAE3C,SAAQC,MAAM,EAASC,kBAAkB,QAAO,cAAc;AAC9D,SAAQC,aAAa,QAAO,aAAa;AACzC,SAAmBC,QAAQ,QAAO,OAAO;AAAC,SAAAC,QAAA,IAAAC,SAAA;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAG1C,SAASC,qBAAqBA,CAACC,KAAY,EAAE;EAAAC,EAAA;EACzC,MAAMC,OAAO,GAAGF,KAAK,CAACE,OAAO;EAC7B,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGV,QAAQ,CAAY,EAAE,CAAC;EAErDD,aAAa,CAAC,MAAM;IAChBD,kBAAkB,CAACa,GAAG,CAAC,sBAAsB,EAAE,IAAI,CAAC;IACpDf,aAAa,CAACgB,MAAM,CAACC,EAAE,CAACC,IAAI,CAACC,KAAK,GAAG;MAAC,SAAS,EAAEP,OAAO,CAACQ;IAAE,CAAC;IAC5DpB,aAAa,CAACgB,MAAM,CAACK,OAAO,CAAC,CAAC;IAC9B;AACR;AACA;AACA;AACA;AACA;AACA;IACQrB,aAAa,CAACgB,MAAM,CAACM,EAAE,CAAC,YAAY,EAAGC,MAAyC,IAAK;MACjF,MAAMC,cAAc,GAAGvB,MAAM,CAACwB,QAAQ,CAACF,MAAM,CAAC;MAC9CG,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEJ,MAAM,CAAC;MACnDC,cAAc,CAACI,QAAQ,GAAG,CAAC;MAC3B,IAAG,CAACf,OAAO,CAACgB,QAAQ,CAACL,cAAc,CAACJ,EAAE,CAAC,EAAE;QACrCM,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEd,OAAO,CAAC;QACxCC,UAAU,CAAC,CAAC,GAAGD,OAAO,EAAEU,MAAM,CAACH,EAAE,CAAC,CAAC;QACnCI,cAAc,CAACM,IAAI,CAAC,CAAC;MACzB;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;EAIF,oBAAOtB,OAAA,CAAAF,SAAA,mBAAI,CAAC;AAChB;AAACK,EAAA,CA9BQF,qBAAqB;EAAA,QAI1BN,aAAa;AAAA;AAAA4B,EAAA,GAJRtB,qBAAqB;AAgC9B,eAAeA,qBAAqB;AAAC,IAAAsB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module"}