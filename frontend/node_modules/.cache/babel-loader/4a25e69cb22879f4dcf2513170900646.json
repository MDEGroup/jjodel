{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VariableExpression = void 0;\nvar Expression_1 = require(\"./Expression\");\n/**\n * Resolve variables. Simple values are returned as is (e.g. self.age: number), collections are aggregated.\n */\nvar VariableExpression = /** @class */function (_super) {\n  __extends(VariableExpression, _super);\n  function VariableExpression(source) {\n    var _this = _super.call(this, source) || this;\n    _this.variable = source;\n    return _this;\n  }\n  VariableExpression.prototype.getVariable = function () {\n    return this.variable;\n  };\n  VariableExpression.prototype.evaluate = function (visitor, localVariables) {\n    var obj;\n    var _variables = localVariables;\n    var source = this.getVariable();\n    var parts = source.split('.');\n    if (parts[0] === 'self') {\n      parts.shift();\n      obj = _variables && _variables['self'] || visitor.getObjectToEvaluate();\n    } else if (_variables === undefined) {\n      var type = visitor.getRegisteredType(source);\n      if (type) {\n        return type;\n      } else {\n        obj = visitor.getObjectToEvaluate();\n      }\n    } else {\n      obj = _variables;\n    }\n    return visitor.getRegisteredType(obj) || _resolvePath(obj, parts.join('.'));\n    function _resolvePath(object, reference) {\n      return reference.split('.').reduce(dot_deref, object);\n      function dot_deref(o, ref) {\n        if (!o) return;\n        o = isIterable(o) ? Array.from(o) : o;\n        return !ref ? o : ref.split('[').reduce(arr_deref, o);\n      }\n      function arr_deref(o, ref, i) {\n        if (!o) return;\n        if (!ref) {\n          return o;\n        } else {\n          var prop_1 = ref.slice(0, i ? -1 : ref.length);\n          if (Array.isArray(o)) {\n            return o.map(function (c) {\n              return c[prop_1];\n            }).reduce(function (prev, cur) {\n              if (Array.isArray(cur)) {\n                prev.push.apply(prev, cur);\n              } else {\n                prev.push(cur);\n              }\n              return prev;\n            }, []);\n          } else {\n            return o[prop_1];\n          }\n        }\n      }\n    }\n    function isIterable(iterableObject) {\n      if (!iterableObject) {\n        return false;\n      }\n      return iterableObject instanceof Array || iterableObject instanceof Set;\n    }\n  };\n  return VariableExpression;\n}(Expression_1.SourceBasedExpression);\nexports.VariableExpression = VariableExpression;","map":{"version":3,"names":["Expression_1","require","VariableExpression","_super","__extends","source","_this","call","variable","prototype","getVariable","evaluate","visitor","localVariables","obj","_variables","parts","split","shift","getObjectToEvaluate","undefined","type","getRegisteredType","_resolvePath","join","object","reference","reduce","dot_deref","o","ref","isIterable","Array","from","arr_deref","i","prop_1","slice","length","isArray","map","c","prev","cur","push","apply","iterableObject","Set","SourceBasedExpression","exports"],"sources":["../../../lib/components/expressions/VariableExpression.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}