{"ast":null,"code":"var _jsxFileName = \"C:\\\\0Programmi\\\\Dev\\\\projects\\\\frontend\\\\jjodel\\\\frontend\\\\src\\\\components\\\\topbar\\\\undoredocomponent.tsx\";\nimport React, { PureComponent } from 'react';\nimport { DUser, U, RedoAction, statehistory, UndoAction, store, DPointerTargetable } from '../../joiner';\nimport { connect } from \"react-redux\";\nimport \"./undoredo.scss\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nclass UndoRedoState {\n  constructor(jsx) {\n    this.hover = false;\n    this.jsx = void 0;\n    this.jsx = jsx;\n  }\n}\n\n// private\n\n// private\n\n// private\n\n// private\n\n// private\n\nexport class SaveManagerComponent extends PureComponent {\n  printablePointer(pathsegment, state) {\n    let obj = DPointerTargetable.from(pathsegment, state);\n    if (!obj) return pathsegment;\n    if (obj.name) return \"$\" + obj.name;\n    if (obj.className) return \"#\" + obj.className;\n    return pathsegment;\n  }\n\n  // redo list is updated only when the user mouse-enters it. for efficiency.\n\n  improveText(e, s) {\n    if (e.fullstr.includes(\"Pointer\")) {\n      let editedfullpath = e.fullpath.map(pathsegment => {\n        //  console.log(\"undoredo replace attempt\", {pathsegment, idlookup:s.idlookup, dobj:s.idlookup[pathsegment], replacement: this.printablePointer(pathsegment, s)});\n        return this.printablePointer(pathsegment, s);\n      });\n      e.str = editedfullpath.join(\".\") + \" = \" + e.val;\n      console.log(\"undoredo replace attempt\", {\n        editedfullpath,\n        beststr: e.str,\n        best: e\n      });\n    }\n    if (e.path[0] === \"idlookup\") e.str = \"\" + e.str.substring(\"idlookup.\".length);\n    if (e.fullvalue.includes(\"Pointer\")) {\n      e.val = this.printablePointer(e.fullvalue.substring(1, e.fullvalue.length - 1), s); // 1, -1 because string values have quotes \"\"\n      e.str = e.str.substring(0, e.str.lastIndexOf(\"=\")) + \"= \" + e.val;\n    }\n  }\n  constructor(props, context) {\n    var _this;\n    super(props, context);\n    _this = this;\n    this.undoredolistoutdated = void 0;\n    this.do_undo = index => {\n      UndoAction.new(index + 1, this.state.user, false).commit();\n      this.undoenter(); // updates list\n    };\n    this.do_redo = index => {\n      console.log(\"redo(\" + index + \")\");\n      RedoAction.new(index + 1, this.state.user, false).commit();\n      this.redoenter();\n    };\n    this.undoredoenter2 = function () {\n      let key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"undo\";\n      let history = _this.get_history(_this.state.user);\n      let undoarr = history.undoable;\n      let redoarr = history.redoable;\n      console.log(\"statemanager undo update\", {\n        thiss: _this,\n        undoarr,\n        redoarr,\n        user: _this.state.user,\n        props: _this.props,\n        state: _this.state\n      });\n      if (!_this.undoredolistoutdated) return;\n      let s = store.getState();\n      let arr = [...(key === 'undo' ? undoarr : redoarr)].reverse().slice(0, _this.props.maxlistsize);\n      let out = [];\n      let strings = arr.map(delta => U.ObjectToAssignementStrings(delta, 10, 6, 20, \"…\", out, true));\n      //todo: make it just for current index, then get the next val from index+1 or current state, using R.path and replacing just the value. on mouseover switch it val of the delta vs next val\n      let list = arr.map((delta, index) => {});\n    };\n    this.undoredoenter = function () {\n      let key = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"undo\";\n      let debug = _this.props.debug;\n      let history = _this.get_history(_this.state.user);\n      let undoarr = history.undoable;\n      let redoarr = history.redoable;\n      console.log(\"statemanager undo update\", {\n        thiss: _this,\n        undoarr,\n        redoarr,\n        user: _this.state.user,\n        props: _this.props,\n        state: _this.state\n      });\n      if (!_this.undoredolistoutdated) return;\n      let s = store.getState();\n      // let arr = [...(this.props as GObject)[key]].reverse().slice(0, this.props.maxlistsize);\n      let fullarr = [...(key === 'undo' ? undoarr : redoarr)].reverse();\n      let arr = fullarr.slice(0, _this.props.maxlistsize);\n      function getLatestDelta(i, searchPath) {\n        let direction = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n        outer: for (; i < fullarr.length + 1 && i >= -1; i += direction) {\n          let rootdelta = fullarr[i] || s;\n          let currDelta = rootdelta;\n          for (let pathSeg of searchPath) {\n            if (!(pathSeg in currDelta)) continue outer;else currDelta = currDelta[pathSeg];\n          }\n          return rootdelta;\n        }\n        return s;\n      }\n      let list = arr.map((delta, index) => {\n        let out = [];\n        let out_otherdelta = [];\n        let titleindex = index + (key === 'undo' ? -1 : 0);\n        let titleDelta = arr[titleindex];\n        let otherDelta = arr[index + 1]; //[index + (key === 'undo' ? -1 : +1)]\n        // let actiodesc = key ==='undo' ? arr[index + 1] : ) || s;\n\n        let excludedPaths = {\n          'action.title': true,\n          'action.description': true\n        };\n        let filterrow = e => {\n          console.log('filterrow', {\n            debug,\n            e\n          });\n          return debug || !excludedPaths[key] && !e.fullpath.includes(\"clonedCounter\") && !e.fullpath.includes(\"pointedBy\") && !e.fullpath.includes('__jjObjDiffIsArr');\n        };\n        U.ObjectToAssignementStrings(delta, 10, 6, 20, \"…\", out, true, filterrow);\n        if (otherDelta) U.ObjectToAssignementStrings(otherDelta, 10, 6, 20, \"…\", out_otherdelta, true);\n        // if (!index) console.log('debug undoredo', {out, delta, arr});\n        // if out.best is undef, then get most recent titles until you find a delta with a title or the current(state)\n        let latestTitleDelta = getLatestDelta(titleindex, ['action_title'], key === 'undo' ? -1 : +1);\n        let debugTitle = (titleDelta || s).action_title;\n        if (latestTitleDelta.action_title) out.best.str = latestTitleDelta.action_title;\n        if (latestTitleDelta.action_description) out.best.fullstr = latestTitleDelta.action_description;\n        if (latestTitleDelta.action_title !== debugTitle) out.best.str = '* ' + out.best.str;\n        console.log('getLatestDelta', {\n          latestTitleDelta,\n          best: out.best.str,\n          titleDelta,\n          dt: (titleDelta || s).action_title,\n          titleindex\n        });\n        if (otherDelta === null || otherDelta === void 0 ? void 0 : otherDelta.action_title) out_otherdelta.best.str = (otherDelta || s).action_title;\n        if (otherDelta === null || otherDelta === void 0 ? void 0 : otherDelta.action_description) out_otherdelta.best.fullstr = (otherDelta || s).action_description;\n        out.best.str = U.cropStr(out.best.str, 1, 0, 13, 12);\n        out.best.fullstr = U.cropStr(out.best.fullstr, 1, 0, 250, 250);\n        //out_otherdelta.best.str = U.cropStr(out_otherdelta.best.str, 1, 0, 13, 12);\n        //out_otherdelta.best.fullstr = U.cropStr(out_otherdelta.best.fullstr, 1, 0, 250, 250);\n        //this.improveText(out.best, s);\n        let other = out.slice(0, _this.props.maxDetailSize); //.map(e=>this.improveText(e));\n        let other2 = out_otherdelta.slice(0, _this.props.maxDetailSize); //.map(e=>this.improveText(e));\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          onClick: () => _this[\"do_\" + key](index),\n          className: \"hoverable\",\n          tabIndex: 0,\n          style: {\n            overflow: \"visible\",\n            height: \"24px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"preview\",\n            children: out.best.str\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"content inline\",\n            children: out.best.fullstr\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"content detail-list\",\n            children: [other.map((row, ii) => {\n              let row2 = other2[ii];\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: 'detail-entry hoverable',\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"preview inline\",\n                  children: row.fullpath.join(\".\") + \" = \" + row.fullvalue\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 166,\n                  columnNumber: 29\n                }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"content inline\",\n                  children: [\"r2:@@@\", row2 && row2.fullpath.join(\".\") + \" = \" + row2.fullvalue]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 167,\n                  columnNumber: 29\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 165,\n                columnNumber: 32\n              }, _this);\n            }), out.length !== other.length ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: 'detail-entry',\n              children: \"...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 52\n            }, _this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 17\n          }, _this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 20\n        }, _this);\n      });\n      let jsx = /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: list\n      }, void 0, false);\n      let obj = {};\n      obj[key] = {\n        ..._this.state[key],\n        hover: true,\n        jsx\n      };\n      // {undo: {...this.state.undo, hover: true, jsx}}\n      _this.undoredolistoutdated = false;\n      _this.setState(obj);\n    };\n    this.undoenter = () => {\n      return this.undoredoenter(\"undo\");\n    };\n    this.redoenter = () => {\n      return this.undoredoenter(\"redo\");\n    };\n    this.undoleave = () => {\n      this.setState({\n        undo: {\n          ...this.state.undo,\n          hover: false\n        }\n      });\n    };\n    this.redoleave = () => {\n      this.setState({\n        redo: {\n          ...this.state.redo,\n          hover: false\n        }\n      });\n    };\n    let undo = new UndoRedoState( /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"undo list example\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 38\n    }, void 0));\n    let redo = new UndoRedoState( /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"redo list example\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 38\n    }, void 0));\n    this.state = {\n      undo,\n      redo,\n      user: DUser.current\n    };\n    this.undoredolistoutdated = true;\n    // this.setState({undo, redo});\n  }\n  get_history(user) {\n    // let ret = {redoable: [] as GObject[], undoable: [] as GObject[]};\n    return statehistory[user];\n  }\n  erase_history(user, project) {\n    if (user === 'all') {\n      /*\r\n      for (let user of project.collaborators){\r\n      this.erase_history(user.id, project);\r\n      }\r\n      this.erase_history(DUser.current, project);*/\n      for (let user in statehistory) {\n        statehistory[user].undoable = [];\n        statehistory[user].redoable = [];\n      }\n    } else {\n      statehistory[user].undoable = [];\n      statehistory[user].redoable = [];\n    }\n  }\n  render() {\n    let user = this.state.user;\n    this.undoredolistoutdated = true; // if render is called it means redux state props he's watching (redux-state) changed, so the preview list in component-state is outdated.\n    // console.log(\"undoredomanager\", {thiss:this, undo:this.props.undo, props: this.props, state:this.state});\n    let history = this.get_history(user);\n    let undo = history.undoable;\n    let redo = history.redoable;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"undoredo\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"hoverable\",\n          style: {\n            position: \"relative\",\n            background: \"white\"\n          },\n          onMouseEnter: this.undoenter,\n          onMouseLeave: this.undoleave,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: 'item border round ms-1',\n            onClick: e => {\n              this.do_undo(0);\n            },\n            children: [\"Undo (\", undo.length, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 21\n          }, this), this.props.debug && undo.length ? /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              background: \"inherit\",\n              width: \"max-content\",\n              zIndex: 10000\n            },\n            className: \"content\",\n            children: this.state.undo.jsx\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 25\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"hoverable\",\n          style: {\n            position: \"relative\",\n            background: \"white\"\n          },\n          onMouseEnter: this.redoenter,\n          onMouseLeave: this.redoleave,\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: 'item border round ms-1',\n            onClick: e => {\n              this.do_redo(0);\n            },\n            children: [\"Redo (\", redo.length, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 21\n          }, this), this.props.debug && redo.length ? /*#__PURE__*/_jsxDEV(\"ul\", {\n            style: {\n              background: \"inherit\",\n              width: \"max-content\",\n              zIndex: 10000\n            },\n            className: \"content\",\n            children: this.state.redo.jsx\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 56\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            this.erase_history(user, this.props.project);\n          },\n          children: \"x\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 13\n      }, this)\n    }, void 0, false);\n  }\n}\nSaveManagerComponent.cname = \"SaveManagerComponent\";\nfunction mapStateToProps(state, ownProps) {\n  const ret = {};\n  //ret.undo = statehistory[DUser.current].undoable;\n  //ret.redo = statehistory[DUser.current].redoable;\n  ret.maxlistsize = 10;\n  ret.maxDetailSize = 20;\n  ret.debug = state.debug;\n  return ret;\n}\nfunction mapDispatchToProps(dispatch) {\n  const ret = {};\n  /// to fill\n  return ret;\n}\nexport const SaveManagerConnected = connect(mapStateToProps, mapDispatchToProps)(SaveManagerComponent);\nexport default SaveManagerConnected;\nexport const Undoredocomponent = SaveManagerConnected;","map":{"version":3,"names":["React","PureComponent","DUser","U","RedoAction","statehistory","UndoAction","store","DPointerTargetable","connect","jsxDEV","_jsxDEV","Fragment","_Fragment","UndoRedoState","constructor","jsx","hover","SaveManagerComponent","printablePointer","pathsegment","state","obj","from","name","className","improveText","e","s","fullstr","includes","editedfullpath","fullpath","map","str","join","val","console","log","beststr","best","path","substring","length","fullvalue","lastIndexOf","props","context","_this","this","undoredolistoutdated","do_undo","index","new","user","commit","undoenter","do_redo","redoenter","undoredoenter2","key","arguments","undefined","history","get_history","undoarr","undoable","redoarr","redoable","thiss","getState","arr","reverse","slice","maxlistsize","out","strings","delta","ObjectToAssignementStrings","list","undoredoenter","debug","fullarr","getLatestDelta","i","searchPath","direction","outer","rootdelta","currDelta","pathSeg","out_otherdelta","titleindex","titleDelta","otherDelta","excludedPaths","filterrow","latestTitleDelta","debugTitle","action_title","action_description","dt","cropStr","other","maxDetailSize","other2","onClick","tabIndex","style","overflow","height","children","fileName","_jsxFileName","lineNumber","columnNumber","row","ii","row2","setState","undoleave","undo","redoleave","redo","current","erase_history","project","render","position","background","onMouseEnter","onMouseLeave","width","zIndex","cname","mapStateToProps","ownProps","ret","mapDispatchToProps","dispatch","SaveManagerConnected","Undoredocomponent"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/frontend/src/components/topbar/undoredocomponent.tsx"],"sourcesContent":["import React, {Dispatch, PureComponent, ReactNode} from 'react';\r\nimport {\r\n    Dictionary, DUser,\r\n    GObject, DState,\r\n    Log, U, RedoAction,\r\n    statehistory,\r\n    UndoAction, store, DPointerTargetable, Pointer, LProject,\r\n} from '../../joiner';\r\nimport {connect} from \"react-redux\";\r\nimport \"./undoredo.scss\"\r\n\r\ninterface SaveManagerProps {}\r\n\r\nclass UndoRedoState{\r\n    hover: boolean = false;\r\n    jsx: any | null;\r\n    constructor(jsx: any) {  this.jsx = jsx; }\r\n}\r\n\r\n// private\r\ninterface ThisState {\r\n    undo: UndoRedoState;\r\n    redo: UndoRedoState;\r\n    user: Pointer<DUser>|'all';\r\n}\r\n\r\n// private\r\ninterface OwnProps {\r\n    // propsRequestedFromHtmlAsAttributes: string;\r\n    project: LProject;\r\n}\r\n// private\r\ninterface StateProps {\r\n    // propsFromReduxStateOrOtherKindOfStateManagement: boolean; // flux or custom things too, unrelated to this.state of react.\r\n    maxlistsize: number;\r\n    maxDetailSize: number;\r\n    //undo: GObject<\"delta\">[],\r\n    // redo: GObject<\"delta\">[],\r\n    debug: boolean\r\n}\r\n\r\n// private\r\ninterface DispatchProps {\r\n    // propsFromReduxActions: typeof funzioneTriggeraAzioneDaImportare;\r\n}\r\n\r\ntype R = {str: string, fullstr: string, path:string[], fullpath:string[], val: string, fullvalue: string, pathlength?: number};\r\n\r\n// private\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\nexport class SaveManagerComponent extends PureComponent<AllProps, ThisState>{\r\n    public static cname: string = \"SaveManagerComponent\";\r\n    private undoredolistoutdated: boolean;\r\n    do_undo = (index: number) => {\r\n        UndoAction.new(index+1, this.state.user, false).commit();\r\n        this.undoenter(); // updates list\r\n    }\r\n    do_redo = (index: number) => {\r\n        console.log(\"redo(\" + index + \")\");\r\n        RedoAction.new(index+1, this.state.user, false).commit();\r\n        this.redoenter();\r\n    }\r\n    printablePointer(pathsegment: string, state: DState){\r\n        let obj = DPointerTargetable.from(pathsegment, state) as GObject;\r\n        if (!obj) return pathsegment;\r\n        if (obj.name) return \"$\"+obj.name;\r\n        if (obj.className) return \"#\"+obj.className;\r\n        return pathsegment;\r\n    }\r\n\r\n    // redo list is updated only when the user mouse-enters it. for efficiency.\r\n    undoredoenter2 = (key: \"undo\"|\"redo\" = \"undo\") => {\r\n        let history = this.get_history(this.state.user);\r\n        let undoarr = history.undoable;\r\n        let redoarr = history.redoable;\r\n        console.log(\"statemanager undo update\", {thiss:this, undoarr, redoarr, user: this.state.user, props: this.props, state:this.state});\r\n        if (!this.undoredolistoutdated) return;\r\n        let s: DState = store.getState();\r\n        let arr = [...(key === 'undo' ? undoarr : redoarr)].reverse().slice(0, this.props.maxlistsize);\r\n        let out: {best: R, obj: GObject}&R[] = [] as any;\r\n        let strings = arr.map( delta => U.ObjectToAssignementStrings(delta, 10, 6, 20, \"…\", out, true));\r\n        //todo: make it just for current index, then get the next val from index+1 or current state, using R.path and replacing just the value. on mouseover switch it val of the delta vs next val\r\n            let list = arr.map((delta, index) => {})\r\n\r\n    }\r\n\r\n    improveText(e: R, s: DState) {\r\n        if (e.fullstr.includes(\"Pointer\")) {\r\n            let editedfullpath = e.fullpath.map( (pathsegment) => {\r\n                //  console.log(\"undoredo replace attempt\", {pathsegment, idlookup:s.idlookup, dobj:s.idlookup[pathsegment], replacement: this.printablePointer(pathsegment, s)});\r\n                return this.printablePointer(pathsegment, s); });\r\n            e.str = editedfullpath.join(\".\") + \" = \" + e.val;\r\n            console.log(\"undoredo replace attempt\", {editedfullpath, beststr:e.str, best: e});\r\n        }\r\n        if (e.path[0] === \"idlookup\") e.str = \"\" + e.str.substring(\"idlookup.\".length);\r\n        if (e.fullvalue.includes(\"Pointer\")) {\r\n            e.val = this.printablePointer(e.fullvalue.substring(1, e.fullvalue.length-1), s); // 1, -1 because string values have quotes \"\"\r\n            e.str = e.str.substring(0, e.str.lastIndexOf(\"=\")) + \"= \" + e.val;\r\n        }\r\n    }\r\n    undoredoenter = (key: \"undo\"|\"redo\" = \"undo\") => {\r\n        let debug = this.props.debug;\r\n        let history = this.get_history(this.state.user);\r\n        let undoarr = history.undoable;\r\n        let redoarr = history.redoable;\r\n        console.log(\"statemanager undo update\", {thiss:this, undoarr, redoarr, user: this.state.user, props: this.props, state:this.state});\r\n        if (!this.undoredolistoutdated) return;\r\n        let s: DState = store.getState();\r\n        // let arr = [...(this.props as GObject)[key]].reverse().slice(0, this.props.maxlistsize);\r\n        let fullarr = [...(key === 'undo' ? undoarr : redoarr)].reverse()\r\n        let arr = fullarr.slice(0, this.props.maxlistsize);\r\n        function getLatestDelta(i: number, searchPath: string[], direction: -1 | 1 = 1): GObject {\r\n            outer: for (; i < fullarr.length+1 && i >= -1; i+=direction) {\r\n                let rootdelta = fullarr[i] || s;\r\n                let currDelta = rootdelta;\r\n                for (let pathSeg of searchPath){\r\n                    if (!(pathSeg in currDelta)) continue outer;\r\n                    else currDelta = currDelta[pathSeg];\r\n                }\r\n                return rootdelta;\r\n            }\r\n            return s;\r\n        }\r\n        let list = arr.map((delta, index) => {\r\n            let out: {best: R, obj: GObject}&R[] = [] as GObject as any;\r\n            let out_otherdelta: {best: R, obj: GObject}&R[] = [] as any;\r\n            let titleindex = index + (key === 'undo' ? -1 : 0);\r\n            let titleDelta = arr[titleindex]\r\n            let otherDelta = arr[index + 1]; //[index + (key === 'undo' ? -1 : +1)]\r\n            // let actiodesc = key ==='undo' ? arr[index + 1] : ) || s;\r\n\r\n            let excludedPaths: Dictionary<string, boolean> = {'action.title': true, 'action.description': true};\r\n            let filterrow = (e:R)=> {\r\n                console.log('filterrow', {debug, e});\r\n                return debug || !excludedPaths[key] && !e.fullpath.includes(\"clonedCounter\")\r\n                    && !e.fullpath.includes(\"pointedBy\")\r\n                    && !e.fullpath.includes('__jjObjDiffIsArr');\r\n            }\r\n            U.ObjectToAssignementStrings(delta, 10, 6, 20, \"…\", out, true, filterrow);\r\n            if (otherDelta) U.ObjectToAssignementStrings(otherDelta, 10, 6, 20, \"…\", out_otherdelta, true);\r\n            // if (!index) console.log('debug undoredo', {out, delta, arr});\r\n            // if out.best is undef, then get most recent titles until you find a delta with a title or the current(state)\r\n            let latestTitleDelta = getLatestDelta(titleindex, ['action_title'], (key === 'undo' ? -1 : +1));\r\n            let debugTitle = (titleDelta||s).action_title;\r\n            if (latestTitleDelta.action_title) out.best.str = latestTitleDelta.action_title;\r\n            if (latestTitleDelta.action_description) out.best.fullstr = latestTitleDelta.action_description;\r\n            if (latestTitleDelta.action_title !== debugTitle) out.best.str = '* ' + out.best.str;\r\n            console.log('getLatestDelta', {latestTitleDelta, best:out.best.str, titleDelta, dt:(titleDelta||s).action_title, titleindex})\r\n            if ((otherDelta)?.action_title) out_otherdelta.best.str = (otherDelta||s).action_title;\r\n            if ((otherDelta)?.action_description) out_otherdelta.best.fullstr = (otherDelta||s).action_description;\r\n            out.best.str = U.cropStr(out.best.str, 1, 0, 13, 12);\r\n            out.best.fullstr = U.cropStr(out.best.fullstr, 1, 0, 250, 250);\r\n            //out_otherdelta.best.str = U.cropStr(out_otherdelta.best.str, 1, 0, 13, 12);\r\n            //out_otherdelta.best.fullstr = U.cropStr(out_otherdelta.best.fullstr, 1, 0, 250, 250);\r\n            //this.improveText(out.best, s);\r\n            let other = out.slice(0, this.props.maxDetailSize); //.map(e=>this.improveText(e));\r\n            let other2 = out_otherdelta.slice(0, this.props.maxDetailSize); //.map(e=>this.improveText(e));\r\n            return <li onClick={() => ((this as GObject)[\"do_\" + key](index))} className=\"hoverable\" key={index} tabIndex={0}\r\n                       style={{overflow: \"visible\", height: \"24px\"}}>\r\n                <div className={\"preview\"}>{out.best.str}</div>\r\n                <div className={\"content inline\"}>{out.best.fullstr}</div>\r\n                <div className={\"content detail-list\"}>{\r\n                    other.map((row, ii) => {\r\n                        let row2 = other2[ii];\r\n                        return <div className={'detail-entry hoverable'}>\r\n                            <span className='preview inline'>{row.fullpath.join(\".\") + \" = \" + row.fullvalue}</span>\r\n                            <span className='content inline'>r2:@@@{row2 && (row2.fullpath.join(\".\") + \" = \" + row2.fullvalue)}</span>\r\n                        </div>\r\n                    })}\r\n                    {out.length !== other.length ? <div className={'detail-entry'}>...</div> : null}\r\n                </div>\r\n            </li>\r\n        });\r\n        let jsx = <>{list}</>;\r\n        let obj: GObject = {};\r\n        obj[key] = {...(this.state as GObject)[key], hover: true, jsx};\r\n        // {undo: {...this.state.undo, hover: true, jsx}}\r\n        this.undoredolistoutdated = false;\r\n        this.setState(obj as ThisState);\r\n    }\r\n\r\n    undoenter = ()=>{ return this.undoredoenter(\"undo\"); }\r\n    redoenter = ()=>{ return this.undoredoenter(\"redo\"); }\r\n    undoleave = ()=>{ this.setState({undo: {...this.state.undo, hover: false}}); }\r\n    redoleave = ()=>{ this.setState({redo: {...this.state.redo, hover: false}}); }\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        let undo = new UndoRedoState(<div>undo list example</div>);\r\n        let redo = new UndoRedoState(<div>redo list example</div>);\r\n        this.state = {undo, redo, user: DUser.current};\r\n        this.undoredolistoutdated = true;\r\n        // this.setState({undo, redo});\r\n    }\r\n    get_history(user: Pointer<DUser> | 'all'): {redoable: GObject[], undoable: GObject[]}{\r\n        // let ret = {redoable: [] as GObject[], undoable: [] as GObject[]};\r\n            return statehistory[user];\r\n    }\r\n    erase_history(user: Pointer<DUser> | 'all', project: LProject){\r\n        if (user === 'all'){/*\r\n            for (let user of project.collaborators){\r\n                this.erase_history(user.id, project);\r\n            }\r\n            this.erase_history(DUser.current, project);*/\r\n            for (let user in statehistory){\r\n                statehistory[user].undoable = [];\r\n                statehistory[user].redoable = [];\r\n            }\r\n        } else {\r\n            statehistory[user].undoable = [];\r\n            statehistory[user].redoable = [];\r\n        }\r\n    }\r\n    render(): ReactNode {\r\n        let user = this.state.user;\r\n        this.undoredolistoutdated = true; // if render is called it means redux state props he's watching (redux-state) changed, so the preview list in component-state is outdated.\r\n        // console.log(\"undoredomanager\", {thiss:this, undo:this.props.undo, props: this.props, state:this.state});\r\n        let history = this.get_history(user);\r\n        let undo = history.undoable;\r\n        let redo = history.redoable;\r\n        return(<>\r\n            <div className='undoredo'>\r\n                <span className={\"hoverable\"} style={{position: \"relative\", background: \"white\"}} onMouseEnter={this.undoenter} onMouseLeave={this.undoleave}>\r\n                    <button className={'item border round ms-1'} onClick={(e)=> { this.do_undo(0) }}>Undo ({undo.length})</button>\r\n                    {this.props.debug && undo.length ?\r\n                        <ul style={{background: \"inherit\", width: \"max-content\", zIndex:10000}} className={\"content\"}>\r\n                            {this.state.undo.jsx}\r\n                        </ul>\r\n                        : null}\r\n                </span>\r\n                <span className={\"hoverable\"} style={{position: \"relative\", background: \"white\"}} onMouseEnter={this.redoenter} onMouseLeave={this.redoleave}>\r\n                    <button className={'item border round ms-1'} onClick={(e)=> { this.do_redo(0) }}>Redo ({redo.length})</button>\r\n                    {this.props.debug && redo.length ? <ul style={{background: \"inherit\", width: \"max-content\", zIndex:10000}} className={\"content\"}>{this.state.redo.jsx}</ul> : null}\r\n                </span>\r\n                <button onClick={()=>{this.erase_history(user, this.props.project)}}>x</button>\r\n            </div>\r\n        </>);\r\n    }\r\n}\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    //ret.undo = statehistory[DUser.current].undoable;\r\n    //ret.redo = statehistory[DUser.current].redoable;\r\n    ret.maxlistsize = 10;\r\n    ret.maxDetailSize = 20;\r\n    ret.debug = state.debug;\r\n    return ret; }\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    /// to fill\r\n    return ret; }\r\n\r\nexport const SaveManagerConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(SaveManagerComponent);\r\n\r\nexport default SaveManagerConnected;\r\nexport const Undoredocomponent = SaveManagerConnected;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}