{"ast":null,"code":"import React,{useEffect}from'react';import{connect}from'react-redux';import Editor,{useMonaco}from'@monaco-editor/react';import{Defaults,LPointerTargetable,LViewElement}from'../../../joiner';import{useStateIfMounted}from'use-state-if-mounted';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function JsEditorComponent(props){const{placeHolder,height,title,getter,setter,jsxLabel,field}=props;let data=LPointerTargetable.wrap(props.data);let value=getter?getter(data,field):(data||{})[field];const[js,setJs]=useStateIfMounted(value);const[show,setShow]=useStateIfMounted(props.initialExpand?props.initialExpand(data,field):false);const[expand,setExpand]=useStateIfMounted(false);const monaco=useMonaco();window.monaco=monaco;const readOnly=props.readonly!==undefined?props.readonly:!props.debugmode&&Defaults.check(data.id);const change=value=>{/* save in local state for frequent changes */if(value!==undefined)setJs(value);};const blur=()=>{/* confirm in redux state for final state */if(js&&setter)setter(js,data,field);else if(field)data[field]=js;};useEffect(()=>{if(!monaco)return;monaco.languages.typescript.typescriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.Latest,allowNonTsExtensions:true,moduleResolution:monaco.languages.typescript.ModuleResolutionKind.NodeJs,module:monaco.languages.typescript.ModuleKind.CommonJS,noEmit:true,esModuleInterop:true,reactNamespace:'React',allowJs:true,typeRoots:['node_modules/@types']//, 'src/static/'], // doubt those can be accesed at runtime but trying\n});monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:false,noSyntaxValidation:false});monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);monaco.languages.typescript.typescriptDefaults.addExtraLib(\"declare var data: 'datatype';\");},[monaco]);if(!(data&&field||getter&&setter))return/*#__PURE__*/_jsx(_Fragment,{children:\"Either props.data & field or both getter & setter are required.\"});if(placeHolder&&!js)value=placeHolder;if(!value)value='';const lines=Math.round(value.split(/\\r|\\r\\n|\\n/).length*1.8)<5?10:Math.round(value.split(/\\r|\\r\\n|\\n/).length*1.8);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:{...(props.style||{})},className:'cursor-pointer d-flex',onClick:e=>setShow(!show),children:[/*#__PURE__*/_jsx(\"span\",{className:'my-auto',tabIndex:-1,children:/*#__PURE__*/_jsx(\"i\",{className:'bi bi-chevron-'+(show?'down':'right')})}),/*#__PURE__*/_jsx(\"label\",{className:'editor-label',children:title||'JS Editor'}),jsxLabel&&jsxLabel]}),show&&/*#__PURE__*/_jsx(\"div\",{className:'monaco-editor-wrapper'/* style={{padding: '5px', minHeight: '20px', height: height ? `${height}px` : '100px', resize: 'vertical', overflow:'hidden'}}*/,style:{padding:'5px',minHeight:'20px',height:\"\".concat(expand?lines+'lvh':'5lvh'),transition:'height 0.3s',resize:'vertical',overflow:'hidden'},tabIndex:-1,onFocus:()=>setExpand(true),onBlur:()=>{setExpand(false);blur();},children:/*#__PURE__*/_jsx(Editor,{className:'mx-1',onChange:change,options:{fontSize:12,scrollbar:{vertical:'hidden',horizontalScrollbarSize:5},minimap:{enabled:false},readOnly:readOnly},defaultLanguage:'typescript',value:value})})]});}function mapStateToProps(state,ownProps){const ret={};ret.data=LViewElement.wrap(ownProps.data);ret.debugmode=state.debug;return ret;}function mapDispatchToProps(dispatch){const ret={};return ret;}export const JsEditorConnected=connect(mapStateToProps,mapDispatchToProps)(JsEditorComponent);export const JsEditor=function(props){let children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(JsEditorConnected,{...props,children});};JsEditorComponent.cname='JsEditorComponent';JsEditorConnected.cname='JsEditorConnected';JsEditor.cname='JsEditor';","map":{"version":3,"names":["React","useEffect","connect","Editor","useMonaco","Defaults","LPointerTargetable","LViewElement","useStateIfMounted","Fragment","_Fragment","jsx","_jsx","jsxs","_jsxs","JsEditorComponent","props","placeHolder","height","title","getter","setter","jsxLabel","field","data","wrap","value","js","setJs","show","setShow","initialExpand","expand","setExpand","monaco","window","readOnly","readonly","undefined","debugmode","check","id","change","blur","languages","typescript","typescriptDefaults","setCompilerOptions","target","ScriptTarget","Latest","allowNonTsExtensions","moduleResolution","ModuleResolutionKind","NodeJs","module","ModuleKind","CommonJS","noEmit","esModuleInterop","reactNamespace","allowJs","typeRoots","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","javascriptDefaults","setEagerModelSync","addExtraLib","children","lines","Math","round","split","length","style","className","onClick","e","tabIndex","padding","minHeight","concat","transition","resize","overflow","onFocus","onBlur","onChange","options","fontSize","scrollbar","vertical","horizontalScrollbarSize","minimap","enabled","defaultLanguage","mapStateToProps","state","ownProps","ret","debug","mapDispatchToProps","dispatch","JsEditorConnected","JsEditor","arguments","cname"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/frontend/src/components/editors/languages/Js.tsx"],"sourcesContent":["import React, {CSSProperties, Dispatch, ReactElement, ReactNode, useEffect} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport Editor, {useMonaco} from '@monaco-editor/react';\r\nimport {\r\n    Defaults,\r\n    DPointerTargetable,\r\n    DState,\r\n    DViewElement,\r\n    LPointerTargetable,\r\n    LViewElement, Overlap,\r\n    Pointer\r\n} from '../../../joiner';\r\nimport {useStateIfMounted} from 'use-state-if-mounted';\r\nimport {FakeStateProps} from '../../../joiner/types';\r\nimport { CommandBar, Btn } from '../../commandbar/CommandBar';\r\n\r\nfunction JsEditorComponent(props: AllProps) {\r\n    const {placeHolder, height, title, getter, setter, jsxLabel, field} = props;\r\n    let data: LPointerTargetable = LPointerTargetable.wrap(props.data) as any;\r\n    let value = getter ? getter(data, field) : ((data|| {}) as any)[field as any];\r\n    const [js, setJs] = useStateIfMounted(value);\r\n    const [show, setShow] = useStateIfMounted(props.initialExpand ? props.initialExpand(data, field) : false);\r\n    const [expand, setExpand] = useStateIfMounted(false);\r\n    const monaco = useMonaco();\r\n    (window as any).monaco = monaco;\r\n\r\n    const readOnly = props.readonly !== undefined ? props.readonly : !props.debugmode && Defaults.check(data.id);\r\n    const change = (value: string|undefined) => {\r\n        /* save in local state for frequent changes */\r\n        if (value !== undefined) setJs(value);\r\n    }\r\n    const blur = () => {\r\n        /* confirm in redux state for final state */\r\n        if (js && setter) setter(js, data, field);\r\n        else if(field) (data as any)[field] = js;\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!monaco) return;\r\n        monaco.languages.typescript.typescriptDefaults.setCompilerOptions({\r\n            target: monaco.languages.typescript.ScriptTarget.Latest,\r\n            allowNonTsExtensions: true,\r\n            moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,\r\n            module: monaco.languages.typescript.ModuleKind.CommonJS,\r\n            noEmit: true,\r\n            esModuleInterop: true,\r\n            reactNamespace: 'React',\r\n            allowJs: true,\r\n            typeRoots: ['node_modules/@types']//, 'src/static/'], // doubt those can be accesed at runtime but trying\r\n        });\r\n        monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({ noSemanticValidation: false, noSyntaxValidation: false });\r\n        monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);\r\n        monaco.languages.typescript.typescriptDefaults.addExtraLib(`declare var data: 'datatype';`);\r\n    }, [monaco]);\r\n    if (!((data && field) || (getter && setter))) return(<>Either props.data & field or both getter & setter are required.</>);\r\n\r\n    if (placeHolder && !js) value = placeHolder;\r\n    if (!value) value = '';\r\n    const lines = (Math.round(value.split(/\\r|\\r\\n|\\n/).length*1.8) < 5 ? 10 : Math.round(value.split(/\\r|\\r\\n|\\n/).length*1.8));\r\n\r\n    return <>\r\n        <div style={{...(props.style || {})}} className={'cursor-pointer d-flex'} onClick={e => setShow(!show)}>\r\n            <span className={'my-auto'} tabIndex={-1}>\r\n                <i className={'bi bi-chevron-' + (show ? 'down' : 'right')} />\r\n                {/*show ? <i className={'bi bi-eye-fill'} /> : <i className={'bi bi-eye-slash-fill'} /> */}\r\n            </span>\r\n            <label className={'editor-label'}>\r\n                {title || 'JS Editor'}\r\n            </label>\r\n            {jsxLabel && jsxLabel}\r\n            {/* show && <CommandBar style={{paddingTop: '10px'}}>\r\n                {expand ?\r\n                    <Btn icon={'shrink'} action={(e) => {setExpand(false); setShow(true)}} tip={'Minimize editor'}/>\r\n                    :\r\n                    <Btn icon={'expand'} action={(e) => {setExpand(true); setShow(true)}} tip={'Enlarge editor'}/>\r\n                }\r\n            </CommandBar>*/}\r\n        </div>\r\n        {show && <div className={'monaco-editor-wrapper'}\r\n                /* style={{padding: '5px', minHeight: '20px', height: height ? `${height}px` : '100px', resize: 'vertical', overflow:'hidden'}}*/\r\n                style={{padding: '5px', minHeight: '20px', height:`${expand ? lines+'lvh' : '5lvh'}`, transition: 'height 0.3s', resize: 'vertical', overflow:'hidden'}}\r\n                tabIndex={-1}\r\n                onFocus={() => setExpand(true)}\r\n                onBlur={() => {setExpand(false);blur()}}>\r\n            <Editor className={'mx-1'} onChange={change}\r\n                    options={{fontSize: 12, scrollbar: {vertical: 'hidden', horizontalScrollbarSize: 5}, minimap: {enabled: false}, readOnly: readOnly}}\r\n                    defaultLanguage={'typescript'} value={value} />\r\n        </div>}\r\n    </>;\r\n}\r\ninterface OwnProps {\r\n    readonly?: boolean;\r\n    data?: Pointer | DPointerTargetable | LPointerTargetable;\r\n    field?: string;\r\n    placeHolder?: string;\r\n    title?: ReactNode;\r\n    height?: number;\r\n    style?: CSSProperties;\r\n    jsxLabel?: ReactNode;\r\n    getter?: (data?:LPointerTargetable, field?: string) => string;\r\n    setter?: (js: string, data?:LPointerTargetable, field?: string) => void;\r\n    initialExpand?: (data: LPointerTargetable, field?: string) => boolean;\r\n}\r\ninterface StateProps {\r\n    data?: LPointerTargetable;\r\n    debugmode: boolean;}\r\ninterface DispatchProps {}\r\ntype AllProps = Overlap<Overlap<OwnProps, StateProps>, DispatchProps>;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    ret.data = LViewElement.wrap(ownProps.data);\r\n    ret.debugmode = state.debug;\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\n\r\nexport const JsEditorConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(JsEditorComponent);\r\n\r\nexport const JsEditor = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <JsEditorConnected {...{...props, children}} />;\r\n}\r\n\r\nJsEditorComponent.cname = 'JsEditorComponent';\r\nJsEditorConnected.cname = 'JsEditorConnected';\r\nJsEditor.cname = 'JsEditor';\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}