{"ast":null,"code":"var _jsxFileName = \"C:\\\\0Programmi\\\\Dev\\\\projects\\\\frontend\\\\jjodel\\\\frontend\\\\src\\\\graph\\\\graphElement\\\\graphElement.tsx\",\n  _dec,\n  _class,\n  _class2,\n  _this = this;\nimport React, { Component } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { connect } from \"react-redux\";\nimport './graphElement.scss';\nimport { Point, Pointers, TRANSACTION, GraphPoint, Selectors } from \"../../joiner\";\nimport { LGraphElement, store, CreateElementAction, DClass, Debug, DEdge, DEnumerator, DGraph, DGraphElement, DModel, DObject, DPackage, DPointerTargetable, DUser, DV, EMeasurableEvents, GraphElementOwnProps, GraphElementReduxStateProps, JSXT, Keystrokes, Log, LPointerTargetable, MyProxyHandler, RuntimeAccessible, SetFieldAction, SetRootFieldAction, U, UX, windoww, transientProperties } from \"../../joiner\";\nimport { NodeTransientProperties } from \"../../joiner/classes\";\n\n// const Selectors: typeof Selectors_ = windoww.Selectors;\n/*\r\nexport function makeEvalContext(view: LViewElement, state: DState, ownProps: GraphElementOwnProps, stateProps: GraphElementReduxStateProps): GObject {\r\n    let component = GraphElementComponent.map[ownProps.nodeid as Pointer<DGraphElement>];\r\n    let allProps = {...ownProps, ...stateProps};\r\n    let parsedConstants = stateProps.view._parsedConstants;\r\n    let evalContext: GObject = {\r\n        model: stateProps.data,\r\n        ...ownProps,\r\n        ...stateProps,\r\n        edge: (RuntimeAccessibleClass.extends(stateProps.node?.className, \"DVoidEdge\") ? stateProps.node : undefined),\r\n        state,\r\n        ownProps,\r\n        stateProps,\r\n        props: allProps,\r\n        component,\r\n        constants: parsedConstants,\r\n        // getSize:vcomponent?.getSize, setSize: vcomponent?.setSize,\r\n        ...parsedConstants,\r\n        // ...stateProps.usageDeclarations, NOT because they are not evaluated yet. i need a basic eval context to evaluate them\r\n    };\r\n    evalContext.__proto__ = windoww.defaultContext;\r\n    transientProperties.node[ownProps.nodeid as string].evalContext = evalContext;\r\n    return evalContext;\r\n}\r\n\r\nfunction setTemplateString(stateProps: InOutParam<GraphElementReduxStateProps>, ownProps: Readonly<GraphElementOwnProps>, state: DState): void {\r\n    //if (!jsxString) { this.setState({template: this.getDefaultTemplate()}); return; }\r\n    // sintassi: '||' + anything + (opzionale: '|' + anything)*N_Volte + '||' + jsx oppure direttamente: jsx\r\n    const view: LViewElement = stateProps.view; //data._transient.currentView;\r\n    // eslint-disable-next-line no-mixed-operators\r\n    const evalContext = makeEvalContext(view, state, ownProps, stateProps);\r\n    // Log.exDev(!evalContext.data, \"missing data\", {evalContext, ownProps, stateProps});\r\n\r\n    // const evalContextOld = U.evalInContext(this, constants);\r\n    // this.setState({evalContext});\r\n\r\n}*/\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction computeUsageDeclarations(component, allProps, state, lview) {\n  // compute usageDeclarations\n  let udret = {\n    __notInitialized: true\n  };\n  const view = lview.__raw;\n  const vid = view.id;\n  const constants = transientProperties.view[vid].constants;\n  let UDEvalContext = {\n    ...allProps,\n    ...constants,\n    constants,\n    component,\n    view: lview,\n    // data and node are inherited through props, but view needs redefinition\n    usageDeclarations: undefined,\n    stateProps: allProps,\n    props: allProps,\n    ownProps: allProps,\n    state\n  }; //transientProperties.node[stateProps.nodeid].evalContext;\n  /*\r\n  *\r\n          \"constants\": true, \"usageDeclarations\": true,\r\n          \"component\": true,\r\n          \"htmlindex\": true,\r\n          \"state\": true, \"stateProps\": true, \"ownProps\": true,*/\n  if (!view.usageDeclarations) {\n    udret = {\n      data: allProps.data,\n      view,\n      node: allProps.node\n    };\n  } else try {\n    transientProperties.view[vid].UDFunction.call(UDEvalContext, UDEvalContext, udret);\n    // console.log(\"computing usage declarations: \", {f:transientProperties.view[vid].UDFunction, udret, UDEvalContext});\n  } catch (e) {\n    e.isSyntax = false;\n    udret = {\n      data: allProps.data,\n      view,\n      node: allProps.node,\n      __invalidUsageDeclarations: e\n    }; // \"@runtime:\" +e};\n    Log.ee(\"Invalid usage declarations\", {\n      e,\n      str: view.usageDeclarations,\n      view,\n      data: allProps.data,\n      stateProps: allProps\n    });\n  }\n  transientProperties.node[allProps.nodeid].viewScores[vid].usageDeclarations = udret;\n  // do not merge to create jsx final context now, because if shouldcomponentupdate fails, i want to keep the OLD context for measurable events.\n  return udret;\n}\nlet debugcount = 0;\nlet maxRenderCounter = Number.POSITIVE_INFINITY;\nexport const lightModeAllowedElements = [DModel.cname, DPackage.cname, DClass.cname, DEnumerator.cname, DObject.cname];\nfunction getScores(ret, ownProps) {\n  return Selectors.getAppliedViewsNew({\n    data: ret.data,\n    node: ret.node,\n    nid: ownProps.nodeid,\n    pv: ownProps.parentViewId && DPointerTargetable.from(ownProps.parentViewId)\n  });\n}\nconst countRenders = true;\nexport let GraphElementComponent = (_dec = RuntimeAccessible('GraphElementComponent'), _dec(_class = (_class2 = class GraphElementComponent extends Component {\n  static defaultShouldComponentUpdate(instance, nextProps, nextState, nextContext) {\n    return !U.shallowEqual(instance.props, nextProps) || !U.shallowEqual(instance.state, nextState);\n  }\n\n  // requires data and node wrapping first\n  static mapViewStuff(state, ret, ownProps) {\n    var _tn$validMainViews, _tn$mainView, _ownProps$view, _ret$node, _ret$node$father, _ret$node2;\n    // let dnode: DGraphElement | undefined = ownProps?.nodeid && DPointerTargetable.from(ownProps.nodeid, state) as any;\n    // console.log(\"viewsss mapstate 3 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, vv:ret.view, ownProps, stateProps:{...ret}, thiss:this});\n    ret.parentviewid = ownProps.parentViewId;\n    const explicitView = ret.view || ownProps.view;\n    const explicitViews = ret.views || ownProps.views;\n    let scores = undefined;\n    let tn = transientProperties.node[ownProps.nodeid]; // tn === scores if getScore is called (getScore have a sideeffect)\n    if (!tn) transientProperties.node[ownProps.nodeid] = tn = new NodeTransientProperties();\n    if (explicitView) {\n      let idorname = Pointers.from(explicitView) || explicitView;\n      ret.view = tn.mainView = LPointerTargetable.fromD(Selectors.getViewByIDOrNameD(idorname, state));\n    }\n    if (!ret.view) {\n      var _scores$mainView, _ret$view;\n      // if view is not explicitly set or the assigned view is not found, match a new one.\n      if (!scores) scores = getScores(ret, ownProps);\n      ret.view = scores.mainView = LPointerTargetable.fromPointer((_scores$mainView = scores.mainView) === null || _scores$mainView === void 0 ? void 0 : _scores$mainView.id, state);\n      Log.w(!!explicitView, \"Requested main view \" + ownProps.view + \" not found. Another view got assigned: \" + ((_ret$view = ret.view) === null || _ret$view === void 0 ? void 0 : _ret$view.__raw.name), {\n        requested: ownProps.view,\n        props: ownProps,\n        state: ret\n      });\n    }\n    if (!((_tn$validMainViews = tn.validMainViews) === null || _tn$validMainViews === void 0 ? void 0 : _tn$validMainViews[0]) || tn.validMainViews[0].id !== ((_tn$mainView = tn.mainView) === null || _tn$mainView === void 0 ? void 0 : _tn$mainView.id)) tn.validMainViews = [tn.mainView, ...(tn.validMainViews || [])];\n    // @ts-ignore\n    let vname = !ret.view && ownProps.view ? ' Check the manual assignment of props view={\"' + (((_ownProps$view = ownProps.view) === null || _ownProps$view === void 0 ? void 0 : _ownProps$view.name) || ownProps.view) + '\"}' : '';\n    let pview = !ret.view ? (_ret$node = ret.node) === null || _ret$node === void 0 ? void 0 : (_ret$node$father = _ret$node.father) === null || _ret$node$father === void 0 ? void 0 : _ret$node$father.view : undefined;\n    Log.ex(!ret.view, \"Could not find any view applicable to element.\" + vname + (pview ? ' in view \"' + pview.name + '\"' : ''), {\n      data: ret.data,\n      props: ownProps,\n      state: ret,\n      scores: ret.viewScores,\n      nid: ownProps.nodeid,\n      tn: transientProperties.node[ownProps.nodeid]\n    });\n    if (explicitViews) {\n      // ret.views = tn.stackViews = LPointerTargetable.fromArr(explicitView);\n      let views = [];\n      for (let v of explicitViews) {\n        let idorname = Pointers.from(v) || v;\n        let view = LPointerTargetable.fromD(Selectors.getViewByIDOrNameD(idorname, state));\n        if (view) views.push(view);else Log.ww(\"Requested decorative view \" + v + \" not found.\", {\n          requested: v,\n          idorname,\n          props: ownProps,\n          state: ret\n        });\n      }\n      ret.views = tn.stackViews = views;\n    }\n    if (!ret.views) {\n      // if views is not explicitly set. (if some are not found, they are just missing by choice, will not replace)\n      if (!scores) {\n        scores = getScores(ret, ownProps);\n        ret.views = scores.stackViews;\n      } else ret.views = scores.stackViews = LPointerTargetable.fromArr((scores.stackViews || []).map(v => v === null || v === void 0 ? void 0 : v.id).filter(vid => !!vid));\n    }\n    // console.log(\"viewsss mapstate 4 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps: {...ret}, thiss:this});\n\n    ret.viewsid = Pointers.fromArr(ret.views);\n    ret.viewid = ret.view.id;\n    let dnode = (_ret$node2 = ret.node) === null || _ret$node2 === void 0 ? void 0 : _ret$node2.__raw;\n    if (dnode) dnode.view = ret.viewid;\n    ret.viewScores = tn; // debug only\n  }\n  static mapLModelStuff(state, ownProps, ret) {\n    // NB: Edge constructor might have set it from props.start, so keep the check before overwriting.\n    if (typeof ownProps.data === \"object\") {\n      ret.dataid = ownProps.data.id;\n    } else ret.dataid = ownProps.data;\n    ret.data = LPointerTargetable.wrap(ret.dataid); // forcing re-wrapping even if props was a dobject or lobject, because i want to get the latest version of it.\n\n    /*\r\n    const meid: string = (typeof ownProps.data === 'string' ? ownProps.data as string : (ownProps.data as any as DModelElement)?.id) as string;\r\n    // Log.exDev(!meid, \"model element id not found in GE.mapstatetoprops\", {meid, ret, ownProps, state});\r\n    ret.data = MyProxyHandler.wrap(meid, state);\r\n    // Log.ex(!ret.data, \"can't find model data:\", {meid, state, ownpropsdata:ownProps.data, ownProps});\r\n    */\n  }\n  static mapLGraphElementStuff(state, ownProps, ret) {\n    let dGraphElementDataClass = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DGraphElement;\n    let isDGraph = arguments.length > 4 ? arguments[4] : undefined;\n    let nodeid = ownProps.nodeid;\n    let graphid = isDGraph ? isDGraph.id : ownProps.graphid;\n    let parentnodeid = ownProps.parentnodeid;\n    ret.nodeid = nodeid;\n    let tn = transientProperties.node[nodeid];\n    if (!tn) tn = transientProperties.node[nodeid] = new NodeTransientProperties();\n    // let data: Pointer<DModelElement, 0, 1, LModelElement> = ownProps.data || null;\n    // Log.exDev(!nodeid || !graphid, 'node id injection failed', {ownProps, data: ret.data, name:(ret.data as any)?.name || (ret.data as any)?.className}); /*\n    /*if (!nodeid) {\r\n        nodeid = 'nodeof_' + stateProps.data.id + (stateProps.view.storeSize ? '_' + stateProps.view.id : '') + '_1';\r\n        stateProps.nodeid = U.increaseEndingNumber(nodeid, false, false, id => !DPointerTargetable.from(id, state));\r\n        todo: quando il componente si aggiorna questo viene perso, come posso rendere permanente un settaggio di reduxstate in mapstatetoprops? o devo metterlo nello stato normale?\r\n    }*/\n\n    let graph = DPointerTargetable.from(graphid, state); // se non c'è un grafo lo creo\n    if (!graph) {\n      // Log.exDev(!dataid, 'attempted to make a Graph element without model', {dataid, ownProps, ret, thiss:this});\n      if (ret.data) CreateElementAction.new(DGraph.new(0, ret.data.id, parentnodeid, graphid, graphid));\n    }\n    /*else {\r\n        graph = MyProxyHandler.wrap(graph);\r\n        Log.exDev(graph.__raw.className !== \"DGraph\", 'graph class is wrong', {graph: ret.graph, ownProps});\r\n    }*/\n    let dnode = DPointerTargetable.from(nodeid, state);\n\n    // console.log('dragx GE mapstate addGEStuff', {dGraphElementDataClass, created: new dGraphElementDataClass(false, nodeid, graphid)});\n    if (!dnode && !DPointerTargetable.pendingCreation[nodeid]) {\n      /*\r\n      console.log(\"making node:\", {dGraphElementDataClass, nodeid, parentnodeid, graphid, dataid, ownProps, ret,\r\n          pendings: {...DPointerTargetable.pendingCreation}, pending:DPointerTargetable.pendingCreation[nodeid]});*/\n      // so this is called once, but createaction is triggered twice only for edgepoints? it works if i create it through console.\n      let dge;\n      /*\r\n      if (dGraphElementDataClass === DEdgePoint) { // made it same as dvertex\r\n          let initialSize = ownProps.initialSize;\r\n          dge = DEdgePoint.new(ownProps.htmlindex as number, dataid, parentnodeid, graphid, nodeid, initialSize);\r\n          ret.node =  MyProxyHandler.wrap(dge);\r\n      } else*/\n      if (dGraphElementDataClass === DEdge) {\n        var _ret$data;\n        // set start and end from ownprops;\n        let edgeOwnProps = ownProps;\n        let edgeStateProps = ret;\n        let startnodeid = LGraphElement.getNodeId(edgeOwnProps.start);\n        let endnodeid = LGraphElement.getNodeId(edgeOwnProps.end);\n        if (!startnodeid) {\n          startnodeid = LGraphElement.getNodeId(ret.data);\n        }\n        edgeStateProps.start = LPointerTargetable.fromPointer(startnodeid);\n        edgeStateProps.end = LPointerTargetable.fromPointer(endnodeid);\n        Log.e(!startnodeid, \"Cannot create an edge without start node\", {\n          startnodeid,\n          data: ret.data,\n          propsStart: edgeOwnProps.start\n        });\n        Log.e(!endnodeid, \"Cannot create an edge without end node (yet)\", {\n          endnodeid,\n          data: ret.data,\n          propsEnd: edgeOwnProps.end\n        });\n        if (!startnodeid || !endnodeid) return;\n        let longestLabel = edgeOwnProps.label;\n        let labels = edgeOwnProps.labels;\n        // dge = DEdge.new(ownProps.htmlindex as number, ret.data?.id, parentnodeid, graphid, nodeid, startnodeid, endnodeid, longestLabel, labels);\n        let ddata = (_ret$data = ret.data) === null || _ret$data === void 0 ? void 0 : _ret$data.__raw;\n        dge = DEdge.new2(ddata === null || ddata === void 0 ? void 0 : ddata.id, parentnodeid, graphid, nodeid, startnodeid, endnodeid, d => {\n          //d.longestLabel = longestLabel;\n          //d.labels = labels;\n          d.isReference = !!edgeOwnProps.isReference;\n          if (edgeOwnProps.isValue !== undefined) d.isValue = !!edgeOwnProps.isValue;else d.isValue = !!(d.isReference && ddata && ddata.className === 'DValue');\n          if (d.isValue) d.isReference = false;\n          d.isDependency = !!edgeOwnProps.isDepencency;\n          d.isExtend = !!edgeOwnProps.isExtend;\n          let tn = transientProperties.node[nodeid];\n          if (!tn) transientProperties.node[nodeid] = new NodeTransientProperties();\n          tn.onDelete = edgeOwnProps.onDelete;\n          tn.labels = labels;\n          tn.longestLabel = longestLabel;\n          d.zIndex = edgeOwnProps.htmlindex || 1;\n          if (edgeOwnProps.anchorStart) d.anchorStart = edgeOwnProps.anchorStart;\n          if (edgeOwnProps.anchorEnd) d.anchorEnd = edgeOwnProps.anchorEnd;\n        });\n        edgeStateProps.node = edgeStateProps.edge = MyProxyHandler.wrap(dge);\n      } else {\n        var _ret$data2;\n        let initialSize = ownProps.initialSize;\n        dge = dGraphElementDataClass.new(ownProps.htmlindex, (_ret$data2 = ret.data) === null || _ret$data2 === void 0 ? void 0 : _ret$data2.id, parentnodeid, graphid, nodeid, initialSize);\n        if (!tn) transientProperties.node[nodeid] = new NodeTransientProperties();\n        tn.onDelete = ownProps.onDelete;\n        ret.node = MyProxyHandler.wrap(dge);\n      }\n      // console.log(\"map ge2\", {nodeid: nodeid+'', dge: {...dge}, dgeid: dge.id});\n    } else {\n      ret.node = MyProxyHandler.wrap(dnode);\n      if (dGraphElementDataClass === DEdge) ret.edge = ret.node;\n    }\n    if (ret.dataid) {\n      // set up transient model-> node map\n      let ta = transientProperties.modelElement[ret.dataid];\n      if (!ta) transientProperties.modelElement[ret.dataid] = {\n        nodes: {}\n      };\n      ta.nodes[ownProps.nodeid] = ret.node;\n      ta.node = ret.node;\n    }\n  }\n\n  ////// mapper func\n  static mapStateToProps(state, ownProps) {\n    let dGraphDataClass = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : DGraphElement;\n    let startingobj = arguments.length > 3 ? arguments[3] : undefined;\n    // console.log('dragx GE mapstate', {dGraphDataClass});\n    let ret = startingobj || GraphElementReduxStateProps.new(); // NB: cannot use a constructor, must be pojo\n    // console.log(\"viewsss mapstate 0 \" + ownProps.view + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\n\n    GraphElementComponent.mapLModelStuff(state, ownProps, ret);\n    if (Debug.lightMode && (!ret.data || !lightModeAllowedElements.includes(ret.data.className))) {\n      return ret;\n    }\n    // console.log(\"map ge\", {ownProps, ret, state});\n    GraphElementComponent.mapLGraphElementStuff(state, ownProps, ret, dGraphDataClass);\n    // console.log(\"viewsss mapstate 2 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\n\n    GraphElementComponent.mapViewStuff(state, ret, ownProps);\n    // console.log(\"viewsss mapstate 5 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\n\n    Log.exDev(!ret.view || !ret.views, 'failed to assign view:', {\n      state,\n      ownProps,\n      reduxProps: ret\n    });\n    // @ts-ignore\n    ret.key = ret.key || ownProps.key;\n    // @ts-ignore\n    ret.forceupdate = state.forceupdate;\n\n    // Log.l((ret.data as any)?.name === \"concept 1\", \"mapstatetoprops concept 1\", {newnode: ret.node});\n    U.removeEmptyObjectKeys(ret);\n    return ret;\n  }\n  static mapDispatchToProps(dispatch) {\n    const ret = {};\n    return ret;\n  }\n\n  // undefined or view.clonedCounter;\n\n  // undefined or data.clonedCounter;\n\n  shouldComponentUpdate(nextProps, nextState, nextContext, oldProps) {\n    var _nextProps$data;\n    if (!oldProps) oldProps = this.props; //for subviewcomponent\n    if (nextProps.__skipRender) return true;\n    let debug = false;\n    // return GraphElementComponent.defaultShouldComponentUpdate(this, nextProps, nextState, nextContext);\n    let data = (_nextProps$data = nextProps.data) === null || _nextProps$data === void 0 ? void 0 : _nextProps$data.__raw;\n    let out = {\n      reason: undefined\n    };\n    let skipDeepKeys = {\n      pointedBy: true,\n      clonedCounter: true\n    }; // clonedCounter is checked manually before looping object keys\n    // let skipPropKeys = {...skipDeepKeys, usageDeclarations: true, node:true, data:true, initialSize: true};\n    let ret = false; // !U.isShallowEqualWithProxies(oldProps, nextProps, 0, 1, skipPropKeys, out);\n    // if node and data in props must be ignored and not checked for changes. but they are checked if present in usageDeclarations\n    let component = nextProps.node.component;\n    const nid = nextProps.nodeid;\n    // U.arrayDiff()\n    for (let v of nextProps.views) {\n      const vid = v.__raw.id;\n      let nodeviewentry = transientProperties.node[nid].viewScores[vid];\n      let old_ud = nodeviewentry.usageDeclarations;\n      computeUsageDeclarations(component, nextProps, nextState, v);\n      let new_ud = nodeviewentry.usageDeclarations;\n      nodeviewentry.shouldUpdate = !U.isShallowEqualWithProxies(old_ud, new_ud, skipDeepKeys, out);\n      nodeviewentry.shouldUpdate_reason = {\n        ...out\n      };\n      nodeviewentry.shouldUpdate_reasonDebug = {\n        old_ud,\n        new_ud\n      };\n      Log.l(debug, \"DECORATIVE_VIEW ShouldComponentUpdate \" + (data === null || data === void 0 ? void 0 : data.name) + (nodeviewentry.shouldUpdate ? \" UPDATED \" : \" REJECTED \") + vid, {\n        ret: nodeviewentry.shouldUpdate,\n        reason: out.reason,\n        old_ud,\n        new_ud,\n        oldProps: oldProps,\n        nextProps,\n        vid\n      });\n      if (!ret && nodeviewentry.shouldUpdate) ret = true;\n    }\n    const vid = nextProps.view.__raw.id;\n    let nodeviewentry = transientProperties.node[nextProps.nodeid].viewScores[vid];\n    let old_ud = nodeviewentry.usageDeclarations;\n    computeUsageDeclarations(component, nextProps, nextState, nextProps.view);\n    let new_ud = nodeviewentry.usageDeclarations;\n    nodeviewentry.shouldUpdate = !U.isShallowEqualWithProxies(old_ud, new_ud, skipDeepKeys, out);\n    nodeviewentry.shouldUpdate_reason = {\n      ...out\n    };\n    nodeviewentry.shouldUpdate_reasonDebug = {\n      old_ud,\n      new_ud\n    };\n    Log.l(debug, \"ShouldComponentUpdate \" + (data === null || data === void 0 ? void 0 : data.name) + (nodeviewentry.shouldUpdate ? \" UPDATED \" : \" REJECTED \") + vid, {\n      ret: nodeviewentry.shouldUpdate,\n      reason: out.reason,\n      old_ud,\n      new_ud,\n      oldProps: oldProps,\n      nextProps\n    });\n    if (!ret && nodeviewentry.shouldUpdate) ret = true;\n    return ret; // if any of main view or decorative views need updating\n    // apparently node changes are not working? also check docklayout shouldupdate\n  }\n  doMeasurableEvent(type, vid) {\n    if (Debug.lightMode) return false;\n    let measurableFunc = transientProperties.view[vid][type];\n    if (!measurableFunc) return false;\n    let context = this.getJSXContext(vid); // context + usagedeclarations of main view only\n    try {\n      measurableFunc.call(context, context);\n      console.log(\"measurable executed\", {\n        type,\n        measurableFunc,\n        vid,\n        transient: transientProperties.view[vid]\n      });\n    } catch (e) {\n      Log.ee('Error in measurable \"' + type + '\" ' + e.message, {\n        e,\n        measurableFunc,\n        context\n      });\n    }\n    // it has executed at least partially.\n    // i just need to know if he had the chance to do side-effects and the answer is yes regardless of exceptions\n    return true;\n  }\n  select(forUser) {\n    // if (forUser === DUser.current && this.html.current) this.html.current.focus();\n    TRANSACTION('selection', () => {\n      var _this$props$node, _this$props$data;\n      (_this$props$node = this.props.node) === null || _this$props$node === void 0 ? void 0 : _this$props$node.select(forUser);\n      SetRootFieldAction.new('_lastSelected', {\n        node: this.props.nodeid,\n        view: this.props.view.id,\n        modelElement: (_this$props$data = this.props.data) === null || _this$props$data === void 0 ? void 0 : _this$props$data.id\n      }, this.props.data.name); /*\r\n                                // ? why this?\r\n                                const id = this.props.data?.id;\r\n                                if (id) {\r\n                                //selected[forUser] = id;\r\n                                SetRootFieldAction.new('selected', id, '', true);\r\n                                }*/\n\n      // SetRootFieldAction.new(`selected.${DUser.current}`, nodeid, '', true);\n    });\n  }\n  constructor(props, context) {\n    super(props, context);\n    this.id = void 0;\n    this.countRenders = void 0;\n    this._isMounted = void 0;\n    this.html = void 0;\n    this.lastViewChanges = void 0;\n    this.lastOnUpdateChanges = void 0;\n    this.stopUpdateEvents = void 0;\n    this.dataOldClonedCounter = void 0;\n    this.lastViewChanges = [];\n    this.lastOnUpdateChanges = [];\n    this.stopUpdateEvents = undefined;\n    this._isMounted = false;\n    this.countRenders = 0;\n    this.id = GraphElementComponent.maxid++;\n    GraphElementComponent.all[this.id] = this;\n    GraphElementComponent.map[props.nodeid] = this; // props might change at runtime, setting in constructor is not enough\n    this.html = /*#__PURE__*/React.createRef();\n    let functionsToBind = [this.onClick, this.onLeave, this.onEnter, this.doContextMenu, this.onContextMenu, this.onMouseDown, this.onMouseUp, this.onKeyDown, this.onScroll, this.onMouseMove]; /*\r\n                                                                                                                                                                                                 this.onClick = this.onClick.bind(this);\r\n                                                                                                                                                                                                 this.onLeave = this.onLeave.bind(this);\r\n                                                                                                                                                                                                 this.onContextMenu = this.onContextMenu.bind(this);\r\n                                                                                                                                                                                                 this.onEnter = this.onEnter.bind(this);\r\n                                                                                                                                                                                                 this.select = this.select.bind(this);*/\n    for (let f of functionsToBind) this[f.name] = f.bind(this);\n    // @ts-ignore\n    this.state = {\n      classes: []\n    };\n    this.shouldComponentUpdate(this.props, this.state, undefined, undefined);\n  }\n\n  // constants: evalutate solo durante il primo render, può essere una funzione con effetti collaterali sul componente,\n  // in tal caso la si esegue e si prende il valore di ritorno.\n  // preRenderFunc: funzione evalutata ed eseguita sempre prima del render, ha senso solo per generare effetti collaterali sulle \"costanti\".\n  // jsxString: funzione evalutata una sola volta durante il primo render ed eseguita ad ogni update dei dati.\n\n  componentDidMount() {\n    // after first render\n    this._isMounted = true;\n  }\n  componentWillUnmount() {\n    // todo: devo fare in modo che il nodo venga cancellato solo se sto modificando la vista in modo che questo vertice non esista più.\n    //  e non venga cancellato se il componente viene smontato perchè ho solo cambiato vista\n    //  LOW PRIORITY perchè funziona anche senza, pur sprecando memoria che potrebbe essere liberata.\n    // if (view_is_still_active_but_got_modified_and_vertex_is_deleted) new DeleteElementAction(this.getId());\n  }\n  /*\r\n      componentDidUpdate(oldProps: Readonly<AllProps {/*\r\n          const newProps = this.props\r\n          if (oldProps.view !== newProps.view) { this.setTemplateString(newProps.view); }\r\n  }*/\n\n  getJSXContext(vid) {\n    let context = transientProperties.node[this.props.nodeid].viewScores[vid].evalContext;\n    if (context && context.component) return context;\n\n    // else rebuild + update it\n    let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\n    let tv = transientProperties.view[vid];\n    context = tnv.evalContext = {\n      ...this.props,\n      ...tv.constants,\n      ...tnv.usageDeclarations,\n      // add component stuff that could not be computed in reducer\n      component: this,\n      otherViews: this.props.views,\n      constants: tv.constants,\n      usageDeclarations: tnv.usageDeclarations,\n      props: this.props\n    };\n    context._context = context;\n    return context;\n  }\n  static displayError(e, where, view, data, node) {\n    let asString = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n    let printData = arguments.length > 6 ? arguments[6] : undefined;\n    // const view: LViewElement = this.props.view; //data._transient.currentView;\n    let errormsg = (where === \"preRenderFunc\" ? \"Pre-Render \" : \"\") + (e.message || \"\\n\").split(\"\\n\")[0];\n    if (e.message.indexOf(\"Unexpected token .\") >= 0 || view.jsxString.indexOf('?.') >= 0 || view.jsxString.indexOf('??') >= 0) {\n      errormsg += '\\n\\nReminder: nullish operators \".?\" and \"??\" are not supported.';\n    } else if (view.jsxString.indexOf('?.') >= 0) {\n      errormsg += '\\n\\nReminder: ?. operator and empty tags <></> are not supported.';\n    } else if (e.message.indexOf(\"Unexpected token '<'\") !== -1) {\n      errormsg += '\\n\\nDid you forgot to close a html </tag>?';\n    }\n    try {\n      let ee = e.stack || \"\";\n      let stackerrorlast = ee.split(\"\\n\")[1];\n      let icol = stackerrorlast.lastIndexOf(\":\");\n      let jsxString = view.jsxString;\n      // let col = stackerrorlast.substring(icol+1);\n      let irow = stackerrorlast.lastIndexOf(\":\", icol - 1);\n      const offset = {\n        row: -2,\n        col: 1\n      };\n      let stackerrorlinenum = {\n        row: Number.parseInt(stackerrorlast.substring(irow + 1, icol)) + offset.row,\n        col: Number.parseInt(stackerrorlast.substring(icol + 1)) + offset.col\n      };\n      let linesPre = 1;\n      let linesPost = 1;\n      let jsxlines = jsxString.split(\"\\n\");\n      let culpritlinesPre = jsxlines.slice(stackerrorlinenum.row - linesPre - 1, stackerrorlinenum.row - 1);\n      let culpritline = jsxlines[stackerrorlinenum.row - 1]; // stack start counting lines from 1\n      let culpritlinesPost = jsxlines.slice(stackerrorlinenum.row, stackerrorlinenum.row + linesPost);\n      console.error(\"errr\", {\n        e,\n        node,\n        jsxlines,\n        culpritlinesPre,\n        culpritline,\n        culpritlinesPost,\n        stackerrorlinenum,\n        icol,\n        irow,\n        stackerrorlast\n      });\n      if (stackerrorlinenum.col - offset.col > (culpritline === null || culpritline === void 0 ? void 0 : culpritline.length) && stackerrorlinenum.row === 1) stackerrorlinenum.col = 0;\n      let caretCursor = \"▓\"; // ⵊ ꕯ 𝙸 Ꮖ\n      if (culpritline && stackerrorlinenum.col - offset.col <= (culpritline === null || culpritline === void 0 ? void 0 : culpritline.length) && stackerrorlast.indexOf(\"main.chunk.js\") === -1) {\n        let rowPre = culpritline.substring(0, stackerrorlinenum.col);\n        let rowPost = culpritline.substring(stackerrorlinenum.col);\n        let jsxcode = /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontFamily: \"monospaced sans-serif\",\n            color: \"#444\"\n          },\n          children: [culpritlinesPre.map(l => /*#__PURE__*/_jsxDEV(\"div\", {\n            children: l\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 562,\n            columnNumber: 52\n          }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [rowPre, \" \", /*#__PURE__*/_jsxDEV(\"b\", {\n              style: {\n                color: \"red\"\n              },\n              children: [\" \", caretCursor, \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 563,\n              columnNumber: 39\n            }, this), \" \", rowPost]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 563,\n            columnNumber: 25\n          }, this), culpritlinesPost.map(l => /*#__PURE__*/_jsxDEV(\"div\", {\n            children: l\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 564,\n            columnNumber: 53\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 561,\n          columnNumber: 21\n        }, this);\n        errormsg += \" @ line \" + stackerrorlinenum.row + \", col:\" + stackerrorlinenum.col;\n        if (asString) return DV.errorView_string('<div>' + errormsg + '\\n' + jsxcode + '</div>', {\n          where: \"in \" + where + \"()\",\n          e,\n          template: view.jsxString,\n          view: view\n        }, where, data, node, view);\n        return DV.errorView( /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [errormsg, jsxcode]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 568,\n          columnNumber: 37\n        }, this), {\n          where: \"in \" + where + \"()\",\n          e,\n          template: view.jsxString,\n          view: view\n        }, where, data, node, view);\n      } else {\n        // it means it is likely accessing a minified.js src code, sending generic error without source mapping\n      }\n    } catch (e2) {\n      Log.eDevv(\"internal error in error view\", {\n        e,\n        e2,\n        where\n      });\n      return null;\n    }\n    if (asString) return DV.errorView_string('<div>' + errormsg + '</div>', {\n      where: \"in \" + where + \"()\",\n      e,\n      template: view.jsxString,\n      view: view\n    }, where, data, node, view);\n    return DV.errorView( /*#__PURE__*/_jsxDEV(\"div\", {\n      children: errormsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 577,\n      columnNumber: 29\n    }, this), {\n      where: \"in \" + where + \"()\",\n      e,\n      template: view.jsxString,\n      view: view,\n      ...(printData || {})\n    }, where, data, node, view);\n  }\n  /*\r\n      protected getTemplate(): ReactNode {\r\n          /*if (!this.state.template) {\r\n              this.setTemplateString('{c1: 118}', '()=>{this.setState({c1: this.state.c1+1})}',\r\n                  '<div><input value=\"{name}\" onInput=\"{setName}\"></input><p>c1:{this.state.c1}</p><Attribute prop1={daa} prop2={1 + 1.5} stringPropdaa=\\\"daa\\\" /><ul>{colors.map( color => <li>color: {color}</li>)}</ul></div>');\r\n          }* /\r\n          // console.log('getTemplate:', {props: this.props, template: this.props.template, ctx: this.props.evalContext});\r\n  \r\n          // Log.exDev(debug && maxRenderCounter-- < 0, \"loop involving render\");\r\n          if (this.props.invalidUsageDeclarations) {\r\n              return this.displayError(this.props.invalidUsageDeclarations, \"Usage Declaration\");\r\n          }\r\n          let context: GObject = this.getContext();\r\n          // abababababab\r\n          // todo: invece di fare un mapping ricorsivo dei figli per inserirgli delle prop, forse posso farlo passando una mia factory che wrappa React.createElement\r\n  \r\n          try {\r\n              let preRenderFuncStr: string | undefined = this.props.view.preRenderFunc;\r\n              if (preRenderFuncStr) {\r\n                  // eval prerender\r\n                  let obj: GObject = {};\r\n                  let tempContext: GObject = {__param: obj};\r\n                  tempContext.__proto__ = context;\r\n                  U.evalInContextAndScopeNew(\"(\"+preRenderFuncStr+\")(this.__param)\", tempContext, true, false);\r\n                  U.objectMergeInPlace(context, obj);\r\n              }\r\n          }\r\n          catch(e: any) { return this.displayError(e, \"Pre-Render\");  }\r\n  \r\n          let ret;\r\n          // eval template\r\n          let jsxCodeString: DocString<ReactNode>;\r\n  \r\n          try { jsxCodeString = JSXT.fromString(this.props.view.jsxString, {factory: 'React.createElement'}); }\r\n          catch (e: any) { return this.displayError(e, \"JSX Syntax\"); }\r\n  \r\n          try { ret = U.evalInContextAndScope<() => ReactNode>('(()=>{ return ' + jsxCodeString + '})()', context); }\r\n          catch (e: any) { return this.displayError(e, \"JSX Semantic\"); }\r\n          return ret;\r\n      }*/\n  getTemplate3(vid, v, context) {\n    let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\n    let tv = transientProperties.view[vid];\n    // console.log(\"getTemplate jsx\", {vid, v, context, tnv, tv, shouldUp: tnv.shouldUpdate, jsxFunc:tv.JSXFunction});\n    let ret = this.getTemplate3_(vid, v, context);\n    return ret;\n  }\n  getTemplate3_(vid, v, context) {\n    let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\n    if (!tnv.shouldUpdate && tnv.jsxOutput) return tnv.jsxOutput;\n    let tv = transientProperties.view[vid];\n    let ret = tnv.jsxOutput = tv.JSXFunction ? tv.JSXFunction.call(context, context) : null;\n    if (typeof ret === \"object\" && ret !== null && ! /*#__PURE__*/React.isValidElement(ret)) {\n      // plain objects cannot be react nodes, but react noeds are objects. so i try serializing\n      // this only happens if someone puts an object in jsx\n      try {\n        ret = JSON.stringify(ret);\n      } catch (e) {\n        ret = \"{__ Cyclic Object __}\";\n      }\n    }\n    return ret;\n  }\n  getTemplate2(v, udContext) {\n    // todo: invece di fare un mapping ricorsivo dei figli per inserirgli delle prop, forse posso farlo passando una mia factory che wrappa React.createElement\n\n    /*\r\n    let thisContext: GObject = {};\r\n    try {\r\n        let preRenderFuncStr: string | undefined = v.preRenderFunc;\r\n        if (preRenderFuncStr) {\r\n            // eval prerender\r\n            let tempContext: GObject = {__param: thisContext};\r\n            this.addToContext(udContext, {__param: thisContext});\r\n            tempContext.__proto__ = sharedContext;\r\n            U.evalInContextAndScopeNew(\"(\"+preRenderFuncStr+\")(this.__param)\", tempContext, true, false);\r\n            U.objectMergeInPlace(thisContext, udContext);\r\n            // thisContext.__proto__ = sharedContext;\r\n        } else thisContext = udContext;\r\n    }\r\n    catch(e: any) { return this.displayError(e, \"Pre-Render\", v);  }*/\n\n    let ret;\n    // eval template\n    let jsxCodeString;\n    try {\n      jsxCodeString = JSXT.fromString(v.jsxString, {\n        factory: 'React.createElement'\n      });\n    } catch (e) {\n      var _this$props$data2, _this$props$node2;\n      return GraphElementComponent.displayError(e, \"JSX Syntax\", v.__raw, (_this$props$data2 = this.props.data) === null || _this$props$data2 === void 0 ? void 0 : _this$props$data2.__raw, (_this$props$node2 = this.props.node) === null || _this$props$node2 === void 0 ? void 0 : _this$props$node2.__raw);\n    }\n\n    // console.log('context for ' + (this.props.data?.name), {udContext});\n    try {\n      let parsedFunc = U.parseFunctionWithContextAndScope('()=>{ return ' + jsxCodeString + '}', udContext, udContext);\n      ret = parsedFunc(udContext);\n      /// ret = U.evalInContextAndScope<() => ReactNode>('(()=>{ return ' + jsxCodeString + '})()', udContext);\n    } catch (e) {\n      var _this$props$data3, _this$props$node3;\n      return GraphElementComponent.displayError(e, \"JSX Semantic\", v.__raw, (_this$props$data3 = this.props.data) === null || _this$props$data3 === void 0 ? void 0 : _this$props$data3.__raw, (_this$props$node3 = this.props.node) === null || _this$props$node3 === void 0 ? void 0 : _this$props$node3.__raw, false, {\n        udContext\n      });\n    }\n    return ret;\n  }\n  onContextMenu(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    // NOT executed here, but on mousedown because of IOS compatibility\n  }\n  doContextMenu(e) {\n    TRANSACTION('contextmenu', () => {\n      var _state$contextMenu;\n      this.props.node.select();\n      if (this.html.current) this.html.current.focus();\n      let state = store.getState();\n      if (((_state$contextMenu = state.contextMenu) === null || _state$contextMenu === void 0 ? void 0 : _state$contextMenu.x) !== e.clientX) {\n        var _this$props$node4;\n        SetRootFieldAction.new(\"contextMenu\", {\n          display: true,\n          x: e.clientX,\n          y: e.clientY,\n          nodeid: (_this$props$node4 = this.props.node) === null || _this$props$node4 === void 0 ? void 0 : _this$props$node4.id\n        });\n      }\n    }, true, false);\n  }\n  onEnter(e) {\n    var _this$props$isEdgePen, _this$props$data4;\n    // instead of doing it here, might set this class on render, and trigger it visually operative with :hover selector css\n    const isEdgePending = (_this$props$isEdgePen = this.props.isEdgePending) === null || _this$props$isEdgePen === void 0 ? void 0 : _this$props$isEdgePen.source;\n    if (!isEdgePending || ((_this$props$data4 = this.props.data) === null || _this$props$data4 === void 0 ? void 0 : _this$props$data4.className) !== \"DClass\") return;\n    const extendError = {\n      reason: '',\n      allTargetSuperClasses: []\n    };\n    const canBeExtend = isEdgePending.canExtend(this.props.data, extendError);\n    if (canBeExtend) this.setState({\n      classes: [...this.state.classes, \"class-can-be-extended\"]\n    });else this.setState({\n      classes: [...this.state.classes, \"class-cannot-be-extended\"]\n    });\n  }\n  onLeave(e) {\n    var _this$props$data5;\n    if (((_this$props$data5 = this.props.data) === null || _this$props$data5 === void 0 ? void 0 : _this$props$data5.className) !== \"DClass\") return;\n    this.setState({\n      classes: this.state.classes.filter(classname => {\n        return classname !== \"class-can-be-extended\" && classname !== \"class-cannot-be-extended\";\n      })\n    });\n  }\n  onMouseDown(e) {\n    if (UX.isStoppedEvt(e)) return;\n    e.stopPropagation();\n    GraphElementComponent.mousedownComponent = this;\n    //TRANSACTION('contextmenu', ()=>{\n    if (e.button === Keystrokes.clickRight) {\n      this.doContextMenu(e);\n    }\n    let p = this.props;\n    console.log('try drag', {\n      p,\n      ig: p.isGraph,\n      iv: p.isVertex,\n      e\n    });\n    // if ((p.isGraph && !p.isVertex) || (p.isGraph && p.isVertex && e.ctrlKey)) GraphDragManager.startPanning(e, this.props.node as LGraph);\n    //})\n  }\n  onScroll(e) {\n    console.log(\"onScroll\");\n    let scroll = new Point(e.currentTarget.scrollLeft, e.currentTarget.scrollTop);\n    let scrollOrigin = new Point(e.nativeEvent.offsetX, e.nativeEvent.offsetY);\n    let g = this.props.node.graph;\n    let oldZoom = g.zoom;\n    let newZoom = new GraphPoint(oldZoom.x + 0.1, oldZoom.y + 0.1);\n    let oldOffset = g.offset;\n    let gscrollOrigin = oldOffset.add(scrollOrigin.multiply(oldZoom, true), true);\n    let newscrollOrigin = oldOffset.add(scrollOrigin.multiply(newZoom, true), true);\n    let newOffset = oldOffset.add(gscrollOrigin.subtract(newscrollOrigin, true), true);\n    TRANSACTION('scroll graph', () => {\n      g.offset = newOffset;\n      g.zoom = newZoom;\n    });\n    e.stopPropagation();\n  }\n  onMouseMove(e) {\n    //this.onMouseUp(e);\n  }\n  onMouseUp(e) {\n    let frommousemove = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    e.stopPropagation();\n    TRANSACTION('Vertex click-events', () => {\n      //GraphDragManager.stopPanning(e);\n      if (GraphElementComponent.mousedownComponent !== this) {\n        return;\n      }\n      if (!frommousemove) this.doOnClick(e);\n    });\n  }\n  onKeyDown(e) {\n    var _this$props$data6;\n    console.log('keydown', e.key, {\n      e,\n      m: (_this$props$data6 = this.props.data) === null || _this$props$data6 === void 0 ? void 0 : _this$props$data6.name\n    });\n    let target = e.target;\n    switch (target === null || target === void 0 ? void 0 : target.tagName.toLowerCase()) {\n      case 'input':\n      case 'textarea':\n        e.stopPropagation();\n        return;\n      default:\n        if ((target === null || target === void 0 ? void 0 : target.getAttribute('contenteditable')) === 'true') {\n          e.stopPropagation();\n          return;\n        }\n    }\n    if (!(this.props.isGraph && !this.props.isVertex)) e.stopPropagation();\n    if (e.key === Keystrokes.escape) {\n      this.props.node.deselect();\n      if (this.props.isEdgePending) {\n        // this.stopPendingEdge(); todo\n        return;\n      }\n    }\n    let isDelete = false;\n    if (e.key === Keystrokes.delete) {\n      isDelete = true;\n    }\n    if (e.shiftKey) {\n      var _this$props$data7;\n      // todo: make them a switch\n      if (e.key === \"D\" || e.key === \"d\") (_this$props$data7 = this.props.data) === null || _this$props$data7 === void 0 ? void 0 : _this$props$data7.duplicate();else if (e.key === \"R\" || e.key === \"r\") {\n        isDelete = true;\n      }\n    }\n    console.log('keydown isDelete', isDelete);\n    if (isDelete) {\n      let nid = this.props.nodeid;\n      let tn = transientProperties.node[nid];\n      TRANSACTION('delete ' + this.props.node.name, () => {\n        if (tn && tn.onDelete && tn.onDelete(this.props.node) === false) return;\n        // if shapeless, erase the node directly.\n        if (!this.props.data) {\n          this.props.node.delete();\n          return;\n        }\n        // if dictated by the model, change the model to erase indirectly the node.\n        if (!this.props.isEdge) {\n          this.props.data.delete();\n          return;\n        }\n        // if edge\n        let e = this.props.node;\n        let de = e.__raw;\n        if (de.isExtend) {\n          let data = this.props.data;\n          data.unsetExtends(e.end.model);\n          // SetFieldAction(data.id, 'extends', )\n        }\n        if (de.isReference) {\n          if (this.props.data.className === 'DReference') {\n            let ref = this.props.data;\n            ref.type = ref.father.id;\n          } else {\n            let lval = this.props.data;\n            lval.remove(e.end.model);\n          }\n        }\n        if (de.isDependency) {\n          // pkg dependency\n          let ref = this.props.data;\n        } else {}\n      });\n    }\n    if (e.ctrlKey) {\n      var _this$props$data8, _this$props$data9, _this$props$data10, _this$props$data11, _this$props$data12, _this$props$data13, _this$props$data14, _this$props$data15, _this$props$data16, _this$props$data17;\n      // if (e.key === Keystrokes.escape) this.props.node.toggleMinimize();\n      if (e.key === \"a\") (_this$props$data8 = this.props.data) === null || _this$props$data8 === void 0 ? void 0 : _this$props$data8.addChild(\"auto\");else\n        // add class if on package, literal if on enum...\n        if (e.key === \"r\") (_this$props$data9 = this.props.data) === null || _this$props$data9 === void 0 ? void 0 : _this$props$data9.addChild(\"reference\");else if (e.key === \"o\") ((_this$props$data10 = this.props.data) === null || _this$props$data10 === void 0 ? void 0 : _this$props$data10.addChild(\"operation\")) || ((_this$props$data11 = this.props.data) === null || _this$props$data11 === void 0 ? void 0 : _this$props$data11.addChild(\"object\"));else if (e.key === \"l\") (_this$props$data12 = this.props.data) === null || _this$props$data12 === void 0 ? void 0 : _this$props$data12.addChild(\"literal\");else if (e.key === \"p\") ((_this$props$data13 = this.props.data) === null || _this$props$data13 === void 0 ? void 0 : _this$props$data13.addChild(\"package\")) || ((_this$props$data14 = this.props.data) === null || _this$props$data14 === void 0 ? void 0 : _this$props$data14.addChild(\"parameter\"));else if (e.key === \"c\") (_this$props$data15 = this.props.data) === null || _this$props$data15 === void 0 ? void 0 : _this$props$data15.addChild(\"class\");else if (e.key === \"e\") (_this$props$data16 = this.props.data) === null || _this$props$data16 === void 0 ? void 0 : _this$props$data16.addChild(\"enumerator\");else if (e.key === \"q\") (_this$props$data17 = this.props.data) === null || _this$props$data17 === void 0 ? void 0 : _this$props$data17.addChild(\"annotation\");else ;\n    }\n  }\n  doOnClick(e) {\n    var _state$contextMenu2, _this$props$isEdgePen2;\n    // (e.target as any).focus();\n    e.stopPropagation();\n    let state = store.getState();\n    if (e.button !== Keystrokes.clickRight && ((_state$contextMenu2 = state.contextMenu) === null || _state$contextMenu2 === void 0 ? void 0 : _state$contextMenu2.display)) SetRootFieldAction.new(\"contextMenu\", {\n      display: false,\n      x: 0,\n      y: 0\n    }); // todo: need to move it on document or <App>\n    const edgePendingSource = (_this$props$isEdgePen2 = this.props.isEdgePending) === null || _this$props$isEdgePen2 === void 0 ? void 0 : _this$props$isEdgePen2.source;\n    //console.log('mousedown select() check PRE:', {e, name: this.props.data?.name, isSelected: this.props.node.isSelected(), 'nodeIsSelectedMapProxy': this.props.node?.isSelected, nodeIsSelectedRaw:this.props.node?.__raw.isSelected});\n\n    if (edgePendingSource) {\n      var _this$props$data18;\n      if (((_this$props$data18 = this.props.data) === null || _this$props$data18 === void 0 ? void 0 : _this$props$data18.className) !== \"DClass\") return;\n      // const user = this.props.isEdgePending.user;\n      const extendError = {\n        reason: '',\n        allTargetSuperClasses: []\n      };\n      const canBeExtend = this.props.data && edgePendingSource.canExtend(this.props.data, extendError);\n      if (canBeExtend && this.props.data) {\n        const lClass = LPointerTargetable.from(this.props.data.id);\n        // SetFieldAction.new(lClass.id, \"extendedBy\", source.id, \"\", true); // todo: this should throw a error for wrong type.\n        // todo: use source.addExtends(lClass); or something (source is LClass)\n        SetFieldAction.new(lClass.id, \"extendedBy\", edgePendingSource.id, \"+=\", true);\n        SetFieldAction.new(edgePendingSource.id, \"extends\", lClass.id, \"+=\", true);\n      }\n      SetRootFieldAction.new('isEdgePending', {\n        user: '',\n        source: ''\n      });\n      return;\n    }\n    //console.log('mousedown select() check:', {e, isSelected: this.props.node.isSelected(), 'nodeIsSelectedMapProxy': this.props.node?.isSelected, nodeIsSelectedRaw:this.props.node?.__raw.isSelected});\n    windoww.node = this.props.node;\n    TRANSACTION('select', () => {\n      var _state$_lastSelected;\n      this.props.node.toggleSelected(DUser.current);\n      if (((_state$_lastSelected = state._lastSelected) === null || _state$_lastSelected === void 0 ? void 0 : _state$_lastSelected.node) !== this.props.nodeid) {\n        var _this$props$data19;\n        SetRootFieldAction.new('_lastSelected', {\n          node: this.props.nodeid,\n          view: this.props.view.id,\n          modelElement: (_this$props$data19 = this.props.data) === null || _this$props$data19 === void 0 ? void 0 : _this$props$data19.id\n        });\n      }\n      if (e.shiftKey || e.ctrlKey) {} else {\n        var _this$props$node5;\n        let allNodes = (_this$props$node5 = this.props.node) === null || _this$props$node5 === void 0 ? void 0 : _this$props$node5.graph.allSubNodes;\n        let nid = this.props.node.id;\n        if (allNodes) for (let node of allNodes) if (node.id !== nid) node.deselect(DUser.current);\n      }\n    });\n  }\n  onClick(e) {}\n  onDataUpdateMeasurable(view, vid, index) {\n    if (index > 0) {\n      this.doMeasurableEvent(EMeasurableEvents.onDataUpdate, vid);\n      return;\n    }\n    // only on first of a sequence of onDataUpdate events for all stackviews (the mainview),\n    // set time of current stack of updates, to check if they are generating a loop\n\n    // EMeasurableEvents.onDataUpdate -> handling and checking for loops\n    if (!this.stopUpdateEvents || this.stopUpdateEvents !== this.props.view.clonedCounter) {\n      this.stopUpdateEvents = undefined;\n      if (this.props.data && this.dataOldClonedCounter !== this.props.data.clonedCounter && this.doMeasurableEvent(EMeasurableEvents.onDataUpdate, vid)) {\n        var _this$lastOnUpdateCha;\n        this.dataOldClonedCounter = this.props.data.clonedCounter;\n        let thischange = {\n          t: Date.now()\n        };\n        this.lastOnUpdateChanges.push(thischange);\n        if (thischange.t - ((_this$lastOnUpdateCha = this.lastOnUpdateChanges[this.lastOnUpdateChanges.length - 10]) === null || _this$lastOnUpdateCha === void 0 ? void 0 : _this$lastOnUpdateCha.t) < 300) {\n          var _this$lastOnUpdateCha2;\n          // if N updates in <= 0.2 sec\n          this.stopUpdateEvents = this.props.view.clonedCounter;\n          Log.eDevv(\"loop in node.render() likely due to MeasurableEvent onDataUpdate. It has been disabled until the view changes.\", {\n            change_log: this.lastOnUpdateChanges,\n            component: this,\n            timediff: thischange.t - ((_this$lastOnUpdateCha2 = this.lastOnUpdateChanges[this.lastOnUpdateChanges.length - 10]) === null || _this$lastOnUpdateCha2 === void 0 ? void 0 : _this$lastOnUpdateCha2.t)\n          });\n        }\n      }\n    }\n  }\n\n  // returns: true if an action is fired and component needs re-rendering\n  updateNodeFromProps(props) {\n    let ret = false;\n    TRANSACTION('update node from props', () => {\n      ret = this.updateNodeFromProps0(props);\n    });\n    return ret;\n  }\n  updateNodeFromProps0(props) {\n    let ret = false;\n    let tn = transientProperties.node[props.nodeid];\n    if (tn && !tn.viewScores) console.error('tn error 1', {\n      tn: tn && {\n        ...tn\n      }\n    });\n    let ptr;\n    if (!props.node) return false;\n    let node = props.node;\n    let dnode = node.__raw;\n    let edge = props.node;\n    let dedge = dnode;\n    // if edge.label props is func, do not set in the dedge, just in transientproperties. totally override the \"text\" system.\n    // it does not need collab sync:\n    // because if the view is active for the other user, his synched jsx will generate the same function in transientProperties.\n    // if it is inactive it does not matter, the value is not used.\n    if (props.label) {\n      tn.longestLabel = props.label;\n    }\n    if (props.onDelete) {\n      tn.onDelete = props.onDelete;\n    }\n    if (props.longestLabel) {\n      tn.longestLabel = props.longestLabel;\n    }\n    if (props.labels) {\n      tn.labels = props.labels;\n    }\n    if (props.anchorStart && props.isEdge) {\n      edge.anchorStart = props.anchorStart;\n    }\n    if (props.anchorEnd && props.isEdge) {\n      edge.anchorEnd = props.anchorEnd;\n    }\n    if (props.start && props.isEdge) {\n      ptr = Pointers.from(props.start);\n      if (dedge.id !== ptr) edge.start = ptr;\n    }\n    // console.log(\"changing endpt\", props, props.end, props.end?.model?.name);\n    if (props.end && props.isEdge) {\n      ptr = Pointers.from(props.end);\n      if (dedge.id !== ptr) edge.end = ptr;\n    }\n    if (props.anchorEnd) {\n      tn.labels = props.labels;\n    }\n    let todoremovethis = false;\n    // if (typeof props.viewid === 'string') { let old = props.viewid; if (old !== props.node.view.id) { this.forceUpdate(); ret = true;} }\n    if (todoremovethis || props.isReference !== undefined) {\n      let old = dedge.isReference;\n      let n = !!props.isReference;\n      if (old !== n) {\n        edge.isReference = n;\n        ret = true;\n      }\n    }\n    if (todoremovethis || props.isExtend !== undefined) {\n      let old = dedge.isExtend;\n      let n = !!props.isExtend;\n      if (old !== n) {\n        edge.isExtend = n;\n        ret = true;\n      }\n    }\n    if (todoremovethis || props.isValue !== undefined) {\n      let old = dedge.isValue;\n      let n = !!props.isValue;\n      if (old !== n) {\n        edge.isValue = n;\n        ret = true;\n      }\n    }\n    if (todoremovethis || props.isDependency !== undefined) {\n      let old = dedge.isDependency;\n      let n = !!props.isDependency;\n      if (old !== n) {\n        edge.isDependency = n;\n        ret = true;\n      }\n    }\n    if (typeof props.x === 'number') {\n      let old = dnode.x;\n      let n = +props.x;\n      if (old !== n) {\n        node.x = n;\n        ret = true;\n      }\n    }\n    if (typeof props.y === 'number') {\n      let old = dnode.y;\n      let n = +props.y;\n      if (old !== n) {\n        node.y = n;\n        ret = true;\n      }\n    }\n    // risk loop: todo loop detection and skip setting\n    if (typeof props.w === 'number') {\n      let old = dnode.w;\n      let n = +props.w;\n      if (old !== n) {\n        node.w = n;\n        ret = true;\n      }\n    }\n    if (typeof props.h === 'number') {\n      let old = dnode.h;\n      let n = +props.h;\n      if (old !== n) {\n        node.h = n;\n        ret = true;\n      }\n    }\n    if (typeof props.width === 'number') {\n      let old = dnode.w;\n      let n = +props.width;\n      if (old !== n) {\n        node.w = n;\n        ret = true;\n      }\n    }\n    if (typeof props.height === 'number') {\n      let old = dnode.h;\n      let n = +props.height;\n      if (old !== n) {\n        node.h = n;\n        ret = true;\n      }\n    }\n    return ret;\n  }\n  render() {\n    var _this$props$data20;\n    let nodeType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    let styleoverride = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let classes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n    GraphElementComponent.map[this.props.nodeid] = this; // props might change at runtime, setting in constructor is not enough\n    if (Debug.lightMode && (!this.props.data || !lightModeAllowedElements.includes(this.props.data.className))) {\n      return this.props.data ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\" \" + this.props.data.name, \":\", this.props.data.className]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 969,\n        columnNumber: 38\n      }, this) : undefined;\n    }\n    if (!this.props.node) return \"Loading...\";\n    /*if (this.props.node.__raw.view !== this.props.view.id) {\r\n        this.onViewChange();\r\n        return \"Updating view...\";\r\n    }*/\n    if (this.updateNodeFromProps(this.props)) return 'Updating...';\n    let nid = this.props.nodeid;\n    let allviews = [...this.props.views, this.props.view]; // main view must be last, for renderView ordering\n\n    for (let i = 0; i < allviews.length; i++) {\n      let v = allviews[i];\n      const vid = v.id;\n      let viewnodescore = transientProperties.node[nid].viewScores[v.id];\n      if (!viewnodescore.shouldUpdate) continue;\n      viewnodescore.evalContext = undefined; // force rebuild jsx context, needs to be done before renderView and measurable events\n      // only if this exact view had UD changed, instead of being forced to rended by other in viewstack)\n      this.onDataUpdateMeasurable(v, vid, i);\n    }\n\n    /// set classes\n    if (this.props.node) {\n      let isSelected = this.props.node.__raw.isSelected;\n      if (isSelected) {\n        if (isSelected[DUser.current]) {\n          // todo: better to just use css attribute selectors [data-userselecting = \"userID\"]\n          classes.push('selected-by-me');\n          if (Object.keys(isSelected).length > 1) classes.push('selected-by-others');\n        } else if (Object.keys(isSelected).length) classes.push('selected-by-others');\n      }\n    }\n    classes.push(((_this$props$data20 = this.props.data) === null || _this$props$data20 === void 0 ? void 0 : _this$props$data20.className) || 'DVoid');\n    U.arrayMergeInPlace(classes, this.state.classes);\n    if (Array.isArray(this.props.className)) {\n      U.arrayMergeInPlace(classes, this.props.className);\n    } else if (this.props.className) {\n      classes.push(this.props.className);\n    }\n    if (Array.isArray(this.props.class)) {\n      U.arrayMergeInPlace(classes, this.props.class);\n    } else if (this.props.class) {\n      classes.push(this.props.class);\n    }\n    /// end set classes\n\n    let mainView = this.props.view;\n    let otherViews = this.props.views;\n    let decoratorViewsOutput = []; /*\r\n                                   for (let v of this.props.views) {\r\n                                   if (v.isExclusiveView) {\r\n                                   if (mainView) continue;\r\n                                   mainView = v;\r\n                                   } else otherViews.push(v);\r\n                                   }*/\n\n    let jsxOutput = undefined;\n    const tn = transientProperties.node[nid];\n    //console.log(\"render\", {mainView, otherViews, scores:tn.viewScores, tnv:tn.viewScores[this.props.viewid], ud:tn.viewScores[this.props.viewid].usageDeclarations});\n    for (let v of allviews) {\n      // main view is the last\n      let viewnodescore = transientProperties.node[nid].viewScores[v.id];\n      jsxOutput = viewnodescore.shouldUpdate ? undefined : viewnodescore.jsxOutput;\n      let isMain = v === mainView || undefined;\n      if (!jsxOutput) viewnodescore.jsxOutput = jsxOutput = this.renderView(this.props, v, nodeType, classes, styleoverride, isMain && decoratorViewsOutput, mainView.id, isMain && otherViews.map(v => v.id));\n      if (!isMain) decoratorViewsOutput.push(jsxOutput);\n      if (viewnodescore.shouldUpdate) viewnodescore.shouldUpdate = false; // this needs to be placed post renderView call\n    }\n    let mainViewOutput = jsxOutput;\n    return mainViewOutput;\n    // console.log('rendering view stack', {mainView, otherViews, mainViewOutput, decoratorsJSX:decoratorViewsOutput});\n    // windoww.debbugg = {mainViewOutput,otherViews, ret:<>renderrr{mainViewOutput}{otherViews}</>}\n    // return this.props.data?.className === \"DValue\" ? <div>{mainView.jsxString}{mainViewElement}</div> : mainViewElement;\n  }\n  renderView(props, v, nodeType, classes, styleoverride, otherViews, mainviewid) {\n    var _props$node5;\n    let subViewsID = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : [];\n    let dv = v.__raw;\n    const nid = props.nodeid;\n    const vid = v.id;\n    const tnv = transientProperties.node[nid].viewScores[vid];\n    let ud = tnv.usageDeclarations;\n    /*if (false && !ud) {\r\n        this.forceUpdate();\r\n        return <div>Loading...</div>;\r\n    }*/\n\n    if (!ud) tnv.usageDeclarations = ud = computeUsageDeclarations(this, props, this.state, v);\n    //console.log(\"renderView\", {dv, tnv, ud});\n\n    if (ud.__invalidUsageDeclarations) {\n      var _this$props$data21, _this$props$node6;\n      console.error(\"renderView error ud:\", {\n        dv,\n        tnv,\n        ud\n      });\n      return GraphElementComponent.displayError(ud.__invalidUsageDeclarations, \"Usage Declaration \" + (ud.__invalidUsageDeclarations.isSyntax ? \"Syntax\" : \"Semantic\"), v.__raw, (_this$props$data21 = this.props.data) === null || _this$props$data21 === void 0 ? void 0 : _this$props$data21.__raw, (_this$props$node6 = this.props.node) === null || _this$props$node6 === void 0 ? void 0 : _this$props$node6.__raw, false, {\n        ud\n      });\n    }\n    let isMainView = !!otherViews;\n    const context = this.getJSXContext(vid);\n    if (isMainView) context.decorators = otherViews;\n    let rnode;\n    try {\n      rnode = this.getTemplate3(vid, v, context);\n    } catch (e) {\n      var _this$props$data22, _this$props$node7;\n      console.error(\"renderView error get template:\", {\n        e,\n        dv,\n        tnv\n      });\n      // rnode = undefined as any;\n      // todo: move in reducer parser of jsx: catch (e: any) { return GraphElementComponent.displayError(e, \"JSX Syntax\", v.__raw, this.props.data?.__raw, this.props.node?.__raw); }\n      rnode = GraphElementComponent.displayError(e, \"JSX Semantic\", v.__raw, (_this$props$data22 = this.props.data) === null || _this$props$data22 === void 0 ? void 0 : _this$props$data22.__raw, (_this$props$node7 = this.props.node) === null || _this$props$node7 === void 0 ? void 0 : _this$props$node7.__raw, false, {\n        context\n      });\n    }\n    let rawRElement = UX.ReactNodeAsElement(rnode);\n\n    // \\console.log('GE render', {thiss: this, data:me, rnode, rawRElement, props:this.props, name: (me as any)?.name});\n\n    function makeItArray(val) {\n      return val ? [] : Array.isArray(val) ? val : [val];\n    }\n    function getNodeText(node) {\n      if (['string', 'number'].includes(typeof node)) return node;\n      if (node instanceof Array) return node.map(getNodeText).join('');\n      if (typeof node === 'object' && node) return getNodeText(node.props.children);\n    }\n    const addprops = true;\n    let fiximport = !!this.props.node;\n    //let a: false = true as any; if (a) return \"Loading...\";\n    // if (this.props.data?.name === \"Concept 1\") console.log(\"shouldcomponentupdate rendering \" + this.props.data?.name, {cc: this.props.data.clonedCounter, attrs: (this.props.data as any).attributes});\n    if (addprops && rawRElement && fiximport) {\n      if (windoww.debugcount && debugcount++ > windoww.debugcount) throw new Error(\"debug triggered stop\");\n      let fixdoubleroot = true;\n      // add view props to GraphElement children (any level down)\n      const subElements = {}; // this.props.getGVidMap();\n      try {\n        let viewStyle = {\n          ...(this.props.style || {})\n        };\n        /*\r\n            if (view.adaptWidth) viewStyle.width = view.adaptWidth; // '-webkit-fill-available';\r\n            else viewStyle.height = (rootProps.view.height) && rootProps.view.height + 'px';\r\n            if (view.adaptHeight) viewStyle.height = view.adaptHeight; //'fit-content'; // '-webkit-fill-available'; if needs to actually fill all it's not a vertex but a field.\r\n            else viewStyle.width = (rootProps.view.width) && rootProps.view.width + 'px';\r\n            viewStyle = {};\r\n        */\n        // viewStyle.pointerEvents = \"all\";\n        let injectProps = {};\n        if (isMainView) {\n          var _props$node, _props$node2, _props$node3;\n          viewStyle.order = viewStyle.zIndex = (_props$node = props.node) === null || _props$node === void 0 ? void 0 : _props$node.zIndex; // alias? this.props.node.z\n          viewStyle.display = v === null || v === void 0 ? void 0 : v.display;\n          const me = props.data; // this.props.model;\n          if (countRenders) {\n            classes.push(this.countRenders % 2 ? \"animate-on-update-even\" : \"animate-on-update-odd\");\n          } /// let excludeProps = ['data', 'node', 'view', 'children', ]\n          classes.push(\"mainView\", dv.id);\n          classes.push(...subViewsID);\n          injectProps = {\n            ref: this.html,\n            // damiano: ref html viene settato correttamente a tutti tranne ad attribute, ref, operation (è perchè iniziano con <Select/> as root?)\n            id: props.nodeid,\n            \"data-nodeid\": props.nodeid,\n            \"data-dataid\": me === null || me === void 0 ? void 0 : me.id,\n            \"data-viewid\": dv.id,\n            \"data-modelname\": (me === null || me === void 0 ? void 0 : me.className) || \"model-less\",\n            \"data-userselecting\": JSON.stringify(((_props$node2 = props.node) === null || _props$node2 === void 0 ? void 0 : _props$node2.isSelected) || {}),\n            \"data-nodetype\": nodeType,\n            // \"data-order\": this.props.node?.zIndex,\n            style: {\n              ...viewStyle,\n              ...styleoverride\n            },\n            className: classes.join(' '),\n            onClick: this.onClick,\n            onContextMenu: this.onContextMenu,\n            onMouseDown: this.onMouseDown,\n            onMouseUp: this.onMouseUp,\n            onMouseMove: this.onMouseMove,\n            onKeyDown: this.onKeyDown,\n            // onKeyUp: this.onKeyUp,\n            onwheel: this.onScroll,\n            onMouseEnter: this.onEnter,\n            onMouseLeave: this.onLeave,\n            tabIndex: props.tabIndex || -1,\n            \"data-countrenders\": this.countRenders++,\n            \"data-clonedcounter\": ((_props$node3 = props.node) === null || _props$node3 === void 0 ? void 0 : _props$node3.clonedCounter) || -1\n            // decorators: otherViews,\n          };\n          let p = this.props;\n          for (let k in p) {\n            if (typeof p[k] === 'object' || typeof p[k] === 'function') continue;\n            if (!injectProps[k]) injectProps[k] = p[k];\n          }\n        } else injectProps = {\n          \"data-viewid\": v.id,\n          className: \"decorativeView \" + v.id,\n          \"data-mainview\": mainviewid\n        };\n        let debug = {};\n        injectProps.children = UX.recursiveMap(rawRElement /*.props.children*/, (rn, index, depthIndexes) => {\n          let injectOffset = this.props.isGraph && !depthIndexes[0] && !index && this.props.node;\n          //injectOffset&&console.log(\"inject offset props0:\", {injectOffset});\n          //console.log(\"inject offset props00:\", {injectOffset, ig:(this.props as any).isGraph, props:this.props, depthIndexes, index});\n          return UX.injectProp(this, rn, subElements, this.props.parentnodeid, index, depthIndexes, injectOffset);\n        });\n        /*\r\n                        debug.injectPropsOriginal = injectProps.children;\r\n                        debug.recursivemap = injectProps.children;\r\n                        debug.injectChildrensAttempt = [...injectProps.children, ...makeItArray(props.children), ...(otherViews as any[])];\r\n                        debug.rawRElement = {node:rawRElement, text: getNodeText(rawRElement)};*/\n\n        if (otherViews && false) injectProps.children = [...injectProps.children, ...makeItArray(props.children), ...otherViews];\n\n        // injectProps.children = [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)];\n        let children = makeItArray(injectProps.children); // [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)]; rawRElement.child are already in injectprops\n        // injectProps.children = [<div>{children}</div>];//[]; making any change at injectprops.children breaks it?\n        rawRElement = /*#__PURE__*/React.cloneElement(rawRElement, injectProps); //, ...children); // adding chioldrens after injectprops seems pointless\n\n        debug.rawRElementPostInjection = {\n          node: rawRElement,\n          text: getNodeText(rawRElement)\n        };\n        // rawRElement = React.cloneElement(rawRElement, {children: [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)]});\n        // console.log('rendering view stack fixing doubles', {v0:rnode, v1:rawRElement, fixed:rawRElement.props.children})\n        fixdoubleroot = false; // need to set the props to new root in that case.\n        if (fixdoubleroot) rawRElement = rawRElement.props.children;\n        // debug.rawRElementPostfixdoubleroot = {node:rawRElement, text: getNodeText(rawRElement)};\n        // console.log(\"probem\", {rawRElement, children:(rawRElement as any)?.children, pchildren:(rawRElement as any)?.props?.children});\n      } catch (e) {\n        var _props$data, _props$node4;\n        console.error(\"renderView error inject props:\", {\n          e,\n          dv,\n          tnv\n        });\n        rawRElement = DV.errorView(\"error while injecting props to subnodes\\n:\" + (e.message || '').split('\\n')[0], {\n          e,\n          rawRElement,\n          key: props.key,\n          newid: props.nodeid\n        }, 'Subelement props', (_props$data = props.data) === null || _props$data === void 0 ? void 0 : _props$data.__raw, (_props$node4 = props.node) === null || _props$node4 === void 0 ? void 0 : _props$node4.__raw, dv);\n        /*\r\n        rawRElement = U.eval InContextAndScope<ReactElement>('()=>{ return ' +\r\n            DV.errorView(\"error while injecting props to subnodes\",\r\n                {e, rawRElement, key:this.props.key, newid: this.props.nodeid}) + '}',\r\n            {});*/\n\n        // rawRElement = DV.errorView(\"error while injecting props to subnodes\", {e, rawRElement, key:this.props.key, newid: this.props.nodeid});\n      }\n      /*console.log('tempdebug', {deepStrictEqual, okeys:Object.keys});\r\n      let isEqual = true;\r\n      try {deepStrictEqual(subElements, this.props.node.subElements)} catch(e) { isEqual = false; }\r\n      if (isEqual) {\r\n          this.props.node.subElements = Object.keys(subElements);\r\n      }*/\n    }\n    // const injectprops = {a:3, b:4} as DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement>;\n    // rnode = React.cloneElement(rnode as ReactElement, injectprops);\n\n    // console.log(\"nodeee\", {thiss:this, props:this.props, node: this.props.node});\n    if (false && dv.isExclusiveView && ((_props$node5 = props.node) === null || _props$node5 === void 0 ? void 0 : _props$node5.__raw).father) {\n      let $containedIn = $('#' + props.node.__raw.father);\n      let $containerDropArea = $containedIn.find(\".VertexContainer\");\n      const droparea = $containerDropArea[0] || $containedIn[0];\n      Log.exDev(!droparea, 'invalid vertex container target', {\n        $containedIn,\n        $containerDropArea\n      });\n      if (droparea) return /*#__PURE__*/createPortal(rawRElement || rnode, droparea);\n    } /*\r\n      if (countRenders) return <>{[\r\n         rawRElement || rnode,\r\n         <div className={this.countRenders%2 ? \"animate-on-update-even\" : \"animate-on-update-odd\"} data-countrenders={this.countRenders++} />\r\n      ]}</>/*/\n\n    //console.log(\"renderView return:\", rawRElement || rnode);\n    return rawRElement || rnode;\n  }\n}, _class2.cname = void 0, _class2.all = {}, _class2.map = {}, _class2.defaultProps = GraphElementOwnProps.new(), _class2.maxid = 0, _class2.mousedownComponent = void 0, _class2)) || _class);\n\n// private\n// type AllPropss = GraphElementOwnProps & GraphElementDispatchProps & GraphElementReduxStateProps;\n\nconst GraphElementConnected = connect(GraphElementComponent.mapStateToProps, GraphElementComponent.mapDispatchToProps)(GraphElementComponent);\nexport const GraphElement = function (props) {\n  let children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return /*#__PURE__*/_jsxDEV(GraphElementConnected, {\n    ...props,\n    children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1232,\n    columnNumber: 12\n  }, _this);\n};\n// console.info('graphElement loaded');\n_c = GraphElement;\nGraphElementComponent.cname = \"GraphElementComponent\";\nGraphElementConnected.cname = \"GraphElementConnected\";\nGraphElement.cname = \"GraphElement\";\nvar _c;\n$RefreshReg$(_c, \"GraphElement\");","map":{"version":3,"names":["React","Component","createPortal","connect","Point","Pointers","TRANSACTION","GraphPoint","Selectors","LGraphElement","store","CreateElementAction","DClass","Debug","DEdge","DEnumerator","DGraph","DGraphElement","DModel","DObject","DPackage","DPointerTargetable","DUser","DV","EMeasurableEvents","GraphElementOwnProps","GraphElementReduxStateProps","JSXT","Keystrokes","Log","LPointerTargetable","MyProxyHandler","RuntimeAccessible","SetFieldAction","SetRootFieldAction","U","UX","windoww","transientProperties","NodeTransientProperties","jsxDEV","_jsxDEV","computeUsageDeclarations","component","allProps","state","lview","udret","__notInitialized","view","__raw","vid","id","constants","UDEvalContext","usageDeclarations","undefined","stateProps","props","ownProps","data","node","UDFunction","call","e","isSyntax","__invalidUsageDeclarations","ee","str","nodeid","viewScores","debugcount","maxRenderCounter","Number","POSITIVE_INFINITY","lightModeAllowedElements","cname","getScores","ret","getAppliedViewsNew","nid","pv","parentViewId","from","countRenders","GraphElementComponent","_dec","_class","_class2","defaultShouldComponentUpdate","instance","nextProps","nextState","nextContext","shallowEqual","mapViewStuff","_tn$validMainViews","_tn$mainView","_ownProps$view","_ret$node","_ret$node$father","_ret$node2","parentviewid","explicitView","explicitViews","views","scores","tn","idorname","mainView","fromD","getViewByIDOrNameD","_scores$mainView","_ret$view","fromPointer","w","name","requested","validMainViews","vname","pview","father","ex","v","push","ww","stackViews","fromArr","map","filter","viewsid","viewid","dnode","mapLModelStuff","dataid","wrap","mapLGraphElementStuff","dGraphElementDataClass","arguments","length","isDGraph","graphid","parentnodeid","graph","new","pendingCreation","dge","_ret$data","edgeOwnProps","edgeStateProps","startnodeid","getNodeId","start","endnodeid","end","propsStart","propsEnd","longestLabel","label","labels","ddata","new2","d","isReference","isValue","className","isDependency","isDepencency","isExtend","onDelete","zIndex","htmlindex","anchorStart","anchorEnd","edge","_ret$data2","initialSize","ta","modelElement","nodes","mapStateToProps","dGraphDataClass","startingobj","lightMode","includes","exDev","reduxProps","key","forceupdate","removeEmptyObjectKeys","mapDispatchToProps","dispatch","shouldComponentUpdate","oldProps","_nextProps$data","__skipRender","debug","out","reason","skipDeepKeys","pointedBy","clonedCounter","nodeviewentry","old_ud","new_ud","shouldUpdate","isShallowEqualWithProxies","shouldUpdate_reason","shouldUpdate_reasonDebug","l","doMeasurableEvent","type","measurableFunc","context","getJSXContext","console","log","transient","message","select","forUser","_this$props$node","_this$props$data","constructor","_isMounted","html","lastViewChanges","lastOnUpdateChanges","stopUpdateEvents","dataOldClonedCounter","maxid","all","createRef","functionsToBind","onClick","onLeave","onEnter","doContextMenu","onContextMenu","onMouseDown","onMouseUp","onKeyDown","onScroll","onMouseMove","f","bind","classes","componentDidMount","componentWillUnmount","evalContext","tnv","tv","otherViews","_context","displayError","where","asString","printData","errormsg","split","indexOf","jsxString","stack","stackerrorlast","icol","lastIndexOf","irow","offset","row","col","stackerrorlinenum","parseInt","substring","linesPre","linesPost","jsxlines","culpritlinesPre","slice","culpritline","culpritlinesPost","error","caretCursor","rowPre","rowPost","jsxcode","style","fontFamily","color","children","fileName","_jsxFileName","lineNumber","columnNumber","errorView_string","template","errorView","e2","eDevv","getTemplate3","getTemplate3_","jsxOutput","JSXFunction","isValidElement","JSON","stringify","getTemplate2","udContext","jsxCodeString","fromString","factory","_this$props$data2","_this$props$node2","parsedFunc","parseFunctionWithContextAndScope","_this$props$data3","_this$props$node3","preventDefault","stopPropagation","_state$contextMenu","current","focus","getState","contextMenu","x","clientX","_this$props$node4","display","y","clientY","_this$props$isEdgePen","_this$props$data4","isEdgePending","source","extendError","allTargetSuperClasses","canBeExtend","canExtend","setState","_this$props$data5","classname","isStoppedEvt","mousedownComponent","button","clickRight","p","ig","isGraph","iv","isVertex","scroll","currentTarget","scrollLeft","scrollTop","scrollOrigin","nativeEvent","offsetX","offsetY","g","oldZoom","zoom","newZoom","oldOffset","gscrollOrigin","add","multiply","newscrollOrigin","newOffset","subtract","frommousemove","doOnClick","_this$props$data6","m","target","tagName","toLowerCase","getAttribute","escape","deselect","isDelete","delete","shiftKey","_this$props$data7","duplicate","isEdge","de","unsetExtends","model","ref","lval","remove","ctrlKey","_this$props$data8","_this$props$data9","_this$props$data10","_this$props$data11","_this$props$data12","_this$props$data13","_this$props$data14","_this$props$data15","_this$props$data16","_this$props$data17","addChild","_state$contextMenu2","_this$props$isEdgePen2","edgePendingSource","_this$props$data18","lClass","user","_state$_lastSelected","toggleSelected","_lastSelected","_this$props$data19","_this$props$node5","allNodes","allSubNodes","onDataUpdateMeasurable","index","onDataUpdate","_this$lastOnUpdateCha","thischange","t","Date","now","_this$lastOnUpdateCha2","change_log","timediff","updateNodeFromProps","updateNodeFromProps0","ptr","dedge","todoremovethis","old","n","h","width","height","render","_this$props$data20","nodeType","styleoverride","allviews","i","viewnodescore","isSelected","Object","keys","arrayMergeInPlace","Array","isArray","class","decoratorViewsOutput","isMain","renderView","mainViewOutput","mainviewid","_props$node5","subViewsID","dv","ud","_this$props$data21","_this$props$node6","isMainView","decorators","rnode","_this$props$data22","_this$props$node7","rawRElement","ReactNodeAsElement","makeItArray","val","getNodeText","join","addprops","fiximport","Error","fixdoubleroot","subElements","viewStyle","injectProps","_props$node","_props$node2","_props$node3","order","me","onwheel","onMouseEnter","onMouseLeave","tabIndex","k","recursiveMap","rn","depthIndexes","injectOffset","injectProp","cloneElement","rawRElementPostInjection","text","_props$data","_props$node4","newid","isExclusiveView","$containedIn","$","$containerDropArea","find","droparea","defaultProps","GraphElementConnected","GraphElement","_this","_c","$RefreshReg$"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/frontend/src/graph/graphElement/graphElement.tsx"],"sourcesContent":["import React, {Component, Dispatch, PureComponent, ReactElement, ReactNode,} from \"react\";\r\nimport {createPortal} from \"react-dom\";\r\nimport {connect} from \"react-redux\";\r\nimport './graphElement.scss';\r\nimport type {EdgeOwnProps} from \"./sharedTypes/sharedTypes\";\r\nimport {\r\n    GraphSize,\r\n    LGraph, MouseUpEvent, Point,\r\n    Pointers,\r\n    Selectors as Selectors_, Size, TRANSACTION, WGraph,\r\n    GraphDragManager, GraphPoint, Selectors, DNamedElement, DVoidEdge, LEdge, LPackage, LReference, LVoidEdge, LValue\r\n} from \"../../joiner\";\r\nimport {DefaultUsageDeclarations} from \"./sharedTypes/sharedTypes\";\r\n\r\nimport {EdgeStateProps, LGraphElement, store, VertexComponent,\r\n    CreateElementAction, DClass, Debug,\r\n    DEdge, DEnumerator,\r\n    DGraph,\r\n    DGraphElement,\r\n    Dictionary, DModel,\r\n    DModelElement, DObject,\r\n    DocString, DPackage,\r\n    DPointerTargetable,\r\n    DState,\r\n    DUser,\r\n    DV,\r\n    DViewElement,\r\n    EMeasurableEvents,\r\n    GObject,\r\n    GraphElementDispatchProps,\r\n    GraphElementOwnProps,\r\n    GraphElementReduxStateProps,\r\n    GraphElementStatee,\r\n    InOutParam,\r\n    JSXT, Keystrokes,\r\n    LClass,\r\n    LModelElement,\r\n    Log,\r\n    LPointerTargetable,\r\n    LViewElement,\r\n    MyProxyHandler,\r\n    Overlap,\r\n    Pointer,\r\n    RuntimeAccessible,\r\n    RuntimeAccessibleClass,\r\n    SetFieldAction,\r\n    SetRootFieldAction,\r\n    U,\r\n    UX,\r\n    windoww, transientProperties\r\n} from \"../../joiner\";\r\nimport {NodeTransientProperties, Pack1} from \"../../joiner/classes\";\r\n\r\n// const Selectors: typeof Selectors_ = windoww.Selectors;\r\n/*\r\nexport function makeEvalContext(view: LViewElement, state: DState, ownProps: GraphElementOwnProps, stateProps: GraphElementReduxStateProps): GObject {\r\n    let component = GraphElementComponent.map[ownProps.nodeid as Pointer<DGraphElement>];\r\n    let allProps = {...ownProps, ...stateProps};\r\n    let parsedConstants = stateProps.view._parsedConstants;\r\n    let evalContext: GObject = {\r\n        model: stateProps.data,\r\n        ...ownProps,\r\n        ...stateProps,\r\n        edge: (RuntimeAccessibleClass.extends(stateProps.node?.className, \"DVoidEdge\") ? stateProps.node : undefined),\r\n        state,\r\n        ownProps,\r\n        stateProps,\r\n        props: allProps,\r\n        component,\r\n        constants: parsedConstants,\r\n        // getSize:vcomponent?.getSize, setSize: vcomponent?.setSize,\r\n        ...parsedConstants,\r\n        // ...stateProps.usageDeclarations, NOT because they are not evaluated yet. i need a basic eval context to evaluate them\r\n    };\r\n    evalContext.__proto__ = windoww.defaultContext;\r\n    transientProperties.node[ownProps.nodeid as string].evalContext = evalContext;\r\n    return evalContext;\r\n}\r\n\r\nfunction setTemplateString(stateProps: InOutParam<GraphElementReduxStateProps>, ownProps: Readonly<GraphElementOwnProps>, state: DState): void {\r\n    //if (!jsxString) { this.setState({template: this.getDefaultTemplate()}); return; }\r\n    // sintassi: '||' + anything + (opzionale: '|' + anything)*N_Volte + '||' + jsx oppure direttamente: jsx\r\n    const view: LViewElement = stateProps.view; //data._transient.currentView;\r\n    // eslint-disable-next-line no-mixed-operators\r\n    const evalContext = makeEvalContext(view, state, ownProps, stateProps);\r\n    // Log.exDev(!evalContext.data, \"missing data\", {evalContext, ownProps, stateProps});\r\n\r\n    // const evalContextOld = U.evalInContext(this, constants);\r\n    // this.setState({evalContext});\r\n\r\n}*/\r\n\r\nfunction computeUsageDeclarations(component: GraphElementComponent, allProps: AllPropss, state: GraphElementStatee, lview: LViewElement): GObject {\r\n    // compute usageDeclarations\r\n    let udret: GObject = {__notInitialized: true};\r\n    const view: DViewElement = lview.__raw;\r\n    const vid: Pointer<DViewElement> = view.id;\r\n    const constants = transientProperties.view[vid].constants;\r\n    let UDEvalContext: GObject = {...allProps, ...constants, constants, component,\r\n        view:lview, // data and node are inherited through props, but view needs redefinition\r\n        usageDeclarations: undefined, stateProps: allProps, props:allProps, ownProps:allProps, state}//transientProperties.node[stateProps.nodeid].evalContext;\r\n/*\r\n*\r\n        \"constants\": true, \"usageDeclarations\": true,\r\n        \"component\": true,\r\n        \"htmlindex\": true,\r\n        \"state\": true, \"stateProps\": true, \"ownProps\": true,*/\r\n    if (!view.usageDeclarations) {\r\n        udret = {data: allProps.data, view, node: allProps.node};\r\n    } else try {\r\n        transientProperties.view[vid].UDFunction.call(UDEvalContext, UDEvalContext, udret);\r\n        // console.log(\"computing usage declarations: \", {f:transientProperties.view[vid].UDFunction, udret, UDEvalContext});\r\n    } catch (e: any) {\r\n        e.isSyntax = false;\r\n        udret = {data: allProps.data, view, node: allProps.node, __invalidUsageDeclarations: e};// \"@runtime:\" +e};\r\n        Log.ee(\"Invalid usage declarations\", {e, str: view.usageDeclarations, view, data: allProps.data, stateProps: allProps});\r\n    }\r\n\r\n    transientProperties.node[allProps.nodeid].viewScores[vid].usageDeclarations = udret;\r\n    // do not merge to create jsx final context now, because if shouldcomponentupdate fails, i want to keep the OLD context for measurable events.\r\n    return udret;\r\n}\r\n\r\nlet debugcount = 0;\r\nlet maxRenderCounter = Number.POSITIVE_INFINITY;\r\nexport const lightModeAllowedElements = [DModel.cname, DPackage.cname, DClass.cname, DEnumerator.cname, DObject.cname];\r\n\r\nfunction getScores(ret: GraphElementReduxStateProps, ownProps: GraphElementOwnProps): NodeTransientProperties{\r\n    return Selectors.getAppliedViewsNew({data:ret.data, node: ret.node,\r\n        nid: ownProps.nodeid as string, pv: ownProps.parentViewId && DPointerTargetable.from(ownProps.parentViewId)});\r\n}\r\n\r\nconst countRenders = true;\r\n@RuntimeAccessible('GraphElementComponent')\r\nexport class GraphElementComponent<AllProps extends AllPropss = AllPropss, GraphElementState extends GraphElementStatee = GraphElementStatee>\r\n    extends Component<AllProps, GraphElementState>{\r\n    public static cname: string;\r\n    static all: Dictionary<number, GraphElementComponent> = {};\r\n    public static map: Dictionary<Pointer<DGraphElement>, GraphElementComponent> = {};\r\n    static defaultProps: Partial<GraphElementOwnProps> = GraphElementOwnProps.new();\r\n    static maxid: number = 0;\r\n    id: number;\r\n\r\n    public static defaultShouldComponentUpdate<AllProps extends GObject, State extends GObject, Context extends any>\r\n    (instance: React.Component, nextProps: Readonly<AllProps>, nextState: Readonly<State>, nextContext: Context) {\r\n        return (\r\n            !U.shallowEqual(instance.props, nextProps) ||\r\n            !U.shallowEqual(instance.state, nextState)\r\n        );\r\n    }\r\n\r\n    // requires data and node wrapping first\r\n    static mapViewStuff(state: DState, ret: GraphElementReduxStateProps, ownProps: GraphElementOwnProps) {\r\n        // let dnode: DGraphElement | undefined = ownProps?.nodeid && DPointerTargetable.from(ownProps.nodeid, state) as any;\r\n        // console.log(\"viewsss mapstate 3 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, vv:ret.view, ownProps, stateProps:{...ret}, thiss:this});\r\n        ret.parentviewid = ownProps.parentViewId;\r\n\r\n        const explicitView: Pack1<LViewElement> | string | undefined = ret.view || ownProps.view;\r\n        const explicitViews: (Pack1<LViewElement> | string | undefined)[] = ret.views || ownProps.views;\r\n\r\n        let scores: NodeTransientProperties = undefined as any;\r\n        let tn = transientProperties.node[ownProps.nodeid as string]; // tn === scores if getScore is called (getScore have a sideeffect)\r\n        if (!tn) transientProperties.node[ownProps.nodeid as string] = tn = new NodeTransientProperties();\r\n        if (explicitView) {\r\n            let idorname: string = Pointers.from(explicitView) || explicitView as any as string;\r\n            ret.view = tn.mainView = LPointerTargetable.fromD(Selectors.getViewByIDOrNameD(idorname, state) as DViewElement);\r\n\r\n        }\r\n        if (!ret.view) { // if view is not explicitly set or the assigned view is not found, match a new one.\r\n            if (!scores) scores = getScores(ret, ownProps);\r\n            ret.view = scores.mainView = LPointerTargetable.fromPointer((scores.mainView as any)?.id, state);\r\n            Log.w(!!explicitView, \"Requested main view \"+ownProps.view+\" not found. Another view got assigned: \" + ret.view?.__raw.name, {requested: ownProps.view, props: ownProps, state: ret});\r\n        }\r\n        if (!tn.validMainViews?.[0] || tn.validMainViews[0].id !== tn.mainView?.id) tn.validMainViews = [tn.mainView, ...(tn.validMainViews || [])];\r\n        // @ts-ignore\r\n        let vname: string = !ret.view && ownProps.view ? ' Check the manual assignment of props view={\"'+(ownProps.view?.name || ownProps.view) +'\"}' : '';\r\n        let pview: LViewElement|undefined = !ret.view ?  ret.node?.father?.view : undefined;\r\n        Log.ex(!ret.view, \"Could not find any view applicable to element.\" + vname + (pview ? ' in view \"'+pview.name+'\"' : ''),\r\n            {data:ret.data, props: ownProps, state: ret, scores: (ret as any).viewScores, nid: ownProps.nodeid, tn:transientProperties.node[ownProps.nodeid as any]});\r\n\r\n        if (explicitViews){\r\n            // ret.views = tn.stackViews = LPointerTargetable.fromArr(explicitView);\r\n            let views: LViewElement[] = [];\r\n            for (let v of explicitViews) {\r\n                let idorname: string = Pointers.from(v as DViewElement) || v as any as string;\r\n                let view: LViewElement = LPointerTargetable.fromD(Selectors.getViewByIDOrNameD(idorname, state) as DViewElement);\r\n                if (view) views.push(view);\r\n                else Log.ww(\"Requested decorative view \"+v+\" not found.\", {requested: v, idorname, props: ownProps, state: ret});\r\n            }\r\n            ret.views = tn.stackViews = views;\r\n        }\r\n        if (!ret.views) {\r\n            // if views is not explicitly set. (if some are not found, they are just missing by choice, will not replace)\r\n            if (!scores) {\r\n                scores = getScores(ret, ownProps);\r\n                ret.views = scores.stackViews;\r\n            }\r\n            else ret.views = scores.stackViews = LPointerTargetable.fromArr((scores.stackViews||[]).map((v:LViewElement)=>v?.id).filter(vid=>!!vid));\r\n        }\r\n        // console.log(\"viewsss mapstate 4 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps: {...ret}, thiss:this});\r\n\r\n\r\n        ret.viewsid = Pointers.fromArr(ret.views) as Pointer<DViewElement>[];\r\n        ret.viewid = ret.view.id;\r\n\r\n        let dnode = ret.node?.__raw;\r\n        if (dnode) dnode.view = ret.viewid;\r\n        (ret as any).viewScores = tn; // debug only\r\n    }\r\n\r\n    static mapLModelStuff(state: DState, ownProps: GraphElementOwnProps, ret: GraphElementReduxStateProps): void {\r\n        // NB: Edge constructor might have set it from props.start, so keep the check before overwriting.\r\n        if (typeof ownProps.data === \"object\") { ret.dataid = (ownProps.data as any).id; }\r\n        else ret.dataid = ownProps.data as string | undefined;\r\n        ret.data = LPointerTargetable.wrap(ret.dataid) // forcing re-wrapping even if props was a dobject or lobject, because i want to get the latest version of it.\r\n\r\n        /*\r\n        const meid: string = (typeof ownProps.data === 'string' ? ownProps.data as string : (ownProps.data as any as DModelElement)?.id) as string;\r\n        // Log.exDev(!meid, \"model element id not found in GE.mapstatetoprops\", {meid, ret, ownProps, state});\r\n        ret.data = MyProxyHandler.wrap(meid, state);\r\n        // Log.ex(!ret.data, \"can't find model data:\", {meid, state, ownpropsdata:ownProps.data, ownProps});\r\n        */\r\n    }\r\n\r\n\r\n    static mapLGraphElementStuff(state: DState,\r\n                                 ownProps: GraphElementOwnProps,\r\n                                 ret: GraphElementReduxStateProps,\r\n                                 dGraphElementDataClass: typeof DGraphElement = DGraphElement,\r\n                                 isDGraph?: DGraph): void {\r\n        let nodeid: string = ownProps.nodeid as string;\r\n        let graphid: string = isDGraph ? isDGraph.id : ownProps.graphid as string;\r\n        let parentnodeid: string = ownProps.parentnodeid as string;\r\n        ret.nodeid = nodeid;\r\n        let tn = transientProperties.node[nodeid];\r\n        if (!tn) tn = transientProperties.node[nodeid] = new NodeTransientProperties();\r\n        // let data: Pointer<DModelElement, 0, 1, LModelElement> = ownProps.data || null;\r\n        // Log.exDev(!nodeid || !graphid, 'node id injection failed', {ownProps, data: ret.data, name:(ret.data as any)?.name || (ret.data as any)?.className}); /*\r\n        /*if (!nodeid) {\r\n            nodeid = 'nodeof_' + stateProps.data.id + (stateProps.view.storeSize ? '_' + stateProps.view.id : '') + '_1';\r\n            stateProps.nodeid = U.increaseEndingNumber(nodeid, false, false, id => !DPointerTargetable.from(id, state));\r\n            todo: quando il componente si aggiorna questo viene perso, come posso rendere permanente un settaggio di reduxstate in mapstatetoprops? o devo metterlo nello stato normale?\r\n        }*/\r\n\r\n        let graph: DGraph = DPointerTargetable.from(graphid, state) as DGraphElement as any; // se non c'è un grafo lo creo\r\n        if (!graph) {\r\n            // Log.exDev(!dataid, 'attempted to make a Graph element without model', {dataid, ownProps, ret, thiss:this});\r\n            if (ret.data) CreateElementAction.new(DGraph.new(0, ret.data.id, parentnodeid, graphid, graphid)); }\r\n        /*else {\r\n            graph = MyProxyHandler.wrap(graph);\r\n            Log.exDev(graph.__raw.className !== \"DGraph\", 'graph class is wrong', {graph: ret.graph, ownProps});\r\n        }*/\r\n        let dnode: DGraphElement = DPointerTargetable.from(nodeid, state) as DGraphElement;\r\n\r\n        // console.log('dragx GE mapstate addGEStuff', {dGraphElementDataClass, created: new dGraphElementDataClass(false, nodeid, graphid)});\r\n        if (!dnode && !DPointerTargetable.pendingCreation[nodeid]) {\r\n            /*\r\n            console.log(\"making node:\", {dGraphElementDataClass, nodeid, parentnodeid, graphid, dataid, ownProps, ret,\r\n                pendings: {...DPointerTargetable.pendingCreation}, pending:DPointerTargetable.pendingCreation[nodeid]});*/\r\n            // so this is called once, but createaction is triggered twice only for edgepoints? it works if i create it through console.\r\n            let dge;\r\n            /*\r\n            if (dGraphElementDataClass === DEdgePoint) { // made it same as dvertex\r\n                let initialSize = ownProps.initialSize;\r\n                dge = DEdgePoint.new(ownProps.htmlindex as number, dataid, parentnodeid, graphid, nodeid, initialSize);\r\n                ret.node =  MyProxyHandler.wrap(dge);\r\n            } else*/\r\n            if (dGraphElementDataClass === DEdge) {\r\n                // set start and end from ownprops;\r\n                let edgeOwnProps: EdgeOwnProps = ownProps as EdgeOwnProps;\r\n                let edgeStateProps: EdgeStateProps = ret as EdgeStateProps;\r\n                let startnodeid = LGraphElement.getNodeId(edgeOwnProps.start);\r\n                let endnodeid = LGraphElement.getNodeId(edgeOwnProps.end);\r\n                if (!startnodeid) {\r\n                    startnodeid = LGraphElement.getNodeId(ret.data);\r\n                }\r\n                edgeStateProps.start = LPointerTargetable.fromPointer(startnodeid)\r\n                edgeStateProps.end = LPointerTargetable.fromPointer(endnodeid);\r\n                Log.e(!startnodeid, \"Cannot create an edge without start node\", {startnodeid, data:ret.data, propsStart:edgeOwnProps.start});\r\n                Log.e(!endnodeid, \"Cannot create an edge without end node (yet)\", {endnodeid, data:ret.data, propsEnd:edgeOwnProps.end});\r\n                if (!startnodeid || !endnodeid) return;\r\n                let longestLabel = edgeOwnProps.label;\r\n                let labels = edgeOwnProps.labels;\r\n                // dge = DEdge.new(ownProps.htmlindex as number, ret.data?.id, parentnodeid, graphid, nodeid, startnodeid, endnodeid, longestLabel, labels);\r\n                let ddata = ret.data?.__raw;\r\n                dge = DEdge.new2(ddata?.id, parentnodeid, graphid, nodeid, startnodeid, endnodeid, (d: DEdge)=>{\r\n                    //d.longestLabel = longestLabel;\r\n                    //d.labels = labels;\r\n                    d.isReference = !!edgeOwnProps.isReference;\r\n                    if (edgeOwnProps.isValue !== undefined) d.isValue = !!edgeOwnProps.isValue;\r\n                    else d.isValue = !!(d.isReference && ddata && ddata.className === 'DValue');\r\n                    if (d.isValue) d.isReference = false;\r\n                    d.isDependency = !!edgeOwnProps.isDepencency;\r\n                    d.isExtend = !!edgeOwnProps.isExtend;\r\n                    let tn = (transientProperties.node[nodeid]);\r\n                    if (!tn) transientProperties.node[nodeid] = new NodeTransientProperties();\r\n                    tn.onDelete = edgeOwnProps.onDelete;\r\n                    tn.labels = labels;\r\n                    tn.longestLabel = longestLabel;\r\n                    d.zIndex = edgeOwnProps.htmlindex || 1;\r\n                    if (edgeOwnProps.anchorStart) d.anchorStart = edgeOwnProps.anchorStart;\r\n                    if (edgeOwnProps.anchorEnd) d.anchorEnd = edgeOwnProps.anchorEnd;\r\n                });\r\n                edgeStateProps.node = edgeStateProps.edge = MyProxyHandler.wrap(dge);\r\n            }\r\n            else {\r\n                let initialSize = ownProps.initialSize;\r\n                dge = dGraphElementDataClass.new(ownProps.htmlindex as number, ret.data?.id, parentnodeid, graphid, nodeid, initialSize);\r\n                if (!tn) transientProperties.node[nodeid] = new NodeTransientProperties();\r\n                tn.onDelete = ownProps.onDelete;\r\n                ret.node =  MyProxyHandler.wrap(dge);\r\n            }\r\n            // console.log(\"map ge2\", {nodeid: nodeid+'', dge: {...dge}, dgeid: dge.id});\r\n        }\r\n        else {\r\n            ret.node = MyProxyHandler.wrap(dnode);\r\n            if (dGraphElementDataClass === DEdge) (ret as EdgeStateProps).edge = ret.node as any;\r\n        }\r\n\r\n\r\n        if (ret.dataid) {\r\n            // set up transient model-> node map\r\n            let ta = transientProperties.modelElement[ret.dataid];\r\n            if (!ta) transientProperties.modelElement[ret.dataid] = {nodes: {}} as any;\r\n            ta.nodes[ownProps.nodeid as string] = ret.node;\r\n            ta.node = ret.node;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    ////// mapper func\r\n    static mapStateToProps(state: DState, ownProps: GraphElementOwnProps, dGraphDataClass: (typeof DGraphElement | typeof DEdge) = DGraphElement, startingobj?: GObject): GraphElementReduxStateProps {\r\n        // console.log('dragx GE mapstate', {dGraphDataClass});\r\n        let ret: GraphElementReduxStateProps = (startingobj || GraphElementReduxStateProps.new()) as GraphElementReduxStateProps; // NB: cannot use a constructor, must be pojo\r\n        // console.log(\"viewsss mapstate 0 \" + ownProps.view + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\r\n\r\n        GraphElementComponent.mapLModelStuff(state, ownProps, ret);\r\n        if (Debug.lightMode && (!ret.data || !(lightModeAllowedElements.includes(ret.data.className)))){\r\n            return ret;\r\n        }\r\n        // console.log(\"map ge\", {ownProps, ret, state});\r\n        GraphElementComponent.mapLGraphElementStuff(state, ownProps, ret, dGraphDataClass);\r\n        // console.log(\"viewsss mapstate 2 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\r\n\r\n        GraphElementComponent.mapViewStuff(state, ret, ownProps);\r\n        // console.log(\"viewsss mapstate 5 \" + ret.node?.className + \" \" + ret.data?.name, {views:ret.views, ownProps, stateProps:{...ret}, thiss:this});\r\n\r\n        Log.exDev(!ret.view || !ret.views, 'failed to assign view:', {state, ownProps, reduxProps: ret});\r\n        // @ts-ignore\r\n        ret.key = ret.key || ownProps.key;\r\n        // @ts-ignore\r\n        ret.forceupdate = state.forceupdate;\r\n\r\n        // Log.l((ret.data as any)?.name === \"concept 1\", \"mapstatetoprops concept 1\", {newnode: ret.node});\r\n        U.removeEmptyObjectKeys(ret);\r\n        return ret;\r\n    }\r\n\r\n    static mapDispatchToProps(dispatch: Dispatch<any>): GraphElementDispatchProps {\r\n        const ret: GraphElementDispatchProps = {} as any;\r\n        return ret;\r\n    }\r\n\r\n\r\n    countRenders: number;\r\n    _isMounted: boolean;\r\n    html: React.RefObject<HTMLElement | undefined>;\r\n    lastViewChanges: {t: number, vid: Pointer<DViewElement>, v: LViewElement, key?: string}[];\r\n    lastOnUpdateChanges: {t: number}[];\r\n    stopUpdateEvents?: number; // undefined or view.clonedCounter;\r\n    dataOldClonedCounter?: number; // undefined or data.clonedCounter;\r\n\r\n    public shouldComponentUpdate(nextProps: Readonly<AllProps>, nextState: Readonly<GraphElementState>, nextContext: any, oldProps?: Readonly<AllProps>): boolean {\r\n        if (!oldProps) oldProps = this.props;//for subviewcomponent\r\n        if (nextProps.__skipRender) return true;\r\n        let debug = false;\r\n        // return GraphElementComponent.defaultShouldComponentUpdate(this, nextProps, nextState, nextContext);\r\n        let data = nextProps.data?.__raw as DNamedElement | undefined;\r\n\r\n        let out = {reason:undefined};\r\n        let skipDeepKeys = {pointedBy:true, clonedCounter: true};// clonedCounter is checked manually before looping object keys\r\n        // let skipPropKeys = {...skipDeepKeys, usageDeclarations: true, node:true, data:true, initialSize: true};\r\n        let ret = false; // !U.isShallowEqualWithProxies(oldProps, nextProps, 0, 1, skipPropKeys, out);\r\n        // if node and data in props must be ignored and not checked for changes. but they are checked if present in usageDeclarations\r\n        let component = nextProps.node.component;\r\n        const nid = nextProps.nodeid;\r\n        // U.arrayDiff()\r\n        for (let v of nextProps.views) {\r\n            const vid: Pointer<DViewElement> = v.__raw.id;\r\n            let nodeviewentry = transientProperties.node[nid].viewScores[vid];\r\n            let old_ud = nodeviewentry.usageDeclarations;\r\n            computeUsageDeclarations(component, nextProps, nextState, v);\r\n            let new_ud = nodeviewentry.usageDeclarations;\r\n            nodeviewentry.shouldUpdate = !U.isShallowEqualWithProxies(old_ud, new_ud, skipDeepKeys, out);\r\n\r\n            nodeviewentry.shouldUpdate_reason = {...out};\r\n            (nodeviewentry as any).shouldUpdate_reasonDebug = {old_ud, new_ud};\r\n            Log.l(debug, \"DECORATIVE_VIEW ShouldComponentUpdate \" + data?.name + (nodeviewentry.shouldUpdate ? \" UPDATED \" : \" REJECTED \")  + vid,\r\n                {ret:nodeviewentry.shouldUpdate, reason: out.reason, old_ud, new_ud, oldProps:oldProps, nextProps, vid});\r\n\r\n            if (!ret && nodeviewentry.shouldUpdate) ret = true;\r\n        }\r\n\r\n        const vid: Pointer<DViewElement> = nextProps.view.__raw.id;\r\n        let nodeviewentry = transientProperties.node[nextProps.nodeid].viewScores[vid];\r\n        let old_ud = nodeviewentry.usageDeclarations;\r\n        computeUsageDeclarations(component, nextProps, nextState, nextProps.view);\r\n        let new_ud = nodeviewentry.usageDeclarations;\r\n        nodeviewentry.shouldUpdate = !U.isShallowEqualWithProxies(old_ud, new_ud,  skipDeepKeys, out);\r\n        nodeviewentry.shouldUpdate_reason = {...out};\r\n        (nodeviewentry as any).shouldUpdate_reasonDebug = {old_ud, new_ud};\r\n\r\n        Log.l(debug, \"ShouldComponentUpdate \" + data?.name + (nodeviewentry.shouldUpdate ? \" UPDATED \" : \" REJECTED \") + vid,\r\n            {ret:nodeviewentry.shouldUpdate, reason: out.reason, old_ud, new_ud, oldProps:oldProps, nextProps});\r\n        if (!ret && nodeviewentry.shouldUpdate) ret = true;\r\n        return ret; // if any of main view or decorative views need updating\r\n        // apparently node changes are not working? also check docklayout shouldupdate\r\n    }\r\n\r\n    protected doMeasurableEvent(type: EMeasurableEvents, vid: Pointer<DViewElement>): boolean {\r\n        if (Debug.lightMode) return false;\r\n        let measurableFunc: undefined | ((context:GObject)=>void) = (transientProperties.view[vid] as any)[type];\r\n        if (!measurableFunc) return false;\r\n        let context: GObject = this.getJSXContext(vid); // context + usagedeclarations of main view only\r\n        try {\r\n            measurableFunc.call(context, context);\r\n            console.log(\"measurable executed\", {type, measurableFunc, vid, transient:transientProperties.view[vid]});\r\n        }\r\n        catch (e: any) { Log.ee('Error in measurable \"'+type+'\" ' + e.message, {e, measurableFunc, context}); }\r\n        // it has executed at least partially.\r\n        // i just need to know if he had the chance to do side-effects and the answer is yes regardless of exceptions\r\n        return true;\r\n    }\r\n\r\n\r\n\r\n    select(forUser?: Pointer<DUser>): void {\r\n        // if (forUser === DUser.current && this.html.current) this.html.current.focus();\r\n        TRANSACTION('selection', ()=>{\r\n            this.props.node?.select(forUser);\r\n            SetRootFieldAction.new('_lastSelected', {\r\n                node: this.props.nodeid,\r\n                view: this.props.view.id,\r\n                modelElement: this.props.data?.id\r\n            }, (this.props.data as any).name);/*\r\n        // ? why this?\r\n        const id = this.props.data?.id;\r\n        if (id) {\r\n            //selected[forUser] = id;\r\n            SetRootFieldAction.new('selected', id, '', true);\r\n        }*/\r\n\r\n            // SetRootFieldAction.new(`selected.${DUser.current}`, nodeid, '', true);\r\n        })\r\n    }\r\n\r\n    constructor(props: AllProps, context: any) {\r\n        super(props, context);\r\n        this.lastViewChanges = [];\r\n        this.lastOnUpdateChanges = []\r\n        this.stopUpdateEvents = undefined;\r\n        this._isMounted = false;\r\n        this.countRenders = 0;\r\n        this.id = GraphElementComponent.maxid++;\r\n        GraphElementComponent.all[this.id] = this;\r\n        GraphElementComponent.map[props.nodeid as Pointer<DGraphElement>] = this; // props might change at runtime, setting in constructor is not enough\r\n        this.html = React.createRef();\r\n        let functionsToBind = [this.onClick,\r\n            this.onLeave, this.onEnter,\r\n            this.doContextMenu, this.onContextMenu,\r\n            this.onMouseDown, this.onMouseUp, this.onKeyDown, this.onScroll, this.onMouseMove];/*\r\n        this.onClick = this.onClick.bind(this);\r\n        this.onLeave = this.onLeave.bind(this);\r\n        this.onContextMenu = this.onContextMenu.bind(this);\r\n        this.onEnter = this.onEnter.bind(this);\r\n        this.select = this.select.bind(this);*/\r\n        for (let f of functionsToBind) (this as any)[f.name] = f.bind(this);\r\n        // @ts-ignore\r\n        this.state = {classes: [] as string[]};\r\n        this.shouldComponentUpdate(this.props, this.state, undefined, undefined);\r\n    }\r\n\r\n    // constants: evalutate solo durante il primo render, può essere una funzione con effetti collaterali sul componente,\r\n    // in tal caso la si esegue e si prende il valore di ritorno.\r\n    // preRenderFunc: funzione evalutata ed eseguita sempre prima del render, ha senso solo per generare effetti collaterali sulle \"costanti\".\r\n    // jsxString: funzione evalutata una sola volta durante il primo render ed eseguita ad ogni update dei dati.\r\n\r\n\r\n\r\n    componentDidMount(): void {\r\n        // after first render\r\n        this._isMounted = true;\r\n    }\r\n\r\n    componentWillUnmount(): void {\r\n        // todo: devo fare in modo che il nodo venga cancellato solo se sto modificando la vista in modo che questo vertice non esista più.\r\n        //  e non venga cancellato se il componente viene smontato perchè ho solo cambiato vista\r\n        //  LOW PRIORITY perchè funziona anche senza, pur sprecando memoria che potrebbe essere liberata.\r\n        // if (view_is_still_active_but_got_modified_and_vertex_is_deleted) new DeleteElementAction(this.getId());\r\n    }\r\n    /*\r\n        componentDidUpdate(oldProps: Readonly<AllProps {/*\r\n            const newProps = this.props\r\n            if (oldProps.view !== newProps.view) { this.setTemplateString(newProps.view); }\r\n    }*/\r\n\r\n\r\n\r\n    protected getJSXContext(vid: Pointer<DViewElement>): GObject{\r\n        let context: GObject = transientProperties.node[this.props.nodeid].viewScores[vid].evalContext;\r\n        if (context && context.component) return context;\r\n\r\n        // else rebuild + update it\r\n        let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\r\n        let tv = transientProperties.view[vid];\r\n        context = tnv.evalContext = {...this.props, ...tv.constants, ...tnv.usageDeclarations,\r\n            // add component stuff that could not be computed in reducer\r\n            component: this,\r\n            otherViews: this.props.views,\r\n            constants: tv.constants,\r\n            usageDeclarations: tnv.usageDeclarations,\r\n            props: this.props};\r\n        context._context = context;\r\n        return context;\r\n    }\r\n\r\n    public static displayError(e: Error, where: string, view: DViewElement, data?: DModelElement, node?: DGraphElement, asString:boolean = false, printData?: GObject): React.ReactNode {\r\n        // const view: LViewElement = this.props.view; //data._transient.currentView;\r\n        let errormsg = (where === \"preRenderFunc\" ? \"Pre-Render \" : \"\") +(e.message||\"\\n\").split(\"\\n\")[0];\r\n        if (e.message.indexOf(\"Unexpected token .\") >= 0 || view.jsxString.indexOf('?.') >= 0 || view.jsxString.indexOf('??') >= 0) {\r\n            errormsg += '\\n\\nReminder: nullish operators \".?\" and \"??\" are not supported.'; }\r\n        else if (view.jsxString.indexOf('?.') >= 0) { errormsg += '\\n\\nReminder: ?. operator and empty tags <></> are not supported.'; }\r\n        else if (e.message.indexOf(\"Unexpected token '<'\") !== -1) { errormsg += '\\n\\nDid you forgot to close a html </tag>?'; }\r\n        try {\r\n            let ee = e.stack || \"\";\r\n            let stackerrorlast = ee.split(\"\\n\")[1];\r\n\r\n            let icol = stackerrorlast.lastIndexOf(\":\");\r\n            let jsxString = view.jsxString;\r\n            // let col = stackerrorlast.substring(icol+1);\r\n            let irow = stackerrorlast.lastIndexOf(\":\", icol-1);\r\n            const offset={row:-2, col:1};\r\n            let stackerrorlinenum: GObject = {\r\n                row: Number.parseInt(stackerrorlast.substring(irow+1, icol)) + offset.row,\r\n                col: Number.parseInt(stackerrorlast.substring(icol+1)) + offset.col };\r\n            let linesPre = 1;\r\n            let linesPost = 1;\r\n            let jsxlines = jsxString.split(\"\\n\");\r\n            let culpritlinesPre: string[] = jsxlines.slice(stackerrorlinenum.row-linesPre-1, stackerrorlinenum.row - 1);\r\n            let culpritline: string = jsxlines[stackerrorlinenum.row - 1]; // stack start counting lines from 1\r\n            let culpritlinesPost: string[] = jsxlines.slice(stackerrorlinenum.row, stackerrorlinenum.row + linesPost);\r\n            console.error(\"errr\", {e, node, jsxlines, culpritlinesPre, culpritline, culpritlinesPost, stackerrorlinenum, icol, irow, stackerrorlast});\r\n\r\n            if (stackerrorlinenum.col - offset.col > culpritline?.length && stackerrorlinenum.row === 1) stackerrorlinenum.col = 0;\r\n            let caretCursor = \"▓\" // ⵊ ꕯ 𝙸 Ꮖ\r\n            if (culpritline && stackerrorlinenum.col - offset.col <= culpritline?.length && stackerrorlast.indexOf(\"main.chunk.js\") === -1) {\r\n                let rowPre = culpritline.substring(0, stackerrorlinenum.col);\r\n                let rowPost = culpritline.substring(stackerrorlinenum.col);\r\n                let jsxcode =\r\n                    <div style={{fontFamily: \"monospaced sans-serif\", color:\"#444\"}}>\r\n                        { culpritlinesPre.map(l => <div>{l}</div>) }\r\n                        <div>{rowPre} <b style={{color:\"red\"}}> {caretCursor} </b> {rowPost}</div>\r\n                        { culpritlinesPost.map(l => <div>{l}</div>) }\r\n                    </div>;\r\n                errormsg += \" @ line \" + stackerrorlinenum.row + \", col:\" + stackerrorlinenum.col;\r\n                if (asString) return DV.errorView_string('<div>'+errormsg+'\\n'+jsxcode+'</div>', {where:\"in \"+where+\"()\", e, template:view.jsxString, view: view}, where, data, node, view);\r\n                return DV.errorView(<div>{errormsg}{jsxcode}</div>, {where:\"in \"+where+\"()\", e, template:view.jsxString, view: view}, where, data, node, view);\r\n            } else {\r\n                // it means it is likely accessing a minified.js src code, sending generic error without source mapping\r\n            }\r\n        } catch(e2) {\r\n            Log.eDevv(\"internal error in error view\", {e, e2, where} );\r\n            return null;\r\n        }\r\n        if (asString) return DV.errorView_string('<div>'+errormsg+'</div>', {where:\"in \"+where+\"()\", e, template: view.jsxString, view: view}, where, data, node, view);\r\n        return DV.errorView(<div>{errormsg}</div>, {where:\"in \"+where+\"()\", e, template: view.jsxString, view: view, ...(printData || {})}, where, data, node, view);\r\n    }\r\n/*\r\n    protected getTemplate(): ReactNode {\r\n        /*if (!this.state.template) {\r\n            this.setTemplateString('{c1: 118}', '()=>{this.setState({c1: this.state.c1+1})}',\r\n                '<div><input value=\"{name}\" onInput=\"{setName}\"></input><p>c1:{this.state.c1}</p><Attribute prop1={daa} prop2={1 + 1.5} stringPropdaa=\\\"daa\\\" /><ul>{colors.map( color => <li>color: {color}</li>)}</ul></div>');\r\n        }* /\r\n        // console.log('getTemplate:', {props: this.props, template: this.props.template, ctx: this.props.evalContext});\r\n\r\n        // Log.exDev(debug && maxRenderCounter-- < 0, \"loop involving render\");\r\n        if (this.props.invalidUsageDeclarations) {\r\n            return this.displayError(this.props.invalidUsageDeclarations, \"Usage Declaration\");\r\n        }\r\n        let context: GObject = this.getContext();\r\n        // abababababab\r\n        // todo: invece di fare un mapping ricorsivo dei figli per inserirgli delle prop, forse posso farlo passando una mia factory che wrappa React.createElement\r\n\r\n        try {\r\n            let preRenderFuncStr: string | undefined = this.props.view.preRenderFunc;\r\n            if (preRenderFuncStr) {\r\n                // eval prerender\r\n                let obj: GObject = {};\r\n                let tempContext: GObject = {__param: obj};\r\n                tempContext.__proto__ = context;\r\n                U.evalInContextAndScopeNew(\"(\"+preRenderFuncStr+\")(this.__param)\", tempContext, true, false);\r\n                U.objectMergeInPlace(context, obj);\r\n            }\r\n        }\r\n        catch(e: any) { return this.displayError(e, \"Pre-Render\");  }\r\n\r\n        let ret;\r\n        // eval template\r\n        let jsxCodeString: DocString<ReactNode>;\r\n\r\n        try { jsxCodeString = JSXT.fromString(this.props.view.jsxString, {factory: 'React.createElement'}); }\r\n        catch (e: any) { return this.displayError(e, \"JSX Syntax\"); }\r\n\r\n        try { ret = U.evalInContextAndScope<() => ReactNode>('(()=>{ return ' + jsxCodeString + '})()', context); }\r\n        catch (e: any) { return this.displayError(e, \"JSX Semantic\"); }\r\n        return ret;\r\n    }*/\r\n    protected getTemplate3(vid: Pointer<DViewElement>, v: LViewElement, context: GObject): ReactNode {\r\n        let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\r\n        let tv = transientProperties.view[vid];\r\n        // console.log(\"getTemplate jsx\", {vid, v, context, tnv, tv, shouldUp: tnv.shouldUpdate, jsxFunc:tv.JSXFunction});\r\n        let ret = this.getTemplate3_(vid, v, context);\r\n        return ret;\r\n    }\r\n    protected getTemplate3_(vid: Pointer<DViewElement>, v: LViewElement, context: GObject): ReactNode{\r\n        let tnv = transientProperties.node[this.props.nodeid].viewScores[vid];\r\n        if (!tnv.shouldUpdate && tnv.jsxOutput) return tnv.jsxOutput;\r\n        let tv = transientProperties.view[vid];\r\n        let ret = tnv.jsxOutput = (tv.JSXFunction ? tv.JSXFunction.call(context, context) : null);\r\n        if (typeof ret === \"object\" && ret !== null && !React.isValidElement(ret)) {\r\n            // plain objects cannot be react nodes, but react noeds are objects. so i try serializing\r\n            // this only happens if someone puts an object in jsx\r\n            try{\r\n                ret = JSON.stringify(ret);\r\n            }\r\n            catch(e){ ret = \"{__ Cyclic Object __}\"; }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    protected getTemplate2(v: LViewElement, udContext: GObject): ReactNode {\r\n        // todo: invece di fare un mapping ricorsivo dei figli per inserirgli delle prop, forse posso farlo passando una mia factory che wrappa React.createElement\r\n\r\n        /*\r\n        let thisContext: GObject = {};\r\n        try {\r\n            let preRenderFuncStr: string | undefined = v.preRenderFunc;\r\n            if (preRenderFuncStr) {\r\n                // eval prerender\r\n                let tempContext: GObject = {__param: thisContext};\r\n                this.addToContext(udContext, {__param: thisContext});\r\n                tempContext.__proto__ = sharedContext;\r\n                U.evalInContextAndScopeNew(\"(\"+preRenderFuncStr+\")(this.__param)\", tempContext, true, false);\r\n                U.objectMergeInPlace(thisContext, udContext);\r\n                // thisContext.__proto__ = sharedContext;\r\n            } else thisContext = udContext;\r\n        }\r\n        catch(e: any) { return this.displayError(e, \"Pre-Render\", v);  }*/\r\n\r\n        let ret;\r\n        // eval template\r\n        let jsxCodeString: DocString<ReactNode>;\r\n\r\n        try { jsxCodeString = JSXT.fromString(v.jsxString, {factory: 'React.createElement'}); }\r\n        catch (e: any) { return GraphElementComponent.displayError(e, \"JSX Syntax\", v.__raw, this.props.data?.__raw, this.props.node?.__raw); }\r\n\r\n        // console.log('context for ' + (this.props.data?.name), {udContext});\r\n        try {\r\n            let parsedFunc = U.parseFunctionWithContextAndScope('()=>{ return ' + jsxCodeString + '}', udContext, udContext);\r\n            ret = parsedFunc(udContext) as ReactNode;\r\n            /// ret = U.evalInContextAndScope<() => ReactNode>('(()=>{ return ' + jsxCodeString + '})()', udContext);\r\n        }\r\n        catch (e: any) { return GraphElementComponent.displayError(e, \"JSX Semantic\", v.__raw, this.props.data?.__raw, this.props.node?.__raw, false, {udContext}); }\r\n        return ret;\r\n    }\r\n\r\n    onContextMenu(e: React.MouseEvent<Element>) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // NOT executed here, but on mousedown because of IOS compatibility\r\n    }\r\n\r\n    doContextMenu(e: React.MouseEvent<Element>) {\r\n        TRANSACTION('contextmenu', ()=>{\r\n            this.props.node.select();\r\n            if (this.html.current) this.html.current.focus();\r\n            let state: DState = store.getState();\r\n            if (state.contextMenu?.x !== e.clientX) {\r\n                SetRootFieldAction.new(\"contextMenu\", {\r\n                    display: true,\r\n                    x: e.clientX,\r\n                    y: e.clientY,\r\n                    nodeid: this.props.node?.id\r\n                });\r\n            }\r\n        }, true, false)\r\n    }\r\n\r\n    onEnter(e: React.MouseEvent<Element>) { // instead of doing it here, might set this class on render, and trigger it visually operative with :hover selector css\r\n        const isEdgePending = this.props.isEdgePending?.source;\r\n        if (!isEdgePending || this.props.data?.className !== \"DClass\") return;\r\n        const extendError: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}\r\n        const canBeExtend = isEdgePending.canExtend(this.props.data as any as LClass, extendError);\r\n\r\n        if (canBeExtend) this.setState({classes:[...this.state.classes, \"class-can-be-extended\"]});\r\n        else this.setState({classes:[...this.state.classes, \"class-cannot-be-extended\"]});\r\n    }\r\n    onLeave(e: React.MouseEvent<Element>) {\r\n        if (this.props.data?.className !== \"DClass\") return;\r\n        this.setState({classes: this.state.classes.filter((classname) => {\r\n            return classname !== \"class-can-be-extended\" && classname !== \"class-cannot-be-extended\"\r\n        })});\r\n    }\r\n\r\n    static mousedownComponent: GraphElementComponent | undefined;\r\n    onMouseDown(e: React.MouseEvent): void {\r\n        if (UX.isStoppedEvt(e)) return;\r\n        e.stopPropagation();\r\n        GraphElementComponent.mousedownComponent = this;\r\n        //TRANSACTION('contextmenu', ()=>{\r\n            if (e.button === Keystrokes.clickRight) { this.doContextMenu(e); }\r\n            let p: GObject = this.props;\r\n            console.log('try drag', {p, ig: p.isGraph, iv:p.isVertex, e});\r\n            // if ((p.isGraph && !p.isVertex) || (p.isGraph && p.isVertex && e.ctrlKey)) GraphDragManager.startPanning(e, this.props.node as LGraph);\r\n        //})\r\n    }\r\n\r\n\r\n\r\n    onScroll(e: React.MouseEvent): void {\r\n        console.log(\"onScroll\");\r\n        let scroll: Point = new Point(e.currentTarget.scrollLeft, e.currentTarget.scrollTop);\r\n        let scrollOrigin: Point = new Point(e.nativeEvent.offsetX, e.nativeEvent.offsetY);\r\n        let g: LGraph = this.props.node.graph;\r\n        let oldZoom: GraphPoint = g.zoom;\r\n        let newZoom: GraphPoint = new GraphPoint(oldZoom.x+0.1, oldZoom.y+0.1);\r\n        let oldOffset: GraphPoint = g.offset;\r\n        let gscrollOrigin: GraphPoint = oldOffset.add(scrollOrigin.multiply(oldZoom, true), true);\r\n        let newscrollOrigin: GraphPoint = oldOffset.add(scrollOrigin.multiply(newZoom, true), true);\r\n        let newOffset: GraphPoint = oldOffset.add( gscrollOrigin.subtract(newscrollOrigin, true), true);\r\n        TRANSACTION('scroll graph', ()=>{\r\n            g.offset = newOffset;\r\n            g.zoom = newZoom;\r\n        })\r\n        e.stopPropagation();\r\n    }\r\n    onMouseMove(e: React.MouseEvent): void {\r\n        //this.onMouseUp(e);\r\n    }\r\n    onMouseUp(e: React.MouseEvent, frommousemove: boolean = false): void {\r\n        e.stopPropagation();\r\n        TRANSACTION('Vertex click-events', ()=>{\r\n            //GraphDragManager.stopPanning(e);\r\n            if (GraphElementComponent.mousedownComponent !== this) { return; }\r\n            if (!frommousemove) this.doOnClick(e);\r\n        })\r\n    }\r\n    onKeyDown(e: React.KeyboardEvent){\r\n        console.log('keydown', e.key, {e, m:this.props.data?.name});\r\n        let target: HTMLElement = e.target as any;\r\n        switch (target?.tagName.toLowerCase()) {\r\n            case 'input':\r\n            case 'textarea':\r\n                e.stopPropagation(); return;\r\n            default: if (target?.getAttribute('contenteditable') === 'true') { e.stopPropagation(); return; }\r\n        }\r\n        if (!(this.props.isGraph && !this.props.isVertex)) e.stopPropagation();\r\n        if (e.key === Keystrokes.escape) {\r\n            this.props.node.deselect();\r\n            if (this.props.isEdgePending) {\r\n                // this.stopPendingEdge(); todo\r\n                return;\r\n            }\r\n        }\r\n        let isDelete: boolean = false;\r\n        if (e.key === Keystrokes.delete){ isDelete = true; }\r\n        if (e.shiftKey) {\r\n            // todo: make them a switch\r\n            if (e.key === \"D\" || e.key === \"d\") this.props.data?.duplicate(); else\r\n            if (e.key === \"R\" || e.key === \"r\") { isDelete = true; }\r\n        }\r\n        console.log('keydown isDelete', isDelete);\r\n        if (isDelete){\r\n            let nid = this.props.nodeid;\r\n            let tn = transientProperties.node[nid];\r\n            TRANSACTION('delete ' + this.props.node.name, ()=>{\r\n                if (tn && tn.onDelete && tn.onDelete(this.props.node) === false) return;\r\n                // if shapeless, erase the node directly.\r\n                if (!this.props.data) {\r\n                    this.props.node.delete();\r\n                    return;\r\n                }\r\n                // if dictated by the model, change the model to erase indirectly the node.\r\n                if (!this.props.isEdge) {\r\n                    this.props.data.delete();\r\n                    return;\r\n                }\r\n                // if edge\r\n                let e = this.props.node as LVoidEdge;\r\n                let de = e.__raw;\r\n                if (de.isExtend) {\r\n                    let data: LClass = this.props.data as any;\r\n                    data.unsetExtends( e.end.model as LClass);\r\n                    // SetFieldAction(data.id, 'extends', )\r\n                }\r\n                if (de.isReference){\r\n                    if (this.props.data.className === 'DReference'){\r\n                        let ref: LReference = this.props.data as any;\r\n                        ref.type = ref.father.id as any;\r\n                    } else {\r\n                        let lval: LValue = this.props.data as any;\r\n                        lval.remove(e.end.model);\r\n                    }\r\n                }\r\n                if (de.isDependency){ // pkg dependency\r\n                    let ref: LPackage = this.props.data as any;\r\n                }\r\n                else {}\r\n            })\r\n        }\r\n        if (e.ctrlKey) {\r\n            // if (e.key === Keystrokes.escape) this.props.node.toggleMinimize();\r\n            if (e.key === \"a\") this.props.data?.addChild(\"auto\"); else // add class if on package, literal if on enum...\r\n            if (e.key === \"r\") this.props.data?.addChild(\"reference\"); else\r\n            if (e.key === \"o\") this.props.data?.addChild(\"operation\") || this.props.data?.addChild(\"object\"); else\r\n            if (e.key === \"l\") this.props.data?.addChild(\"literal\"); else\r\n            if (e.key === \"p\") this.props.data?.addChild(\"package\") || this.props.data?.addChild(\"parameter\"); else\r\n            if (e.key === \"c\") this.props.data?.addChild(\"class\"); else\r\n            if (e.key === \"e\") this.props.data?.addChild(\"enumerator\"); else\r\n            if (e.key === \"q\") this.props.data?.addChild(\"annotation\"); else\r\n            ;\r\n        }\r\n    }\r\n\r\n    private doOnClick(e: React.MouseEvent): void {\r\n        // (e.target as any).focus();\r\n        e.stopPropagation();\r\n        let state: DState = store.getState();\r\n        if (e.button !== Keystrokes.clickRight && state.contextMenu?.display) SetRootFieldAction.new(\"contextMenu\", {display: false, x: 0, y: 0}); // todo: need to move it on document or <App>\r\n        const edgePendingSource = this.props.isEdgePending?.source;\r\n        //console.log('mousedown select() check PRE:', {e, name: this.props.data?.name, isSelected: this.props.node.isSelected(), 'nodeIsSelectedMapProxy': this.props.node?.isSelected, nodeIsSelectedRaw:this.props.node?.__raw.isSelected});\r\n\r\n        if (edgePendingSource) {\r\n            if (this.props.data?.className !== \"DClass\") return;\r\n            // const user = this.props.isEdgePending.user;\r\n            const extendError: {reason: string, allTargetSuperClasses: LClass[]} = {reason: '', allTargetSuperClasses: []}\r\n            const canBeExtend = this.props.data && edgePendingSource.canExtend(this.props.data as any as LClass, extendError);\r\n            if (canBeExtend && this.props.data) {\r\n                const lClass: LClass = LPointerTargetable.from(this.props.data.id);\r\n                // SetFieldAction.new(lClass.id, \"extendedBy\", source.id, \"\", true); // todo: this should throw a error for wrong type.\r\n                // todo: use source.addExtends(lClass); or something (source is LClass)\r\n                SetFieldAction.new(lClass.id, \"extendedBy\", edgePendingSource.id, \"+=\", true);\r\n                SetFieldAction.new(edgePendingSource.id, \"extends\", lClass.id, \"+=\", true);\r\n            }\r\n            SetRootFieldAction.new('isEdgePending', { user: '',  source: '' });\r\n            return;\r\n        }\r\n        //console.log('mousedown select() check:', {e, isSelected: this.props.node.isSelected(), 'nodeIsSelectedMapProxy': this.props.node?.isSelected, nodeIsSelectedRaw:this.props.node?.__raw.isSelected});\r\n        windoww.node = this.props.node;\r\n\r\n        TRANSACTION('select', ()=>{\r\n            this.props.node.toggleSelected(DUser.current);\r\n            if (state._lastSelected?.node !== this.props.nodeid) {\r\n                SetRootFieldAction.new('_lastSelected', {\r\n                    node: this.props.nodeid,\r\n                    view: this.props.view.id,\r\n                    modelElement: this.props.data?.id\r\n                });\r\n            }\r\n\r\n            if (e.shiftKey || e.ctrlKey) { }\r\n            else {\r\n                let allNodes: LGraphElement[] | undefined = this.props.node?.graph.allSubNodes;\r\n                let nid = this.props.node.id;\r\n                if (allNodes) for (let node of allNodes) if (node.id !== nid) node.deselect(DUser.current);\r\n            }\r\n        })\r\n    }\r\n\r\n    onClick(e: React.MouseEvent): void {\r\n\r\n    }\r\n\r\n    onDataUpdateMeasurable(view: LViewElement, vid: Pointer<DViewElement>, index: number): void{\r\n        if (index > 0) { this.doMeasurableEvent(EMeasurableEvents.onDataUpdate, vid); return; }\r\n        // only on first of a sequence of onDataUpdate events for all stackviews (the mainview),\r\n        // set time of current stack of updates, to check if they are generating a loop\r\n\r\n        // EMeasurableEvents.onDataUpdate -> handling and checking for loops\r\n        if (!this.stopUpdateEvents || this.stopUpdateEvents !== this.props.view.clonedCounter) {\r\n            this.stopUpdateEvents = undefined;\r\n            if (this.props.data && (this.dataOldClonedCounter !== this.props.data.clonedCounter) && this.doMeasurableEvent(EMeasurableEvents.onDataUpdate, vid)) {\r\n                this.dataOldClonedCounter = this.props.data.clonedCounter;\r\n                let thischange = {t: Date.now()};\r\n                this.lastOnUpdateChanges.push(thischange);\r\n                if (thischange.t - this.lastOnUpdateChanges[this.lastOnUpdateChanges.length - 10]?.t < 300) {\r\n                    // if N updates in <= 0.2 sec\r\n                    this.stopUpdateEvents = this.props.view.clonedCounter;\r\n                    Log.eDevv(\"loop in node.render() likely due to MeasurableEvent onDataUpdate. It has been disabled until the view changes.\",{\r\n                        change_log: this.lastOnUpdateChanges,\r\n                        component: this,\r\n                        timediff: (thischange.t - this.lastOnUpdateChanges[this.lastOnUpdateChanges.length - 10]?.t)\r\n                    } as any);\r\n                }\r\n            }\r\n    }\r\n    }\r\n\r\n\r\n    // returns: true if an action is fired and component needs re-rendering\r\n    updateNodeFromProps(props: GObject<AllProps>): boolean {\r\n        let ret = false;\r\n        TRANSACTION('update node from props', ()=>{\r\n            ret = this.updateNodeFromProps0(props);\r\n        });\r\n        return ret;\r\n    }\r\n    updateNodeFromProps0(props: GObject<AllProps>): boolean {\r\n        let ret = false;\r\n        let tn = transientProperties.node[props.nodeid];\r\n        if (tn && !tn.viewScores) console.error('tn error 1', {tn:tn && {...tn}});\r\n        let ptr: Pointer<any>;\r\n        if (!props.node) return false;\r\n        let node = props.node;\r\n        let dnode = node.__raw;\r\n        let edge: LVoidEdge = props.node as any;\r\n        let dedge: DVoidEdge = dnode as any;\r\n        // if edge.label props is func, do not set in the dedge, just in transientproperties. totally override the \"text\" system.\r\n        // it does not need collab sync:\r\n        // because if the view is active for the other user, his synched jsx will generate the same function in transientProperties.\r\n        // if it is inactive it does not matter, the value is not used.\r\n        if (props.label) { tn.longestLabel = props.label; }\r\n        if (props.onDelete) { tn.onDelete = props.onDelete; }\r\n        if (props.longestLabel) { tn.longestLabel = props.longestLabel; }\r\n        if (props.labels) { tn.labels = props.labels; }\r\n        if (props.anchorStart && props.isEdge) { edge.anchorStart = props.anchorStart; }\r\n        if (props.anchorEnd && props.isEdge) { edge.anchorEnd = props.anchorEnd; }\r\n        if (props.start && props.isEdge) {\r\n            ptr = Pointers.from(props.start);\r\n            if (dedge.id !== ptr) edge.start = ptr as any;\r\n        }\r\n        // console.log(\"changing endpt\", props, props.end, props.end?.model?.name);\r\n        if (props.end && props.isEdge) {\r\n            ptr = Pointers.from(props.end);\r\n            if (dedge.id !== ptr) edge.end = ptr as any;\r\n        }\r\n        if (props.anchorEnd) { tn.labels = props.labels; }\r\n        let todoremovethis = false;\r\n        // if (typeof props.viewid === 'string') { let old = props.viewid; if (old !== props.node.view.id) { this.forceUpdate(); ret = true;} }\r\n        if (todoremovethis || props.isReference !== undefined) { let old = dedge.isReference; let n = !!props.isReference; if (old !== n) { edge.isReference = n; ret = true;} }\r\n        if (todoremovethis || props.isExtend !== undefined) { let old = dedge.isExtend; let n = !!props.isExtend; if (old !== n) { edge.isExtend = n; ret = true;} }\r\n        if (todoremovethis || props.isValue !== undefined) { let old = dedge.isValue; let n = !!props.isValue; if (old !== n) { edge.isValue = n; ret = true;} }\r\n        if (todoremovethis || props.isDependency !== undefined) { let old = dedge.isDependency; let n = !!props.isDependency; if (old !== n) { edge.isDependency = n; ret = true;} }\r\n        if (typeof props.x === 'number') { let old = dnode.x; let n = +props.x; if (old !== n) { node.x = n; ret = true;} }\r\n        if (typeof props.y === 'number') { let old = dnode.y; let n = +props.y; if (old !== n) { node.y = n; ret = true;} }\r\n        // risk loop: todo loop detection and skip setting\r\n        if (typeof props.w === 'number') { let old = dnode.w; let n = +props.w; if (old !== n) { node.w = n; ret = true;} }\r\n        if (typeof props.h === 'number') { let old = dnode.h; let n = +props.h; if (old !== n) { node.h = n; ret = true;} }\r\n        if (typeof props.width  === 'number') { let old = dnode.w; let n = +props.width;  if (old !== n) { node.w = n; ret = true;} }\r\n        if (typeof props.height === 'number') { let old = dnode.h; let n = +props.height; if (old !== n) { node.h = n; ret = true;} }\r\n\r\n        return ret;\r\n    }\r\n\r\n    public render(nodeType:string = '', styleoverride:React.CSSProperties={}, classes: string[]=[]): ReactNode {\r\n        GraphElementComponent.map[this.props.nodeid as Pointer<DGraphElement>] = this; // props might change at runtime, setting in constructor is not enough\r\n        if (Debug.lightMode && (!this.props.data || !(lightModeAllowedElements.includes(this.props.data.className)))){\r\n            return this.props.data ? <div>{\" \" + ((this.props.data as any).name)}:{this.props.data.className}</div> : undefined;\r\n        }\r\n        if (!this.props.node) return \"Loading...\";\r\n        /*if (this.props.node.__raw.view !== this.props.view.id) {\r\n            this.onViewChange();\r\n            return \"Updating view...\";\r\n        }*/\r\n        if (this.updateNodeFromProps(this.props as GObject<any>)) return 'Updating...';\r\n        let nid = this.props.nodeid;\r\n        let allviews = [...this.props.views, this.props.view]; // main view must be last, for renderView ordering\r\n\r\n\r\n        for (let i = 0 ; i < allviews.length; i++){\r\n            let v = allviews[i];\r\n            const vid = v.id;\r\n            let viewnodescore = transientProperties.node[nid].viewScores[v.id];\r\n            if (!viewnodescore.shouldUpdate) continue;\r\n            viewnodescore.evalContext = undefined as any; // force rebuild jsx context, needs to be done before renderView and measurable events\r\n            // only if this exact view had UD changed, instead of being forced to rended by other in viewstack)\r\n            this.onDataUpdateMeasurable(v, vid, i);\r\n        }\r\n\r\n        /// set classes\r\n        if (this.props.node) {\r\n            let isSelected: Dictionary<Pointer<DUser>, boolean> = this.props.node.__raw.isSelected;\r\n            if(isSelected) {\r\n                if (isSelected[DUser.current]) { // todo: better to just use css attribute selectors [data-userselecting = \"userID\"]\r\n                    classes.push('selected-by-me');\r\n                    if (Object.keys(isSelected).length > 1) classes.push('selected-by-others');\r\n                } else if (Object.keys(isSelected).length) classes.push('selected-by-others');\r\n            }\r\n        }\r\n\r\n        classes.push(this.props.data?.className || 'DVoid');\r\n        U.arrayMergeInPlace(classes, this.state.classes);\r\n        if (Array.isArray(this.props.className)) { U.arrayMergeInPlace(classes, this.props.className); }\r\n        else if (this.props.className) { classes.push(this.props.className); }\r\n        if (Array.isArray(this.props.class)) { U.arrayMergeInPlace(classes, this.props.class); }\r\n        else if (this.props.class) { classes.push(this.props.class); }\r\n        /// end set classes\r\n\r\n\r\n        let mainView: LViewElement = this.props.view;\r\n        let otherViews: LViewElement[] = this.props.views;\r\n        let decoratorViewsOutput: (ReactNode | ReactElement)[] = [];/*\r\n        for (let v of this.props.views) {\r\n            if (v.isExclusiveView) {\r\n                if (mainView) continue;\r\n                mainView = v;\r\n            } else otherViews.push(v);\r\n        }*/\r\n\r\n        let jsxOutput: ReactNode = undefined as any;\r\n        const tn = transientProperties.node[nid]\r\n        //console.log(\"render\", {mainView, otherViews, scores:tn.viewScores, tnv:tn.viewScores[this.props.viewid], ud:tn.viewScores[this.props.viewid].usageDeclarations});\r\n        for (let v of allviews) { // main view is the last\r\n            let viewnodescore = transientProperties.node[nid].viewScores[v.id];\r\n            jsxOutput = viewnodescore.shouldUpdate ? undefined : viewnodescore.jsxOutput;\r\n            let isMain: true | undefined = v === mainView || undefined;\r\n            if (!jsxOutput) viewnodescore.jsxOutput = jsxOutput =\r\n                this.renderView(this.props, v, nodeType, classes, styleoverride,\r\n                    isMain && decoratorViewsOutput, mainView.id, isMain && otherViews.map(v=>v.id));\r\n            if (!isMain) decoratorViewsOutput.push(jsxOutput);\r\n            if (viewnodescore.shouldUpdate) viewnodescore.shouldUpdate = false; // this needs to be placed post renderView call\r\n        }\r\n\r\n        let mainViewOutput: ReactNode = jsxOutput;\r\n        return mainViewOutput;\r\n        // console.log('rendering view stack', {mainView, otherViews, mainViewOutput, decoratorsJSX:decoratorViewsOutput});\r\n        // windoww.debbugg = {mainViewOutput,otherViews, ret:<>renderrr{mainViewOutput}{otherViews}</>}\r\n        // return this.props.data?.className === \"DValue\" ? <div>{mainView.jsxString}{mainViewElement}</div> : mainViewElement;\r\n    }\r\n\r\n\r\n    protected renderView(props: AllProps, v: LViewElement, nodeType: string, classes: string[], styleoverride: React.CSSProperties,\r\n                         otherViews?: (ReactNode | ReactElement)[], mainviewid?: Pointer<DViewElement>, subViewsID: Pointer<DViewElement>[] = []): ReactNode | ReactElement {\r\n        let dv = v.__raw;\r\n        const nid = props.nodeid;\r\n        const vid = v.id;\r\n        const tnv = transientProperties.node[nid].viewScores[vid];\r\n        let ud: GObject | undefined = tnv.usageDeclarations;\r\n        /*if (false && !ud) {\r\n            this.forceUpdate();\r\n            return <div>Loading...</div>;\r\n        }*/\r\n\r\n        if (!ud) tnv.usageDeclarations = ud = computeUsageDeclarations(this, props, this.state, v);\r\n        //console.log(\"renderView\", {dv, tnv, ud});\r\n\r\n        if (ud.__invalidUsageDeclarations) {\r\n            console.error(\"renderView error ud:\", {dv, tnv, ud});\r\n            return GraphElementComponent.displayError(ud.__invalidUsageDeclarations, \"Usage Declaration \" + (ud.__invalidUsageDeclarations.isSyntax ? \"Syntax\" : \"Semantic\"), v.__raw,\r\n                this.props.data?.__raw, this.props.node?.__raw, false, {ud});\r\n        }\r\n        let isMainView: boolean = !!otherViews;\r\n        const context: GObject = this.getJSXContext(vid);\r\n\r\n        if (isMainView) context.decorators = otherViews;\r\n        let rnode: ReactNode;\r\n        try { rnode = this.getTemplate3(vid, v, context); }\r\n        catch (e: any) {\r\n            console.error(\"renderView error get template:\", {e, dv, tnv});\r\n            // rnode = undefined as any;\r\n            // todo: move in reducer parser of jsx: catch (e: any) { return GraphElementComponent.displayError(e, \"JSX Syntax\", v.__raw, this.props.data?.__raw, this.props.node?.__raw); }\r\n            rnode = GraphElementComponent.displayError(e, \"JSX Semantic\", v.__raw, this.props.data?.__raw, this.props.node?.__raw, false, {context});\r\n        }\r\n        let rawRElement: ReactElement | null = UX.ReactNodeAsElement(rnode);\r\n\r\n\r\n        // \\console.log('GE render', {thiss: this, data:me, rnode, rawRElement, props:this.props, name: (me as any)?.name});\r\n\r\n        function makeItArray(val?: any) { return val ? [] : (Array.isArray(val) ? val : [val]); }\r\n        function getNodeText(node?: any | ReactNode): string | undefined {\r\n            if (['string', 'number'].includes(typeof node)) return node;\r\n            if (node instanceof Array) return node.map(getNodeText).join('');\r\n            if (typeof node === 'object' && node) return getNodeText(node.props.children);\r\n        }\r\n        const addprops: boolean = true;\r\n        let fiximport = !!this.props.node;\r\n        //let a: false = true as any; if (a) return \"Loading...\";\r\n        // if (this.props.data?.name === \"Concept 1\") console.log(\"shouldcomponentupdate rendering \" + this.props.data?.name, {cc: this.props.data.clonedCounter, attrs: (this.props.data as any).attributes});\r\n        if (addprops && rawRElement && fiximport) {\r\n            if (windoww.debugcount && debugcount++>windoww.debugcount) throw new Error(\"debug triggered stop\");\r\n            let fixdoubleroot = true;\r\n            // add view props to GraphElement children (any level down)\r\n            const subElements: Dictionary<DocString<'nodeid'>, boolean> = {}; // this.props.getGVidMap();\r\n            try {\r\n                let viewStyle: GObject = {...(this.props.style || {})};\r\n                /*\r\n                    if (view.adaptWidth) viewStyle.width = view.adaptWidth; // '-webkit-fill-available';\r\n                    else viewStyle.height = (rootProps.view.height) && rootProps.view.height + 'px';\r\n                    if (view.adaptHeight) viewStyle.height = view.adaptHeight; //'fit-content'; // '-webkit-fill-available'; if needs to actually fill all it's not a vertex but a field.\r\n                    else viewStyle.width = (rootProps.view.width) && rootProps.view.width + 'px';\r\n                    viewStyle = {};\r\n                */\r\n                // viewStyle.pointerEvents = \"all\";\r\n                let injectProps: GObject = {};\r\n                if (isMainView) {\r\n                    viewStyle.order = viewStyle.zIndex = props.node?.zIndex; // alias? this.props.node.z\r\n                    viewStyle.display = v?.display;\r\n                    const me: LModelElement | undefined = props.data; // this.props.model;\r\n                    if (countRenders) {\r\n                        classes.push(this.countRenders%2 ? \"animate-on-update-even\" : \"animate-on-update-odd\");\r\n                    }                /// let excludeProps = ['data', 'node', 'view', 'children', ]\r\n                    classes.push(\"mainView\", dv.id);\r\n                    classes.push(...subViewsID);\r\n                    injectProps = {\r\n                        ref: this.html,\r\n                        // damiano: ref html viene settato correttamente a tutti tranne ad attribute, ref, operation (è perchè iniziano con <Select/> as root?)\r\n                        id: props.nodeid,\r\n                        \"data-nodeid\": props.nodeid,\r\n                        \"data-dataid\": me?.id,\r\n                        \"data-viewid\": dv.id,\r\n                        \"data-modelname\": me?.className || \"model-less\",\r\n                        \"data-userselecting\": JSON.stringify(props.node?.isSelected || {}),\r\n                        \"data-nodetype\": nodeType,\r\n                        // \"data-order\": this.props.node?.zIndex,\r\n                        style: {...viewStyle, ...styleoverride},\r\n                        className: classes.join(' '),\r\n                        onClick: this.onClick,\r\n                        onContextMenu: this.onContextMenu,\r\n                        onMouseDown: this.onMouseDown,\r\n                        onMouseUp: this.onMouseUp,\r\n                        onMouseMove: this.onMouseMove,\r\n                        onKeyDown: this.onKeyDown,\r\n                        // onKeyUp: this.onKeyUp,\r\n                        onwheel: this.onScroll,\r\n                        onMouseEnter: this.onEnter,\r\n                        onMouseLeave: this.onLeave,\r\n                        tabIndex: (props as any).tabIndex || -1,\r\n                        \"data-countrenders\": this.countRenders++,\r\n                        \"data-clonedcounter\": props.node?.clonedCounter || -1,\r\n                        // decorators: otherViews,\r\n                    };\r\n                    let p: GObject = this.props;\r\n                    for (let k in p) {\r\n                        if (typeof p[k] === 'object' || typeof p[k] === 'function') continue;\r\n                        if (!injectProps[k]) injectProps[k] = p[k];\r\n                    }\r\n                }\r\n                else injectProps = {\"data-viewid\": v.id, className: \"decorativeView \" + v.id, \"data-mainview\": mainviewid};\r\n\r\n\r\n                let debug: GObject = {};\r\n                injectProps.children = UX.recursiveMap(rawRElement/*.props.children*/,\r\n                    (rn: ReactNode, index: number, depthIndexes: number[]) => {\r\n                        let injectOffset: undefined | LGraph = ((this.props as any).isGraph && !depthIndexes[0] && !index) && (this.props.node as LGraph);\r\n                        //injectOffset&&console.log(\"inject offset props0:\", {injectOffset});\r\n                        //console.log(\"inject offset props00:\", {injectOffset, ig:(this.props as any).isGraph, props:this.props, depthIndexes, index});\r\n                        return UX.injectProp(this, rn, subElements, this.props.parentnodeid as string, index, depthIndexes, injectOffset)\r\n                    });\r\n/*\r\n                debug.injectPropsOriginal = injectProps.children;\r\n                debug.recursivemap = injectProps.children;\r\n                debug.injectChildrensAttempt = [...injectProps.children, ...makeItArray(props.children), ...(otherViews as any[])];\r\n                debug.rawRElement = {node:rawRElement, text: getNodeText(rawRElement)};*/\r\n\r\n                if (otherViews && false) injectProps.children = [...injectProps.children, ...makeItArray(props.children), ...(otherViews as any[])];\r\n\r\n                // injectProps.children = [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)];\r\n                let children = makeItArray(injectProps.children); // [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)]; rawRElement.child are already in injectprops\r\n                // injectProps.children = [<div>{children}</div>];//[]; making any change at injectprops.children breaks it?\r\n                rawRElement = React.cloneElement(rawRElement, injectProps);//, ...children); // adding chioldrens after injectprops seems pointless\r\n\r\n                debug.rawRElementPostInjection = {node:rawRElement, text: getNodeText(rawRElement)};\r\n                // rawRElement = React.cloneElement(rawRElement, {children: [...makeItArray(rawRElement.props.children), ...makeItArray(injectProps.children)]});\r\n                // console.log('rendering view stack fixing doubles', {v0:rnode, v1:rawRElement, fixed:rawRElement.props.children})\r\n                fixdoubleroot = false; // need to set the props to new root in that case.\r\n                if (fixdoubleroot) rawRElement = rawRElement.props.children;\r\n                // debug.rawRElementPostfixdoubleroot = {node:rawRElement, text: getNodeText(rawRElement)};\r\n                // console.log(\"probem\", {rawRElement, children:(rawRElement as any)?.children, pchildren:(rawRElement as any)?.props?.children});\r\n            } catch (e: any) {\r\n                console.error(\"renderView error inject props:\", {e, dv, tnv});\r\n                rawRElement = DV.errorView(\"error while injecting props to subnodes\\n:\" + (e.message || '').split('\\n')[0],\r\n                    {e, rawRElement, key: props.key, newid: props.nodeid},\r\n                    'Subelement props', props.data?.__raw, props.node?.__raw, dv) as ReactElement;\r\n                /*\r\n                rawRElement = U.eval InContextAndScope<ReactElement>('()=>{ return ' +\r\n                    DV.errorView(\"error while injecting props to subnodes\",\r\n                        {e, rawRElement, key:this.props.key, newid: this.props.nodeid}) + '}',\r\n                    {});*/\r\n\r\n                // rawRElement = DV.errorView(\"error while injecting props to subnodes\", {e, rawRElement, key:this.props.key, newid: this.props.nodeid});\r\n            }\r\n            /*console.log('tempdebug', {deepStrictEqual, okeys:Object.keys});\r\n            let isEqual = true;\r\n            try {deepStrictEqual(subElements, this.props.node.subElements)} catch(e) { isEqual = false; }\r\n            if (isEqual) {\r\n                this.props.node.subElements = Object.keys(subElements);\r\n            }*/\r\n        }\r\n        // const injectprops = {a:3, b:4} as DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement>;\r\n        // rnode = React.cloneElement(rnode as ReactElement, injectprops);\r\n\r\n        // console.log(\"nodeee\", {thiss:this, props:this.props, node: this.props.node});\r\n        if (false && dv.isExclusiveView && (props.node?.__raw as DGraphElement).father) {\r\n            let $containedIn = $('#' + props.node.__raw.father);\r\n            let $containerDropArea = $containedIn.find(\".VertexContainer\");\r\n            const droparea = $containerDropArea[0] || $containedIn[0];\r\n            Log.exDev(!droparea, 'invalid vertex container target', {$containedIn, $containerDropArea});\r\n            if (droparea) return createPortal(rawRElement || rnode, droparea);\r\n        }/*\r\n        if (countRenders) return <>{[\r\n            rawRElement || rnode,\r\n            <div className={this.countRenders%2 ? \"animate-on-update-even\" : \"animate-on-update-odd\"} data-countrenders={this.countRenders++} />\r\n        ]}</>/*/\r\n\r\n        //console.log(\"renderView return:\", rawRElement || rnode);\r\n        return rawRElement || rnode;\r\n    }\r\n\r\n}\r\n\r\n// private\r\n// type AllPropss = GraphElementOwnProps & GraphElementDispatchProps & GraphElementReduxStateProps;\r\ntype AllPropss = Overlap<Overlap<GraphElementOwnProps, GraphElementDispatchProps>, GraphElementReduxStateProps>;\r\n\r\nconst GraphElementConnected = connect<GraphElementReduxStateProps, GraphElementDispatchProps, GraphElementOwnProps, DState>(\r\n    GraphElementComponent.mapStateToProps,\r\n    GraphElementComponent.mapDispatchToProps\r\n)(GraphElementComponent as any);\r\n\r\nexport const GraphElement = (props: GraphElementOwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <GraphElementConnected {...{...props, children}} />; }\r\n// console.info('graphElement loaded');\r\n\r\n\r\nGraphElementComponent.cname = \"GraphElementComponent\";\r\nGraphElementConnected.cname = \"GraphElementConnected\";\r\nGraphElement.cname = \"GraphElement\";\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}