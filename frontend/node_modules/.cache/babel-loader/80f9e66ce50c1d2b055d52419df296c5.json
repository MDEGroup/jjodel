{"ast":null,"code":"import{useEffect,useState}from'react';import{connect}from'react-redux';import{DUser,LUser,U}from'../../joiner';import{UsersApi}from\"../../api/persistance\";import{Btn,CommandBar}from'../commandbar/CommandBar';import{useEffectOnce}from\"usehooks-ts\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CollaborativeComponent(props){const{project,users}=props;const[emails,setEmails]=useState([]);const[filteredEmails,setFilteredEmails]=useState([]);const[email,setEmail]=useState('');useEffectOnce(()=>{(async function(){setEmails(await UsersApi.getAllEmails());})();});useEffect(()=>{if(!email)setFilteredEmails([]);else setFilteredEmails(emails.filter(e=>e.startsWith(email)));},[email]);const addCollaborator=async e=>{const user=await UsersApi.getUserByEmail(e);if(!user){U.alert('e','Cannot retrieve user data.');return;}if(!users.map(u=>u.id).includes(user.id))DUser.new(user.name,user.surname,user.nickname,user.affiliation,user.country,user.newsletter,user.email,'',user.id);if(project.collaborators.map(c=>c.id).includes(user.id))return;project.collaborators=[...project.collaborators,user];};return/*#__PURE__*/_jsxs(\"section\",{className:'page-root collaborative-tab',children:[/*#__PURE__*/_jsx(\"h1\",{className:'view',children:\"Collaborative Modeling\"}),/*#__PURE__*/_jsxs(\"div\",{className:'p-1 w-100  d-flex',style:{borderRadius:'var(--radius)'},children:[/*#__PURE__*/_jsxs(\"h5\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-person-video3\"}),\" Editor\"]}),/*#__PURE__*/_jsx(\"label\",{className:'ms-auto',children:project.author.nickname})]}),project.collaborators.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:'mt-2 p-1 w-100 border',style:{borderRadius:'var(--radius'},children:[/*#__PURE__*/_jsxs(\"h5\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-person-video3\"}),\" Collaborators\"]}),/*#__PURE__*/_jsx(\"div\",{className:'ms-auto',children:project.collaborators.map((c,index)=>{return/*#__PURE__*/_jsx(\"label\",{className:'ms-1',children:c.surname},index);})})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:'contributor email',className:'input w-25 float-end',defaultValue:email,onChange:e=>setEmail(e.target.value)}),/*#__PURE__*/_jsx(\"div\",{children:filteredEmails.map(e=>/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(CommandBar,{className:'float-end',style:{marginLeft:'5px'},children:[e,/*#__PURE__*/_jsx(Btn,{icon:'add',action:()=>addCollaborator(e),tip:'Invite contributor'})]})},e))}),/*#__PURE__*/_jsxs(\"div\",{className:'alert',children:[/*#__PURE__*/_jsx(\"i\",{className:\"bi bi-exclamation-circle\"}),\"Important: After sending the invitation, save the project!\"]})]});}function mapStateToProps(state,ownProps){const ret={};const user=LUser.fromPointer(DUser.current);ret.project=user.project;ret.users=LUser.fromPointer(state.users);return ret;}function mapDispatchToProps(dispatch){const ret={};return ret;}export const CollaborativeConnected=connect(mapStateToProps,mapDispatchToProps)(CollaborativeComponent);export const Collaborative=function(props){let children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(CollaborativeConnected,{...props,children});};","map":{"version":3,"names":["useEffect","useState","connect","DUser","LUser","U","UsersApi","Btn","CommandBar","useEffectOnce","jsx","_jsx","jsxs","_jsxs","CollaborativeComponent","props","project","users","emails","setEmails","filteredEmails","setFilteredEmails","email","setEmail","getAllEmails","filter","e","startsWith","addCollaborator","user","getUserByEmail","alert","map","u","id","includes","new","name","surname","nickname","affiliation","country","newsletter","collaborators","c","className","children","style","borderRadius","author","length","index","placeholder","defaultValue","onChange","target","value","marginLeft","icon","action","tip","mapStateToProps","state","ownProps","ret","fromPointer","current","mapDispatchToProps","dispatch","CollaborativeConnected","Collaborative","arguments","undefined"],"sources":["C:/0Programmi/Dev/projects/frontend/jjodel/frontend/src/components/editors/Collaborative.tsx"],"sourcesContent":["import {Dispatch, ReactElement, useEffect, useState} from 'react';\r\nimport {connect} from 'react-redux';\r\nimport type {DState, LProject} from '../../joiner';\r\nimport {DUser, GObject, LUser, U} from '../../joiner';\r\nimport {FakeStateProps} from '../../joiner/types';\r\nimport {UsersApi} from \"../../api/persistance\";\r\nimport {Btn, CommandBar} from '../commandbar/CommandBar';\r\nimport {useEffectOnce} from \"usehooks-ts\";\r\n\r\nfunction CollaborativeComponent(props: AllProps) {\r\n    const {project, users} = props;\r\n    const [emails, setEmails] = useState<string[]>([]);\r\n    const [filteredEmails, setFilteredEmails] = useState<string[]>([]);\r\n    const [email, setEmail] = useState<string>('');\r\n\r\n    useEffectOnce(() => {\r\n        (async function() {\r\n            setEmails(await UsersApi.getAllEmails());\r\n        })();\r\n    });\r\n\r\n    useEffect(() => {\r\n        if(!email) setFilteredEmails([]);\r\n        else setFilteredEmails(emails.filter(e => e.startsWith(email)));\r\n    }, [email])\r\n\r\n    const addCollaborator = async(e: string) => {\r\n        const user = await UsersApi.getUserByEmail(e);\r\n        if(!user) {\r\n            U.alert('e', 'Cannot retrieve user data.');\r\n            return;\r\n        }\r\n        if(!users.map(u => u.id).includes(user.id))\r\n            DUser.new(user.name, user.surname, user.nickname, user.affiliation, user.country, user.newsletter, user.email, '', user.id);\r\n        if(project.collaborators.map(c => c.id).includes(user.id)) return;\r\n        project.collaborators = [...project.collaborators, user];\r\n    }\r\n\r\n    return(<section className={'page-root collaborative-tab'}>\r\n        <h1 className={'view'}>Collaborative Modeling</h1>\r\n        <div className={'p-1 w-100  d-flex'} style={{borderRadius: 'var(--radius)'}}>\r\n            <h5><i className=\"bi bi-person-video3\"></i> Editor</h5>\r\n            <label className={'ms-auto'}>{project.author.nickname}</label>\r\n        </div>\r\n        {project.collaborators.length > 0 && <div className={'mt-2 p-1 w-100 border'} style={{borderRadius: 'var(--radius'}}>\r\n            <h5><i className=\"bi bi-person-video3\"></i> Collaborators</h5>\r\n            <div className={'ms-auto'}>\r\n                {project.collaborators.map((c, index) => {\r\n                    return(<label className={'ms-1'} key={index}>{c.surname}</label>);\r\n                })}\r\n            </div>\r\n        </div>}\r\n        <input placeholder={'contributor email'} className={'input w-25 float-end'} defaultValue={email} onChange={e => setEmail(e.target.value)} />\r\n        <div>\r\n            {filteredEmails.map(e => <div key={e}>\r\n                <CommandBar className={'float-end'} style={{marginLeft: '5px'}}>\r\n                    {e}\r\n                    <Btn icon={'add'} action={() => addCollaborator(e)} tip={'Invite contributor'} />\r\n                </CommandBar>\r\n            </div>)}\r\n        </div>\r\n        <div className={'alert'}>\r\n            <i className=\"bi bi-exclamation-circle\"></i>\r\n            Important: After sending the invitation, save the project!\r\n        </div>\r\n    </section>);\r\n}\r\ninterface OwnProps {}\r\ninterface StateProps {project: LProject, users: LUser[]}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as FakeStateProps;\r\n    const user = LUser.fromPointer(DUser.current);\r\n    ret.project = user.project as LProject;\r\n    ret.users = LUser.fromPointer(state.users);\r\n    return ret;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {};\r\n    return ret;\r\n}\r\n\r\nexport const CollaborativeConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(CollaborativeComponent);\r\n\r\nexport const Collaborative = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <CollaborativeConnected {...{...props, children}} />;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}