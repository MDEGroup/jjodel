{"ast":null,"code":"import _slicedToArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _createForOfIteratorHelper from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/d/Programming/web/jodel-mde/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useEffect,useRef,useState}from\"react\";import{connect}from\"react-redux\";import\"./style.scss\";import{LGraphElement,LModel,SetFieldAction,DVoidEdge,DEdge,DEdgePoint,Constructors,Log,U,SetRootFieldAction}from\"../../joiner\";import ModellingIcon from\"../forEndUser/ModellingIcon\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ti=0;// tabindex counter\nfunction toolbarClick(item_dname,data,myDictValidator,node){switch(item_dname){case DVoidEdge.cname:case DEdge.cname:// no add edges through toolbar for now\nbreak;case DEdgePoint.cname:var ledge=node.edge;var dedge=ledge.__raw;var wedge=ledge;// if (!myDictValidator[item_dname]) return;\nvar longestSeg=undefined;// just because compiler does not know it is always found through the for loop\nvar longestIndex=0;var segms=ledge.segments.segments;// longestIndex = segms.length - 1;// i just put it at end because this edgepoint\nfor(;longestIndex<segms.length;longestIndex++){if(segms[longestIndex].isLongest){longestSeg=segms[longestIndex];break;}}// let index = edge.segments.all.findIndex((s: EdgeSegment) => s.isLongest);\nvar newmp=_objectSpread(_objectSpread({},longestSeg.start.pt.add(longestSeg.end.pt,true).divide(2)),{},{w:15,h:15,index:longestIndex});// @ts-ignore\nnewmp.x-=newmp.w/2;newmp.y-=newmp.h/2;newmp.id=Constructors.makeID();var subelements=_toConsumableArray(dedge.subElements);var prevNodeid=longestSeg.start.ge.id;var prevnodeindex=subelements.indexOf(prevNodeid);if(prevnodeindex===-1){if(prevNodeid===dedge.start)prevnodeindex=0;// first and last are not subelements\nelse if(prevNodeid===dedge.end)prevnodeindex=subelements.length;else Log.exDevv(\"edgepoint insert position not found\",{subelements:subelements,prevNodeid:prevNodeid,longestSeg:longestSeg,dedge:dedge,ledge:ledge});}else prevnodeindex+=1;var goodway=true;// not working// todo: keep his true branch and remove this when finished debug. false crashed for missing father on subelements, guess i need more delay??\nif(goodway)newmp.index=prevnodeindex;// delete (newmp as any).id;\nvar mp=_toConsumableArray(dedge.midPoints);mp.splice(longestIndex,0,newmp);wedge.midPoints=mp;//\nvar olddebug=_toConsumableArray(subelements);subelements.splice(prevnodeindex,0,newmp.id);console.log(\"injecting ep\",{prevnodeindex:prevnodeindex,newmp:newmp,prevNodeid:prevNodeid,longestSeg:longestSeg,old:olddebug,new:subelements,ledge:ledge,dedge:dedge});// this might break pointers too\nvar fixorder=function fixorder(){wedge.subElements=subelements;};if(!goodway)setTimeout(fixorder,1);// need to wait edgepoint creation\n// selectNode(newmp);\nbreak;default:if(!data||!myDictValidator)return;var item=item_dname.substring(1).toLowerCase();var d=data.addChild(item);try{var d2=d();if(myDictValidator[item_dname])select(d2);}catch(e){if(myDictValidator[item_dname])select(d);}break;}}var n_agonSides=10;//this shuld be in react.setState(), but the function handling it is outside a component, so i don't wanna rewrite it.\n// it should be fine, except for the input value being shared on different sidebar components, which might even be better.\nfunction getItems(data,myDictValidator,items,node){var reactNodes=[];// todo: does myDictValidator have any reason to exist? if something is invalid it should not make it on toolbar jsx generated list\nvar _iterator=_createForOfIteratorHelper(items),_step;try{var _loop=function _loop(){var item_dname=_step.value;if(item_dname[0]==\"_\"){var _data;item_dname=item_dname.substring(2);data=((_data=data)===null||_data===void 0?void 0:_data.father)||data;}var item=item_dname.substring(1).toLowerCase();reactNodes.push(/*#__PURE__*/_jsxs(\"div\",{className:'toolbar-item',tabIndex:ti,style:{cursor:\"pointer\"},onClick:function onClick(){return toolbarClick(item_dname,data,myDictValidator,node);},children:[/*#__PURE__*/_jsx(ModellingIcon,{name:item}),/*#__PURE__*/_jsx(\"span\",{className:'ms-1 my-auto text-capitalize',children:item})]},item_dname));};for(_iterator.s();!(_step=_iterator.n()).done;){_loop();}}catch(err){_iterator.e(err);}finally{_iterator.f();}return reactNodes;}function select(dl){var d=(dl===null||dl===void 0?void 0:dl.__raw)||dl;console.log(\"selecting\",{d:d,dl:dl,selector:\".Graph [data-dataid='\"+(d===null||d===void 0?void 0:d.id)+\"']\",$:$(\".Graph [data-dataid='\"+(d===null||d===void 0?void 0:d.id)+\"']\")});if(d&&d.id)setTimeout(function(){return $(\".Graph [data-dataid='\"+(d===null||d===void 0?void 0:d.id)+\"']\").trigger(\"click\");},10);return d;}function selectNode(d){if(d&&d.id)setTimeout(function(){return $(\".Graph [data-nodeid='\"+(d===null||d===void 0?void 0:d.id)+\"']\").trigger(\"click\");},10);return d;}function ToolBarComponent(props,state){var node=props.node;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),pinned=_useState2[0],setPinned=_useState2[1];var htmlref=useRef(null);useEffect(function(){if(!htmlref.current)return;var draggableOptions={cursor:'grabbing',axis:\"y\",opacity:0.0,distance:5,containment:'parent'// helper: 'clone'\n};$(htmlref.current).draggable(draggableOptions);},[htmlref.current]);if(!node)return null;var data=node.model?node.model:LModel.fromPointer(props.model);var isMetamodel=props.isMetamodel;var metamodel=props.metamodel;var downward={};var addChildren=function addChildren(items){return items?getItems(data,downward,_toConsumableArray(new Set(items)),node):[];};// downward[\"DModel\"] = [\"DPackage\"];\n// downward[\"DModel\"] = [\"DPackage\"];\ndownward[\"DPackage\"]=[\"DPackage\",\"DClass\",\"DEnumerator\"];downward[\"DClass\"]=[\"DAttribute\",\"DReference\",\"DOperation\"];downward[\"DEnumerator\"]=[\"DLiteral\"];downward[\"DOperation\"]=[\"DParameter\",\"DException\"];// nodes\ndownward[\"DEdge\"]=[\"DEdgePoint\"];downward[\"DVoidEdge\"]=[\"DEdgePoint\"];// for (let parentKey in downward) myDictValidator.set(parentKey, addChildren(\"package\"));\nvar upward={};for(var parentKey in downward){var vals=downward[parentKey];if(!vals)continue;var _iterator2=_createForOfIteratorHelper(vals),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _upward$child;var child=_step2.value;if(!upward[child])upward[child]=[];upward[child].push(parentKey);(_upward$child=upward[child]).push.apply(_upward$child,_toConsumableArray(downward[parentKey]||[]));}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}downward[\"DModel\"]=downward[\"DPackage\"];// exceptions:\nupward[\"DPackage\"]=[\"_pDPackage\"];//, \"DModel\"]; because from a package, i don't want to prompt the user to create a model in toolbar.\nupward[\"DEdgePoint\"]=[\"DEdgePoint\"];//, \"DEdge\", \"DVoidEdge\"]; because from a edgeNode, i don't want to prompt the user to create a edge in toolbar.\n// upward[\"DClass\"] = [\"_pDPackage\", \"DClass\", \"DEnumerator\"];\nvar content;// if (RuntimeAccessibleClass.extends(props.selected?.node?.className, DVoidEdge)) { }\nif(isMetamodel){var siblings=data?addChildren(upward[data.className]):[];if(node)siblings.push.apply(siblings,_toConsumableArray(addChildren(upward[node.className])));var subelements=data?addChildren(downward[data.className]):[];content=/*#__PURE__*/_jsxs(_Fragment,{children:[siblings.length>0&&[/*#__PURE__*/_jsx(\"b\",{className:'toolbar-section-label',children:\"Sibling\"}),siblings],siblings.length>0&&subelements.length>0&&/*#__PURE__*/_jsx(\"hr\",{className:'my-2'}),subelements.length>0&&[/*#__PURE__*/_jsx(\"b\",{className:'toolbar-section-label',children:\"Sublevel\"}),subelements]]});}else{var classes=metamodel===null||metamodel===void 0?void 0:metamodel.classes;var model=LModel.fromPointer(props.model);var lobj=data.className===\"DObject\"?data:undefined;var lfeat=data.className===\"DValue\"?data:undefined;var subleveloptions=[];if(lobj&&(!lobj.instanceof||lobj.partial))subleveloptions.push(/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-item feature\",tabIndex:ti,onClick:function onClick(){lobj.addValue();},children:\"+Feature\"},\"Feature\"));if(lfeat&&lfeat.values.length<lfeat.upperBound)subleveloptions.push(/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item value\",tabIndex:ti,onClick:function onClick(){SetFieldAction.new(lfeat.id,'value',undefined,'+=',false);},children:[/*#__PURE__*/_jsx(ModellingIcon,{name:'value'}),/*#__PURE__*/_jsx(\"span\",{className:'ms-1 my-auto text-capitalize',children:\"value\"})]},\"Value\"));if(node)subleveloptions.push.apply(subleveloptions,_toConsumableArray(addChildren(downward[node.className])));content=/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"b\",{className:'toolbar-section-label',style:{marginRight:\"1.5em\"/*to avoid overlap with pin*/},children:\"Root level\"}),classes===null||classes===void 0?void 0:classes.filter(function(lClass){return!lClass.abstract&&!lClass.interface;}).map(function(lClass,index){var dclass=lClass.__raw;return/*#__PURE__*/_jsxs(\"div\",{onMouseEnter:function onMouseEnter(e){return SetRootFieldAction.new('tooltip',lClass.annotations.map(function(a){return a.source;}).join(' '));},onMouseLeave:function onMouseLeave(e){return SetRootFieldAction.new('tooltip','');},className:\"toolbar-item LObject\",tabIndex:ti,onClick:function onClick(){return select(model.addObject({},lClass));},children:[dclass._state.icon?/*#__PURE__*/_jsx(ModellingIcon,{src:dclass._state.icon}):/*#__PURE__*/_jsx(ModellingIcon,{name:'object'}),/*#__PURE__*/_jsx(\"span\",{className:'ms-1 my-auto text-capitalize',children:U.stringMiddleCut(dclass.name,14)})]},\"LObject_\"+dclass.id);}),/*#__PURE__*/_jsxs(\"div\",{className:'toolbar-item',tabIndex:ti,onClick:function onClick(){return select(model.addObject({},null));},children:[/*#__PURE__*/_jsx(ModellingIcon,{name:'object'}),/*#__PURE__*/_jsx(\"span\",{className:'ms-1 my-auto text-capitalize',children:\"Object\"})]},\"RawObject\"),subleveloptions.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{className:'my-2'}),/*#__PURE__*/_jsx(\"b\",{className:'toolbar-section-label',children:\"Sublevel\"}),subleveloptions]})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-draggable\",ref:htmlref,style:{top:'35px',position:\"absolute\"}// refuses to focus without event...\n,onClick:function onClick(e){console.log(\"click focus\",{htmlref:htmlref});setTimeout(function(){if(htmlref.current)htmlref.current.children[0].focus();},1);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar mt-2 hoverable\"+(pinned?\" pinned\":''),tabIndex:0,children:[/*#__PURE__*/_jsx(\"div\",{className:\"drag-handle dark\"}),/*#__PURE__*/_jsx(\"i\",{className:\"content pin bi bi-pin-angle\"+(pinned?\"-fill\":''),onClick:function onClick(){return setPinned(!pinned);}}),/*#__PURE__*/_jsx(\"div\",{className:\"preview toolbar-section-label mb-0 mx-1\",children:\"Add\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content inline\",children:content})]})});}//* 23/11 versione giordano\nfunction mapStateToProps(state,ownProps){var _state$_lastSelected;var ret={};var nodeid=(_state$_lastSelected=state._lastSelected)===null||_state$_lastSelected===void 0?void 0:_state$_lastSelected.node;if(nodeid)ret.node=LGraphElement.fromPointer(nodeid);else ret.node=null;if(ownProps.metamodelId){ret.metamodel=LModel.fromPointer(ownProps.metamodelId);}return ret;}/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.selectedid = state._lastSelected;\r\n    ret.selected = ret.selectedid && {\r\n        node: LPointerTargetable.from(ret.selectedid.node, state) as LGraphElement,\r\n        view: LPointerTargetable.from(ret.selectedid.view, state) as LViewElement,\r\n        modelElement: ret.selectedid.modelElement ? LPointerTargetable.from(ret.selectedid.modelElement, state) : undefined\r\n    };\r\n    if (ownProps.metamodelId) { ret.metamodel = LModel.fromPointer(ownProps.metamodelId); }\r\n    return ret;\r\n}*/function mapDispatchToProps(dispatch){var ret={};return ret;}export var ToolBarConnected=connect(mapStateToProps,mapDispatchToProps)(ToolBarComponent);export var ToolBar=function ToolBar(props){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return/*#__PURE__*/_jsx(ToolBarConnected,_objectSpread({},_objectSpread(_objectSpread({},props),{},{children:children})));};export default ToolBar;","map":{"version":3,"names":["React","useEffect","useRef","useState","connect","LGraphElement","LModel","SetFieldAction","DVoidEdge","DEdge","DEdgePoint","Constructors","Log","U","SetRootFieldAction","ModellingIcon","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ti","toolbarClick","item_dname","data","myDictValidator","node","cname","ledge","edge","dedge","__raw","wedge","longestSeg","undefined","longestIndex","segms","segments","length","isLongest","newmp","_objectSpread","start","pt","add","end","divide","w","h","index","x","y","id","makeID","subelements","_toConsumableArray","subElements","prevNodeid","ge","prevnodeindex","indexOf","exDevv","goodway","mp","midPoints","splice","olddebug","console","log","old","new","fixorder","setTimeout","item","substring","toLowerCase","d","addChild","d2","select","e","n_agonSides","getItems","items","reactNodes","_iterator","_createForOfIteratorHelper","_step","_loop","value","_data","father","push","className","tabIndex","style","cursor","onClick","children","name","s","n","done","err","f","dl","selector","$","trigger","selectNode","ToolBarComponent","props","state","_useState","_useState2","_slicedToArray","pinned","setPinned","htmlref","current","draggableOptions","axis","opacity","distance","containment","draggable","model","fromPointer","isMetamodel","metamodel","downward","addChildren","Set","upward","parentKey","vals","_iterator2","_step2","_upward$child","child","apply","content","siblings","classes","lobj","lfeat","subleveloptions","instanceof","partial","addValue","values","upperBound","marginRight","filter","lClass","abstract","interface","map","dclass","onMouseEnter","annotations","a","source","join","onMouseLeave","addObject","_state","icon","src","stringMiddleCut","ref","top","position","focus","mapStateToProps","ownProps","_state$_lastSelected","ret","nodeid","_lastSelected","metamodelId","mapDispatchToProps","dispatch","ToolBarConnected","ToolBar","arguments"],"sources":["C:/d/Programming/web/jodel-mde/src/components/toolbar/ToolBar.tsx"],"sourcesContent":["import React, {Dispatch, ReactElement, ReactNode, useEffect, useRef, useState} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport \"./style.scss\";\r\nimport {\r\n    DState,\r\n    DGraphElement,\r\n    Dictionary,\r\n    DModel,\r\n    DModelElement,\r\n    DNamedElement,\r\n    DObject,\r\n    DocString,\r\n    DPointerTargetable,\r\n    DViewElement,\r\n    LGraphElement,\r\n    LModel,\r\n    LModelElement,\r\n    LObject,\r\n    LValue,\r\n    LViewElement,\r\n    MyProxyHandler,\r\n    Pointer,\r\n    SetFieldAction,\r\n    RuntimeAccessibleClass,\r\n    DVoidEdge,\r\n    DEdge,\r\n    DEdgePoint,\r\n    EdgeSegment,\r\n    LVoidEdge,\r\n    Constructors,\r\n    WVoidEdge,\r\n    Log,\r\n    LEdgePoint, DUser,\r\n    U, LPointerTargetable, SetRootFieldAction, GObject, EMeasurableEvents, TRANSACTION\r\n} from \"../../joiner\";\r\nimport {InitialVertexSizeObj} from \"../../joiner/types\";\r\nimport ModellingIcon from \"../forEndUser/ModellingIcon\";\r\n\r\ninterface ThisState {}\r\n\r\nlet ti = 0; // tabindex counter\r\n\r\nfunction toolbarClick(item_dname: string, data: LModelElement|undefined, myDictValidator: Dictionary<DocString<\"DClassName\">, DocString<\"hisChildren\">[]>, node?:LGraphElement) {\r\n    switch(item_dname){\r\n        case DVoidEdge.cname:\r\n        case DEdge.cname:\r\n            // no add edges through toolbar for now\r\n            break;\r\n        case DEdgePoint.cname:\r\n            let ledge: LVoidEdge = (node as LEdgePoint | LVoidEdge).edge;\r\n            let dedge: DVoidEdge = ledge.__raw;\r\n            let wedge: WVoidEdge = ledge as any;\r\n            // if (!myDictValidator[item_dname]) return;\r\n            let longestSeg: EdgeSegment = undefined as any; // just because compiler does not know it is always found through the for loop\r\n            let longestIndex: number = 0;\r\n            let segms = ledge.segments.segments;\r\n            // longestIndex = segms.length - 1;// i just put it at end because this edgepoint\r\n            for (; longestIndex < segms.length; longestIndex++) if (segms[longestIndex].isLongest) { longestSeg = segms[longestIndex]; break;}\r\n            // let index = edge.segments.all.findIndex((s: EdgeSegment) => s.isLongest);\r\n            let newmp: InitialVertexSizeObj = {...(longestSeg.start.pt.add(longestSeg.end.pt, true).divide(2)), w: 15, h: 15, index:longestIndex};\r\n            // @ts-ignore\r\n            newmp.x -= newmp.w/2; newmp.y -= newmp.h/2;\r\n\r\n            newmp.id = Constructors.makeID();\r\n            let subelements = [...dedge.subElements];\r\n            let prevNodeid = longestSeg.start.ge.id;\r\n            let prevnodeindex = subelements.indexOf(prevNodeid);\r\n            if (prevnodeindex === -1) {\r\n                if (prevNodeid === dedge.start) prevnodeindex = 0; // first and last are not subelements\r\n                else if (prevNodeid === dedge.end) prevnodeindex = subelements.length;\r\n                else Log.exDevv(\"edgepoint insert position not found\", {subelements, prevNodeid, longestSeg, dedge, ledge});\r\n            } else prevnodeindex += 1;\r\n            let goodway = true; // not working// todo: keep his true branch and remove this when finished debug. false crashed for missing father on subelements, guess i need more delay??\r\n            if (goodway) newmp.index = prevnodeindex;\r\n            // delete (newmp as any).id;\r\n            let mp = [...dedge.midPoints];\r\n            mp.splice(longestIndex, 0, newmp);\r\n            wedge.midPoints = mp;\r\n            //\r\n            let olddebug = [...subelements];\r\n            subelements.splice(prevnodeindex, 0, newmp.id as string);\r\n            console.log(\"injecting ep\", {prevnodeindex, newmp, prevNodeid, longestSeg, old: olddebug, new: subelements, ledge, dedge});\r\n            // this might break pointers too\r\n            let fixorder = () => { wedge.subElements = subelements; }\r\n            if (!goodway) setTimeout( fixorder, 1); // need to wait edgepoint creation\r\n            // selectNode(newmp);\r\n            break;\r\n        default:\r\n            if (!data || !myDictValidator) return;\r\n            let item = item_dname.substring(1).toLowerCase();\r\n            let d = data.addChild(item);\r\n            try {\r\n                let d2 = (d as any)();\r\n                if (myDictValidator[item_dname]) select(d2);\r\n            } catch(e) {\r\n                if (myDictValidator[item_dname]) select(d);\r\n            }\r\n            break;\r\n    }\r\n}\r\nlet n_agonSides = 10; //this shuld be in react.setState(), but the function handling it is outside a component, so i don't wanna rewrite it.\r\n// it should be fine, except for the input value being shared on different sidebar components, which might even be better.\r\nfunction getItems(data: LModelElement|undefined, myDictValidator: Dictionary<DocString<\"DClassName\">, DocString<\"hisChildren\">[]>, items: DocString<\"D-ClassNames\">[], node?:LGraphElement): ReactNode[] {\r\n    const reactNodes: ReactNode[] = [];\r\n    // todo: does myDictValidator have any reason to exist? if something is invalid it should not make it on toolbar jsx generated list\r\n    for (let item_dname of items) {\r\n        if (item_dname[0]==\"_\") {\r\n            item_dname = item_dname.substring(2);\r\n            data = data?.father || data;\r\n        }\r\n        let item = item_dname.substring(1).toLowerCase();\r\n        reactNodes.push(<div className={'toolbar-item'} tabIndex={ti} style={{cursor:\"pointer\"}} key={item_dname} onClick={()=>toolbarClick(item_dname, data, myDictValidator, node)}>\r\n            <ModellingIcon name={item} />\r\n            <span className={'ms-1 my-auto text-capitalize'}>{item}</span>\r\n            {/*\r\n            <i className=\"bi bi-arrow-right-short hoverable\">\r\n                <ul className={\"content\"}>\r\n                    <li className={\"hoverable\"}>\r\n                        <span className={'ms-1 my-auto text-capitalize'}>Polygon</span>\r\n                        <i className=\"bi bi-arrow-right-short hoverable\">\r\n                            <ul className={\"content\"}>\r\n                                <span className={'ms-1 my-auto text-capitalize'}>Triangle</span>\r\n                                <span className={'ms-1 my-auto text-capitalize'}>Pentagon</span>\r\n                                <span className={'ms-1 my-auto text-capitalize'}>Hexagon</span>\r\n                                <span className={'ms-1 my-auto text-capitalize'}>Octagon</span>\r\n                                <span className={'ms-1 my-auto text-capitalize'}>\r\n                                    <input className={\"autosize-input\"} type={\"number\"} min={3} step={1}\r\n                                           value={n_agonSides} onClick{(evt) => { evt.stopPropagation()}}\r\n                                        onChange={(evt) => {\r\n                                            n_agonSides = +evt.target.value || 10;\r\n                                            if (n_agonSides<3) n_agonSides = 10;\r\n                                        }}\r\n                                    />-agon</span>\r\n                            </ul>\r\n                        </i>\r\n                    </li>\r\n                </ul>\r\n            </i>\r\n            <i className=\"bi bi-arrow-right-short hoverable\">\r\n                <ul className={\"content\"}>\r\n                    <li className={\"hoverable\"}>\r\n                        <span className={'ms-1 my-auto text-capitalize'}>Polygon</span>\r\n                    </li>\r\n                </ul>\r\n            </i>\r\n                */\r\n            }\r\n\r\n        </div>);\r\n    }\r\n    return reactNodes;\r\n}\r\nfunction select(dl: DModelElement | LModelElement): DModelElement {\r\n    let d: DModelElement = (dl as LModelElement)?.__raw || dl as DModelElement;\r\n    console.log(\"selecting\", {d, dl, selector:\".Graph [data-dataid='\"+d?.id+\"']\", $:$(\".Graph [data-dataid='\"+d?.id+\"']\")});\r\n    if (d && d.id) setTimeout(()=>$(\".Graph [data-dataid='\"+d?.id+\"']\").trigger(\"click\"), 10);\r\n    return d; }\r\nfunction selectNode(d: DGraphElement|{id: string}): any {\r\n    if (d && d.id) setTimeout(()=>$(\".Graph [data-nodeid='\"+d?.id+\"']\").trigger(\"click\"), 10);\r\n    return d; }\r\n\r\nfunction ToolBarComponent(props: AllProps, state: ThisState) {\r\n    const node = props.node;\r\n    let [pinned, setPinned] = useState(true);\r\n\r\n    const htmlref: React.MutableRefObject<null | HTMLDivElement>= useRef(null);\r\n    useEffect(() => {\r\n        if (!htmlref.current) return;\r\n        let draggableOptions = {\r\n            cursor: 'grabbing',\r\n            axis: \"y\",\r\n            opacity: 0.0,\r\n            distance: 5,\r\n            containment: 'parent',\r\n            // helper: 'clone'\r\n        };\r\n        ($(htmlref.current) as GObject<'JQuery + ui plugin'>).draggable(draggableOptions);\r\n    }, [htmlref.current]);\r\n\r\n    if (!node) return null;\r\n    const data: LModelElement|LModel = (node.model) ? node.model : LModel.fromPointer(props.model);\r\n\r\n    const isMetamodel: boolean = props.isMetamodel;\r\n    const metamodel: LModel|undefined = props.metamodel;\r\n    const downward: Dictionary<DocString<\"DClassName\">, DocString<\"hisChildren\">[]> = {}\r\n    const addChildren = (items: string[]) => items ? getItems(data, downward, [...new Set(items)], node) : [];\r\n\r\n    // downward[\"DModel\"] = [\"DPackage\"];\r\n    // downward[\"DModel\"] = [\"DPackage\"];\r\n    downward[\"DPackage\"] = [\"DPackage\", \"DClass\", \"DEnumerator\"];\r\n    downward[\"DClass\"] = [\"DAttribute\", \"DReference\", \"DOperation\"];\r\n    downward[\"DEnumerator\"] = [\"DLiteral\"];\r\n    downward[\"DOperation\"] = [\"DParameter\", \"DException\"];\r\n\r\n\r\n    // nodes\r\n    downward[\"DEdge\"] = [\"DEdgePoint\"]\r\n    downward[\"DVoidEdge\"] = [\"DEdgePoint\"]\r\n\r\n    // for (let parentKey in downward) myDictValidator.set(parentKey, addChildren(\"package\"));\r\n    let upward: Dictionary<DocString<\"DClassName (model)\">, DocString<\"hisDParents\">[]> = {};\r\n    for (let parentKey in downward){\r\n        let vals = downward[parentKey];\r\n        if(!vals) continue;\r\n        for (let child of vals) {\r\n            if (!upward[child]) upward[child] = [];\r\n            upward[child].push(parentKey)\r\n            upward[child].push(...(downward[parentKey]||[]));\r\n        }\r\n    }\r\n    downward[\"DModel\"] = downward[\"DPackage\"];\r\n\r\n    // exceptions:\r\n    upward[\"DPackage\"] = [\"_pDPackage\"]; //, \"DModel\"]; because from a package, i don't want to prompt the user to create a model in toolbar.\r\n    upward[\"DEdgePoint\"] = [\"DEdgePoint\"]; //, \"DEdge\", \"DVoidEdge\"]; because from a edgeNode, i don't want to prompt the user to create a edge in toolbar.\r\n    // upward[\"DClass\"] = [\"_pDPackage\", \"DClass\", \"DEnumerator\"];\r\n\r\n    let content: ReactNode;\r\n    // if (RuntimeAccessibleClass.extends(props.selected?.node?.className, DVoidEdge)) { }\r\n    if (isMetamodel) {\r\n        let siblings = data ? addChildren(upward[data.className]) : [];\r\n        if (node) siblings.push(...addChildren(upward[node.className]));\r\n        let subelements = data ? addChildren(downward[data.className]) : [];\r\n        content = (<>\r\n            {siblings.length > 0 &&\r\n                [<b className={'toolbar-section-label'}>Sibling</b>, siblings]\r\n            }\r\n            {siblings.length > 0 && subelements.length > 0 && <hr className={'my-2'} />}\r\n            {subelements.length > 0 &&\r\n                [<b className={'toolbar-section-label'}>Sublevel</b>, subelements]\r\n            }\r\n            {/*<hr className={'my-2'} />\r\n            <b className={'d-block text-center text-uppercase mb-1'}>Add shape</b>\r\n            {node && addChildren(downward[node.className])}\r\n            {/*<div className={\"toolbar-item annotation\"} tabIndex={ti} onClick={() => select(lModelElement.addChild(\"annotation\"))}>+annotation</div>* /}\r\n            <hr className={'my-2'} />\r\n            */}\r\n        </>);\r\n    }\r\n    else {\r\n        const classes = metamodel?.classes;\r\n        const model: LModel = LModel.fromPointer(props.model);\r\n        const lobj: LObject | undefined = data.className === \"DObject\" ? data as LObject : undefined;\r\n        const lfeat: LValue | undefined = data.className === \"DValue\" ? data as LValue : undefined;\r\n\r\n        let subleveloptions = [];\r\n        if (lobj && (!lobj.instanceof || lobj.partial)) subleveloptions.push(\r\n            <div key={\"Feature\"} className={\"toolbar-item feature\"} tabIndex={ti} onClick={() => { lobj.addValue(); }}>+Feature</div>\r\n        );\r\n        if (lfeat && lfeat.values.length < lfeat.upperBound) subleveloptions.push(\r\n            <div key={\"Value\"} className={\"toolbar-item value\"} tabIndex={ti} onClick={() => {SetFieldAction.new(lfeat.id, 'value' as any, undefined, '+=', false); }}>\r\n                <ModellingIcon name={'value'} />\r\n                <span className={'ms-1 my-auto text-capitalize'}>value</span>\r\n            </div>\r\n        );\r\n        if (node) subleveloptions.push(...addChildren(downward[node.className]));\r\n        content = (<>\r\n            <b className={'toolbar-section-label'} style={{marginRight:\"1.5em\"/*to avoid overlap with pin*/}}>Root level</b>\r\n            {classes?.filter((lClass) => {return !lClass.abstract && !lClass.interface}).map((lClass, index) => {\r\n                let dclass = lClass.__raw;\r\n                return <div\r\n                    onMouseEnter={e => SetRootFieldAction.new('tooltip', lClass.annotations.map(a => a.source).join(' '))}\r\n                    onMouseLeave={e => SetRootFieldAction.new('tooltip', '')}\r\n                    key={\"LObject_\"+dclass.id} className={\"toolbar-item LObject\"} tabIndex={ti} onClick={()=>select(model.addObject({}, lClass)) }>\r\n                    {dclass._state.icon ? <ModellingIcon src={dclass._state.icon}/> : <ModellingIcon name={'object'} />}\r\n                    <span className={'ms-1 my-auto text-capitalize'}>{U.stringMiddleCut(dclass.name, 14)}</span>\r\n                </div>\r\n            })}\r\n            <div key={\"RawObject\"} className={'toolbar-item'} tabIndex={ti} onClick={()=>select(model.addObject({}, null))}>\r\n                <ModellingIcon name={'object'} />\r\n                <span className={'ms-1 my-auto text-capitalize'}>Object</span>\r\n            </div>\r\n            { subleveloptions.length > 0 && <>\r\n                <hr className={'my-2'} />\r\n                <b className={'toolbar-section-label'}>Sublevel</b>\r\n                {subleveloptions}\r\n            </>}\r\n            {/*<hr className={'my-2'} />*/}\r\n        </>);\r\n    }\r\n\r\n    return (\r\n        <div className=\"toolbar-draggable\" ref={htmlref} style={{top: '35px', position:\"absolute\"}} // refuses to focus without event...\r\n             onClick={(e)=>{ console.log(\"click focus\", {htmlref}); setTimeout(()=> {\r\n                 if (htmlref.current) (htmlref.current as any).children[0].focus();\r\n             }, 1)}}>\r\n            <div className={\"toolbar mt-2 hoverable\" + (pinned ? \" pinned\" : '')} tabIndex={0}>\r\n                <div className={\"drag-handle dark\"}>\r\n                </div>\r\n\r\n                <i className={\"content pin bi bi-pin-angle\"+(pinned ? \"-fill\" : '')} onClick={()=> setPinned(!pinned) } />\r\n                <div className={\"preview toolbar-section-label mb-0 mx-1\"}>Add</div>\r\n                <div className={\"content inline\"}>{content}</div>\r\n            </div>\r\n        </div>);\r\n}\r\n\r\ninterface OwnProps {\r\n    model: Pointer<DModel, 1, 1, LModel>;\r\n    isMetamodel: boolean;\r\n    metamodelId?: Pointer<DModelElement, 1, 1, LModelElement>;\r\n}\r\n\r\ninterface StateProps {\r\n    node: LGraphElement|null;\r\n    metamodel?: LModel;\r\n}\r\ninterface DispatchProps {}\r\ntype AllProps = OwnProps & StateProps & DispatchProps;\r\n\r\n//* 23/11 versione giordano\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    const nodeid = state._lastSelected?.node;\r\n    if(nodeid) ret.node = LGraphElement.fromPointer(nodeid);\r\n    else ret.node = null;\r\n    if(ownProps.metamodelId) { ret.metamodel = LModel.fromPointer(ownProps.metamodelId); }\r\n    return ret;\r\n}\r\n/*\r\nfunction mapStateToProps(state: DState, ownProps: OwnProps): StateProps {\r\n    const ret: StateProps = {} as any;\r\n    ret.selectedid = state._lastSelected;\r\n    ret.selected = ret.selectedid && {\r\n        node: LPointerTargetable.from(ret.selectedid.node, state) as LGraphElement,\r\n        view: LPointerTargetable.from(ret.selectedid.view, state) as LViewElement,\r\n        modelElement: ret.selectedid.modelElement ? LPointerTargetable.from(ret.selectedid.modelElement, state) : undefined\r\n    };\r\n    if (ownProps.metamodelId) { ret.metamodel = LModel.fromPointer(ownProps.metamodelId); }\r\n    return ret;\r\n}*/\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch<any>): DispatchProps {\r\n    const ret: DispatchProps = {} as any;\r\n    return ret;\r\n}\r\n\r\n\r\nexport const ToolBarConnected = connect<StateProps, DispatchProps, OwnProps, DState>(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ToolBarComponent);\r\n\r\nexport const ToolBar = (props: OwnProps, children: (string | React.Component)[] = []): ReactElement => {\r\n    return <ToolBarConnected {...{...props, children}} />;\r\n}\r\nexport default ToolBar;\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}